<html lang="en"><head><meta content="text/html; charset=utf-8" http-equiv="Content-Type"><meta content="width=device-width, initial-scale=1" name="viewport"><meta content="@TheMatten I ended up dropping the type class entirely and put the encoders in the Site type
image.png 
https://github.com/srid/ema/pull/81/files
I don&#39;t like the PartialIsoEnumerableWithCtx type much; it probably can be simplified ...
-- | An Iso that is not necessarily surjective; as well as takes" name="description"><link href="https://funprog.srid.ca/hacker-log/composable-ema-sites.html" rel="canonical"><meta property="og:title" content="Composable Ema sites - Hacker Log"><meta property="og:site_name" content="Functional Programming Zulip Archive"><meta property="og:type" content="article"><meta property="og:article:section" content="Hacker Log"><meta property="og:article:modified_time" content="2022-03-10T23:21:49Z"><meta property="og:article:published_time" content="2022-02-13T01:00:29Z"><meta property="og:image" content="https://zulip-avatars.s3.amazonaws.com/13896/4429aa8b689608f24a4ad712843ce29862e330d2?version=3"><title>Composable Ema sites - Hacker Log</title><style type="text/css">
div#thesite
{
  font-family   : "Open Sans", sans-serif;
  font-size     : 1em !important;
  margin-top    : 1em;
  margin-bottom : 1em;
}

div#thesite h1
{
  font-family : "Roboto", sans-serif;
  line-height : 1.19999em;
}

div#thesite h2
{
  font-family : "Roboto", sans-serif;
  line-height : 1.19999em;
}

div#thesite h3
{
  font-family : "Roboto", sans-serif;
  line-height : 1.19999em;
}

div#thesite h4
{
  font-family : "Roboto", sans-serif;
  line-height : 1.19999em;
}

div#thesite h5
{
  font-family : "Roboto", sans-serif;
  line-height : 1.19999em;
}

div#thesite h6
{
  font-family : "Roboto", sans-serif;
  line-height : 1.19999em;
}

div#thesite .ui.breadcrumb.rib .section
{
  font-family : "Roboto", sans-serif;
  line-height : 1.19999em;
}

div#thesite .header
{
  font-family : "Roboto", sans-serif;
  line-height : 1.19999em;
}

div#thesite .as-header
{
  font-family : "Roboto", sans-serif;
  line-height : 1.19999em;
}

div#thesite code, pre, tt
{
  font-family : "SFMono-Regular","Menlo","Monaco","Consolas","Liberation Mono","Courier New", monospace;
}

div#thesite .ui.breadcrumb.rib
{
  margin-bottom : 1em;
}



div#thesite .ui.comments.messages .comment .metadata a
{
  color : #808080;
}

div#thesite .ui.comments.messages .comment a.avatar img
{
  height : auto;
}

div#thesite .subtle
{
  color : #808080;
}


div#thesite .messages pre
{
  font-size : 85%;
  overflow  : auto;
  max-width : 100%;
}

div#thesite .messages .message_embed
{
  border-left  : solid 3px #808080;
  padding-left : 0.69999em;
}

div#thesite .messages .message_inline_image img
{
  max-width     : 100%;
  margin-bottom : 1em;
}


/* Generated with Clay, http://fvisser.nl/clay */</style><link href="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.4.1/semantic.min.css" rel="stylesheet"><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.min.css" rel="stylesheet"><link href="https://fonts.googleapis.com/css?family=Open+Sans|Oswald&amp;display=swap" rel="stylesheet"><link href="https://fonts.googleapis.com/css?family=Roboto|Open+Sans&amp;display=swap" rel="stylesheet"></head><body><div id="thesite" class="ui text container"><div class="ui violet inverted top attached center aligned segment"><h1 class="ui huge header">Composable Ema sites - Hacker Log</h1></div><div class="ui attached segment"><div class="ui message"><p>Welcome to the Functional Programming Zulip Chat Archive. You can join the chat <a href="https://funprog.zulipchat.com">here</a>.</p></div><div class="ui breadcrumb rib"><a href="/" class="section">Home</a><i class="right angle icon divider"></i><a href="/hacker-log/" class="section">#Hacker Log</a><i class="right angle icon divider"></i><div class="active section">Composable Ema sites</div></div><div class="ui comments messages"><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/4429aa8b689608f24a4ad712843ce29862e330d2?version=3"></a><div class="content"><a class="author">Sridhar Ratnakumar</a><div class="metadata"><a href="#271719082" name="271719082"><div>2022-02-13 01:00:29</div></a></div><div class="text"><p><span class="user-mention" data-user-id="225127">@TheMatten</span> I ended up dropping the type class entirely and put the encoders in the <code>Site</code> type</p>
<p><a href="/user_uploads/13896/CoE1QACQrCZoOtJbZoy0ch-Y/image.png">image.png</a> </p>
<div class="message_inline_image"><a href="/user_uploads/13896/CoE1QACQrCZoOtJbZoy0ch-Y/image.png" title="image.png"><img src="/user_uploads/13896/CoE1QACQrCZoOtJbZoy0ch-Y/image.png"></a></div><p><a href="https://github.com/srid/ema/pull/81/files">https://github.com/srid/ema/pull/81/files</a></p>
<p>I don't like the <code>PartialIsoEnumerableWithCtx</code> type much; it probably can be simplified ...</p>
<div class="codehilite" data-code-language="Haskell"><pre><span></span><code><span class="c1">-- | An Iso that is not necessarily surjective; as well as takes an (unchanging)</span><span class="w"></span>
<span class="c1">-- context value.</span><span class="w"></span>
<span class="kr">type</span><span class="w"> </span><span class="kt">PartialIsoEnumerableWithCtx</span><span class="w"> </span><span class="n">ctx</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="p">(</span><span class="n">ctx</span><span class="w"> </span><span class="ow">-&gt;</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="ow">-&gt;</span><span class="w"> </span><span class="n">s</span><span class="p">,</span><span class="w"> </span><span class="n">ctx</span><span class="w"> </span><span class="ow">-&gt;</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="ow">-&gt;</span><span class="w"> </span><span class="kt">Maybe</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">ctx</span><span class="w"> </span><span class="ow">-&gt;</span><span class="w"> </span><span class="p">[</span><span class="n">a</span><span class="p">])</span><span class="w"></span>

<span class="nf">partialIsoIsLawfulForCtx</span><span class="w"> </span><span class="ow">::</span><span class="w"> </span><span class="kt">Eq</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="ow">=&gt;</span><span class="w"> </span><span class="kt">PartialIsoEnumerableWithCtx</span><span class="w"> </span><span class="n">ctx</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="ow">-&gt;</span><span class="w"> </span><span class="n">ctx</span><span class="w"> </span><span class="ow">-&gt;</span><span class="w"> </span><span class="kt">Bool</span><span class="w"></span>
<span class="nf">partialIsoIsLawfulForCtx</span><span class="w"> </span><span class="p">(</span><span class="n">to</span><span class="p">,</span><span class="w"> </span><span class="n">from</span><span class="p">,</span><span class="w"> </span><span class="n">getas</span><span class="p">)</span><span class="w"> </span><span class="n">ctx</span><span class="w"> </span><span class="ow">=</span><span class="w"></span>
<span class="w">  </span><span class="n">all</span><span class="w"> </span><span class="p">(</span><span class="nf">\</span><span class="n">a</span><span class="w"> </span><span class="ow">-&gt;</span><span class="w"> </span><span class="kr">let</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">ctx</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="kt">Just</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="n">ctx</span><span class="w"> </span><span class="n">s</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="n">getas</span><span class="w"> </span><span class="n">ctx</span><span class="p">)</span><span class="w"></span>

<span class="nf">defaultEnum</span><span class="w"> </span><span class="ow">::</span><span class="w"> </span><span class="p">(</span><span class="kt">Bounded</span><span class="w"> </span><span class="n">r</span><span class="p">,</span><span class="w"> </span><span class="kt">Enum</span><span class="w"> </span><span class="n">r</span><span class="p">)</span><span class="w"> </span><span class="ow">=&gt;</span><span class="w"> </span><span class="p">[</span><span class="n">r</span><span class="p">]</span><span class="w"></span>
<span class="nf">defaultEnum</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="p">[</span><span class="n">minBound</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="n">maxBound</span><span class="p">]</span><span class="w"></span>
</code></pre></div></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/4429aa8b689608f24a4ad712843ce29862e330d2?version=3"></a><div class="content"><a class="author">Sridhar Ratnakumar</a><div class="metadata"><a href="#271723154" name="271723154"><div>2022-02-13 02:51:15</div></a></div><div class="text"><p>Where I'm at ...</p>
<div class="codehilite" data-code-language="Haskell"><pre><span></span><code><span class="nf">concatSites</span><span class="w"> </span><span class="ow">::</span><span class="w"></span>
<span class="w">  </span><span class="n">forall</span><span class="w"> </span><span class="n">r1</span><span class="w"> </span><span class="n">r2</span><span class="w"> </span><span class="n">a1</span><span class="w"> </span><span class="n">a2</span><span class="o">.</span><span class="w"></span>
<span class="w">  </span><span class="kt">Site</span><span class="w"> </span><span class="n">r1</span><span class="w"> </span><span class="n">a1</span><span class="w"> </span><span class="ow">-&gt;</span><span class="w"> </span><span class="kt">Site</span><span class="w"> </span><span class="n">r2</span><span class="w"> </span><span class="n">a2</span><span class="w"> </span><span class="ow">-&gt;</span><span class="w"> </span><span class="kt">Site</span><span class="w"> </span><span class="p">(</span><span class="kt">Either</span><span class="w"> </span><span class="n">r1</span><span class="w"> </span><span class="n">r2</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="n">a1</span><span class="p">,</span><span class="w"> </span><span class="n">a2</span><span class="p">)</span><span class="w"></span>
<span class="nf">concatSites</span><span class="w"> </span><span class="n">site1</span><span class="w"> </span><span class="n">site2</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="n">undefined</span><span class="w"></span>
</code></pre></div>
<p>This is like Semigroup, but with polymorphic type indexes (r a).</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/4429aa8b689608f24a4ad712843ce29862e330d2?version=3"></a><div class="content"><a class="author">Sridhar Ratnakumar</a><div class="metadata"><a href="#271724475" name="271724475"><div>2022-02-13 03:29:08</div></a></div><div class="text"><p>Working version of that function!</p>
<p><a href="https://github.com/srid/ema/blob/1e7318e929e28c7444e488089ce52d87e1c187db/src/Ema/Site.hs#L78-L123">https://github.com/srid/ema/blob/1e7318e929e28c7444e488089ce52d87e1c187db/src/Ema/Site.hs#L78-L123</a></p>
<p>Gotta heavily refactor. Wonder if any of the existing ideas would be useful to simplify this definition and implementation?</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/4429aa8b689608f24a4ad712843ce29862e330d2?version=3"></a><div class="content"><a class="author">Sridhar Ratnakumar</a><div class="metadata"><a href="#271757893" name="271757893"><div>2022-02-13 18:10:01</div></a></div><div class="text"><p><a href="/user_uploads/13896/5qaMh_4abAghOH_vYvM_z0Jw/image.png">image.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/13896/5qaMh_4abAghOH_vYvM_z0Jw/image.png" title="image.png"><img src="/user_uploads/13896/5qaMh_4abAghOH_vYvM_z0Jw/image.png"></a></div></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/4429aa8b689608f24a4ad712843ce29862e330d2?version=3"></a><div class="content"><a class="author">Sridhar Ratnakumar</a><div class="metadata"><a href="#271777850" name="271777850"><div>2022-02-14 01:50:00</div></a></div><div class="text"><div class="codehilite" data-code-language="Haskell"><pre><span></span><code><span class="kr">class</span><span class="w"> </span><span class="kt">PartialIsoFunctor</span><span class="w"> </span><span class="p">(</span><span class="n">f</span><span class="w"> </span><span class="ow">::</span><span class="w"> </span><span class="kt">Type</span><span class="w"> </span><span class="ow">-&gt;</span><span class="w"> </span><span class="kt">Type</span><span class="w"> </span><span class="ow">-&gt;</span><span class="w"> </span><span class="kt">Type</span><span class="w"> </span><span class="ow">-&gt;</span><span class="w"> </span><span class="kt">Type</span><span class="p">)</span><span class="w"> </span><span class="kr">where</span><span class="w"></span>
<span class="w">  </span><span class="n">pimap</span><span class="w"> </span><span class="ow">::</span><span class="w"> </span><span class="kt">Iso</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="p">(</span><span class="kt">Maybe</span><span class="w"> </span><span class="n">a</span><span class="p">)</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="ow">-&gt;</span><span class="w"> </span><span class="kt">Iso'</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="n">d</span><span class="w"> </span><span class="ow">-&gt;</span><span class="w"> </span><span class="p">(</span><span class="n">y</span><span class="w"> </span><span class="ow">-&gt;</span><span class="w"> </span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="ow">-&gt;</span><span class="w"> </span><span class="n">f</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="ow">-&gt;</span><span class="w"> </span><span class="n">f</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="n">d</span><span class="w"></span>
</code></pre></div></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/4429aa8b689608f24a4ad712843ce29862e330d2?version=3"></a><div class="content"><a class="author">Sridhar Ratnakumar</a><div class="metadata"><a href="#272488984" name="272488984"><div>2022-02-19 03:27:24</div></a></div><div class="text"><p><a href="https://stackoverflow.com/q/71180949/55246">https://stackoverflow.com/q/71180949/55246</a></p>
<p>/cc <span class="user-mention" data-user-id="225127">@TheMatten</span></p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/4429aa8b689608f24a4ad712843ce29862e330d2?version=3"></a><div class="content"><a class="author">Sridhar Ratnakumar</a><div class="metadata"><a href="#272489537" name="272489537"><div>2022-02-19 03:37:47</div></a></div><div class="text"><p>I have got something that's <em>correct</em> ... BUT not very elegant at all. <a href="https://github.com/srid/ema/pull/81">https://github.com/srid/ema/pull/81</a></p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/20a04d823b7c3891d78ca5f6a188ccd0e4fc5e3d?version=2"></a><div class="content"><a class="author">TheMatten</a><div class="metadata"><a href="#272511564" name="272511564"><div>2022-02-19 11:11:30</div></a></div><div class="text"><p><span class="user-mention silent" data-user-id="251311">Sridhar Ratnakumar</span> <a href="#narrow/stream/286324-Hacker-Log/topic/Composable.20Ema.20sites/near/272488984">said</a>:</p>
<blockquote>
<p><a href="https://stackoverflow.com/q/71180949/55246">https://stackoverflow.com/q/71180949/55246</a></p>
<p>/cc <span class="user-mention silent" data-user-id="225127">TheMatten</span></p>
</blockquote>
<p>Haha, I'm literally working on such typeclass right now with <span class="user-mention" data-user-id="225136">@Asad Saeeduddin</span> <span aria-label="big smile" class="emoji emoji-1f604" role="img" title="big smile">:big_smile:</span> <br>
What you want is <code>Apply</code> part of <code>Applicative</code> on n-ary functor, with different monoidal categories used for every type parameter (<code>(Hask, (,), ())</code> and <code>(Hask, Either, Void)</code> instead of just <code>(Hask, (,), ())</code> used in <code>Applicative</code>)</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/4429aa8b689608f24a4ad712843ce29862e330d2?version=3"></a><div class="content"><a class="author">Sridhar Ratnakumar</a><div class="metadata"><a href="#272523693" name="272523693"><div>2022-02-19 15:12:46</div></a></div><div class="text"><p>What's <code>Hask</code> here?</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/4429aa8b689608f24a4ad712843ce29862e330d2?version=3"></a><div class="content"><a class="author">Sridhar Ratnakumar</a><div class="metadata"><a href="#272523735" name="272523735"><div>2022-02-19 15:13:52</div></a></div><div class="text"><p>Someone suggests <code>Data.Contravariant.Decidable</code> in Twitter: <a href="https://twitter.com/lucasdicioccio/status/1494902322861850625">https://twitter.com/lucasdicioccio/status/1494902322861850625</a></p>
<div class="inline-preview-twitter"><div class="twitter-tweet"><a href="https://twitter.com/lucasdicioccio/status/1494902322861850625"><img class="twitter-avatar" src="https://uploads.zulipusercontent.net/2aad34b6dccf4bc61bf1c6ed95d3030a66f4cb12/68747470733a2f2f7062732e7477696d672e636f6d2f70726f66696c655f696d616765732f313431313037323638343335323538353733302f6d3266344c4a6a325f6e6f726d616c2e6a7067"></a><p><a href="https://twitter.com/sridca">@sridca</a> Looks like Data.Contravariant.Decidable in hiding.</p><span>- lucas卞dicioccio (@lucasdicioccio)</span></div></div></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/20a04d823b7c3891d78ca5f6a188ccd0e4fc5e3d?version=2"></a><div class="content"><a class="author">TheMatten</a><div class="metadata"><a href="#272530257" name="272530257"><div>2022-02-19 17:17:20</div></a></div><div class="text"><p><span class="user-mention silent" data-user-id="251311">Sridhar Ratnakumar</span> <a href="#narrow/stream/286324-Hacker-Log/topic/Composable.20Ema.20sites/near/272523693">said</a>:</p>
<blockquote>
<p>What's <code>Hask</code> here?</p>
</blockquote>
<p>It's this hypothetical category of Haskell types and functions between them - doesn't really matter here, basically what I'm saying is that you can combine arbitrary types wrapped in your functor by tupling:</p>
<div class="codehilite" data-code-language="Haskell"><pre><span></span><code><span class="nf">merge</span><span class="w"> </span><span class="ow">::</span><span class="w"> </span><span class="n">f</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="ow">-&gt;</span><span class="w"> </span><span class="n">f</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="ow">-&gt;</span><span class="w"> </span><span class="n">f</span><span class="w"> </span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">)</span><span class="w"></span>
</code></pre></div>
<p>which is the same thing as</p>
<div class="codehilite" data-code-language="Haskell"><pre><span></span><code><span class="p">(</span><span class="o">&lt;*&gt;</span><span class="p">)</span><span class="w"> </span><span class="ow">::</span><span class="w"> </span><span class="n">f</span><span class="w"> </span><span class="p">(</span><span class="n">a</span><span class="w"> </span><span class="ow">-&gt;</span><span class="w"> </span><span class="n">b</span><span class="p">)</span><span class="w"> </span><span class="ow">-&gt;</span><span class="w"> </span><span class="n">f</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="ow">-&gt;</span><span class="w"> </span><span class="n">f</span><span class="w"> </span><span class="n">b</span><span class="w"></span>
</code></pre></div>
<p>just expressed differently</p>
<p>Similarly, in case of different functor you may combine these with sum:</p>
<div class="codehilite" data-code-language="Haskell"><pre><span></span><code><span class="nf">merge</span><span class="w"> </span><span class="ow">::</span><span class="w"> </span><span class="n">f</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="ow">-&gt;</span><span class="w"> </span><span class="n">f</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="ow">-&gt;</span><span class="w"> </span><span class="n">f</span><span class="w"> </span><span class="p">(</span><span class="kt">Either</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">b</span><span class="p">)</span><span class="w"></span>
</code></pre></div>
<p>which is suspiciously similar to</p>
<div class="codehilite" data-code-language="Haskell"><pre><span></span><code><span class="nf">choose</span><span class="w"> </span><span class="ow">::</span><span class="w"> </span><span class="p">(</span><span class="n">a</span><span class="w"> </span><span class="ow">-&gt;</span><span class="w"> </span><span class="kt">Either</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="n">c</span><span class="p">)</span><span class="w"> </span><span class="ow">-&gt;</span><span class="w"> </span><span class="n">f</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="ow">-&gt;</span><span class="w"> </span><span class="n">f</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="ow">-&gt;</span><span class="w"> </span><span class="n">f</span><span class="w"> </span><span class="n">a</span><span class="w"></span>
</code></pre></div>
<p>except that <code>Decidable</code> lives in "opposite" category of Hask, where functions go the opposite way (as in <code>Contravariant</code>)</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/20a04d823b7c3891d78ca5f6a188ccd0e4fc5e3d?version=2"></a><div class="content"><a class="author">TheMatten</a><div class="metadata"><a href="#272530377" name="272530377"><div>2022-02-19 17:19:48</div></a></div><div class="text"><p>All of this stuff doesn't really matter - instead, at some point you should be able to just <del>implement</del> derive some <code>MonoidalN</code> class on <code>Site</code> and specialize it's method to get <code>siteMerge</code></p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/4429aa8b689608f24a4ad712843ce29862e330d2?version=3"></a><div class="content"><a class="author">Sridhar Ratnakumar</a><div class="metadata"><a href="#273161700" name="273161700"><div>2022-02-24 23:00:05</div></a></div><div class="text"><p>Getting close to getting things working (composing Emanote, and extending it, as example). Mostly works, with some edges cases (how some routes are decoded in Emanote).</p>
<p>Overall, there is progress in composable sites in Ema ... BUT still not happy. I can't compose the model creator/updater process easily (I <em>can</em> compose it, but it is a lot of leg work). I suspect the use of LVar (TMVar) is getting in the way.</p>
<p>I should look into continuations. Can they be composed more easily?</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/4429aa8b689608f24a4ad712843ce29862e330d2?version=3"></a><div class="content"><a class="author">Sridhar Ratnakumar</a><div class="metadata"><a href="#273162824" name="273162824"><div>2022-02-24 23:10:40</div></a></div><div class="text"><p>Beneath the LVar abstraction, I already have something akin to continuations:</p>
<div class="codehilite" data-code-language="Haskell"><pre><span></span><code><span class="w">  </span><span class="n">m</span><span class="w"></span>
<span class="w">    </span><span class="p">(</span><span class="w"> </span><span class="kt">Change</span><span class="w"> </span><span class="n">source</span><span class="w"> </span><span class="n">tag</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="p">(</span><span class="kt">Change</span><span class="w"> </span><span class="n">source</span><span class="w"> </span><span class="n">tag</span><span class="w"> </span><span class="ow">-&gt;</span><span class="w"> </span><span class="n">m</span><span class="w"> </span><span class="nb">()</span><span class="p">)</span><span class="w"> </span><span class="ow">-&gt;</span><span class="w"></span>
<span class="w">      </span><span class="n">m</span><span class="w"> </span><span class="kt">Cmd</span><span class="w"></span>
<span class="w">    </span><span class="p">)</span><span class="w"></span>
</code></pre></div>
<p><a href="https://github.com/srid/unionmount/blob/c906d32c6e8d1b849e60680fd33d2af38fde309d/src/System/UnionMount.hs#L164-L168">https://github.com/srid/unionmount/blob/c906d32c6e8d1b849e60680fd33d2af38fde309d/src/System/UnionMount.hs#L164-L168</a></p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/4429aa8b689608f24a4ad712843ce29862e330d2?version=3"></a><div class="content"><a class="author">Sridhar Ratnakumar</a><div class="metadata"><a href="#273162885" name="273162885"><div>2022-02-24 23:11:13</div></a></div><div class="text"><p><code>m (initialValue, functionThatWillInformOfNewValues)</code></p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/4429aa8b689608f24a4ad712843ce29862e330d2?version=3"></a><div class="content"><a class="author">Sridhar Ratnakumar</a><div class="metadata"><a href="#273165156" name="273165156"><div>2022-02-24 23:34:56</div></a></div><div class="text"><p>Alternatively I should think of Ema model updates as streams. Then it becomes a matter of composing streams.</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/4429aa8b689608f24a4ad712843ce29862e330d2?version=3"></a><div class="content"><a class="author">Sridhar Ratnakumar</a><div class="metadata"><a href="#273165186" name="273165186"><div>2022-02-24 23:35:12</div></a></div><div class="text"><p>Non-empty streams, more specifically (the initial value is readily available).</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/4429aa8b689608f24a4ad712843ce29862e330d2?version=3"></a><div class="content"><a class="author">Sridhar Ratnakumar</a><div class="metadata"><a href="#273170473" name="273170473"><div>2022-02-25 00:41:17</div></a></div><div class="text"><p>Composing callback-based updates using Applicative: <a href="/user_uploads/13896/M3wb6vWN5pCbApYSqkwhyXLo/image.png">image.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/13896/M3wb6vWN5pCbApYSqkwhyXLo/image.png" title="image.png"><img src="/user_uploads/13896/M3wb6vWN5pCbApYSqkwhyXLo/image.png"></a></div></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/4429aa8b689608f24a4ad712843ce29862e330d2?version=3"></a><div class="content"><a class="author">Sridhar Ratnakumar</a><div class="metadata"><a href="#274889663" name="274889663"><div>2022-03-10 20:18:00</div></a></div><div class="text"><p>I find myself going back to type class. Works well with generic composition.</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/4429aa8b689608f24a4ad712843ce29862e330d2?version=3"></a><div class="content"><a class="author">Sridhar Ratnakumar</a><div class="metadata"><a href="#274910233" name="274910233"><div>2022-03-10 23:21:30</div></a></div><div class="text"><p>Simplest site:</p>
<div class="codehilite" data-code-language="Haskell"><pre><span></span><code><span class="kr">data</span><span class="w"> </span><span class="kt">Route</span><span class="w"></span>
<span class="w">  </span><span class="ow">=</span><span class="w"> </span><span class="kt">Route_Index</span><span class="w"></span>
<span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="kt">Route_About</span><span class="w"></span>
<span class="w">  </span><span class="kr">deriving</span><span class="w"> </span><span class="n">stock</span><span class="w"> </span><span class="p">(</span><span class="kt">Show</span><span class="p">,</span><span class="w"> </span><span class="kt">Eq</span><span class="p">,</span><span class="w"> </span><span class="kt">GHC</span><span class="o">.</span><span class="kt">Generic</span><span class="p">)</span><span class="w"></span>
<span class="w">  </span><span class="kr">deriving</span><span class="w"> </span><span class="n">anyclass</span><span class="w"> </span><span class="p">(</span><span class="kt">Generic</span><span class="p">,</span><span class="w"> </span><span class="kt">HasDatatypeInfo</span><span class="p">,</span><span class="w"> </span><span class="kt">IsRoute</span><span class="p">,</span><span class="w"> </span><span class="kt">HasModel</span><span class="p">)</span><span class="w"></span>

<span class="nf">main</span><span class="w"> </span><span class="ow">::</span><span class="w"> </span><span class="kt">IO</span><span class="w"> </span><span class="nb">()</span><span class="w"></span>
<span class="nf">main</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="n">void</span><span class="w"> </span><span class="o">$</span><span class="w"> </span><span class="kt">Ema</span><span class="o">.</span><span class="n">runSite</span><span class="w"> </span><span class="o">@</span><span class="kt">Route</span><span class="w"> </span><span class="nb">()</span><span class="w"></span>

<span class="kr">instance</span><span class="w"> </span><span class="kt">RenderAsset</span><span class="w"> </span><span class="kt">Route</span><span class="w"> </span><span class="kr">where</span><span class="w"></span>
<span class="w">  </span><span class="n">renderAsset</span><span class="w"> </span><span class="n">enc</span><span class="w"> </span><span class="nb">()</span><span class="w"> </span><span class="n">r</span><span class="w"> </span><span class="ow">=</span><span class="w"></span>
<span class="w">    </span><span class="kt">Ema</span><span class="o">.</span><span class="kt">AssetGenerated</span><span class="w"> </span><span class="kt">Ema</span><span class="o">.</span><span class="kt">Html</span><span class="w"> </span><span class="o">$</span><span class="w"></span>
<span class="w">      </span><span class="n">tailwindLayout</span><span class="w"> </span><span class="p">(</span><span class="kt">H</span><span class="o">.</span><span class="n">title</span><span class="w"> </span><span class="s">"Basic site"</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="kt">H</span><span class="o">.</span><span class="n">base</span><span class="w"> </span><span class="o">!</span><span class="w"> </span><span class="kt">A</span><span class="o">.</span><span class="n">href</span><span class="w"> </span><span class="s">"/"</span><span class="p">)</span><span class="w"> </span><span class="o">$</span><span class="w"></span>
<span class="w">        </span><span class="kt">H</span><span class="o">.</span><span class="n">div</span><span class="w"> </span><span class="o">!</span><span class="w"> </span><span class="kt">A</span><span class="o">.</span><span class="n">class_</span><span class="w"> </span><span class="s">"container mx-auto"</span><span class="w"> </span><span class="o">$</span><span class="w"> </span><span class="kr">do</span><span class="w"></span>
<span class="w">          </span><span class="kt">H</span><span class="o">.</span><span class="n">div</span><span class="w"> </span><span class="o">!</span><span class="w"> </span><span class="kt">A</span><span class="o">.</span><span class="n">class_</span><span class="w"> </span><span class="s">"mt-8 p-2 text-center"</span><span class="w"> </span><span class="o">$</span><span class="w"> </span><span class="kr">do</span><span class="w"></span>
<span class="w">            </span><span class="kr">case</span><span class="w"> </span><span class="n">r</span><span class="w"> </span><span class="kr">of</span><span class="w"></span>
<span class="w">              </span><span class="kt">Route_Index</span><span class="w"> </span><span class="ow">-&gt;</span><span class="w"> </span><span class="kr">do</span><span class="w"></span>
<span class="w">                </span><span class="s">"You are on the index page. "</span><span class="w"></span>
<span class="w">                </span><span class="n">routeElem</span><span class="w"> </span><span class="kt">Route_About</span><span class="w"> </span><span class="s">"Go to About"</span><span class="w"></span>
<span class="w">              </span><span class="kt">Route_About</span><span class="w"> </span><span class="ow">-&gt;</span><span class="w"> </span><span class="kr">do</span><span class="w"></span>
<span class="w">                </span><span class="n">routeElem</span><span class="w"> </span><span class="kt">Route_Index</span><span class="w"> </span><span class="s">"Go to Index"</span><span class="w"></span>
<span class="w">                </span><span class="s">". You are on the about page. "</span><span class="w"></span>
<span class="w">    </span><span class="kr">where</span><span class="w"></span>
<span class="w">      </span><span class="n">routeElem</span><span class="w"> </span><span class="n">r'</span><span class="w"> </span><span class="n">w</span><span class="w"> </span><span class="ow">=</span><span class="w"></span>
<span class="w">        </span><span class="kt">H</span><span class="o">.</span><span class="n">a</span><span class="w"> </span><span class="o">!</span><span class="w"> </span><span class="kt">A</span><span class="o">.</span><span class="n">class_</span><span class="w"> </span><span class="s">"text-red-500 hover:underline"</span><span class="w"> </span><span class="o">!</span><span class="w"> </span><span class="n">routeHref</span><span class="w"> </span><span class="n">r'</span><span class="w"> </span><span class="o">$</span><span class="w"> </span><span class="n">w</span><span class="w"></span>
<span class="w">      </span><span class="n">routeHref</span><span class="w"> </span><span class="n">r'</span><span class="w"> </span><span class="ow">=</span><span class="w"></span>
<span class="w">        </span><span class="kt">A</span><span class="o">.</span><span class="n">href</span><span class="w"> </span><span class="p">(</span><span class="n">fromString</span><span class="w"> </span><span class="o">.</span><span class="w"> </span><span class="n">toString</span><span class="w"> </span><span class="o">$</span><span class="w"> </span><span class="kt">Ema</span><span class="o">.</span><span class="n">routeUrl</span><span class="w"> </span><span class="n">enc</span><span class="w"> </span><span class="nb">()</span><span class="w"> </span><span class="n">r'</span><span class="p">)</span><span class="w"></span>
</code></pre></div></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/4429aa8b689608f24a4ad712843ce29862e330d2?version=3"></a><div class="content"><a class="author">Sridhar Ratnakumar</a><div class="metadata"><a href="#274910254" name="274910254"><div>2022-03-10 23:21:49</div></a></div><div class="text"><p>Just route type and HTML; everything else is boilerplate-free</p></div></div></div></div></div><div class="ui vertical footer segment"><a href="https://github.com/srid/zulip-archive">Powered by Haskell</a> | Questions? Contact <a href="https://www.srid.ca">srid</a></div></div></body></html>