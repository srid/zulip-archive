<html lang="en"><head><meta content="text/html; charset=utf-8" http-equiv="Content-Type"><meta content="width=device-width, initial-scale=1" name="viewport"><meta content="What are some good/motivating/unexpected Generic examples?" name="description"><link href="https://funprog.srid.ca/haskell/generic-examples.html" rel="canonical"><meta property="og:title" content="Generic examples - Haskell"><meta property="og:site_name" content="Functional Programming Zulip Archive"><meta property="og:type" content="article"><meta property="og:article:section" content="Haskell"><meta property="og:article:modified_time" content="2020-01-31T09:20:57Z"><meta property="og:article:published_time" content="2020-01-26T11:15:42Z"><meta property="og:image" content="https://zulip-avatars.s3.amazonaws.com/13896/4d7e5bf37281d41829f7b8a95d15292ff274c327?x=x&amp;version=2"><title>Generic examples - Haskell</title><style type="text/css">
div#thesite
{
  font-family   : "Open Sans", sans-serif;
  font-size     : 1em !important;
  margin-top    : 1em;
  margin-bottom : 1em;
}

div#thesite h1
{
  font-family : "Roboto", sans-serif;
  line-height : 1.19999em;
}

div#thesite h2
{
  font-family : "Roboto", sans-serif;
  line-height : 1.19999em;
}

div#thesite h3
{
  font-family : "Roboto", sans-serif;
  line-height : 1.19999em;
}

div#thesite h4
{
  font-family : "Roboto", sans-serif;
  line-height : 1.19999em;
}

div#thesite h5
{
  font-family : "Roboto", sans-serif;
  line-height : 1.19999em;
}

div#thesite h6
{
  font-family : "Roboto", sans-serif;
  line-height : 1.19999em;
}

div#thesite .ui.breadcrumb.rib .section
{
  font-family : "Roboto", sans-serif;
  line-height : 1.19999em;
}

div#thesite .header
{
  font-family : "Roboto", sans-serif;
  line-height : 1.19999em;
}

div#thesite .as-header
{
  font-family : "Roboto", sans-serif;
  line-height : 1.19999em;
}

div#thesite code, pre, tt
{
  font-family : "SFMono-Regular","Menlo","Monaco","Consolas","Liberation Mono","Courier New", monospace;
}

div#thesite .ui.breadcrumb.rib
{
  margin-bottom : 1em;
}



div#thesite .ui.comments.messages .comment .metadata a
{
  color : #808080;
}

div#thesite .ui.comments.messages .comment a.avatar img
{
  height : auto;
}

div#thesite .subtle
{
  color : #808080;
}


div#thesite .messages pre
{
  font-size : 85%;
  overflow  : auto;
  max-width : 100%;
}

div#thesite .messages .message_embed
{
  border-left  : solid 3px #808080;
  padding-left : 0.69999em;
}

div#thesite .messages .message_inline_image img
{
  max-width     : 100%;
  margin-bottom : 1em;
}


/* Generated with Clay, http://fvisser.nl/clay */</style><link href="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.4.1/semantic.min.css" rel="stylesheet"><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.min.css" rel="stylesheet"><link href="https://fonts.googleapis.com/css?family=Open+Sans|Oswald&amp;display=swap" rel="stylesheet"><link href="https://fonts.googleapis.com/css?family=Roboto|Open+Sans&amp;display=swap" rel="stylesheet"></head><body><div id="thesite" class="ui text container"><div class="ui violet inverted top attached center aligned segment"><h1 class="ui huge header">Generic examples - Haskell</h1></div><div class="ui attached segment"><div class="ui message"><p>Welcome to the Functional Programming Zulip Chat Archive. You can join the chat <a href="https://funprog.zulipchat.com">here</a>.</p></div><div class="ui breadcrumb rib"><a href="/" class="section">Home</a><i class="right angle icon divider"></i><a href="/haskell/" class="section">#Haskell</a><i class="right angle icon divider"></i><div class="active section">Generic examples</div></div><div class="ui comments messages"><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/4d7e5bf37281d41829f7b8a95d15292ff274c327?x=x&amp;version=2"></a><div class="content"><a class="author">Vladimir Ciobanu</a><div class="metadata"><a href="#186617122" name="186617122"><div>2020-01-26 11:15:42</div></a></div><div class="text"><p>What are some good/motivating/unexpected <code>Generic</code> examples?</p></div></div></div><div class="comment"><a class="avatar"><img src="https://secure.gravatar.com/avatar/3d24a4100b3eab34d8ce3059d789c543?d=identicon&amp;version=1"></a><div class="content"><a class="author">Sandy Maguire</a><div class="metadata"><a href="#186628268" name="186628268"><div>2020-01-26 16:35:32</div></a></div><div class="text"><p>beam</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/20a04d823b7c3891d78ca5f6a188ccd0e4fc5e3d?x=x&amp;version=2"></a><div class="content"><a class="author">TheMatten</a><div class="metadata"><a href="#186628829" name="186628829"><div>2020-01-26 16:53:19</div></a></div><div class="text"><p>Generic church encodings <span aria-label="big smile" class="emoji emoji-1f604" role="img" title="big smile">:big_smile:</span></p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/20a04d823b7c3891d78ca5f6a188ccd0e4fc5e3d?x=x&amp;version=2"></a><div class="content"><a class="author">TheMatten</a><div class="metadata"><a href="#186628998" name="186628998"><div>2020-01-26 16:58:36</div></a></div><div class="text"><p>That's unexpected one <span aria-label="slight smile" class="emoji emoji-1f642" role="img" title="slight smile">:slight_smile:</span>  - I guess generic <code>Show</code>, <code>Read</code> or <code>ToJSON</code> instances could be considered motivating - they allow you to get rid of lot of boilerplate by treating datatypes uniformly</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/4d7e5bf37281d41829f7b8a95d15292ff274c327?x=x&amp;version=2"></a><div class="content"><a class="author">Vladimir Ciobanu</a><div class="metadata"><a href="#186636224" name="186636224"><div>2020-01-26 20:12:17</div></a></div><div class="text"><p>I mean, <code>Show</code> and <code>Read</code> would be interesting if GHC didn't already automatically derive them. I am probably asking for too much without even explaining the context: trying to do a short presentation for the junior devs at the office on Generics, so I wish I could find some good motivating example to use.</p>
<p>The current contender is <code>Eq</code> since it's easy to explain and implement, but then it's hard to motivate why since GHC already derives it. <code>ToJSON</code> might be a good example; I wonder how easy it is to implement.</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/4d7e5bf37281d41829f7b8a95d15292ff274c327?x=x&amp;version=2"></a><div class="content"><a class="author">Vladimir Ciobanu</a><div class="metadata"><a href="#186636263" name="186636263"><div>2020-01-26 20:13:42</div></a></div><div class="text"><p>I think most of them have already used <code>Generic</code>s in the sense that they derived it and reaped the benefits of <code>derive anyclass (...)</code>, but I don't think any of them wrote their own typeclass / instances using <code>Generic</code> so I thought an example might help.</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/20a04d823b7c3891d78ca5f6a188ccd0e4fc5e3d?x=x&amp;version=2"></a><div class="content"><a class="author">TheMatten</a><div class="metadata"><a href="#186636459" name="186636459"><div>2020-01-26 20:18:52</div></a></div><div class="text"><p>I did simplified <code>AsJSON</code> impl for similar purposes (it just didn't end up being used <span aria-label="slight smile" class="emoji emoji-1f642" role="img" title="slight smile">:slight_smile:</span>)<br>
I think that one is a good candidate, because it feels more real-world-like, works with both directions (to and from generic rep) and encoding of sums is a little bit more creative than just spitting out value corresponding to some constructor, while still simple enough</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/20a04d823b7c3891d78ca5f6a188ccd0e4fc5e3d?x=x&amp;version=2"></a><div class="content"><a class="author">TheMatten</a><div class="metadata"><a href="#186636635" name="186636635"><div>2020-01-26 20:24:02</div></a></div><div class="text"><p>(<code>AsJSON</code> as in custom class for going to and from <code>Aeson.Value</code>)</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/4d7e5bf37281d41829f7b8a95d15292ff274c327?x=x&amp;version=2"></a><div class="content"><a class="author">Vladimir Ciobanu</a><div class="metadata"><a href="#186636676" name="186636676"><div>2020-01-26 20:24:26</div></a></div><div class="text"><p>That sounds interesting, I'll have a stab at it and see how it ends up. Thanks!</p></div></div></div><div class="comment"><a class="avatar"><img src="https://secure.gravatar.com/avatar/520889f20a2c66a8f4bd5be6f37d2923?d=identicon&amp;version=1"></a><div class="content"><a class="author">Asad Saeeduddin</a><div class="metadata"><a href="#186641749" name="186641749"><div>2020-01-26 22:52:47</div></a></div><div class="text"><p>Reimplementing the derivations for <code>Eq</code>, <code>Show</code>, <code>Functor</code> etc. using generics would make for a pretty good blog post, I still have no idea how to do most of those</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/4d7e5bf37281d41829f7b8a95d15292ff274c327?x=x&amp;version=2"></a><div class="content"><a class="author">Vladimir Ciobanu</a><div class="metadata"><a href="#186641927" name="186641927"><div>2020-01-26 22:58:07</div></a></div><div class="text"><p>Eq is pretty trivial, but Functor might be rough. That's a good idea though!</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/89529ef093c72e16a5ce3ac00d88f354ccc08cf9?x=x&amp;version=2"></a><div class="content"><a class="author">Lysxia</a><div class="metadata"><a href="#186849639" name="186849639"><div>2020-01-29 01:58:59</div></a></div><div class="text"><p>GHC's stock deriving is not extensible though, as opposed to generics. You can take a generic implementation, which is just a function, and manually replace some of the cases, or even do "surgery" on your data types before deriving.</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/89529ef093c72e16a5ce3ac00d88f354ccc08cf9?x=x&amp;version=2"></a><div class="content"><a class="author">Lysxia</a><div class="metadata"><a href="#186849656" name="186849656"><div>2020-01-29 01:59:38</div></a></div><div class="text"><p>Monoid is another common example, that is not handled by stock deriving.</p></div></div></div><div class="comment"><a class="avatar"><img src="https://secure.gravatar.com/avatar/d3d2de116df80bc024b799e84dcdbc97?d=identicon&amp;version=1"></a><div class="content"><a class="author">gilmi</a><div class="metadata"><a href="#186958958" name="186958958"><div>2020-01-30 06:46:19</div></a></div><div class="text"><p>I'd really love to see an implementation of uniplate using Generic but I actually don't know if that's even possible</p></div></div></div><div class="comment"><a class="avatar"><img src="https://secure.gravatar.com/avatar/3d24a4100b3eab34d8ce3059d789c543?d=identicon&amp;version=1"></a><div class="content"><a class="author">Sandy Maguire</a><div class="metadata"><a href="#186958974" name="186958974"><div>2020-01-30 06:47:01</div></a></div><div class="text"><p>what do you use uniplate for?</p></div></div></div><div class="comment"><a class="avatar"><img src="https://secure.gravatar.com/avatar/3d24a4100b3eab34d8ce3059d789c543?d=identicon&amp;version=1"></a><div class="content"><a class="author">Sandy Maguire</a><div class="metadata"><a href="#186959045" name="186959045"><div>2020-01-30 06:48:55</div></a></div><div class="text"><p><a href="https://www.stackage.org/haddock/lts-14.22/uniplate-1.6.12/Data-Generics-Uniplate-Operations.html#t:Uniplate" target="_blank" title="https://www.stackage.org/haddock/lts-14.22/uniplate-1.6.12/Data-Generics-Uniplate-Operations.html#t:Uniplate">https://www.stackage.org/haddock/lts-14.22/uniplate-1.6.12/Data-Generics-Uniplate-Operations.html#t:Uniplate</a> this doesn't look difficult to genericise</p></div></div></div><div class="comment"><a class="avatar"><img src="https://secure.gravatar.com/avatar/3d24a4100b3eab34d8ce3059d789c543?d=identicon&amp;version=1"></a><div class="content"><a class="author">Sandy Maguire</a><div class="metadata"><a href="#186959119" name="186959119"><div>2020-01-30 06:50:23</div></a></div><div class="text"><p>but also there are no instances for this thing, so i don't know if it's what you're talking about</p></div></div></div><div class="comment"><a class="avatar"><img src="https://secure.gravatar.com/avatar/d3d2de116df80bc024b799e84dcdbc97?d=identicon&amp;version=1"></a><div class="content"><a class="author">gilmi</a><div class="metadata"><a href="#186959326" name="186959326"><div>2020-01-30 06:56:08</div></a></div><div class="text"><p>Compilers. Things like transforming every element of a certain type or getting all of the elements of a certain type</p></div></div></div><div class="comment"><a class="avatar"><img src="https://secure.gravatar.com/avatar/d3d2de116df80bc024b799e84dcdbc97?d=identicon&amp;version=1"></a><div class="content"><a class="author">gilmi</a><div class="metadata"><a href="#186959331" name="186959331"><div>2020-01-30 06:56:37</div></a></div><div class="text"><p>I use the Data instances since it's the easiest</p></div></div></div><div class="comment"><a class="avatar"><img src="https://secure.gravatar.com/avatar/d3d2de116df80bc024b799e84dcdbc97?d=identicon&amp;version=1"></a><div class="content"><a class="author">gilmi</a><div class="metadata"><a href="#186959335" name="186959335"><div>2020-01-30 06:56:47</div></a></div><div class="text"><p>But also not so fast</p></div></div></div><div class="comment"><a class="avatar"><img src="https://secure.gravatar.com/avatar/d3d2de116df80bc024b799e84dcdbc97?d=identicon&amp;version=1"></a><div class="content"><a class="author">gilmi</a><div class="metadata"><a href="#186959351" name="186959351"><div>2020-01-30 06:57:24</div></a></div><div class="text"><p><a href="https://www.stackage.org/haddock/lts-14.22/uniplate-1.6.12/Data-Generics-Uniplate-Data.html" target="_blank" title="https://www.stackage.org/haddock/lts-14.22/uniplate-1.6.12/Data-Generics-Uniplate-Data.html">https://www.stackage.org/haddock/lts-14.22/uniplate-1.6.12/Data-Generics-Uniplate-Data.html</a></p></div></div></div><div class="comment"><a class="avatar"><img src="https://secure.gravatar.com/avatar/3d24a4100b3eab34d8ce3059d789c543?d=identicon&amp;version=1"></a><div class="content"><a class="author">Sandy Maguire</a><div class="metadata"><a href="#186959411" name="186959411"><div>2020-01-30 06:58:54</div></a></div><div class="text"><p>yeah you could definitely generate these generically</p></div></div></div><div class="comment"><a class="avatar"><img src="https://secure.gravatar.com/avatar/d3d2de116df80bc024b799e84dcdbc97?d=identicon&amp;version=1"></a><div class="content"><a class="author">gilmi</a><div class="metadata"><a href="#186959475" name="186959475"><div>2020-01-30 07:00:18</div></a></div><div class="text"><p>Are you familiar with resources that might help me understand how to implement this? I've read the chapter in your book and am currently slowing going through <a href="https://www.stackbuilders.com/tutorials/haskell/generics/" target="_blank" title="https://www.stackbuilders.com/tutorials/haskell/generics/">https://www.stackbuilders.com/tutorials/haskell/generics/</a></p></div></div></div><div class="comment"><a class="avatar"><img src="https://secure.gravatar.com/avatar/d3d2de116df80bc024b799e84dcdbc97?d=identicon&amp;version=1"></a><div class="content"><a class="author">gilmi</a><div class="metadata"><a href="#186959478" name="186959478"><div>2020-01-30 07:00:34</div></a></div><div class="text"><p>But this is really all I found on the topic</p></div></div></div><div class="comment"><a class="avatar"><img src="https://secure.gravatar.com/avatar/d3d2de116df80bc024b799e84dcdbc97?d=identicon&amp;version=1"></a><div class="content"><a class="author">gilmi</a><div class="metadata"><a href="#186959498" name="186959498"><div>2020-01-30 07:01:50</div></a></div><div class="text"><p>Specifically I'm unsure how to recurse through types and apply a  function to an element of a specific type</p></div></div></div><div class="comment"><a class="avatar"><img src="https://secure.gravatar.com/avatar/3d24a4100b3eab34d8ce3059d789c543?d=identicon&amp;version=1"></a><div class="content"><a class="author">Sandy Maguire</a><div class="metadata"><a href="#186959553" name="186959553"><div>2020-01-30 07:02:24</div></a></div><div class="text"><p>which specific type? something concrete? or like a recursive bit</p></div></div></div><div class="comment"><a class="avatar"><img src="https://secure.gravatar.com/avatar/d3d2de116df80bc024b799e84dcdbc97?d=identicon&amp;version=1"></a><div class="content"><a class="author">gilmi</a><div class="metadata"><a href="#186959559" name="186959559"><div>2020-01-30 07:02:36</div></a></div><div class="text"><p>Like have exactly the api and behavior of transform or transformBi</p></div></div></div><div class="comment"><a class="avatar"><img src="https://secure.gravatar.com/avatar/d3d2de116df80bc024b799e84dcdbc97?d=identicon&amp;version=1"></a><div class="content"><a class="author">gilmi</a><div class="metadata"><a href="#186959578" name="186959578"><div>2020-01-30 07:04:01</div></a></div><div class="text"><p>If I pass (Int -&gt; Int) to transformBi it will find all Ints in the type and transform them</p></div></div></div><div class="comment"><a class="avatar"><img src="https://secure.gravatar.com/avatar/d3d2de116df80bc024b799e84dcdbc97?d=identicon&amp;version=1"></a><div class="content"><a class="author">gilmi</a><div class="metadata"><a href="#186959621" name="186959621"><div>2020-01-30 07:04:19</div></a></div><div class="text"><p>Or through mutual recursion and stuff</p></div></div></div><div class="comment"><a class="avatar"><img src="https://secure.gravatar.com/avatar/3d24a4100b3eab34d8ce3059d789c543?d=identicon&amp;version=1"></a><div class="content"><a class="author">Sandy Maguire</a><div class="metadata"><a href="#186959626" name="186959626"><div>2020-01-30 07:04:34</div></a></div><div class="text"><p>you'd do something like this:</p>
<div class="codehilite"><pre><span></span><span class="kr">class</span> <span class="kt">GTransform</span> <span class="n">a</span> <span class="n">struct</span> <span class="kr">where</span>
  <span class="n">gtransform</span> <span class="ow">::</span> <span class="p">(</span><span class="n">a</span> <span class="ow">-&gt;</span> <span class="n">a</span><span class="p">)</span> <span class="ow">-&gt;</span> <span class="n">struct</span> <span class="n">x</span> <span class="ow">-&gt;</span> <span class="n">struct</span> <span class="n">x</span>
</pre></div>


<p>then do structural recursion over <code>struct</code>, and give instances for <code>instance {-# OVERLAPPING #-} a (K1 a)</code> that performs the function and <code>instance {-# OVERLAPPED #-} a (K1 b)</code> that doesn't</p></div></div></div><div class="comment"><a class="avatar"><img src="https://secure.gravatar.com/avatar/d3d2de116df80bc024b799e84dcdbc97?d=identicon&amp;version=1"></a><div class="content"><a class="author">gilmi</a><div class="metadata"><a href="#186959645" name="186959645"><div>2020-01-30 07:05:30</div></a></div><div class="text"><p>Oh</p></div></div></div><div class="comment"><a class="avatar"><img src="https://secure.gravatar.com/avatar/d3d2de116df80bc024b799e84dcdbc97?d=identicon&amp;version=1"></a><div class="content"><a class="author">gilmi</a><div class="metadata"><a href="#186959648" name="186959648"><div>2020-01-30 07:05:43</div></a></div><div class="text"><p>Ok I think I understand thank you!</p></div></div></div><div class="comment"><a class="avatar"><img src="https://secure.gravatar.com/avatar/3d24a4100b3eab34d8ce3059d789c543?d=identicon&amp;version=1"></a><div class="content"><a class="author">Sandy Maguire</a><div class="metadata"><a href="#186959687" name="186959687"><div>2020-01-30 07:06:04</div></a></div><div class="text"><p>and then</p>
<div class="codehilite"><pre><span></span><span class="nf">transform</span> <span class="ow">::</span> <span class="p">(</span><span class="kt">Generic</span> <span class="n">struct</span><span class="p">,</span> <span class="kt">GTransform</span> <span class="n">a</span> <span class="p">(</span><span class="kt">Rep</span> <span class="n">struct</span><span class="p">))</span> <span class="ow">=&gt;</span> <span class="p">(</span><span class="n">a</span> <span class="ow">-&gt;</span> <span class="n">a</span><span class="p">)</span> <span class="ow">-&gt;</span> <span class="n">struct</span> <span class="ow">-&gt;</span> <span class="n">struct</span>
<span class="nf">transform</span> <span class="n">f</span> <span class="ow">=</span> <span class="n">to</span> <span class="o">.</span> <span class="n">gtransform</span> <span class="n">f</span> <span class="o">.</span> <span class="n">from</span>
</pre></div></div></div></div><div class="comment"><a class="avatar"><img src="https://secure.gravatar.com/avatar/d3d2de116df80bc024b799e84dcdbc97?d=identicon&amp;version=1"></a><div class="content"><a class="author">gilmi</a><div class="metadata"><a href="#186959695" name="186959695"><div>2020-01-30 07:06:31</div></a></div><div class="text"><p>Very nice</p></div></div></div><div class="comment"><a class="avatar"><img src="https://secure.gravatar.com/avatar/3d24a4100b3eab34d8ce3059d789c543?d=identicon&amp;version=1"></a><div class="content"><a class="author">Sandy Maguire</a><div class="metadata"><a href="#186959704" name="186959704"><div>2020-01-30 07:07:03</div></a></div><div class="text"><p>(or you could use generics to derive the uniplate class directly)</p></div></div></div><div class="comment"><a class="avatar"><img src="https://secure.gravatar.com/avatar/d3d2de116df80bc024b799e84dcdbc97?d=identicon&amp;version=1"></a><div class="content"><a class="author">gilmi</a><div class="metadata"><a href="#186959715" name="186959715"><div>2020-01-30 07:07:55</div></a></div><div class="text"><p>Yeah that's also a good option</p></div></div></div><div class="comment"><a class="avatar"><img src="https://secure.gravatar.com/avatar/d3d2de116df80bc024b799e84dcdbc97?d=identicon&amp;version=1"></a><div class="content"><a class="author">gilmi</a><div class="metadata"><a href="#186959766" name="186959766"><div>2020-01-30 07:08:46</div></a></div><div class="text"><p>Thanks for the help!</p></div></div></div><div class="comment"><a class="avatar"><img src="https://secure.gravatar.com/avatar/d3d2de116df80bc024b799e84dcdbc97?d=identicon&amp;version=1"></a><div class="content"><a class="author">gilmi</a><div class="metadata"><a href="#186961594" name="186961594"><div>2020-01-30 07:55:04</div></a></div><div class="text"><p>Is overlapped a thing? I get unrecognized pragma warning</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/20a04d823b7c3891d78ca5f6a188ccd0e4fc5e3d?x=x&amp;version=2"></a><div class="content"><a class="author">TheMatten</a><div class="metadata"><a href="#186962140" name="186962140"><div>2020-01-30 08:04:37</div></a></div><div class="text"><p><span class="user-mention" data-user-id="251051">@gilmi</span> Just <code>overlapping</code> by itself should work</p></div></div></div><div class="comment"><a class="avatar"><img src="https://secure.gravatar.com/avatar/d3d2de116df80bc024b799e84dcdbc97?d=identicon&amp;version=1"></a><div class="content"><a class="author">gilmi</a><div class="metadata"><a href="#186962164" name="186962164"><div>2020-01-30 08:05:16</div></a></div><div class="text"><p>Thanks <span aria-label="+1" class="emoji emoji-1f44d" role="img" title="+1">:+1:</span></p></div></div></div><div class="comment"><a class="avatar"><img src="https://secure.gravatar.com/avatar/d3d2de116df80bc024b799e84dcdbc97?d=identicon&amp;version=1"></a><div class="content"><a class="author">gilmi</a><div class="metadata"><a href="#186962626" name="186962626"><div>2020-01-30 08:14:23</div></a></div><div class="text"><p>Ok I got transform to work and that's pretty awesome thanks for the help!</p></div></div></div><div class="comment"><a class="avatar"><img src="https://secure.gravatar.com/avatar/3d24a4100b3eab34d8ce3059d789c543?d=identicon&amp;version=1"></a><div class="content"><a class="author">Sandy Maguire</a><div class="metadata"><a href="#186968374" name="186968374"><div>2020-01-30 09:53:57</div></a></div><div class="text"><p>liberal usage of <code>INLINABLE</code> will make that puppy hella fast too</p></div></div></div><div class="comment"><a class="avatar"><img src="https://secure.gravatar.com/avatar/d3d2de116df80bc024b799e84dcdbc97?d=identicon&amp;version=1"></a><div class="content"><a class="author">gilmi</a><div class="metadata"><a href="#186971696" name="186971696"><div>2020-01-30 10:35:50</div></a></div><div class="text"><p>Will do</p></div></div></div><div class="comment"><a class="avatar"><img src="https://secure.gravatar.com/avatar/d3d2de116df80bc024b799e84dcdbc97?d=identicon&amp;version=1"></a><div class="content"><a class="author">gilmi</a><div class="metadata"><a href="#186971944" name="186971944"><div>2020-01-30 10:39:08</div></a></div><div class="text"><p>So this is what I got and I see very significant improvement over uniplate Data in my tiny benchmark<br>
<a href="https://gist.github.com/soupi/c9048ca0d53c8a3c67f7f9a217748003" target="_blank" title="https://gist.github.com/soupi/c9048ca0d53c8a3c67f7f9a217748003">https://gist.github.com/soupi/c9048ca0d53c8a3c67f7f9a217748003</a></p>
<div class="message_embed"><a class="message_embed_image" href="https://gist.github.com/soupi/c9048ca0d53c8a3c67f7f9a217748003" style="background-image: url(https://github.githubassets.com/images/modules/gists/gist-og-image.png)" target="_blank"></a><div class="data-container"><div class="message_embed_title"><a href="https://gist.github.com/soupi/c9048ca0d53c8a3c67f7f9a217748003" target="_blank" title="implementation of transform using generics">implementation of transform using generics</a></div><div class="message_embed_description">implementation of transform using generics. GitHub Gist: instantly share code, notes, and snippets.</div></div></div></div></div></div><div class="comment"><a class="avatar"><img src="https://secure.gravatar.com/avatar/d3d2de116df80bc024b799e84dcdbc97?d=identicon&amp;version=1"></a><div class="content"><a class="author">gilmi</a><div class="metadata"><a href="#186972068" name="186972068"><div>2020-01-30 10:40:37</div></a></div><div class="text"><p>Does that make sense? Also, how can I get away from defining the Expr Int instances manually, if I don't do that I get a no Generic instance for Int</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/20a04d823b7c3891d78ca5f6a188ccd0e4fc5e3d?x=x&amp;version=2"></a><div class="content"><a class="author">TheMatten</a><div class="metadata"><a href="#186972121" name="186972121"><div>2020-01-30 10:41:43</div></a></div><div class="text"><p><span class="user-mention" data-user-id="251051">@gilmi</span> You only want <code>overlapping</code>on <code>GTransform a (K1 _1 a)</code> case</p></div></div></div><div class="comment"><a class="avatar"><img src="https://secure.gravatar.com/avatar/3d24a4100b3eab34d8ce3059d789c543?d=identicon&amp;version=1"></a><div class="content"><a class="author">Sandy Maguire</a><div class="metadata"><a href="#186972219" name="186972219"><div>2020-01-30 10:42:34</div></a></div><div class="text"><p>yeah, seeing a perf improvement makes sense</p></div></div></div><div class="comment"><a class="avatar"><img src="https://secure.gravatar.com/avatar/3d24a4100b3eab34d8ce3059d789c543?d=identicon&amp;version=1"></a><div class="content"><a class="author">Sandy Maguire</a><div class="metadata"><a href="#186972269" name="186972269"><div>2020-01-30 10:43:13</div></a></div><div class="text"><p>if you look at the core representation i bet the generic transform is implemented as a <code>case</code> on the data structure that replaces it with the new value</p></div></div></div><div class="comment"><a class="avatar"><img src="https://secure.gravatar.com/avatar/3d24a4100b3eab34d8ce3059d789c543?d=identicon&amp;version=1"></a><div class="content"><a class="author">Sandy Maguire</a><div class="metadata"><a href="#186972283" name="186972283"><div>2020-01-30 10:43:25</div></a></div><div class="text"><p>versus <code>uniplate</code> which i would be surprised if it gets optimized away</p></div></div></div><div class="comment"><a class="avatar"><img src="https://secure.gravatar.com/avatar/3d24a4100b3eab34d8ce3059d789c543?d=identicon&amp;version=1"></a><div class="content"><a class="author">Sandy Maguire</a><div class="metadata"><a href="#186972370" name="186972370"><div>2020-01-30 10:44:11</div></a></div><div class="text"><p>but yeah, you <em>only</em> want this case to be oerlappying: <code>instance {-# OVERLAPPING #-} Transform a a =&gt; GTransform a (K1 _1 a) where</code></p></div></div></div><div class="comment"><a class="avatar"><img src="https://secure.gravatar.com/avatar/d3d2de116df80bc024b799e84dcdbc97?d=identicon&amp;version=1"></a><div class="content"><a class="author">gilmi</a><div class="metadata"><a href="#186972408" name="186972408"><div>2020-01-30 10:44:43</div></a></div><div class="text"><p>Ok cool, is that so I can't implement other instances?</p></div></div></div><div class="comment"><a class="avatar"><img src="https://secure.gravatar.com/avatar/3d24a4100b3eab34d8ce3059d789c543?d=identicon&amp;version=1"></a><div class="content"><a class="author">Sandy Maguire</a><div class="metadata"><a href="#186972453" name="186972453"><div>2020-01-30 10:45:18</div></a></div><div class="text"><p>well you want the <code>a a</code> case to overlap the <code>a b</code> case</p></div></div></div><div class="comment"><a class="avatar"><img src="https://secure.gravatar.com/avatar/d3d2de116df80bc024b799e84dcdbc97?d=identicon&amp;version=1"></a><div class="content"><a class="author">gilmi</a><div class="metadata"><a href="#186972465" name="186972465"><div>2020-01-30 10:45:31</div></a></div><div class="text"><p>Right</p></div></div></div><div class="comment"><a class="avatar"><img src="https://secure.gravatar.com/avatar/d3d2de116df80bc024b799e84dcdbc97?d=identicon&amp;version=1"></a><div class="content"><a class="author">gilmi</a><div class="metadata"><a href="#186972742" name="186972742"><div>2020-01-30 10:48:50</div></a></div><div class="text"><p>Thank you</p></div></div></div><div class="comment"><a class="avatar"><img src="https://secure.gravatar.com/avatar/d3d2de116df80bc024b799e84dcdbc97?d=identicon&amp;version=1"></a><div class="content"><a class="author">gilmi</a><div class="metadata"><a href="#186972797" name="186972797"><div>2020-01-30 10:49:45</div></a></div><div class="text"><p>Any ideas regarding the Int instances?</p></div></div></div><div class="comment"><a class="avatar"><img src="https://secure.gravatar.com/avatar/3d24a4100b3eab34d8ce3059d789c543?d=identicon&amp;version=1"></a><div class="content"><a class="author">Sandy Maguire</a><div class="metadata"><a href="#186973078" name="186973078"><div>2020-01-30 10:52:57</div></a></div><div class="text"><p>i dont think you want those int instances</p></div></div></div><div class="comment"><a class="avatar"><img src="https://secure.gravatar.com/avatar/3d24a4100b3eab34d8ce3059d789c543?d=identicon&amp;version=1"></a><div class="content"><a class="author">Sandy Maguire</a><div class="metadata"><a href="#186973092" name="186973092"><div>2020-01-30 10:53:08</div></a></div><div class="text"><p><code>transform</code> should be just a function, not a method</p></div></div></div><div class="comment"><a class="avatar"><img src="https://secure.gravatar.com/avatar/3d24a4100b3eab34d8ce3059d789c543?d=identicon&amp;version=1"></a><div class="content"><a class="author">Sandy Maguire</a><div class="metadata"><a href="#186973204" name="186973204"><div>2020-01-30 10:54:16</div></a></div><div class="text"><p>ah yeah, getting this thing recursive might be tricky</p></div></div></div><div class="comment"><a class="avatar"><img src="https://secure.gravatar.com/avatar/3d24a4100b3eab34d8ce3059d789c543?d=identicon&amp;version=1"></a><div class="content"><a class="author">Sandy Maguire</a><div class="metadata"><a href="#186973256" name="186973256"><div>2020-01-30 10:55:18</div></a></div><div class="text"><p>why do you bind <code>a</code> in the class of <code>Transform?</code></p></div></div></div><div class="comment"><a class="avatar"><img src="https://secure.gravatar.com/avatar/d3d2de116df80bc024b799e84dcdbc97?d=identicon&amp;version=1"></a><div class="content"><a class="author">gilmi</a><div class="metadata"><a href="#186973963" name="186973963"><div>2020-01-30 11:02:32</div></a></div><div class="text"><p>Can it typecheck without it when I want to apply the function?</p></div></div></div><div class="comment"><a class="avatar"><img src="https://secure.gravatar.com/avatar/d3d2de116df80bc024b799e84dcdbc97?d=identicon&amp;version=1"></a><div class="content"><a class="author">gilmi</a><div class="metadata"><a href="#186974082" name="186974082"><div>2020-01-30 11:03:52</div></a></div><div class="text"><p>Oh, I don't actually need that info there right?</p></div></div></div><div class="comment"><a class="avatar"><img src="https://secure.gravatar.com/avatar/3d24a4100b3eab34d8ce3059d789c543?d=identicon&amp;version=1"></a><div class="content"><a class="author">Sandy Maguire</a><div class="metadata"><a href="#186974685" name="186974685"><div>2020-01-30 11:11:13</div></a></div><div class="text"><p>right</p></div></div></div><div class="comment"><a class="avatar"><img src="https://secure.gravatar.com/avatar/3d24a4100b3eab34d8ce3059d789c543?d=identicon&amp;version=1"></a><div class="content"><a class="author">Sandy Maguire</a><div class="metadata"><a href="#186974697" name="186974697"><div>2020-01-30 11:11:21</div></a></div><div class="text"><p>or MAYBE you do!!!</p></div></div></div><div class="comment"><a class="avatar"><img src="https://secure.gravatar.com/avatar/3d24a4100b3eab34d8ce3059d789c543?d=identicon&amp;version=1"></a><div class="content"><a class="author">Sandy Maguire</a><div class="metadata"><a href="#186974818" name="186974818"><div>2020-01-30 11:12:24</div></a></div><div class="text"><p>what semantics do you want here</p></div></div></div><div class="comment"><a class="avatar"><img src="https://secure.gravatar.com/avatar/3d24a4100b3eab34d8ce3059d789c543?d=identicon&amp;version=1"></a><div class="content"><a class="author">Sandy Maguire</a><div class="metadata"><a href="#186974846" name="186974846"><div>2020-01-30 11:12:45</div></a></div><div class="text"><p>if you are targeting a structure that is recursive in itself do you want to hit the leaves or not</p></div></div></div><div class="comment"><a class="avatar"><img src="https://secure.gravatar.com/avatar/d3d2de116df80bc024b799e84dcdbc97?d=identicon&amp;version=1"></a><div class="content"><a class="author">gilmi</a><div class="metadata"><a href="#186975561" name="186975561"><div>2020-01-30 11:23:20</div></a></div><div class="text"><p>I want to hit all occurrences of the type</p></div></div></div><div class="comment"><a class="avatar"><img src="https://secure.gravatar.com/avatar/d3d2de116df80bc024b799e84dcdbc97?d=identicon&amp;version=1"></a><div class="content"><a class="author">gilmi</a><div class="metadata"><a href="#186975642" name="186975642"><div>2020-01-30 11:24:26</div></a></div><div class="text"><p>Leaves and also with mutual recursion with other types</p></div></div></div><div class="comment"><a class="avatar"><img src="https://secure.gravatar.com/avatar/3d24a4100b3eab34d8ce3059d789c543?d=identicon&amp;version=1"></a><div class="content"><a class="author">Sandy Maguire</a><div class="metadata"><a href="#186975787" name="186975787"><div>2020-01-30 11:26:26</div></a></div><div class="text"><p>okay</p></div></div></div><div class="comment"><a class="avatar"><img src="https://secure.gravatar.com/avatar/3d24a4100b3eab34d8ce3059d789c543?d=identicon&amp;version=1"></a><div class="content"><a class="author">Sandy Maguire</a><div class="metadata"><a href="#186975795" name="186975795"><div>2020-01-30 11:26:32</div></a></div><div class="text"><p>so in that case i think you want transform to be a method</p></div></div></div><div class="comment"><a class="avatar"><img src="https://secure.gravatar.com/avatar/3d24a4100b3eab34d8ce3059d789c543?d=identicon&amp;version=1"></a><div class="content"><a class="author">Sandy Maguire</a><div class="metadata"><a href="#186975799" name="186975799"><div>2020-01-30 11:26:38</div></a></div><div class="text"><p>but with a universal <code>a</code></p></div></div></div><div class="comment"><a class="avatar"><img src="https://secure.gravatar.com/avatar/3d24a4100b3eab34d8ce3059d789c543?d=identicon&amp;version=1"></a><div class="content"><a class="author">Sandy Maguire</a><div class="metadata"><a href="#186975810" name="186975810"><div>2020-01-30 11:26:50</div></a></div><div class="text"><p>and then you give an overlappable <code>Generic</code> instance for it</p></div></div></div><div class="comment"><a class="avatar"><img src="https://secure.gravatar.com/avatar/3d24a4100b3eab34d8ce3059d789c543?d=identicon&amp;version=1"></a><div class="content"><a class="author">Sandy Maguire</a><div class="metadata"><a href="#186975817" name="186975817"><div>2020-01-30 11:27:00</div></a></div><div class="text"><p>and you give specific <code>Int</code> and other primitive instances</p></div></div></div><div class="comment"><a class="avatar"><img src="https://secure.gravatar.com/avatar/3d24a4100b3eab34d8ce3059d789c543?d=identicon&amp;version=1"></a><div class="content"><a class="author">Sandy Maguire</a><div class="metadata"><a href="#186975829" name="186975829"><div>2020-01-30 11:27:06</div></a></div><div class="text"><p>each of which ignores the function</p></div></div></div><div class="comment"><a class="avatar"><img src="https://secure.gravatar.com/avatar/d3d2de116df80bc024b799e84dcdbc97?d=identicon&amp;version=1"></a><div class="content"><a class="author">gilmi</a><div class="metadata"><a href="#186977447" name="186977447"><div>2020-01-30 11:52:02</div></a></div><div class="text"><p>But then for example <code>transform (+1) [1,2,3] == [1,2,3]</code> because you ignore the function right?</p></div></div></div><div class="comment"><a class="avatar"><img src="https://secure.gravatar.com/avatar/3d24a4100b3eab34d8ce3059d789c543?d=identicon&amp;version=1"></a><div class="content"><a class="author">Sandy Maguire</a><div class="metadata"><a href="#186977599" name="186977599"><div>2020-01-30 11:54:51</div></a></div><div class="text"><p>no</p></div></div></div><div class="comment"><a class="avatar"><img src="https://secure.gravatar.com/avatar/3d24a4100b3eab34d8ce3059d789c543?d=identicon&amp;version=1"></a><div class="content"><a class="author">Sandy Maguire</a><div class="metadata"><a href="#186977605" name="186977605"><div>2020-01-30 11:55:02</div></a></div><div class="text"><p>in the <code>a (K1 a)</code> instance you recurse, and then apply the function you have</p></div></div></div><div class="comment"><a class="avatar"><img src="https://secure.gravatar.com/avatar/3d24a4100b3eab34d8ce3059d789c543?d=identicon&amp;version=1"></a><div class="content"><a class="author">Sandy Maguire</a><div class="metadata"><a href="#186977611" name="186977611"><div>2020-01-30 11:55:09</div></a></div><div class="text"><p>so the recursion fails, and then you apply the function you hvae :)</p></div></div></div><div class="comment"><a class="avatar"><img src="https://secure.gravatar.com/avatar/d3d2de116df80bc024b799e84dcdbc97?d=identicon&amp;version=1"></a><div class="content"><a class="author">gilmi</a><div class="metadata"><a href="#186977636" name="186977636"><div>2020-01-30 11:55:55</div></a></div><div class="text"><p>Oh! I understand.</p></div></div></div><div class="comment"><a class="avatar"><img src="https://secure.gravatar.com/avatar/d3d2de116df80bc024b799e84dcdbc97?d=identicon&amp;version=1"></a><div class="content"><a class="author">gilmi</a><div class="metadata"><a href="#186977688" name="186977688"><div>2020-01-30 11:56:07</div></a></div><div class="text"><p>Thanks for all the help, I really appreciate it.</p></div></div></div><div class="comment"><a class="avatar"><img src="https://secure.gravatar.com/avatar/3d24a4100b3eab34d8ce3059d789c543?d=identicon&amp;version=1"></a><div class="content"><a class="author">Sandy Maguire</a><div class="metadata"><a href="#186977710" name="186977710"><div>2020-01-30 11:56:22</div></a></div><div class="text"><p>happy to share</p></div></div></div><div class="comment"><a class="avatar"><img src="https://secure.gravatar.com/avatar/d3d2de116df80bc024b799e84dcdbc97?d=identicon&amp;version=1"></a><div class="content"><a class="author">gilmi</a><div class="metadata"><a href="#186983641" name="186983641"><div>2020-01-30 13:08:14</div></a></div><div class="text"><p>I'm not exactly sure how to fix the issue here but I'm getting 'two instances involving out of scope types' error<br>
<a href="https://gist.github.com/soupi/c9048ca0d53c8a3c67f7f9a217748003" target="_blank" title="https://gist.github.com/soupi/c9048ca0d53c8a3c67f7f9a217748003">https://gist.github.com/soupi/c9048ca0d53c8a3c67f7f9a217748003</a><br>
What am I doing wrong?</p>
<div class="message_embed"><a class="message_embed_image" href="https://gist.github.com/soupi/c9048ca0d53c8a3c67f7f9a217748003" style="background-image: url(https://github.githubassets.com/images/modules/gists/gist-og-image.png)" target="_blank"></a><div class="data-container"><div class="message_embed_title"><a href="https://gist.github.com/soupi/c9048ca0d53c8a3c67f7f9a217748003" target="_blank" title="implementation of transform using generics">implementation of transform using generics</a></div><div class="message_embed_description">implementation of transform using generics. GitHub Gist: instantly share code, notes, and snippets.</div></div></div></div></div></div><div class="comment"><a class="avatar"><img src="https://secure.gravatar.com/avatar/d3d2de116df80bc024b799e84dcdbc97?d=identicon&amp;version=1"></a><div class="content"><a class="author">gilmi</a><div class="metadata"><a href="#186983819" name="186983819"><div>2020-01-30 13:10:12</div></a></div><div class="text"><p>Also had a problem trying to define the overlapping generic instance for Transform</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/89529ef093c72e16a5ce3ac00d88f354ccc08cf9?x=x&amp;version=2"></a><div class="content"><a class="author">Lysxia</a><div class="metadata"><a href="#186985121" name="186985121"><div>2020-01-30 13:23:10</div></a></div><div class="text"><p>I think the uniplate business this is also doable by reusing generic-lens: <a href="https://github.com/kcsongor/generic-lens/issues/103#issuecomment-570422982" target="_blank" title="https://github.com/kcsongor/generic-lens/issues/103#issuecomment-570422982">https://github.com/kcsongor/generic-lens/issues/103#issuecomment-570422982</a></p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/kcsongor/generic-lens/issues/103#issuecomment-570422982" style="background-image: url(https://avatars0.githubusercontent.com/u/313596?s=400&amp;v=4)" target="_blank"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/kcsongor/generic-lens/issues/103#issuecomment-570422982" target="_blank" title="types - recurse over same type? · Issue #103 · kcsongor/generic-lens">types - recurse over same type? · Issue #103 · kcsongor/generic-lens</a></div><div class="message_embed_description">Hi! First I&#39;d like to thank you for this super cool package! I was wondering why doesn&#39;t types recurse deeper when the Traversal focus has the same type as the &quot;big&quot; outer type. E...</div></div></div></div></div></div><div class="comment"><a class="avatar"><img src="https://secure.gravatar.com/avatar/d3d2de116df80bc024b799e84dcdbc97?d=identicon&amp;version=1"></a><div class="content"><a class="author">gilmi</a><div class="metadata"><a href="#186985702" name="186985702"><div>2020-01-30 13:30:07</div></a></div><div class="text"><p>I opened that issue, I remember having some trouble with generic-lens that I couldn't figure out how to implement transform and universe using it. I was under the impression that the identity traversal for the same type case was a deal breaker but maybe i was mistaken</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/89529ef093c72e16a5ce3ac00d88f354ccc08cf9?x=x&amp;version=2"></a><div class="content"><a class="author">Lysxia</a><div class="metadata"><a href="#186986992" name="186986992"><div>2020-01-30 13:46:00</div></a></div><div class="text"><p>I see. You're right something probably needs to be changed; my point was more that the necessary mechanisms are already there, so it should be possible to avoid reinventing them.</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/4d7e5bf37281d41829f7b8a95d15292ff274c327?x=x&amp;version=2"></a><div class="content"><a class="author">Vladimir Ciobanu</a><div class="metadata"><a href="#186987618" name="186987618"><div>2020-01-30 13:53:17</div></a></div><div class="text"><p>Is there a simpler solution to defining generic aeson instances for types with the same shape but different field names? Like my json is <code>{ "id": 1, ... }</code> but my type has a <code>nodeId :: Int, ...</code> field. I wish I could wrap the <code>Int</code> in some newtype and <code>derive via (JsonFieldName "id")</code> or something. I guess I could also do this with <code>generic-data-surgery</code> by removing and re-adding the field with the different name...?</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/4d7e5bf37281d41829f7b8a95d15292ff274c327?x=x&amp;version=2"></a><div class="content"><a class="author">Vladimir Ciobanu</a><div class="metadata"><a href="#186987630" name="186987630"><div>2020-01-30 13:53:27</div></a></div><div class="text"><p>I should probably have started a new thread.</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/89529ef093c72e16a5ce3ac00d88f354ccc08cf9?x=x&amp;version=2"></a><div class="content"><a class="author">Lysxia</a><div class="metadata"><a href="#186988444" name="186988444"><div>2020-01-30 14:01:27</div></a></div><div class="text"><p>There's something to rename fields in the options you pass to <code>genericParseJSON</code>/<code>genericToJSON</code></p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/4d7e5bf37281d41829f7b8a95d15292ff274c327?x=x&amp;version=2"></a><div class="content"><a class="author">Vladimir Ciobanu</a><div class="metadata"><a href="#186988821" name="186988821"><div>2020-01-30 14:04:14</div></a></div><div class="text"><p>Guess I could use that to write <code>JsonFieldName</code> myself.</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/4d7e5bf37281d41829f7b8a95d15292ff274c327?x=x&amp;version=2"></a><div class="content"><a class="author">Vladimir Ciobanu</a><div class="metadata"><a href="#186991028" name="186991028"><div>2020-01-30 14:24:22</div></a></div><div class="text"><p>... but then that function is just some <code>String -&gt; String</code> and I don't get any compile-time errors. :(</p>
<p>Would it be possible to do something like...</p>
<div class="codehilite"><pre><span></span><span class="kr">data</span> <span class="kt">T</span> <span class="ow">=</span> <span class="kt">T</span>
    <span class="p">{</span> <span class="n">tOne</span> <span class="ow">::</span> <span class="kt">String</span>
    <span class="p">,</span> <span class="n">tTwo</span> <span class="ow">::</span> <span class="kt">String</span>
    <span class="p">,</span> <span class="n">three</span> <span class="ow">::</span> <span class="kt">String</span>
    <span class="p">}</span>
    <span class="kr">deriving</span> <span class="p">(</span><span class="kt">Generic</span><span class="p">)</span>
    <span class="kr">deriving</span> <span class="kt">ToJSON</span> <span class="n">via</span> <span class="p">(</span><span class="kt">RenameFields</span> <span class="kt">&#39;[ &#39;( &quot;tOne&quot;, &quot;one&quot; ), &#39;( &quot;tTwo&quot;, &quot;two&quot; ) ]</span> <span class="kt">T</span><span class="p">)</span>
</pre></div></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/4d7e5bf37281d41829f7b8a95d15292ff274c327?x=x&amp;version=2"></a><div class="content"><a class="author">Vladimir Ciobanu</a><div class="metadata"><a href="#186991055" name="186991055"><div>2020-01-30 14:24:45</div></a></div><div class="text"><p>... which would result in an instance as if the type had the fields <code>one</code>, <code>two</code>, and <code>three</code>?</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/20a04d823b7c3891d78ca5f6a188ccd0e4fc5e3d?x=x&amp;version=2"></a><div class="content"><a class="author">TheMatten</a><div class="metadata"><a href="#186991288" name="186991288"><div>2020-01-30 14:26:48</div></a></div><div class="text"><p><span class="user-mention" data-user-id="250750">@Vladimir Ciobanu</span> You could possibly demote that list to value level and do <code>Data.List.lookup</code>, sticking with current name if replacement is not found</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/4d7e5bf37281d41829f7b8a95d15292ff274c327?x=x&amp;version=2"></a><div class="content"><a class="author">Vladimir Ciobanu</a><div class="metadata"><a href="#186991398" name="186991398"><div>2020-01-30 14:28:00</div></a></div><div class="text"><p>But I want a compile-time error if <code>tOne</code> is not a field for <code>T</code>.</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/4d7e5bf37281d41829f7b8a95d15292ff274c327?x=x&amp;version=2"></a><div class="content"><a class="author">Vladimir Ciobanu</a><div class="metadata"><a href="#186991491" name="186991491"><div>2020-01-30 14:28:37</div></a></div><div class="text"><p>Maybe even if <code>one</code> is already a field, or if I do <code>'[ '("tOne", "one"), '("tTwo", "one") ]</code> as well.</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/20a04d823b7c3891d78ca5f6a188ccd0e4fc5e3d?x=x&amp;version=2"></a><div class="content"><a class="author">TheMatten</a><div class="metadata"><a href="#186991692" name="186991692"><div>2020-01-30 14:30:35</div></a></div><div class="text"><p>Oh, actually - pass that list of replacements around in class that generates instance and give it some <code>KnownSymbol (FindReplacement sym replacements)</code> constraint, where <code>FindReplacement</code> is type family</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/20a04d823b7c3891d78ca5f6a188ccd0e4fc5e3d?x=x&amp;version=2"></a><div class="content"><a class="author">TheMatten</a><div class="metadata"><a href="#186992040" name="186992040"><div>2020-01-30 14:34:14</div></a></div><div class="text"><p>And you want to collect all field names maybe upfront - then put family that checks those lists as constraint on top</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/89529ef093c72e16a5ce3ac00d88f354ccc08cf9?x=x&amp;version=2"></a><div class="content"><a class="author">Lysxia</a><div class="metadata"><a href="#186997969" name="186997969"><div>2020-01-30 15:33:48</div></a></div><div class="text"><p><span class="user-mention" data-user-id="250750">@Vladimir Ciobanu</span> I don't think such a thing exists in a library yet, but you can do it.</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/89529ef093c72e16a5ce3ac00d88f354ccc08cf9?x=x&amp;version=2"></a><div class="content"><a class="author">Lysxia</a><div class="metadata"><a href="#186998053" name="186998053"><div>2020-01-30 15:34:25</div></a></div><div class="text"><p>The closest thing I know is this, but it doesn't check for redundancies: <br>
<a href="https://hackage.haskell.org/package/generic-data-0.7.0.0/docs/Generic-Data-Microsurgery.html#t:RenameFields" target="_blank" title="https://hackage.haskell.org/package/generic-data-0.7.0.0/docs/Generic-Data-Microsurgery.html#t:RenameFields">https://hackage.haskell.org/package/generic-data-0.7.0.0/docs/Generic-Data-Microsurgery.html#t:RenameFields</a></p></div></div></div><div class="comment"><a class="avatar"><img src="https://secure.gravatar.com/avatar/d3d2de116df80bc024b799e84dcdbc97?d=identicon&amp;version=1"></a><div class="content"><a class="author">gilmi</a><div class="metadata"><a href="#187039407" name="187039407"><div>2020-01-30 22:43:55</div></a></div><div class="text"><p>I did manage to get a generic version of transform to work, thanks everyone for the help!<br>
While it is faster than uniplate Data, I have a feeling it can be even faster.<br>
<span class="user-mention" data-user-id="251120">@Sandy Maguire</span> or anyone else, if you could take a look at my approach and tell me if I did anything stupid I'd greatly appreciate it. The implementation is at the bottom:</p>
<p><a href="https://gist.github.com/soupi/53351593af29acf58064aac6d6609e94" target="_blank" title="https://gist.github.com/soupi/53351593af29acf58064aac6d6609e94">https://gist.github.com/soupi/53351593af29acf58064aac6d6609e94</a></p>
<p>And benchmark results:</p>
<p><a href="https://gilmi.me/static/misc/generic-plate-results.html" target="_blank" title="https://gilmi.me/static/misc/generic-plate-results.html">https://gilmi.me/static/misc/generic-plate-results.html</a></p>
<div class="message_embed"><a class="message_embed_image" href="https://gist.github.com/soupi/53351593af29acf58064aac6d6609e94" style="background-image: url(https://github.githubassets.com/images/modules/gists/gist-og-image.png)" target="_blank"></a><div class="data-container"><div class="message_embed_title"><a href="https://gist.github.com/soupi/53351593af29acf58064aac6d6609e94" target="_blank" title="Uniplate.Data vs hand written Lens.Plated vs generic-lens">Uniplate.Data vs hand written Lens.Plated vs generic-lens</a></div><div class="message_embed_description">Uniplate.Data vs hand written Lens.Plated vs generic-lens - Plate.hs</div></div></div></div></div></div><div class="comment"><a class="avatar"><img src="https://secure.gravatar.com/avatar/3d24a4100b3eab34d8ce3059d789c543?d=identicon&amp;version=1"></a><div class="content"><a class="author">Sandy Maguire</a><div class="metadata"><a href="#187051840" name="187051840"><div>2020-01-31 02:20:28</div></a></div><div class="text"><p>nice! it would be interesting to turn on <code>-ddump-simpl -dsuppress-all</code> and look at why generics is faster</p></div></div></div><div class="comment"><a class="avatar"><img src="https://secure.gravatar.com/avatar/d3d2de116df80bc024b799e84dcdbc97?d=identicon&amp;version=1"></a><div class="content"><a class="author">gilmi</a><div class="metadata"><a href="#187062017" name="187062017"><div>2020-01-31 07:24:32</div></a></div><div class="text"><p>I need to learn how to read this but it looks like this:<br>
<a href="https://gist.github.com/soupi/3b84c2cb3bf81f9f629e3b563d7c9bd2" target="_blank" title="https://gist.github.com/soupi/3b84c2cb3bf81f9f629e3b563d7c9bd2">https://gist.github.com/soupi/3b84c2cb3bf81f9f629e3b563d7c9bd2</a></p>
<div class="message_embed"><a class="message_embed_image" href="https://gist.github.com/soupi/3b84c2cb3bf81f9f629e3b563d7c9bd2" style="background-image: url(https://github.githubassets.com/images/modules/gists/gist-og-image.png)" target="_blank"></a><div class="data-container"><div class="message_embed_title"><a href="https://gist.github.com/soupi/3b84c2cb3bf81f9f629e3b563d7c9bd2" target="_blank" title="Plate dump">Plate dump</a></div><div class="message_embed_description">Plate dump. GitHub Gist: instantly share code, notes, and snippets.</div></div></div></div></div></div><div class="comment"><a class="avatar"><img src="https://secure.gravatar.com/avatar/3d24a4100b3eab34d8ce3059d789c543?d=identicon&amp;version=1"></a><div class="content"><a class="author">Sandy Maguire</a><div class="metadata"><a href="#187062160" name="187062160"><div>2020-01-31 07:29:15</div></a></div><div class="text"><p>try again without the bench stuff</p></div></div></div><div class="comment"><a class="avatar"><img src="https://secure.gravatar.com/avatar/3d24a4100b3eab34d8ce3059d789c543?d=identicon&amp;version=1"></a><div class="content"><a class="author">Sandy Maguire</a><div class="metadata"><a href="#187062171" name="187062171"><div>2020-01-31 07:29:55</div></a></div><div class="text"><p>oh, maybe there isn't any? what hs file does this correspond to</p></div></div></div><div class="comment"><a class="avatar"><img src="https://secure.gravatar.com/avatar/d3d2de116df80bc024b799e84dcdbc97?d=identicon&amp;version=1"></a><div class="content"><a class="author">gilmi</a><div class="metadata"><a href="#187062174" name="187062174"><div>2020-01-31 07:30:01</div></a></div><div class="text"><p>I've removed those and uniplate as well. Only leaving one call to transform and the Expr because I didn't know if it might be relevant or not</p></div></div></div><div class="comment"><a class="avatar"><img src="https://secure.gravatar.com/avatar/d3d2de116df80bc024b799e84dcdbc97?d=identicon&amp;version=1"></a><div class="content"><a class="author">gilmi</a><div class="metadata"><a href="#187062235" name="187062235"><div>2020-01-31 07:31:13</div></a></div><div class="text"><p>So basically there's the definition of Expr, the function opts from the benchmark and the function check that runs one transform on a simple expression, and all of the transform code</p></div></div></div><div class="comment"><a class="avatar"><img src="https://secure.gravatar.com/avatar/d3d2de116df80bc024b799e84dcdbc97?d=identicon&amp;version=1"></a><div class="content"><a class="author">gilmi</a><div class="metadata"><a href="#187062245" name="187062245"><div>2020-01-31 07:31:56</div></a></div><div class="text"><p>I can upload that file if you like</p></div></div></div><div class="comment"><a class="avatar"><img src="https://secure.gravatar.com/avatar/3d24a4100b3eab34d8ce3059d789c543?d=identicon&amp;version=1"></a><div class="content"><a class="author">Sandy Maguire</a><div class="metadata"><a href="#187062289" name="187062289"><div>2020-01-31 07:32:08</div></a></div><div class="text"><p>yes please</p></div></div></div><div class="comment"><a class="avatar"><img src="https://secure.gravatar.com/avatar/d3d2de116df80bc024b799e84dcdbc97?d=identicon&amp;version=1"></a><div class="content"><a class="author">gilmi</a><div class="metadata"><a href="#187062381" name="187062381"><div>2020-01-31 07:34:29</div></a></div><div class="text"><p><a href="https://gist.github.com/soupi/ee85d03775c21ad2f9270062deeb1b80" target="_blank" title="https://gist.github.com/soupi/ee85d03775c21ad2f9270062deeb1b80">https://gist.github.com/soupi/ee85d03775c21ad2f9270062deeb1b80</a></p>
<div class="message_embed"><a class="message_embed_image" href="https://gist.github.com/soupi/ee85d03775c21ad2f9270062deeb1b80" style="background-image: url(https://github.githubassets.com/images/modules/gists/gist-og-image.png)" target="_blank"></a><div class="data-container"><div class="message_embed_title"><a href="https://gist.github.com/soupi/ee85d03775c21ad2f9270062deeb1b80" target="_blank" title="Plate.hs src">Plate.hs src</a></div><div class="message_embed_description">Plate.hs src. GitHub Gist: instantly share code, notes, and snippets.</div></div></div></div></div></div><div class="comment"><a class="avatar"><img src="https://secure.gravatar.com/avatar/3d24a4100b3eab34d8ce3059d789c543?d=identicon&amp;version=1"></a><div class="content"><a class="author">Sandy Maguire</a><div class="metadata"><a href="#187062404" name="187062404"><div>2020-01-31 07:35:33</div></a></div><div class="text"><p>get rid of the showing stuff also please</p></div></div></div><div class="comment"><a class="avatar"><img src="https://secure.gravatar.com/avatar/d3d2de116df80bc024b799e84dcdbc97?d=identicon&amp;version=1"></a><div class="content"><a class="author">gilmi</a><div class="metadata"><a href="#187062407" name="187062407"><div>2020-01-31 07:35:41</div></a></div><div class="text"><p>OK</p></div></div></div><div class="comment"><a class="avatar"><img src="https://secure.gravatar.com/avatar/3d24a4100b3eab34d8ce3059d789c543?d=identicon&amp;version=1"></a><div class="content"><a class="author">Sandy Maguire</a><div class="metadata"><a href="#187062408" name="187062408"><div>2020-01-31 07:35:44</div></a></div><div class="text"><p>no deriving, no showing</p></div></div></div><div class="comment"><a class="avatar"><img src="https://secure.gravatar.com/avatar/3d24a4100b3eab34d8ce3059d789c543?d=identicon&amp;version=1"></a><div class="content"><a class="author">Sandy Maguire</a><div class="metadata"><a href="#187062411" name="187062411"><div>2020-01-31 07:36:02</div></a></div><div class="text"><p>just<code> main = pure (transform opts) (Lit 1)</code></p></div></div></div><div class="comment"><a class="avatar"><img src="https://secure.gravatar.com/avatar/d3d2de116df80bc024b799e84dcdbc97?d=identicon&amp;version=1"></a><div class="content"><a class="author">gilmi</a><div class="metadata"><a href="#187062451" name="187062451"><div>2020-01-31 07:36:13</div></a></div><div class="text"><p>Should I get rid of the exprssion entirely or not?</p></div></div></div><div class="comment"><a class="avatar"><img src="https://secure.gravatar.com/avatar/3d24a4100b3eab34d8ce3059d789c543?d=identicon&amp;version=1"></a><div class="content"><a class="author">Sandy Maguire</a><div class="metadata"><a href="#187062470" name="187062470"><div>2020-01-31 07:37:06</div></a></div><div class="text"><p>i'd move the transform stuff into a separate module</p></div></div></div><div class="comment"><a class="avatar"><img src="https://secure.gravatar.com/avatar/3d24a4100b3eab34d8ce3059d789c543?d=identicon&amp;version=1"></a><div class="content"><a class="author">Sandy Maguire</a><div class="metadata"><a href="#187062476" name="187062476"><div>2020-01-31 07:37:19</div></a></div><div class="text"><p>define expr with only generic</p></div></div></div><div class="comment"><a class="avatar"><img src="https://secure.gravatar.com/avatar/3d24a4100b3eab34d8ce3059d789c543?d=identicon&amp;version=1"></a><div class="content"><a class="author">Sandy Maguire</a><div class="metadata"><a href="#187062477" name="187062477"><div>2020-01-31 07:37:22</div></a></div><div class="text"><p>define opts</p></div></div></div><div class="comment"><a class="avatar"><img src="https://secure.gravatar.com/avatar/3d24a4100b3eab34d8ce3059d789c543?d=identicon&amp;version=1"></a><div class="content"><a class="author">Sandy Maguire</a><div class="metadata"><a href="#187062480" name="187062480"><div>2020-01-31 07:37:31</div></a></div><div class="text"><p>and then <code>main = pure (transform opts) (Lit 1)</code></p></div></div></div><div class="comment"><a class="avatar"><img src="https://secure.gravatar.com/avatar/d3d2de116df80bc024b799e84dcdbc97?d=identicon&amp;version=1"></a><div class="content"><a class="author">gilmi</a><div class="metadata"><a href="#187062488" name="187062488"><div>2020-01-31 07:37:52</div></a></div><div class="text"><p>OK</p></div></div></div><div class="comment"><a class="avatar"><img src="https://secure.gravatar.com/avatar/3d24a4100b3eab34d8ce3059d789c543?d=identicon&amp;version=1"></a><div class="content"><a class="author">Sandy Maguire</a><div class="metadata"><a href="#187062489" name="187062489"><div>2020-01-31 07:38:00</div></a></div><div class="text"><p>right now that core contains code for all of the stuff you're deriving, plus for the generic transformations, plus for how to do the error messaging, etc</p></div></div></div><div class="comment"><a class="avatar"><img src="https://secure.gravatar.com/avatar/3d24a4100b3eab34d8ce3059d789c543?d=identicon&amp;version=1"></a><div class="content"><a class="author">Sandy Maguire</a><div class="metadata"><a href="#187062528" name="187062528"><div>2020-01-31 07:38:10</div></a></div><div class="text"><p>obfuscating the bit we want to look at, and i cbf to find it in that sprall</p></div></div></div><div class="comment"><a class="avatar"><img src="https://secure.gravatar.com/avatar/d3d2de116df80bc024b799e84dcdbc97?d=identicon&amp;version=1"></a><div class="content"><a class="author">gilmi</a><div class="metadata"><a href="#187062766" name="187062766"><div>2020-01-31 07:45:56</div></a></div><div class="text"><p>Yeah I understand I'll upload the new files in a couple of minutes</p></div></div></div><div class="comment"><a class="avatar"><img src="https://secure.gravatar.com/avatar/d3d2de116df80bc024b799e84dcdbc97?d=identicon&amp;version=1"></a><div class="content"><a class="author">gilmi</a><div class="metadata"><a href="#187063143" name="187063143"><div>2020-01-31 07:56:49</div></a></div><div class="text"><p><a href="https://gist.github.com/soupi/3b84c2cb3bf81f9f629e3b563d7c9bd2" target="_blank" title="https://gist.github.com/soupi/3b84c2cb3bf81f9f629e3b563d7c9bd2">https://gist.github.com/soupi/3b84c2cb3bf81f9f629e3b563d7c9bd2</a></p>
<div class="message_embed"><a class="message_embed_image" href="https://gist.github.com/soupi/3b84c2cb3bf81f9f629e3b563d7c9bd2" style="background-image: url(https://github.githubassets.com/images/modules/gists/gist-og-image.png)" target="_blank"></a><div class="data-container"><div class="message_embed_title"><a href="https://gist.github.com/soupi/3b84c2cb3bf81f9f629e3b563d7c9bd2" target="_blank" title="Plate dump">Plate dump</a></div><div class="message_embed_description">Plate dump. GitHub Gist: instantly share code, notes, and snippets.</div></div></div></div></div></div><div class="comment"><a class="avatar"><img src="https://secure.gravatar.com/avatar/d3d2de116df80bc024b799e84dcdbc97?d=identicon&amp;version=1"></a><div class="content"><a class="author">gilmi</a><div class="metadata"><a href="#187063149" name="187063149"><div>2020-01-31 07:57:08</div></a></div><div class="text"><p>Updated the file, below there's Compiling Main</p></div></div></div><div class="comment"><a class="avatar"><img src="https://secure.gravatar.com/avatar/d3d2de116df80bc024b799e84dcdbc97?d=identicon&amp;version=1"></a><div class="content"><a class="author">gilmi</a><div class="metadata"><a href="#187063156" name="187063156"><div>2020-01-31 07:57:25</div></a></div><div class="text"><p>Also I had to derive Generic</p></div></div></div><div class="comment"><a class="avatar"><img src="https://secure.gravatar.com/avatar/d3d2de116df80bc024b799e84dcdbc97?d=identicon&amp;version=1"></a><div class="content"><a class="author">gilmi</a><div class="metadata"><a href="#187063227" name="187063227"><div>2020-01-31 07:58:48</div></a></div><div class="text"><p>Also this doesn't look totally alien to me</p></div></div></div><div class="comment"><a class="avatar"><img src="https://secure.gravatar.com/avatar/3d24a4100b3eab34d8ce3059d789c543?d=identicon&amp;version=1"></a><div class="content"><a class="author">Sandy Maguire</a><div class="metadata"><a href="#187063309" name="187063309"><div>2020-01-31 07:59:18</div></a></div><div class="text"><p>:) looks like it was completely optimized away</p></div></div></div><div class="comment"><a class="avatar"><img src="https://secure.gravatar.com/avatar/3d24a4100b3eab34d8ce3059d789c543?d=identicon&amp;version=1"></a><div class="content"><a class="author">Sandy Maguire</a><div class="metadata"><a href="#187063354" name="187063354"><div>2020-01-31 07:59:52</div></a></div><div class="text"><p>ghc so smart</p></div></div></div><div class="comment"><a class="avatar"><img src="https://secure.gravatar.com/avatar/d3d2de116df80bc024b799e84dcdbc97?d=identicon&amp;version=1"></a><div class="content"><a class="author">gilmi</a><div class="metadata"><a href="#187063358" name="187063358"><div>2020-01-31 07:59:57</div></a></div><div class="text"><p>So basically this is the best we can get in your opinion?</p></div></div></div><div class="comment"><a class="avatar"><img src="https://secure.gravatar.com/avatar/3d24a4100b3eab34d8ce3059d789c543?d=identicon&amp;version=1"></a><div class="content"><a class="author">Sandy Maguire</a><div class="metadata"><a href="#187063413" name="187063413"><div>2020-01-31 08:00:04</div></a></div><div class="text"><p>hahah well it is doing zero work</p></div></div></div><div class="comment"><a class="avatar"><img src="https://secure.gravatar.com/avatar/3d24a4100b3eab34d8ce3059d789c543?d=identicon&amp;version=1"></a><div class="content"><a class="author">Sandy Maguire</a><div class="metadata"><a href="#187063426" name="187063426"><div>2020-01-31 08:00:10</div></a></div><div class="text"><p>so... hard to do better than that</p></div></div></div><div class="comment"><a class="avatar"><img src="https://secure.gravatar.com/avatar/d3d2de116df80bc024b799e84dcdbc97?d=identicon&amp;version=1"></a><div class="content"><a class="author">gilmi</a><div class="metadata"><a href="#187063458" name="187063458"><div>2020-01-31 08:00:37</div></a></div><div class="text"><p>:) Maybe I'll try a more complex expression?</p></div></div></div><div class="comment"><a class="avatar"><img src="https://secure.gravatar.com/avatar/3d24a4100b3eab34d8ce3059d789c543?d=identicon&amp;version=1"></a><div class="content"><a class="author">Sandy Maguire</a><div class="metadata"><a href="#187063591" name="187063591"><div>2020-01-31 08:02:39</div></a></div><div class="text"><p>i suspect it will also optimize away</p></div></div></div><div class="comment"><a class="avatar"><img src="https://secure.gravatar.com/avatar/d3d2de116df80bc024b799e84dcdbc97?d=identicon&amp;version=1"></a><div class="content"><a class="author">gilmi</a><div class="metadata"><a href="#187063595" name="187063595"><div>2020-01-31 08:02:44</div></a></div><div class="text"><p>Wait did it do this at compile time??</p></div></div></div><div class="comment"><a class="avatar"><img src="https://secure.gravatar.com/avatar/3d24a4100b3eab34d8ce3059d789c543?d=identicon&amp;version=1"></a><div class="content"><a class="author">Sandy Maguire</a><div class="metadata"><a href="#187063596" name="187063596"><div>2020-01-31 08:02:47</div></a></div><div class="text"><p>yeah!</p></div></div></div><div class="comment"><a class="avatar"><img src="https://secure.gravatar.com/avatar/d3d2de116df80bc024b799e84dcdbc97?d=identicon&amp;version=1"></a><div class="content"><a class="author">gilmi</a><div class="metadata"><a href="#187063598" name="187063598"><div>2020-01-31 08:02:55</div></a></div><div class="text"><p>Oh wow</p></div></div></div><div class="comment"><a class="avatar"><img src="https://secure.gravatar.com/avatar/3d24a4100b3eab34d8ce3059d789c543?d=identicon&amp;version=1"></a><div class="content"><a class="author">Sandy Maguire</a><div class="metadata"><a href="#187063606" name="187063606"><div>2020-01-31 08:03:15</div></a></div><div class="text"><p>i suspect any constant expr you put there will optimize away</p></div></div></div><div class="comment"><a class="avatar"><img src="https://secure.gravatar.com/avatar/3d24a4100b3eab34d8ce3059d789c543?d=identicon&amp;version=1"></a><div class="content"><a class="author">Sandy Maguire</a><div class="metadata"><a href="#187063612" name="187063612"><div>2020-01-31 08:03:29</div></a></div><div class="text"><p>try making one with a <code>NOINLINE</code> on it</p></div></div></div><div class="comment"><a class="avatar"><img src="https://secure.gravatar.com/avatar/d3d2de116df80bc024b799e84dcdbc97?d=identicon&amp;version=1"></a><div class="content"><a class="author">gilmi</a><div class="metadata"><a href="#187063678" name="187063678"><div>2020-01-31 08:04:33</div></a></div><div class="text"><p>I added a <code>read &lt;$&gt; getLine</code></p></div></div></div><div class="comment"><a class="avatar"><img src="https://secure.gravatar.com/avatar/d3d2de116df80bc024b799e84dcdbc97?d=identicon&amp;version=1"></a><div class="content"><a class="author">gilmi</a><div class="metadata"><a href="#187063710" name="187063710"><div>2020-01-31 08:05:32</div></a></div><div class="text"><p>Updated the files</p></div></div></div><div class="comment"><a class="avatar"><img src="https://secure.gravatar.com/avatar/3d24a4100b3eab34d8ce3059d789c543?d=identicon&amp;version=1"></a><div class="content"><a class="author">Sandy Maguire</a><div class="metadata"><a href="#187063779" name="187063779"><div>2020-01-31 08:06:38</div></a></div><div class="text"><p>actually try it without read</p></div></div></div><div class="comment"><a class="avatar"><img src="https://secure.gravatar.com/avatar/3d24a4100b3eab34d8ce3059d789c543?d=identicon&amp;version=1"></a><div class="content"><a class="author">Sandy Maguire</a><div class="metadata"><a href="#187063794" name="187063794"><div>2020-01-31 08:07:16</div></a></div><div class="text"><p>just:</p>
<div class="codehilite"><pre><span></span>foo :: Expr
foo = Neg $ Neg $ Lit 5
{-# NOINLINE foo #-}

main = do
  pure $ transform opts foo
</pre></div></div></div></div><div class="comment"><a class="avatar"><img src="https://secure.gravatar.com/avatar/d3d2de116df80bc024b799e84dcdbc97?d=identicon&amp;version=1"></a><div class="content"><a class="author">gilmi</a><div class="metadata"><a href="#187063798" name="187063798"><div>2020-01-31 08:07:25</div></a></div><div class="text"><p>Ok</p></div></div></div><div class="comment"><a class="avatar"><img src="https://secure.gravatar.com/avatar/3d24a4100b3eab34d8ce3059d789c543?d=identicon&amp;version=1"></a><div class="content"><a class="author">Sandy Maguire</a><div class="metadata"><a href="#187063799" name="187063799"><div>2020-01-31 08:07:26</div></a></div><div class="text"><p>noinline should prevent the const expr optimization</p></div></div></div><div class="comment"><a class="avatar"><img src="https://secure.gravatar.com/avatar/d3d2de116df80bc024b799e84dcdbc97?d=identicon&amp;version=1"></a><div class="content"><a class="author">gilmi</a><div class="metadata"><a href="#187063802" name="187063802"><div>2020-01-31 08:07:34</div></a></div><div class="text"><p>Ohh I understand</p></div></div></div><div class="comment"><a class="avatar"><img src="https://secure.gravatar.com/avatar/d3d2de116df80bc024b799e84dcdbc97?d=identicon&amp;version=1"></a><div class="content"><a class="author">gilmi</a><div class="metadata"><a href="#187063870" name="187063870"><div>2020-01-31 08:09:02</div></a></div><div class="text"><p>Updated</p></div></div></div><div class="comment"><a class="avatar"><img src="https://secure.gravatar.com/avatar/d3d2de116df80bc024b799e84dcdbc97?d=identicon&amp;version=1"></a><div class="content"><a class="author">gilmi</a><div class="metadata"><a href="#187063936" name="187063936"><div>2020-01-31 08:10:28</div></a></div><div class="text"><p>Well I can kinda read this but I'm not sure if this is the desired result</p></div></div></div><div class="comment"><a class="avatar"><img src="https://secure.gravatar.com/avatar/3d24a4100b3eab34d8ce3059d789c543?d=identicon&amp;version=1"></a><div class="content"><a class="author">Sandy Maguire</a><div class="metadata"><a href="#187063969" name="187063969"><div>2020-01-31 08:11:56</div></a></div><div class="text"><p>hmm the generics aren't optiizing away</p></div></div></div><div class="comment"><a class="avatar"><img src="https://secure.gravatar.com/avatar/3d24a4100b3eab34d8ce3059d789c543?d=identicon&amp;version=1"></a><div class="content"><a class="author">Sandy Maguire</a><div class="metadata"><a href="#187064041" name="187064041"><div>2020-01-31 08:13:23</div></a></div><div class="text"><p>oh that's probably to be expected</p></div></div></div><div class="comment"><a class="avatar"><img src="https://secure.gravatar.com/avatar/3d24a4100b3eab34d8ce3059d789c543?d=identicon&amp;version=1"></a><div class="content"><a class="author">Sandy Maguire</a><div class="metadata"><a href="#187064108" name="187064108"><div>2020-01-31 08:15:01</div></a></div><div class="text"><p>actually i'm not sure whats's going on here</p></div></div></div><div class="comment"><a class="avatar"><img src="https://secure.gravatar.com/avatar/3d24a4100b3eab34d8ce3059d789c543?d=identicon&amp;version=1"></a><div class="content"><a class="author">Sandy Maguire</a><div class="metadata"><a href="#187064116" name="187064116"><div>2020-01-31 08:15:05</div></a></div><div class="text"><p>it's been a while since i've looked at core</p></div></div></div><div class="comment"><a class="avatar"><img src="https://secure.gravatar.com/avatar/d3d2de116df80bc024b799e84dcdbc97?d=identicon&amp;version=1"></a><div class="content"><a class="author">gilmi</a><div class="metadata"><a href="#187064224" name="187064224"><div>2020-01-31 08:17:40</div></a></div><div class="text"><p>Can ghc look at a L1 (R1 ..) and go 'oh! That's actually Neg'?</p></div></div></div><div class="comment"><a class="avatar"><img src="https://secure.gravatar.com/avatar/d3d2de116df80bc024b799e84dcdbc97?d=identicon&amp;version=1"></a><div class="content"><a class="author">gilmi</a><div class="metadata"><a href="#187064929" name="187064929"><div>2020-01-31 08:31:11</div></a></div><div class="text"><p>I'll start reading the 'Optimizing Generics Is Easy!' paper, it looks relevant here.</p></div></div></div><div class="comment"><a class="avatar"><img src="https://secure.gravatar.com/avatar/d3d2de116df80bc024b799e84dcdbc97?d=identicon&amp;version=1"></a><div class="content"><a class="author">gilmi</a><div class="metadata"><a href="#187065248" name="187065248"><div>2020-01-31 08:37:29</div></a></div><div class="text"><p>With -O2 instead of -O it looks different</p></div></div></div><div class="comment"><a class="avatar"><img src="https://secure.gravatar.com/avatar/3d24a4100b3eab34d8ce3059d789c543?d=identicon&amp;version=1"></a><div class="content"><a class="author">Sandy Maguire</a><div class="metadata"><a href="#187066072" name="187066072"><div>2020-01-31 08:54:44</div></a></div><div class="text"><p>yeah?</p></div></div></div><div class="comment"><a class="avatar"><img src="https://secure.gravatar.com/avatar/3d24a4100b3eab34d8ce3059d789c543?d=identicon&amp;version=1"></a><div class="content"><a class="author">Sandy Maguire</a><div class="metadata"><a href="#187066083" name="187066083"><div>2020-01-31 08:54:53</div></a></div><div class="text"><p>do all of the L1s disappear?</p></div></div></div><div class="comment"><a class="avatar"><img src="https://secure.gravatar.com/avatar/d3d2de116df80bc024b799e84dcdbc97?d=identicon&amp;version=1"></a><div class="content"><a class="author">gilmi</a><div class="metadata"><a href="#187066331" name="187066331"><div>2020-01-31 08:59:48</div></a></div><div class="text"><p>I think they did</p></div></div></div><div class="comment"><a class="avatar"><img src="https://secure.gravatar.com/avatar/d3d2de116df80bc024b799e84dcdbc97?d=identicon&amp;version=1"></a><div class="content"><a class="author">gilmi</a><div class="metadata"><a href="#187066344" name="187066344"><div>2020-01-31 08:59:56</div></a></div><div class="text"><p>I updated the gist</p></div></div></div><div class="comment"><a class="avatar"><img src="https://secure.gravatar.com/avatar/d3d2de116df80bc024b799e84dcdbc97?d=identicon&amp;version=1"></a><div class="content"><a class="author">gilmi</a><div class="metadata"><a href="#187066402" name="187066402"><div>2020-01-31 09:00:24</div></a></div><div class="text"><p>I did try running the benchmark again with O2 and didn't see improvements though</p></div></div></div><div class="comment"><a class="avatar"><img src="https://secure.gravatar.com/avatar/3d24a4100b3eab34d8ce3059d789c543?d=identicon&amp;version=1"></a><div class="content"><a class="author">Sandy Maguire</a><div class="metadata"><a href="#187066519" name="187066519"><div>2020-01-31 09:03:08</div></a></div><div class="text"><p>it's getting fully optimized again</p></div></div></div><div class="comment"><a class="avatar"><img src="https://secure.gravatar.com/avatar/d3d2de116df80bc024b799e84dcdbc97?d=identicon&amp;version=1"></a><div class="content"><a class="author">gilmi</a><div class="metadata"><a href="#187066533" name="187066533"><div>2020-01-31 09:03:36</div></a></div><div class="text"><p>Oh</p></div></div></div><div class="comment"><a class="avatar"><img src="https://secure.gravatar.com/avatar/3d24a4100b3eab34d8ce3059d789c543?d=identicon&amp;version=1"></a><div class="content"><a class="author">Sandy Maguire</a><div class="metadata"><a href="#187066585" name="187066585"><div>2020-01-31 09:04:04</div></a></div><div class="text"><p>nvm im crazy</p></div></div></div><div class="comment"><a class="avatar"><img src="https://secure.gravatar.com/avatar/d3d2de116df80bc024b799e84dcdbc97?d=identicon&amp;version=1"></a><div class="content"><a class="author">gilmi</a><div class="metadata"><a href="#187067574" name="187067574"><div>2020-01-31 09:20:57</div></a></div><div class="text"><p>If I add getLine it's not removing the L1s anymore</p></div></div></div></div></div><div class="ui vertical footer segment"><a href="https://github.com/srid/zulip-archive">Powered by Haskell</a> | Questions? Contact <a href="https://www.srid.ca">srid</a></div></div></body></html>