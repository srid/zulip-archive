<html lang="en"><head><meta content="text/html; charset=utf-8" http-equiv="Content-Type"><meta content="width=device-width, initial-scale=1" name="viewport"><meta content="@Alexis King :wave:" name="description"><link href="https://funprog.srid.ca/haskell/delimited-continuations-for-modeling-effectful-computations.html" rel="canonical"><meta property="og:title" content="Delimited continuations for modeling effectful computations - Haskell"><meta property="og:site_name" content="Functional Programming Zulip Archive"><meta property="og:type" content="article"><meta property="og:article:section" content="Haskell"><meta property="og:article:modified_time" content="2020-02-24T08:05:21Z"><meta property="og:article:published_time" content="2020-02-17T23:29:55Z"><title>Delimited continuations for modeling effectful computations - Haskell</title><style type="text/css">
div#thesite
{
  font-family   : "Open Sans", sans-serif;
  font-size     : 1em !important;
  margin-top    : 1em;
  margin-bottom : 1em;
}

div#thesite h1
{
  font-family : "Roboto", sans-serif;
  line-height : 1.19999em;
}

div#thesite h2
{
  font-family : "Roboto", sans-serif;
  line-height : 1.19999em;
}

div#thesite h3
{
  font-family : "Roboto", sans-serif;
  line-height : 1.19999em;
}

div#thesite h4
{
  font-family : "Roboto", sans-serif;
  line-height : 1.19999em;
}

div#thesite h5
{
  font-family : "Roboto", sans-serif;
  line-height : 1.19999em;
}

div#thesite h6
{
  font-family : "Roboto", sans-serif;
  line-height : 1.19999em;
}

div#thesite .ui.breadcrumb.rib .section
{
  font-family : "Roboto", sans-serif;
  line-height : 1.19999em;
}

div#thesite .header
{
  font-family : "Roboto", sans-serif;
  line-height : 1.19999em;
}

div#thesite .as-header
{
  font-family : "Roboto", sans-serif;
  line-height : 1.19999em;
}

div#thesite code, pre, tt
{
  font-family : "SFMono-Regular","Menlo","Monaco","Consolas","Liberation Mono","Courier New", monospace;
}

div#thesite .ui.breadcrumb.rib
{
  margin-bottom : 1em;
}



div#thesite .ui.comments.messages .comment .metadata a
{
  color : #808080;
}

div#thesite .ui.comments.messages .comment a.avatar img
{
  height : auto;
}

div#thesite .subtle
{
  color : #808080;
}


div#thesite .messages pre
{
  font-size : 85%;
  overflow  : auto;
  max-width : 100%;
}

div#thesite .messages .message_embed
{
  border-left  : solid 3px #808080;
  padding-left : 0.69999em;
}

div#thesite .messages .message_inline_image img
{
  max-width     : 100%;
  margin-bottom : 1em;
}


/* Generated with Clay, http://fvisser.nl/clay */</style><link href="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.4.1/semantic.min.css" rel="stylesheet"><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.min.css" rel="stylesheet"><link href="https://fonts.googleapis.com/css?family=Open+Sans|Oswald&amp;display=swap" rel="stylesheet"><link href="https://fonts.googleapis.com/css?family=Roboto|Open+Sans&amp;display=swap" rel="stylesheet"></head><body><div id="thesite" class="ui text container"><div class="ui violet inverted top attached center aligned segment"><h1 class="ui huge header">Delimited continuations for modeling effectful computations - Haskell</h1></div><div class="ui attached segment"><div class="ui message"><p>Welcome to the Functional Programming Zulip Chat Archive. You can join the chat <a href="https://funprog.zulipchat.com">here</a>.</p></div><div class="ui breadcrumb rib"><a href="/" class="section">Home</a><i class="right angle icon divider"></i><a href="/haskell/" class="section">#Haskell</a><i class="right angle icon divider"></i><div class="active section">Delimited continuations for modeling effectful computations</div></div><div class="ui comments messages"><div class="comment"><a class="avatar"><img src="https://www.gravatar.com/avatar/520889f20a2c66a8f4bd5be6f37d2923"></a><div class="content"><a class="author">Asad Saeeduddin</a><div class="metadata"><a href="#188413031" name="188413031"><div>2020-02-17 23:29:55</div></a></div><div class="text"><p><span class="user-mention" data-user-id="251362">@Alexis King</span> <span aria-label="wave" class="emoji emoji-1f44b" role="img" title="wave">:wave:</span></p></div></div></div><div class="comment"><a class="avatar"><img src="https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b"></a><div class="content"><a class="author">Alexis King</a><div class="metadata"><a href="#188413083" name="188413083"><div>2020-02-17 23:30:49</div></a></div><div class="text"><p>Hello!</p></div></div></div><div class="comment"><a class="avatar"><img src="https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b"></a><div class="content"><a class="author">Alexis King</a><div class="metadata"><a href="#188413095" name="188413095"><div>2020-02-17 23:31:21</div></a></div><div class="text"><p>So, just to include the most recent context, the grammar of terms and evaluation contexts in a call-by-value lambda calculus:</p>
<div class="codehilite"><pre><span></span>v ::= (\x -&gt; e) | &lt;number&gt;
e ::= v | e e | e + e
E ::= ● | E e | v E | E + e | v + E
</pre></div></div></div></div><div class="comment"><a class="avatar"><img src="https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b"></a><div class="content"><a class="author">Alexis King</a><div class="metadata"><a href="#188413156" name="188413156"><div>2020-02-17 23:32:05</div></a></div><div class="text"><p>What’s going on here? Let’s start with the base case: <code>●</code> by itself is always a legal evaluation context. It’s a very boring one, but it’s allowed.</p></div></div></div><div class="comment"><a class="avatar"><img src="https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b"></a><div class="content"><a class="author">Alexis King</a><div class="metadata"><a href="#188413178" name="188413178"><div>2020-02-17 23:33:04</div></a></div><div class="text"><p>The evaluation context <code>● + 1</code> is also legal, as is <code>● + (1 + 2)</code>. We’re using the <code>E + e</code> production rule to make those evaluation contexts, where the <code>E</code> is <code>●</code> and the <code>e</code> is <code>1</code> or <code>1 + 2</code>.</p></div></div></div><div class="comment"><a class="avatar"><img src="https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b"></a><div class="content"><a class="author">Alexis King</a><div class="metadata"><a href="#188413194" name="188413194"><div>2020-02-17 23:33:36</div></a></div><div class="text"><p>The evaluation context <code>1 + ●</code> is legal, too… but note that <code>(1 + 2) + ●</code> is <strong>not!</strong> Why?</p></div></div></div><div class="comment"><a class="avatar"><img src="https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b"></a><div class="content"><a class="author">Alexis King</a><div class="metadata"><a href="#188413242" name="188413242"><div>2020-02-17 23:34:03</div></a></div><div class="text"><p>Because the production rule for “going inside” the right argument of a <code>+</code> requires the left side be <code>v</code>, a value. And <code>1 + 2</code> is not a value, it’s an expression.</p></div></div></div><div class="comment"><a class="avatar"><img src="https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b"></a><div class="content"><a class="author">Alexis King</a><div class="metadata"><a href="#188413258" name="188413258"><div>2020-02-17 23:34:36</div></a></div><div class="text"><p>This is why this is a grammar for a <em>call by value</em> lambda calculus; it enforces a left-to-right evaluation order just by restricting the grammar of <code>E</code>.</p></div></div></div><div class="comment"><a class="avatar"><img src="https://www.gravatar.com/avatar/520889f20a2c66a8f4bd5be6f37d2923"></a><div class="content"><a class="author">Asad Saeeduddin</a><div class="metadata"><a href="#188413398" name="188413398"><div>2020-02-17 23:38:10</div></a></div><div class="text"><p>So what we mean by just dot is that anything from the <code>e</code> list can go there</p></div></div></div><div class="comment"><a class="avatar"><img src="https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b"></a><div class="content"><a class="author">Alexis King</a><div class="metadata"><a href="#188413408" name="188413408"><div>2020-02-17 23:38:39</div></a></div><div class="text"><p>No, the dot is a literal dot! It’s the <code>●</code> from continuation frames!</p></div></div></div><div class="comment"><a class="avatar"><img src="https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b"></a><div class="content"><a class="author">Alexis King</a><div class="metadata"><a href="#188413429" name="188413429"><div>2020-02-17 23:39:40</div></a></div><div class="text"><p>As a Haskell datatype, the definition of <code>E</code> would look like this:</p>
<div class="codehilite"><pre><span></span><span class="kr">data</span> <span class="kt">E</span> <span class="ow">=</span> <span class="kt">Hole</span> <span class="o">|</span> <span class="kt">AppL</span> <span class="kt">E</span> <span class="kt">Expr</span> <span class="o">|</span> <span class="kt">AppR</span> <span class="kt">Value</span> <span class="kt">E</span> <span class="o">|</span> <span class="kt">PlusL</span> <span class="kt">E</span> <span class="kt">Expr</span> <span class="o">|</span> <span class="kt">PlusR</span> <span class="kt">Value</span> <span class="kt">E</span>
</pre></div></div></div></div><div class="comment"><a class="avatar"><img src="https://www.gravatar.com/avatar/520889f20a2c66a8f4bd5be6f37d2923"></a><div class="content"><a class="author">Asad Saeeduddin</a><div class="metadata"><a href="#188413432" name="188413432"><div>2020-02-17 23:39:59</div></a></div><div class="text"><p>Right, but I mean in an <code>E[e]</code>, the dot case just means we have <code>e</code></p></div></div></div><div class="comment"><a class="avatar"><img src="https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b"></a><div class="content"><a class="author">Alexis King</a><div class="metadata"><a href="#188413478" name="188413478"><div>2020-02-17 23:40:27</div></a></div><div class="text"><p>Yes, that’s right—the notation <code>E[e]</code> means “replace the <code>●</code> in <code>E</code> with <code>e</code>.”</p></div></div></div><div class="comment"><a class="avatar"><img src="https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b"></a><div class="content"><a class="author">Alexis King</a><div class="metadata"><a href="#188413486" name="188413486"><div>2020-02-17 23:40:39</div></a></div><div class="text"><p>In other words, “plug the hole.”</p></div></div></div><div class="comment"><a class="avatar"><img src="https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b"></a><div class="content"><a class="author">Alexis King</a><div class="metadata"><a href="#188413508" name="188413508"><div>2020-02-17 23:41:37</div></a></div><div class="text"><p>Let’s consider the beta reduction rule from earlier:</p>
<div class="codehilite"><pre><span></span>(\x -&gt; e) v   ---&gt;   e[x := v]
</pre></div>


<p>We can make this more precise by adding an evaluation context around the outside:</p>
<div class="codehilite"><pre><span></span>E[(\x -&gt; e) v]   ---&gt;   E[e[x := v]]
</pre></div>


<p>Now consider where this is/is not allowed to be used. We can reduce <code>(\x -&gt; x + 2) 1 + 3</code> to <code>(1 + 2) + 3</code>, because we can take the evaluation context <code>E = ● + 3</code>, so we have</p>
<div class="codehilite"><pre><span></span>E[(\x -&gt; x + 2) 1]   ---&gt;   E[1 + 2]
</pre></div></div></div></div><div class="comment"><a class="avatar"><img src="https://www.gravatar.com/avatar/520889f20a2c66a8f4bd5be6f37d2923"></a><div class="content"><a class="author">Asad Saeeduddin</a><div class="metadata"><a href="#188413514" name="188413514"><div>2020-02-17 23:42:00</div></a></div><div class="text"><p>hmm, actually I'm probably not understanding it correctly, given that <code>E e</code> is also an evaluation context. Shouldn't dot feature somewhere in every possible evaluation context?</p></div></div></div><div class="comment"><a class="avatar"><img src="https://www.gravatar.com/avatar/520889f20a2c66a8f4bd5be6f37d2923"></a><div class="content"><a class="author">Asad Saeeduddin</a><div class="metadata"><a href="#188413554" name="188413554"><div>2020-02-17 23:42:13</div></a></div><div class="text"><p>sorry if I'm being slow</p></div></div></div><div class="comment"><a class="avatar"><img src="https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b"></a><div class="content"><a class="author">Alexis King</a><div class="metadata"><a href="#188413557" name="188413557"><div>2020-02-17 23:42:20</div></a></div><div class="text"><p>No, it’s fine—evaluation contexts are confusing.</p></div></div></div><div class="comment"><a class="avatar"><img src="https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b"></a><div class="content"><a class="author">Alexis King</a><div class="metadata"><a href="#188413584" name="188413584"><div>2020-02-17 23:43:35</div></a></div><div class="text"><p>Genuinely think of evaluation contexts like an algebraic datatype. Note that in the Haskell type above, every value of <code>E</code> has to have one and <em>exactly</em> one <code>Hole</code> somewhere inside it, since every other case contains another <code>E</code>.</p></div></div></div><div class="comment"><a class="avatar"><img src="https://www.gravatar.com/avatar/520889f20a2c66a8f4bd5be6f37d2923"></a><div class="content"><a class="author">Asad Saeeduddin</a><div class="metadata"><a href="#188413586" name="188413586"><div>2020-02-17 23:43:37</div></a></div><div class="text"><p>ah, I see my mistake. for some reason I was reading <code>E e</code> as some kind of special construct, when it just means anything that's an evaluation context can go there</p></div></div></div><div class="comment"><a class="avatar"><img src="https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b"></a><div class="content"><a class="author">Alexis King</a><div class="metadata"><a href="#188413591" name="188413591"><div>2020-02-17 23:43:58</div></a></div><div class="text"><p>Yes, that’s right. The grammar we’re defining here is 100% syntactic.</p></div></div></div><div class="comment"><a class="avatar"><img src="https://www.gravatar.com/avatar/520889f20a2c66a8f4bd5be6f37d2923"></a><div class="content"><a class="author">Asad Saeeduddin</a><div class="metadata"><a href="#188413630" name="188413630"><div>2020-02-17 23:44:08</div></a></div><div class="text"><p>ok, thanks. that makes sense</p></div></div></div><div class="comment"><a class="avatar"><img src="https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b"></a><div class="content"><a class="author">Alexis King</a><div class="metadata"><a href="#188413640" name="188413640"><div>2020-02-17 23:44:46</div></a></div><div class="text"><p>We have an idea of what it all “means”—<code>v</code> represents values, <code>e</code> represents expressions, and <code>E</code> represents evaluation frames—but the formal system is technically just a bunch of string rewriting rules.</p></div></div></div><div class="comment"><a class="avatar"><img src="https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b"></a><div class="content"><a class="author">Alexis King</a><div class="metadata"><a href="#188413712" name="188413712"><div>2020-02-17 23:46:07</div></a></div><div class="text"><p>Anyway, going back to your original example of <code>E = throw f; ●</code>, that wouldn’t be a legal evaluation context because monads enforce an evaluation order. You have to evaluate <code>throw f</code> before you can evaluated the statement after it.</p></div></div></div><div class="comment"><a class="avatar"><img src="https://www.gravatar.com/avatar/520889f20a2c66a8f4bd5be6f37d2923"></a><div class="content"><a class="author">Asad Saeeduddin</a><div class="metadata"><a href="#188413732" name="188413732"><div>2020-02-17 23:47:20</div></a></div><div class="text"><p>what I meant in that context would be modeled in a monadic computation by <code>throw f &gt;&gt; ●</code>, but I'm not sure whether that's a valid evaluation frame either</p></div></div></div><div class="comment"><a class="avatar"><img src="https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b"></a><div class="content"><a class="author">Alexis King</a><div class="metadata"><a href="#188413736" name="188413736"><div>2020-02-17 23:47:45</div></a></div><div class="text"><p>It isn’t, for the same reasons—I was just blurring the language and metalanguage a little bit.</p></div></div></div><div class="comment"><a class="avatar"><img src="https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b"></a><div class="content"><a class="author">Alexis King</a><div class="metadata"><a href="#188413793" name="188413793"><div>2020-02-17 23:48:31</div></a></div><div class="text"><p>An evaluation context extended with <code>do</code> might look like this:</p>
<div class="codehilite"><pre><span></span>E ::= ... | do { x &lt;- E; e }
</pre></div>


<p>Interestingly, we don’t have a rule for going inside the next statement at all. But we could define a reduction rule to do it:</p>
<div class="codehilite"><pre><span></span>E[do { x &lt;- pure v; e }]   ---&gt;   E[e[x := v]]
</pre></div></div></div></div><div class="comment"><a class="avatar"><img src="https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b"></a><div class="content"><a class="author">Alexis King</a><div class="metadata"><a href="#188413933" name="188413933"><div>2020-02-17 23:52:49</div></a></div><div class="text"><p>So, going back to our <code>catch</code> example, the rules might reasonably look like</p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>E</mi><mo stretchy="false">[</mo><mi mathvariant="normal">catch</mi><mo>⁡</mo><mo stretchy="false">(</mo><mi mathvariant="normal">pure</mi><mo>⁡</mo><mi>v</mi><mo stretchy="false">)</mo><mi>f</mi><mo stretchy="false">]</mo><mo>⟶</mo><mi>E</mi><mo stretchy="false">[</mo><mi mathvariant="normal">pure</mi><mo>⁡</mo><mi>v</mi><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">E[\operatorname{catch} (\operatorname{pure} v) f] \longrightarrow E[\operatorname{pure} v]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.05764em;">E</span><span class="mopen">[</span><span class="mop"><span class="mord mathrm">c</span><span class="mord mathrm">a</span><span class="mord mathrm">t</span><span class="mord mathrm">c</span><span class="mord mathrm">h</span></span><span class="mopen">(</span><span class="mop"><span class="mord mathrm">p</span><span class="mord mathrm">u</span><span class="mord mathrm">r</span><span class="mord mathrm">e</span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">v</span><span class="mclose">)</span><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="mclose">]</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">⟶</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.05764em;">E</span><span class="mopen">[</span><span class="mop"><span class="mord mathrm">p</span><span class="mord mathrm">u</span><span class="mord mathrm">r</span><span class="mord mathrm">e</span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">v</span><span class="mclose">]</span></span></span></span></span></p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>E</mi><mn>1</mn></msub><mo stretchy="false">[</mo><mi mathvariant="normal">catch</mi><mo>⁡</mo><msub><mi>E</mi><mn>2</mn></msub><mo stretchy="false">[</mo><mi mathvariant="normal">throw</mi><mo>⁡</mo><mi>e</mi><mo stretchy="false">]</mo><mi>f</mi><mo stretchy="false">]</mo><mo>⟶</mo><msub><mi>E</mi><mn>1</mn></msub><mo stretchy="false">[</mo><mi>f</mi><mi>e</mi><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">E_1[\operatorname{catch} E_2[\operatorname{throw} e] f] \longrightarrow E_1[f e]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.05764em;">E</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.05764em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">[</span><span class="mop"><span class="mord mathrm">c</span><span class="mord mathrm">a</span><span class="mord mathrm">t</span><span class="mord mathrm">c</span><span class="mord mathrm">h</span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.05764em;">E</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.05764em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">[</span><span class="mop"><span class="mord mathrm">t</span><span class="mord mathrm">h</span><span class="mord mathrm">r</span><span class="mord mathrm">o</span><span class="mord mathrm" style="margin-right:0.01389em;">w</span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault">e</span><span class="mclose">]</span><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="mclose">]</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">⟶</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.05764em;">E</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.05764em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">[</span><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="mord mathdefault">e</span><span class="mclose">]</span></span></span></span></span></p></div></div></div><div class="comment"><a class="avatar"><img src="https://www.gravatar.com/avatar/520889f20a2c66a8f4bd5be6f37d2923"></a><div class="content"><a class="author">Asad Saeeduddin</a><div class="metadata"><a href="#188414017" name="188414017"><div>2020-02-17 23:55:26</div></a></div><div class="text"><p>and <code>E</code> again has a dot case for the do notation stuff</p></div></div></div><div class="comment"><a class="avatar"><img src="https://www.gravatar.com/avatar/520889f20a2c66a8f4bd5be6f37d2923"></a><div class="content"><a class="author">Asad Saeeduddin</a><div class="metadata"><a href="#188414065" name="188414065"><div>2020-02-17 23:56:23</div></a></div><div class="text"><p>I'm having trouble imagining how to model general purpose monadic computations without reinventing something like beta reduction inside the string rewriting rules</p></div></div></div><div class="comment"><a class="avatar"><img src="https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b"></a><div class="content"><a class="author">Alexis King</a><div class="metadata"><a href="#188414081" name="188414081"><div>2020-02-17 23:57:39</div></a></div><div class="text"><p>Yes, indeed! You do have to do that if you want to model it all formally. Of course, you wouldn’t bother if you’re just using the ideas to reason informally—I wouldn’t recommend actually thinking about “evaluation contexts” and all that just to think about some monadic code. But I’m afraid I have to go for the moment—I have some plans. But I would be happy to continue this some other time. The interesting tidbit we didn’t get to is the rule for <code>&lt;|&gt;</code> in the list monad, which duplicates the evaluation context, since that corresponds to invoking the continuation multiple times.</p></div></div></div><div class="comment"><a class="avatar"><img src="https://www.gravatar.com/avatar/520889f20a2c66a8f4bd5be6f37d2923"></a><div class="content"><a class="author">Asad Saeeduddin</a><div class="metadata"><a href="#188414131" name="188414131"><div>2020-02-17 23:58:38</div></a></div><div class="text"><p>Thanks for the explanation so far, this has really helped!</p></div></div></div><div class="comment"><a class="avatar"><img src="https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b"></a><div class="content"><a class="author">Alexis King</a><div class="metadata"><a href="#188900445" name="188900445"><div>2020-02-24 05:26:54</div></a></div><div class="text"><p><span class="user-mention" data-user-id="225136">@Asad Saeeduddin</span> In case you happen to be interested: I’ve written up an example of using reduction semantics to reason about code that uses continuations <a href="https://github.com/ghc-proposals/ghc-proposals/pull/313#issuecomment-590170853" target="_blank" title="https://github.com/ghc-proposals/ghc-proposals/pull/313#issuecomment-590170853">in a GitHub comment on my proposal</a>.</p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/ghc-proposals/ghc-proposals/pull/313#issuecomment-590170853" style="background-image: url(https://avatars0.githubusercontent.com/u/20374637?s=400&amp;v=4)" target="_blank"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/ghc-proposals/ghc-proposals/pull/313#issuecomment-590170853" target="_blank" title="Delimited continuation primops by lexi-lambda · Pull Request #313 · ghc-proposals/ghc-proposals">Delimited continuation primops by lexi-lambda · Pull Request #313 · ghc-proposals/ghc-proposals</a></div><div class="message_embed_description">This is a proposal for adding primops for capturing slices of the RTS stack to improve the performance of algebraic effect systems, which require delimited continuations.
Rendered</div></div></div></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/20a04d823b7c3891d78ca5f6a188ccd0e4fc5e3d?version=2"></a><div class="content"><a class="author">TheMatten</a><div class="metadata"><a href="#188905932" name="188905932"><div>2020-02-24 07:49:13</div></a></div><div class="text"><p><span class="user-mention" data-user-id="251362">@Alexis King</span> As it is, this interface should basically stay unchanged if it gets merged? (not asking for guarantees, just curious if there are some details to sort out <span aria-label="slight smile" class="emoji emoji-1f642" role="img" title="slight smile">:slight_smile:</span>)</p></div></div></div><div class="comment"><a class="avatar"><img src="https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b"></a><div class="content"><a class="author">Alexis King</a><div class="metadata"><a href="#188906725" name="188906725"><div>2020-02-24 08:05:21</div></a></div><div class="text"><p>Yes, I think so. I may try to figure out how to make <code>reset#</code> levity-polymorphic as well, but otherwise I think the interface is pretty reasonable.</p></div></div></div></div></div><div class="ui vertical footer segment"><a href="https://github.com/srid/zulip-archive">Powered by Haskell</a> | Questions? Contact <a href="https://www.srid.ca">srid</a></div></div></body></html>