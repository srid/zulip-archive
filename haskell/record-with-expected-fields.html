<html lang="en"><head><meta content="text/html; charset=utf-8" http-equiv="Content-Type"><meta content="width=device-width, initial-scale=1" name="viewport"><meta content="My library may ask the user code to supply a product type that must have at least two types of a certain type (say, path and parsed). The user may define it as this:
data Article path parsed
  = Article
    { _article_path :: path
    , _article_parsed :: parsed
    , _article_title :: Text
    , _a" name="description"><link href="https://funprog.srid.ca/haskell/record-with-expected-fields.html" rel="canonical"><meta property="og:title" content="Record with expected fields - Haskell"><meta property="og:site_name" content="Functional Programming Zulip Archive"><meta property="og:type" content="article"><meta property="og:article:section" content="Haskell"><meta property="og:article:modified_time" content="2019-11-27T02:12:05Z"><meta property="og:article:published_time" content="2019-11-26T03:27:10Z"><meta property="og:image" content="https://zulip-avatars.s3.amazonaws.com/13896/4429aa8b689608f24a4ad712843ce29862e330d2?x=x&amp;version=2"><title>Record with expected fields - Haskell</title><style type="text/css">
div#thesite
{
  font-family   : "Open Sans", sans-serif;
  font-size     : 1em !important;
  margin-top    : 1em;
  margin-bottom : 1em;
}

div#thesite h1
{
  font-family : "Roboto", sans-serif;
  line-height : 1.19999em;
}

div#thesite h2
{
  font-family : "Roboto", sans-serif;
  line-height : 1.19999em;
}

div#thesite h3
{
  font-family : "Roboto", sans-serif;
  line-height : 1.19999em;
}

div#thesite h4
{
  font-family : "Roboto", sans-serif;
  line-height : 1.19999em;
}

div#thesite h5
{
  font-family : "Roboto", sans-serif;
  line-height : 1.19999em;
}

div#thesite h6
{
  font-family : "Roboto", sans-serif;
  line-height : 1.19999em;
}

div#thesite .ui.breadcrumb.rib .section
{
  font-family : "Roboto", sans-serif;
  line-height : 1.19999em;
}

div#thesite .header
{
  font-family : "Roboto", sans-serif;
  line-height : 1.19999em;
}

div#thesite .as-header
{
  font-family : "Roboto", sans-serif;
  line-height : 1.19999em;
}

div#thesite code, pre, tt
{
  font-family : "SFMono-Regular","Menlo","Monaco","Consolas","Liberation Mono","Courier New", monospace;
}

div#thesite .ui.breadcrumb.rib
{
  margin-bottom : 1em;
}



div#thesite .ui.comments.messages .comment .metadata a
{
  color : #808080;
}

div#thesite .ui.comments.messages .comment a.avatar img
{
  height : auto;
}

div#thesite .subtle
{
  color : #808080;
}


div#thesite .messages pre
{
  font-size : 85%;
  overflow  : auto;
  max-width : 100%;
}

div#thesite .messages .message_embed
{
  border-left  : solid 3px #808080;
  padding-left : 0.69999em;
}

div#thesite .messages .message_inline_image img
{
  max-width     : 100%;
  margin-bottom : 1em;
}


/* Generated with Clay, http://fvisser.nl/clay */</style><link href="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.4.1/semantic.min.css" rel="stylesheet"><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.min.css" rel="stylesheet"><link href="https://fonts.googleapis.com/css?family=Open+Sans|Oswald&amp;display=swap" rel="stylesheet"><link href="https://fonts.googleapis.com/css?family=Roboto|Open+Sans&amp;display=swap" rel="stylesheet"></head><body><div id="thesite" class="ui text container"><div class="ui violet inverted top attached center aligned segment"><h1 class="ui huge header">Record with expected fields - Haskell</h1></div><div class="ui attached segment"><div class="ui message"><p>Welcome to the Functional Programming Zulip Chat Archive. You can join the chat <a href="https://funprog.zulipchat.com">here</a>.</p></div><div class="ui breadcrumb rib"><a href="/" class="section">Home</a><i class="right angle icon divider"></i><a href="/haskell/" class="section">#Haskell</a><i class="right angle icon divider"></i><div class="active section">Record with expected fields</div></div><div class="ui comments messages"><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/4429aa8b689608f24a4ad712843ce29862e330d2?x=x&amp;version=2"></a><div class="content"><a class="author">Sridhar Ratnakumar</a><div class="metadata"><a href="#181886649" name="181886649"><div>2019-11-26 03:27:10</div></a></div><div class="text"><p>My library may ask the user code to supply a product type that must have at least two types of a certain type (say, <code>path</code> and <code>parsed</code>). The user may define it as this:</p>
<div class="codehilite"><pre><span></span><span class="kr">data</span> <span class="kt">Article</span> <span class="n">path</span> <span class="n">parsed</span>
  <span class="ow">=</span> <span class="kt">Article</span>
    <span class="p">{</span> <span class="n">_article_path</span> <span class="ow">::</span> <span class="n">path</span>
    <span class="p">,</span> <span class="n">_article_parsed</span> <span class="ow">::</span> <span class="n">parsed</span>
    <span class="p">,</span> <span class="n">_article_title</span> <span class="ow">::</span> <span class="kt">Text</span>
    <span class="p">,</span> <span class="n">_article_description</span> <span class="ow">::</span> <span class="kt">Maybe</span> <span class="kt">Text</span>
    <span class="p">}</span>
</pre></div>


<p>This doesn't look right though. Is there a type sytem feature I can use to enforce this constraint? So users can define their product types however they want, except to make sure they support those two fields (which the library should be able to access)?</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/4429aa8b689608f24a4ad712843ce29862e330d2?x=x&amp;version=2"></a><div class="content"><a class="author">Sridhar Ratnakumar</a><div class="metadata"><a href="#181886716" name="181886716"><div>2019-11-26 03:28:51</div></a></div><div class="text"><p>(The library will fill-in the rest of the fields by loading some JSON, whose structure is defined by the user, based on the fields they use)</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/4429aa8b689608f24a4ad712843ce29862e330d2?x=x&amp;version=2"></a><div class="content"><a class="author">Sridhar Ratnakumar</a><div class="metadata"><a href="#181886803" name="181886803"><div>2019-11-26 03:31:27</div></a></div><div class="text"><p>Maybe this? <a href="http://hackage.haskell.org/package/named-records-0.5/docs/Data-NamedRecord.html" target="_blank" title="http://hackage.haskell.org/package/named-records-0.5/docs/Data-NamedRecord.html">http://hackage.haskell.org/package/named-records-0.5/docs/Data-NamedRecord.html</a></p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/4429aa8b689608f24a4ad712843ce29862e330d2?x=x&amp;version=2"></a><div class="content"><a class="author">Sridhar Ratnakumar</a><div class="metadata"><a href="#181886931" name="181886931"><div>2019-11-26 03:34:57</div></a></div><div class="text"><p>Or this: <a href="http://hackage.haskell.org/package/vinyl-0.12.0/docs/Data-Vinyl-Tutorial-Overview.html" target="_blank" title="http://hackage.haskell.org/package/vinyl-0.12.0/docs/Data-Vinyl-Tutorial-Overview.html">http://hackage.haskell.org/package/vinyl-0.12.0/docs/Data-Vinyl-Tutorial-Overview.html</a></p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/4429aa8b689608f24a4ad712843ce29862e330d2?x=x&amp;version=2"></a><div class="content"><a class="author">Sridhar Ratnakumar</a><div class="metadata"><a href="#181887084" name="181887084"><div>2019-11-26 03:39:14</div></a></div><div class="text"><p>Or maybe this: <a href="https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/glasgow_exts.html#record-field-selector-polymorphism" target="_blank" title="https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/glasgow_exts.html#record-field-selector-polymorphism">https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/glasgow_exts.html#record-field-selector-polymorphism</a></p></div></div></div><div class="comment"><a class="avatar"></a><div class="content"><a class="author">Ben Kolera</a><div class="metadata"><a href="#181887143" name="181887143"><div>2019-11-26 03:40:50</div></a></div><div class="text"><p>I mean, I'd probably go down a DSum + Classy Lens approach, but that's just me. <span aria-label="slight smile" class="emoji emoji-1f642" role="img" title="slight smile">:slight_smile:</span></p></div></div></div><div class="comment"><a class="avatar"></a><div class="content"><a class="author">Ben Kolera</a><div class="metadata"><a href="#181887151" name="181887151"><div>2019-11-26 03:41:30</div></a></div><div class="text"><p>DSum to link a tag to a result type, and using classy lenses to make sure that the target datatype can at least return path and parsed.</p></div></div></div><div class="comment"><a class="avatar"></a><div class="content"><a class="author">Ben Kolera</a><div class="metadata"><a href="#181887197" name="181887197"><div>2019-11-26 03:42:18</div></a></div><div class="text"><p>A full blown extensible records may be too much weight for what you need.</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/20a04d823b7c3891d78ca5f6a188ccd0e4fc5e3d?x=x&amp;version=2"></a><div class="content"><a class="author">TheMatten</a><div class="metadata"><a href="#181893117" name="181893117"><div>2019-11-26 06:07:03</div></a></div><div class="text"><p><span class="user-mention" data-user-id="251311">@Sridhar Ratnakumar</span> Have them provide <code>foo :: d path parsed -&gt; (path, parsed)</code> method - they shouldn't be able to come up with those out of thin air, right?</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/4429aa8b689608f24a4ad712843ce29862e330d2?x=x&amp;version=2"></a><div class="content"><a class="author">Sridhar Ratnakumar</a><div class="metadata"><a href="#181948997" name="181948997"><div>2019-11-26 18:22:05</div></a></div><div class="text"><p><span class="user-mention" data-user-id="251045">@Ben Kolera</span> I have used DSum/DMap before, but have a hard time figuring out how they fit in this case.</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/4429aa8b689608f24a4ad712843ce29862e330d2?x=x&amp;version=2"></a><div class="content"><a class="author">Sridhar Ratnakumar</a><div class="metadata"><a href="#181949030" name="181949030"><div>2019-11-26 18:22:44</div></a></div><div class="text"><p><span class="user-mention" data-user-id="225127">@TheMatten</span> I'll try to frame the question better.</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/4429aa8b689608f24a4ad712843ce29862e330d2?x=x&amp;version=2"></a><div class="content"><a class="author">Sridhar Ratnakumar</a><div class="metadata"><a href="#181949040" name="181949040"><div>2019-11-26 18:22:52</div></a></div><div class="text"><p>Found another library that's possibly relevant: <a href="https://github.com/i-am-tom/higgledy" target="_blank" title="https://github.com/i-am-tom/higgledy">https://github.com/i-am-tom/higgledy</a></p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/i-am-tom/higgledy" style="background-image: url(https://avatars3.githubusercontent.com/u/6302310?s=400&amp;v=4)" target="_blank"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/i-am-tom/higgledy" target="_blank" title="i-am-tom/higgledy">i-am-tom/higgledy</a></div><div class="message_embed_description">Higher-kinded data via generics. Contribute to i-am-tom/higgledy development by creating an account on GitHub.</div></div></div></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/4429aa8b689608f24a4ad712843ce29862e330d2?x=x&amp;version=2"></a><div class="content"><a class="author">Sridhar Ratnakumar</a><div class="metadata"><a href="#181983506" name="181983506"><div>2019-11-27 02:12:05</div></a></div><div class="text"><p>Okay, an update. I ended up sidestepping this problem entirely by designing my types differently. In particular, I detached the <code>Document</code> type from the <code>Markup</code> type class. Separation of concerns, ftw. <a href="https://github.com/srid/rib/pull/51/files" target="_blank" title="https://github.com/srid/rib/pull/51/files">https://github.com/srid/rib/pull/51/files</a></p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/srid/rib/pull/51/files" style="background-image: url(https://avatars2.githubusercontent.com/u/3998?s=400&amp;v=4)" target="_blank"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/srid/rib/pull/51/files" target="_blank" title="API improvements by srid 路 Pull Request #51 路 srid/rib">API improvements by srid 路 Pull Request #51 路 srid/rib</a></div><div class="message_embed_description">
Have a question about this project? Sign up for a free GitHub account to open an issue and contact its maintainers and the community.
  </div></div></div></div></div></div></div></div><div class="ui vertical footer segment"><a href="https://github.com/srid/zulip-archive">Powered by Haskell</a> | Questions? Contact <a href="https://www.srid.ca">srid</a></div></div></body></html>