<html lang="en"><head><meta content="text/html; charset=utf-8" http-equiv="Content-Type"><meta content="width=device-width, initial-scale=1" name="viewport"><meta content="does anyone have a setup for generating ctags for the entire dependency tree when using nix in some way? like codex does for stack projects" name="description"><link href="https://funprog.srid.ca/haskell/nix-and-ctags.html" rel="canonical"><meta property="og:title" content="nix and ctags - Haskell"><meta property="og:site_name" content="Functional Programming Zulip Archive"><meta property="og:type" content="article"><meta property="og:article:section" content="Haskell"><meta property="og:article:modified_time" content="2020-06-26T01:53:21Z"><meta property="og:article:published_time" content="2020-04-21T22:30:51Z"><meta property="og:image" content="https://zulip-avatars.s3.amazonaws.com/13896/7334dc60b6aef6a75cd9284126231f13c76926a5?x=x&amp;version=3"><title>nix and ctags - Haskell</title><style type="text/css">
div#thesite
{
  font-family   : "Open Sans", sans-serif;
  font-size     : 1em !important;
  margin-top    : 1em;
  margin-bottom : 1em;
}

div#thesite h1
{
  font-family : "Roboto", sans-serif;
  line-height : 1.19999em;
}

div#thesite h2
{
  font-family : "Roboto", sans-serif;
  line-height : 1.19999em;
}

div#thesite h3
{
  font-family : "Roboto", sans-serif;
  line-height : 1.19999em;
}

div#thesite h4
{
  font-family : "Roboto", sans-serif;
  line-height : 1.19999em;
}

div#thesite h5
{
  font-family : "Roboto", sans-serif;
  line-height : 1.19999em;
}

div#thesite h6
{
  font-family : "Roboto", sans-serif;
  line-height : 1.19999em;
}

div#thesite .ui.breadcrumb.rib .section
{
  font-family : "Roboto", sans-serif;
  line-height : 1.19999em;
}

div#thesite .header
{
  font-family : "Roboto", sans-serif;
  line-height : 1.19999em;
}

div#thesite .as-header
{
  font-family : "Roboto", sans-serif;
  line-height : 1.19999em;
}

div#thesite code, pre, tt
{
  font-family : "SFMono-Regular","Menlo","Monaco","Consolas","Liberation Mono","Courier New", monospace;
}

div#thesite .ui.breadcrumb.rib
{
  margin-bottom : 1em;
}



div#thesite .ui.comments.messages .comment .metadata a
{
  color : #808080;
}

div#thesite .ui.comments.messages .comment a.avatar img
{
  height : auto;
}

div#thesite .subtle
{
  color : #808080;
}


div#thesite .messages pre
{
  font-size : 85%;
  overflow  : auto;
  max-width : 100%;
}

div#thesite .messages .message_embed
{
  border-left  : solid 3px #808080;
  padding-left : 0.69999em;
}

div#thesite .messages .message_inline_image img
{
  max-width     : 100%;
  margin-bottom : 1em;
}


/* Generated with Clay, http://fvisser.nl/clay */</style><link href="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.4.1/semantic.min.css" rel="stylesheet"><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.min.css" rel="stylesheet"><link href="https://fonts.googleapis.com/css?family=Open+Sans|Oswald&amp;display=swap" rel="stylesheet"><link href="https://fonts.googleapis.com/css?family=Roboto|Open+Sans&amp;display=swap" rel="stylesheet"></head><body><div id="thesite" class="ui text container"><div class="ui violet inverted top attached center aligned segment"><h1 class="ui huge header">nix and ctags - Haskell</h1></div><div class="ui attached segment"><div class="ui message"><p>Welcome to the Functional Programming Zulip Chat Archive. You can join the chat <a href="https://funprog.zulipchat.com">here</a>.</p></div><div class="ui breadcrumb rib"><a href="/" class="section">Home</a><i class="right angle icon divider"></i><a href="/haskell/" class="section">#Haskell</a><i class="right angle icon divider"></i><div class="active section">nix and ctags</div></div><div class="ui comments messages"><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/7334dc60b6aef6a75cd9284126231f13c76926a5?x=x&amp;version=3"></a><div class="content"><a class="author">Torsten Schmits</a><div class="metadata"><a href="#194870077" name="194870077"><div>2020-04-21 22:30:51</div></a></div><div class="text"><p>does anyone have a setup for generating ctags for the entire dependency tree when using nix in some way? like codex does for stack projects</p></div></div></div><div class="comment"><a class="avatar"><img src="https://secure.gravatar.com/avatar/3d24a4100b3eab34d8ce3059d789c543?d=identicon&amp;version=1"></a><div class="content"><a class="author">Sandy Maguire</a><div class="metadata"><a href="#194875425" name="194875425"><div>2020-04-21 23:48:12</div></a></div><div class="text"><p>i do this: <code>hasktags **/*.hs</code>. not nix specific, but works OK</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/7334dc60b6aef6a75cd9284126231f13c76926a5?x=x&amp;version=3"></a><div class="content"><a class="author">Torsten Schmits</a><div class="metadata"><a href="#194881427" name="194881427"><div>2020-04-22 02:00:55</div></a></div><div class="text"><p>you mean for the local files in the project?</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/cf32e348c646a53534a1a022c022bab8528df176?x=x&amp;version=3"></a><div class="content"><a class="author">Alex Chapman</a><div class="metadata"><a href="#195009074" name="195009074"><div>2020-04-23 00:56:15</div></a></div><div class="text"><p>I just have <code>hasktags</code>, but yeah that's only for files in the project. Would be amazing to have ctags for the whole dependency tree.</p></div></div></div><div class="comment"><a class="avatar"><img src="https://secure.gravatar.com/avatar/a3a40b5b547344370d45ad0f805b4d81?d=identicon&amp;version=1"></a><div class="content"><a class="author">Ben Kolera</a><div class="metadata"><a href="#195012237" name="195012237"><div>2020-04-23 02:07:46</div></a></div><div class="text"><p>How would hasktags work there since you wont necessarily have the source around? Tried the local hoogle for a nix haskell env?</p></div></div></div><div class="comment"><a class="avatar"><img src="https://secure.gravatar.com/avatar/a3a40b5b547344370d45ad0f805b4d81?d=identicon&amp;version=1"></a><div class="content"><a class="author">Ben Kolera</a><div class="metadata"><a href="#195012294" name="195012294"><div>2020-04-23 02:08:22</div></a></div><div class="text"><p>The project specific hoogle is pretty rad, modulo the shitty broken file links to the nix store.</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/cf32e348c646a53534a1a022c022bab8528df176?x=x&amp;version=3"></a><div class="content"><a class="author">Alex Chapman</a><div class="metadata"><a href="#195012383" name="195012383"><div>2020-04-23 02:10:49</div></a></div><div class="text"><p>I have tried the local hoogle when playing with Reflex, and that's pretty nice. But it would be so much better to have text editor support for jumping to the code. Maybe I want text editor support for hoogle.</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/cf32e348c646a53534a1a022c022bab8528df176?x=x&amp;version=3"></a><div class="content"><a class="author">Alex Chapman</a><div class="metadata"><a href="#195012401" name="195012401"><div>2020-04-23 02:11:36</div></a></div><div class="text"><p>I would be happy to have the source around... but I guess nix doesn't keep it in the package?</p></div></div></div><div class="comment"><a class="avatar"><img src="https://secure.gravatar.com/avatar/a3a40b5b547344370d45ad0f805b4d81?d=identicon&amp;version=1"></a><div class="content"><a class="author">Ben Kolera</a><div class="metadata"><a href="#195012629" name="195012629"><div>2020-04-23 02:16:24</div></a></div><div class="text"><p>It would only be in the nix store if you built from source. If you got a cached version, your machine would never see the source.</p></div></div></div><div class="comment"><a class="avatar"><img src="https://secure.gravatar.com/avatar/a3a40b5b547344370d45ad0f805b4d81?d=identicon&amp;version=1"></a><div class="content"><a class="author">Ben Kolera</a><div class="metadata"><a href="#195012647" name="195012647"><div>2020-04-23 02:17:39</div></a></div><div class="text"><p>I don't know of any haskell tooling that will fetch sources for you. Not like how java has the pretty widely accepted pattern of putting source jars in maven.</p></div></div></div><div class="comment"><a class="avatar"><img src="https://secure.gravatar.com/avatar/a3a40b5b547344370d45ad0f805b4d81?d=identicon&amp;version=1"></a><div class="content"><a class="author">Ben Kolera</a><div class="metadata"><a href="#195012704" name="195012704"><div>2020-04-23 02:19:03</div></a></div><div class="text"><p>Other than cabal fetch/unpack, ofc, but that's no where near automated for a whole project.</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/cf32e348c646a53534a1a022c022bab8528df176?x=x&amp;version=3"></a><div class="content"><a class="author">Alex Chapman</a><div class="metadata"><a href="#195012810" name="195012810"><div>2020-04-23 02:21:18</div></a></div><div class="text"><p>It feels like it should be another flag to the nix haskell package library, like <code>doBenchmark</code> and <code>dontCheck</code>: <code>includeSources</code></p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/cf32e348c646a53534a1a022c022bab8528df176?x=x&amp;version=3"></a><div class="content"><a class="author">Alex Chapman</a><div class="metadata"><a href="#195012819" name="195012819"><div>2020-04-23 02:21:43</div></a></div><div class="text"><p>maybe <code>keepSource</code></p></div></div></div><div class="comment"><a class="avatar"><img src="https://secure.gravatar.com/avatar/a3a40b5b547344370d45ad0f805b4d81?d=identicon&amp;version=1"></a><div class="content"><a class="author">Ben Kolera</a><div class="metadata"><a href="#195013827" name="195013827"><div>2020-04-23 02:44:40</div></a></div><div class="text"><p>Source derivations are much deeper in the nix space than just the haskell library.</p></div></div></div><div class="comment"><a class="avatar"><img src="https://secure.gravatar.com/avatar/a3a40b5b547344370d45ad0f805b4d81?d=identicon&amp;version=1"></a><div class="content"><a class="author">Ben Kolera</a><div class="metadata"><a href="#195015044" name="195015044"><div>2020-04-23 03:21:13</div></a></div><div class="text"><p>Would still be lovely though if you could get to the source locally from hoogle.</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/7334dc60b6aef6a75cd9284126231f13c76926a5?x=x&amp;version=3"></a><div class="content"><a class="author">Torsten Schmits</a><div class="metadata"><a href="#195458129" name="195458129"><div>2020-04-27 18:36:24</div></a></div><div class="text"><p>I built something for generating tags:<br>
<a href="https://github.com/tek/thax" title="https://github.com/tek/thax">https://github.com/tek/thax</a></p>
<p>Works pretty well. With 4500 dependencies it takes about four seconds on my machine to re-run the derivation for all packages with everything cached. Of course you could generate dependency tags only when they change and do only the local source on save.</p>
<p>Suggestions appreciated!</p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/tek/thax" style="background-image: url(https://avatars0.githubusercontent.com/u/2632?s=400&amp;v=4)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/tek/thax" title="tek/thax">tek/thax</a></div><div class="message_embed_description">ctags generation for haskell projects with nix dependency management - tek/thax</div></div></div></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/cf32e348c646a53534a1a022c022bab8528df176?x=x&amp;version=3"></a><div class="content"><a class="author">Alex Chapman</a><div class="metadata"><a href="#195499357" name="195499357"><div>2020-04-28 03:57:23</div></a></div><div class="text"><p><span class="user-mention" data-user-id="260881">@Torsten Schmits</span> Awesome! Works for me. Thanks :)</p></div></div></div><div class="comment"><a class="avatar"><img src="https://secure.gravatar.com/avatar/a3a40b5b547344370d45ad0f805b4d81?d=identicon&amp;version=1"></a><div class="content"><a class="author">Ben Kolera</a><div class="metadata"><a href="#195499500" name="195499500"><div>2020-04-28 04:00:35</div></a></div><div class="text"><p>That looks like an awesome thing to build into a lorri setup so that it's always there in direnv.</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/cf32e348c646a53534a1a022c022bab8528df176?x=x&amp;version=3"></a><div class="content"><a class="author">Alex Chapman</a><div class="metadata"><a href="#195499819" name="195499819"><div>2020-04-28 04:10:08</div></a></div><div class="text"><p>/me adds lorri to his list of things to play with</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/cf32e348c646a53534a1a022c022bab8528df176?x=x&amp;version=3"></a><div class="content"><a class="author">Alex Chapman</a><div class="metadata"><a href="#195499831" name="195499831"><div>2020-04-28 04:11:00</div></a></div><div class="text"><p>My problem now is that there are too many ctags. E.g. following a tag for <code>Parser</code> gets me 22 results to sort through.</p></div></div></div><div class="comment"><a class="avatar"><img src="https://secure.gravatar.com/avatar/a3a40b5b547344370d45ad0f805b4d81?d=identicon&amp;version=1"></a><div class="content"><a class="author">Ben Kolera</a><div class="metadata"><a href="#195500215" name="195500215"><div>2020-04-28 04:20:18</div></a></div><div class="text"><p>rip</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/7334dc60b6aef6a75cd9284126231f13c76926a5?x=x&amp;version=3"></a><div class="content"><a class="author">Torsten Schmits</a><div class="metadata"><a href="#195551750" name="195551750"><div>2020-04-28 11:52:10</div></a></div><div class="text"><p><span class="user-mention silent" data-user-id="282523">Alex Chapman</span> <a href="#narrow/stream/201385-Haskell/topic/nix.20and.20ctags/near/195499831" title="#narrow/stream/201385-Haskell/topic/nix.20and.20ctags/near/195499831">said</a>:</p>
<blockquote>
<p>My problem now is that there are too many ctags. E.g. following a tag for <code>Parser</code> gets me 22 results to sort through.</p>
</blockquote>
<p>as opposed to what? having no dependency tags or using a different tool like codex?</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/cf32e348c646a53534a1a022c022bab8528df176?x=x&amp;version=3"></a><div class="content"><a class="author">Alex Chapman</a><div class="metadata"><a href="#195637772" name="195637772"><div>2020-04-28 22:42:54</div></a></div><div class="text"><p>The problem is that ctags isn't smart enough to know what definition I <em>actually</em> want to look up. If I look up <code>show</code>, it finds hundreds of instances of <code>show</code> to show me. It doesn't do type inference, figure out exactly what type's <code>show</code> instance I want, then go to that source code. Of course I never expected ctags to be able to do this. Maybe what I want next is the ability to fuzzy-find within a ctags lookup when there are many options.</p></div></div></div><div class="comment"><a class="avatar"><img src="https://secure.gravatar.com/avatar/a3a40b5b547344370d45ad0f805b4d81?d=identicon&amp;version=1"></a><div class="content"><a class="author">Ben Kolera</a><div class="metadata"><a href="#195639188" name="195639188"><div>2020-04-28 22:57:04</div></a></div><div class="text"><p>fzf ftw</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/cf32e348c646a53534a1a022c022bab8528df176?x=x&amp;version=3"></a><div class="content"><a class="author">Alex Chapman</a><div class="metadata"><a href="#195639414" name="195639414"><div>2020-04-28 22:59:24</div></a></div><div class="text"><p>Yeah, I want fzf within the tag disambiguation interface. I already have fzf for searching through all tags, via fzf.kak, but not for searching through the different options at the other end of the tag.</p></div></div></div><div class="comment"><a class="avatar"><img src="https://secure.gravatar.com/avatar/a3a40b5b547344370d45ad0f805b4d81?d=identicon&amp;version=1"></a><div class="content"><a class="author">Ben Kolera</a><div class="metadata"><a href="#195639637" name="195639637"><div>2020-04-28 23:01:52</div></a></div><div class="text"><p>Kakoune <span aria-label="heart" class="emoji emoji-2764" role="img" title="heart">:heart:</span></p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/cf32e348c646a53534a1a022c022bab8528df176?x=x&amp;version=3"></a><div class="content"><a class="author">Alex Chapman</a><div class="metadata"><a href="#195639705" name="195639705"><div>2020-04-28 23:02:11</div></a></div><div class="text"><p>Kakoune is the best thing since sliced vim :)</p></div></div></div><div class="comment"><a class="avatar"><img src="https://secure.gravatar.com/avatar/a3a40b5b547344370d45ad0f805b4d81?d=identicon&amp;version=1"></a><div class="content"><a class="author">Ben Kolera</a><div class="metadata"><a href="#195639849" name="195639849"><div>2020-04-28 23:03:35</div></a></div><div class="text"><p>I miss all of the shininess in spacemacs though. I need to recreate kakoune interactions (theres multicursors and a modal editing lib) in emacs so I can have the best of both worlds. <span aria-label="slight smile" class="emoji emoji-1f642" role="img" title="slight smile">:slight_smile:</span></p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/7334dc60b6aef6a75cd9284126231f13c76926a5?x=x&amp;version=3"></a><div class="content"><a class="author">Torsten Schmits</a><div class="metadata"><a href="#195640658" name="195640658"><div>2020-04-28 23:12:23</div></a></div><div class="text"><p><span class="user-mention silent" data-user-id="282523">Alex Chapman</span> <a href="#narrow/stream/201385-Haskell/topic/nix.20and.20ctags/near/195637772" title="#narrow/stream/201385-Haskell/topic/nix.20and.20ctags/near/195637772">said</a>:</p>
<blockquote>
<p>It doesn't do type inference</p>
</blockquote>
<p>Your problem is that all our language servers are crap <span aria-label="slight smile" class="emoji emoji-1f642" role="img" title="slight smile">:slight_smile:</span></p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/7334dc60b6aef6a75cd9284126231f13c76926a5?x=x&amp;version=3"></a><div class="content"><a class="author">Torsten Schmits</a><div class="metadata"><a href="#195640900" name="195640900"><div>2020-04-28 23:15:57</div></a></div><div class="text"><p><span class="user-mention silent" data-user-id="282523">Alex Chapman</span> <a href="#narrow/stream/201385-Haskell/topic/nix.20and.20ctags/near/195639414" title="#narrow/stream/201385-Haskell/topic/nix.20and.20ctags/near/195639414">said</a>:</p>
<blockquote>
<p>Yeah, I want fzf within the tag disambiguation interface. I already have fzf for searching through all tags, via fzf.kak, but not for searching through the different options at the other end of the tag.</p>
</blockquote>
<p><code>:Tags show</code> does give you that functionality, unless I'm misunderstanding something</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/cf32e348c646a53534a1a022c022bab8528df176?x=x&amp;version=3"></a><div class="content"><a class="author">Alex Chapman</a><div class="metadata"><a href="#195641545" name="195641545"><div>2020-04-28 23:25:18</div></a></div><div class="text"><blockquote>
<p><code>:Tags show</code> does give you that functionality, unless I'm misunderstanding something</p>
</blockquote>
<p>Which editor is that in?</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/7334dc60b6aef6a75cd9284126231f13c76926a5?x=x&amp;version=3"></a><div class="content"><a class="author">Torsten Schmits</a><div class="metadata"><a href="#195641893" name="195641893"><div>2020-04-28 23:30:04</div></a></div><div class="text"><p>oh right, it's vim</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/7334dc60b6aef6a75cd9284126231f13c76926a5?x=x&amp;version=3"></a><div class="content"><a class="author">Torsten Schmits</a><div class="metadata"><a href="#195641899" name="195641899"><div>2020-04-28 23:30:13</div></a></div><div class="text"><p>with the plugin <code>fzf-vim</code></p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/cf32e348c646a53534a1a022c022bab8528df176?x=x&amp;version=3"></a><div class="content"><a class="author">Alex Chapman</a><div class="metadata"><a href="#195642286" name="195642286"><div>2020-04-28 23:36:31</div></a></div><div class="text"><p>I guess I need to do some tinkering with my kakrc</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/7334dc60b6aef6a75cd9284126231f13c76926a5?x=x&amp;version=3"></a><div class="content"><a class="author">Torsten Schmits</a><div class="metadata"><a href="#195642686" name="195642686"><div>2020-04-28 23:43:02</div></a></div><div class="text"><p>ah, you're using Kakoune as your primary editor</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/7334dc60b6aef6a75cd9284126231f13c76926a5?x=x&amp;version=3"></a><div class="content"><a class="author">Torsten Schmits</a><div class="metadata"><a href="#195642694" name="195642694"><div>2020-04-28 23:43:08</div></a></div><div class="text"><p>how's the mileage?</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/7334dc60b6aef6a75cd9284126231f13c76926a5?x=x&amp;version=3"></a><div class="content"><a class="author">Torsten Schmits</a><div class="metadata"><a href="#195642696" name="195642696"><div>2020-04-28 23:43:14</div></a></div><div class="text"><p>did you use vim before?</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/cf32e348c646a53534a1a022c022bab8528df176?x=x&amp;version=3"></a><div class="content"><a class="author">Alex Chapman</a><div class="metadata"><a href="#195643034" name="195643034"><div>2020-04-28 23:47:34</div></a></div><div class="text"><p>It's awesome. I did use vim previously. I find that kakoune is to vim as vim is to all other editors, in terms of the editing language.</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/7334dc60b6aef6a75cd9284126231f13c76926a5?x=x&amp;version=3"></a><div class="content"><a class="author">Torsten Schmits</a><div class="metadata"><a href="#195643312" name="195643312"><div>2020-04-28 23:50:36</div></a></div><div class="text"><p>ugh crap. I don't want to spend the next six months migrating my shit to a new editor <span aria-label="smiley" class="emoji emoji-1f603" role="img" title="smiley">:smiley:</span></p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/7334dc60b6aef6a75cd9284126231f13c76926a5?x=x&amp;version=3"></a><div class="content"><a class="author">Torsten Schmits</a><div class="metadata"><a href="#195643347" name="195643347"><div>2020-04-28 23:51:07</div></a></div><div class="text"><p>how do you write plugins in kakoune? like rplugins in neovim</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/cf32e348c646a53534a1a022c022bab8528df176?x=x&amp;version=3"></a><div class="content"><a class="author">Alex Chapman</a><div class="metadata"><a href="#195643890" name="195643890"><div>2020-04-28 23:56:54</div></a></div><div class="text"><p>I haven't written my own, but from what I can tell it's mostly about hooking shell commands into the editor. E.g: <a href="https://github.com/andreyorst/fzf.kak/blob/master/rc/fzf.kak" title="https://github.com/andreyorst/fzf.kak/blob/master/rc/fzf.kak">https://github.com/andreyorst/fzf.kak/blob/master/rc/fzf.kak</a></p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/andreyorst/fzf.kak/blob/master/rc/fzf.kak" style="background-image: url(https://avatars3.githubusercontent.com/u/19470159?s=400&amp;v=4)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/andreyorst/fzf.kak/blob/master/rc/fzf.kak" title="andreyorst/fzf.kak">andreyorst/fzf.kak</a></div><div class="message_embed_description">FZF  for Kakoune. Mirror of https://gitlab.com/andreyorst/fzf.kak - andreyorst/fzf.kak</div></div></div></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/7334dc60b6aef6a75cd9284126231f13c76926a5?x=x&amp;version=3"></a><div class="content"><a class="author">Torsten Schmits</a><div class="metadata"><a href="#195644311" name="195644311"><div>2020-04-29 00:01:36</div></a></div><div class="text"><p>looks like there is no support for plugins running in a subprocess with RPC, right?</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/cf32e348c646a53534a1a022c022bab8528df176?x=x&amp;version=3"></a><div class="content"><a class="author">Alex Chapman</a><div class="metadata"><a href="#195646663" name="195646663"><div>2020-04-29 00:39:40</div></a></div><div class="text"><p>I don't know. There's support for connecting to an lsp server, if that helps?</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/7334dc60b6aef6a75cd9284126231f13c76926a5?x=x&amp;version=3"></a><div class="content"><a class="author">Torsten Schmits</a><div class="metadata"><a href="#195647402" name="195647402"><div>2020-04-29 00:50:33</div></a></div><div class="text"><p>nope! <span aria-label="laughter tears" class="emoji emoji-1f602" role="img" title="laughter tears">:laughter_tears:</span></p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/cf32e348c646a53534a1a022c022bab8528df176?x=x&amp;version=3"></a><div class="content"><a class="author">Alex Chapman</a><div class="metadata"><a href="#201690193" name="201690193"><div>2020-06-23 05:58:18</div></a></div><div class="text"><p><span class="user-mention" data-user-id="260881">@Torsten Schmits</span> I now use thax-generated tags hundreds of times a day. Thanks again for making it! I can use the same shortcut to jump to my own source code or to the source code of any Haskell function I use.</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/7334dc60b6aef6a75cd9284126231f13c76926a5?x=x&amp;version=3"></a><div class="content"><a class="author">Torsten Schmits</a><div class="metadata"><a href="#201703254" name="201703254"><div>2020-06-23 09:10:00</div></a></div><div class="text"><p><span class="user-mention" data-user-id="282523">@Alex Chapman</span> that's wonderful! any suggestions for improvements?</p>
<p>I'm quite unhappy with the store hash in the path, but that's more of a presentation problem, (neo)vim's tag menu is not very configurable</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/cf32e348c646a53534a1a022c022bab8528df176?x=x&amp;version=3"></a><div class="content"><a class="author">Alex Chapman</a><div class="metadata"><a href="#201796538" name="201796538"><div>2020-06-23 23:20:23</div></a></div><div class="text"><p>Well my only annoyance is that to update the tags from my own project I need to run the whole tag process again, which takes around 30 seconds, so I avoid doing it too often, and so I can't look up my recently written functions.</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/7334dc60b6aef6a75cd9284126231f13c76926a5?x=x&amp;version=3"></a><div class="content"><a class="author">Torsten Schmits</a><div class="metadata"><a href="#201800325" name="201800325"><div>2020-06-24 00:21:07</div></a></div><div class="text"><p>30 seconds seems steep, for me it takes about 5 seconds. is your dependency tree that huge? I think that the project I've just tested it on is reasonably large. is that an SSD?</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/7334dc60b6aef6a75cd9284126231f13c76926a5?x=x&amp;version=3"></a><div class="content"><a class="author">Torsten Schmits</a><div class="metadata"><a href="#201800346" name="201800346"><div>2020-06-24 00:21:43</div></a></div><div class="text"><p>I trigger it whenever I save</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/cf32e348c646a53534a1a022c022bab8528df176?x=x&amp;version=3"></a><div class="content"><a class="author">Alex Chapman</a><div class="metadata"><a href="#201809642" name="201809642"><div>2020-06-24 04:00:35</div></a></div><div class="text"><p>I haven't tried to keep the dependency tree small, so it probably is pretty huge, though I don't have Pandoc at least. It does take at least 25 seconds, every time, and yes this is on an SSD. The <code>tags</code> file is 23M.</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/7334dc60b6aef6a75cd9284126231f13c76926a5?x=x&amp;version=3"></a><div class="content"><a class="author">Torsten Schmits</a><div class="metadata"><a href="#201817401" name="201817401"><div>2020-06-24 07:14:49</div></a></div><div class="text"><p>hm, my tags file is 32M…what's your cpu?</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/7334dc60b6aef6a75cd9284126231f13c76926a5?x=x&amp;version=3"></a><div class="content"><a class="author">Torsten Schmits</a><div class="metadata"><a href="#201817444" name="201817444"><div>2020-06-24 07:15:53</div></a></div><div class="text"><p>wonder how we could profile this</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/cf32e348c646a53534a1a022c022bab8528df176?x=x&amp;version=3"></a><div class="content"><a class="author">Alex Chapman</a><div class="metadata"><a href="#201921628" name="201921628"><div>2020-06-25 00:51:10</div></a></div><div class="text"><p><a href="https://ark.intel.com/content/www/us/en/ark/products/97496/intel-core-i7-7820hq-processor-8m-cache-up-to-3-90-ghz.html">https://ark.intel.com/content/www/us/en/ark/products/97496/intel-core-i7-7820hq-processor-8m-cache-up-to-3-90-ghz.html</a></p>
<div class="message_embed"><a class="message_embed_image" href="https://ark.intel.com/content/www/us/en/ark/products/97496/intel-core-i7-7820hq-processor-8m-cache-up-to-3-90-ghz.html" style="background-image: url(http://ark.intel.com/inc/images/fusionmobile/intel-logo-blue.png)"></a><div class="data-container"><div class="message_embed_title"><a href="https://ark.intel.com/content/www/us/en/ark/products/97496/intel-core-i7-7820hq-processor-8m-cache-up-to-3-90-ghz.html" title="IntelÂ® Coreâ¢ i7-7820HQ Processor (8M Cache, up to 3.90 GHz) Product Specifications">IntelÂ® Coreâ¢ i7-7820HQ Processor (8M Cache, up to 3.90 GHz) Product Specifications</a></div><div class="message_embed_description">IntelÂ® Coreâ¢ i7-7820HQ Processor (8M Cache, up to 3.90 GHz) quick reference guide including specifications, features, pricing, compatibility, design documentation, ordering codes, spec codes and more.</div></div></div></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/7334dc60b6aef6a75cd9284126231f13c76926a5?x=x&amp;version=3"></a><div class="content"><a class="author">Torsten Schmits</a><div class="metadata"><a href="#201922305" name="201922305"><div>2020-06-25 01:03:13</div></a></div><div class="text"><p>when you run the derivation, do the 30 seconds pass entirely while nix is evaluating, or does it output what it is tagging?</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/cf32e348c646a53534a1a022c022bab8528df176?x=x&amp;version=3"></a><div class="content"><a class="author">Alex Chapman</a><div class="metadata"><a href="#201922515" name="201922515"><div>2020-06-25 01:07:34</div></a></div><div class="text"><p>Oh, it looks like the majority of the time is spent building <em>my</em> project. If I don't change any of my files then it only takes 3.7s.</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/cf32e348c646a53534a1a022c022bab8528df176?x=x&amp;version=3"></a><div class="content"><a class="author">Alex Chapman</a><div class="metadata"><a href="#201922992" name="201922992"><div>2020-06-25 01:16:31</div></a></div><div class="text"><p>So I guess I need my projectTags target to <em>not</em> include my own package, so I can run hasktags on my project without needing to compile it. I have it set up in my <code>default.nix</code> like this:</p>
<div class="codehilite"><pre><span></span><code>  pkg = modifiedHaskellPackages.callCabal2nix pkgname ./. { };
...
        projectTags = tags.combined.all { targets = [pkg] };
</code></pre></div>


<p>Is there a way I can turn <code>pkg</code> into a list of its dependencies, without including itself?</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/7334dc60b6aef6a75cd9284126231f13c76926a5?x=x&amp;version=3"></a><div class="content"><a class="author">Torsten Schmits</a><div class="metadata"><a href="#201956721" name="201956721"><div>2020-06-25 11:26:22</div></a></div><div class="text"><p>by "building my project", do you mean compiling haskell?</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/7334dc60b6aef6a75cd9284126231f13c76926a5?x=x&amp;version=3"></a><div class="content"><a class="author">Torsten Schmits</a><div class="metadata"><a href="#201957717" name="201957717"><div>2020-06-25 11:39:27</div></a></div><div class="text"><p>if so, that's wrong, it should only copy the sources and look at the nix deps, not realise the derivation</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/7334dc60b6aef6a75cd9284126231f13c76926a5?x=x&amp;version=3"></a><div class="content"><a class="author">Torsten Schmits</a><div class="metadata"><a href="#201957821" name="201957821"><div>2020-06-25 11:40:36</div></a></div><div class="text"><p>the optimal case should be that hasktags is run on the current directory and the dep tree is checked for changes by nix</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/cf32e348c646a53534a1a022c022bab8528df176?x=x&amp;version=3"></a><div class="content"><a class="author">Alex Chapman</a><div class="metadata"><a href="#202035271" name="202035271"><div>2020-06-25 22:54:34</div></a></div><div class="text"><p>Yeah, it's compiling Haskell, because I gave the list of targets as a list containing only my package. Otherwise I would need to manually specify all of my dependencies.</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/7334dc60b6aef6a75cd9284126231f13c76926a5?x=x&amp;version=3"></a><div class="content"><a class="author">Torsten Schmits</a><div class="metadata"><a href="#202037343" name="202037343"><div>2020-06-25 23:25:50</div></a></div><div class="text"><p>that's the intended way to use it, but it should not build the package. are you sure there's nothing else that could cause this? the tool only looks at the derivation's attributes to get the sources and dependencies.</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/7334dc60b6aef6a75cd9284126231f13c76926a5?x=x&amp;version=3"></a><div class="content"><a class="author">Torsten Schmits</a><div class="metadata"><a href="#202038653" name="202038653"><div>2020-06-25 23:47:07</div></a></div><div class="text"><p>so I tested it like this:</p>
<div class="codehilite"><pre><span></span><code><span class="k">let</span>
  <span class="ss">pkgs =</span> <span class="nb">import</span> <span class="l">&lt;nixpkgs&gt;</span> <span class="p">{};</span>
  <span class="ss">tags =</span> <span class="nb">import</span> <span class="p">(</span>fetchTarball <span class="s2">&quot;https://github.com/tek/thax/tarball/9ac46dfef0a99a74e65c838a89d0bbab00170d8b&quot;</span><span class="p">)</span> <span class="p">{};</span>
  <span class="ss">p =</span> pkgs<span class="o">.</span>haskellPackages<span class="o">.</span>callCabal2nix <span class="s2">&quot;thax-test&quot;</span> <span class="o">.</span><span class="l">/.</span> <span class="p">{};</span>
<span class="k">in</span> <span class="p">{</span>
  <span class="ss">projectTags =</span> tags<span class="o">.</span>combined<span class="o">.</span>all <span class="p">{</span> <span class="ss">targets =</span> <span class="p">[</span>p<span class="p">];</span> <span class="p">};</span>
<span class="p">}</span>
</code></pre></div>


<p>and the project isn't compiled when I run</p>
<div class="codehilite"><pre><span></span><code>nix-build -A projectTags
</code></pre></div>


<p><span aria-label="shrug" class="emoji emoji-1f937" role="img" title="shrug">:shrug:</span></p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/7334dc60b6aef6a75cd9284126231f13c76926a5?x=x&amp;version=3"></a><div class="content"><a class="author">Torsten Schmits</a><div class="metadata"><a href="#202038741" name="202038741"><div>2020-06-25 23:48:27</div></a></div><div class="text"><p>maybe try this <code>default.nix</code> with a <code>.cabal</code>file and one source file and see what happens, so that we can be sure it's not something external</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/cf32e348c646a53534a1a022c022bab8528df176?x=x&amp;version=3"></a><div class="content"><a class="author">Alex Chapman</a><div class="metadata"><a href="#202043891" name="202043891"><div>2020-06-26 01:23:21</div></a></div><div class="text"><p>It looks like it does build the package even in a simple test with nothing changed after a <code>cabal init</code> except the addition of your <code>default.nix</code> from above:</p>
<div class="codehilite"><pre><span></span><code>λ ~/src/test/ time nix-build -A projectTags
these derivations will be built:
  /nix/store/q4ci8784lmp9ic4nysf0hyxj0dvngww7-test-0.1.0.0-tags.drv
  /nix/store/3k1bqhlk2w2l8jhqzbz9gx1yiqbdaa4y-project-tags.drv
building &#39;/nix/store/q4ci8784lmp9ic4nysf0hyxj0dvngww7-test-0.1.0.0-tags.drv&#39;...
unpacking sources
unpacking source archive /nix/store/3frh2am7mzdk3qgshmlsy26c4hfnnryp-test
source root is test
building
building &#39;/nix/store/3k1bqhlk2w2l8jhqzbz9gx1yiqbdaa4y-project-tags.drv&#39;...
building
/nix/store/hyvqvkaya51kfsbj7cla5vb64jqjfprx-project-tags
nix-build -A projectTags  1.31s user 0.18s system 8% cpu 17.193 total
</code></pre></div></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/cf32e348c646a53534a1a022c022bab8528df176?x=x&amp;version=3"></a><div class="content"><a class="author">Alex Chapman</a><div class="metadata"><a href="#202044113" name="202044113"><div>2020-06-26 01:28:03</div></a></div><div class="text"><div class="codehilite"><pre><span></span><code>λ ~/src/test/ nix-build --version
nix-build (Nix) 2.3.3
λ ~/src/test/ cabal --version
cabal-install version 3.0.0.0
compiled using version 3.0.0.0 of the Cabal library
</code></pre></div></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/cf32e348c646a53534a1a022c022bab8528df176?x=x&amp;version=3"></a><div class="content"><a class="author">Alex Chapman</a><div class="metadata"><a href="#202044139" name="202044139"><div>2020-06-26 01:28:50</div></a></div><div class="text"><p>I'm not supposed to run it from within <code>nix-shell</code> am I?</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/cf32e348c646a53534a1a022c022bab8528df176?x=x&amp;version=3"></a><div class="content"><a class="author">Alex Chapman</a><div class="metadata"><a href="#202044222" name="202044222"><div>2020-06-26 01:30:24</div></a></div><div class="text"><p>(doing so doesn't seem to help)</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/7334dc60b6aef6a75cd9284126231f13c76926a5?x=x&amp;version=3"></a><div class="content"><a class="author">Torsten Schmits</a><div class="metadata"><a href="#202044234" name="202044234"><div>2020-06-26 01:30:50</div></a></div><div class="text"><p>how do you figure it is built? there's no output referencing any haskell files</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/cf32e348c646a53534a1a022c022bab8528df176?x=x&amp;version=3"></a><div class="content"><a class="author">Alex Chapman</a><div class="metadata"><a href="#202044245" name="202044245"><div>2020-06-26 01:31:13</div></a></div><div class="text"><div class="codehilite"><pre><span></span><code>these derivations will be built:
  /nix/store/q4ci8784lmp9ic4nysf0hyxj0dvngww7-test-0.1.0.0-tags.drv
</code></pre></div></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/7334dc60b6aef6a75cd9284126231f13c76926a5?x=x&amp;version=3"></a><div class="content"><a class="author">Torsten Schmits</a><div class="metadata"><a href="#202044255" name="202044255"><div>2020-06-26 01:31:29</div></a></div><div class="text"><p>well, that's the tags derivation</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/cf32e348c646a53534a1a022c022bab8528df176?x=x&amp;version=3"></a><div class="content"><a class="author">Alex Chapman</a><div class="metadata"><a href="#202044263" name="202044263"><div>2020-06-26 01:31:54</div></a></div><div class="text"><p>Oh, I see. Well then why is it slow? :/</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/7334dc60b6aef6a75cd9284126231f13c76926a5?x=x&amp;version=3"></a><div class="content"><a class="author">Torsten Schmits</a><div class="metadata"><a href="#202044304" name="202044304"><div>2020-06-26 01:32:17</div></a></div><div class="text"><p>good question!</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/7334dc60b6aef6a75cd9284126231f13c76926a5?x=x&amp;version=3"></a><div class="content"><a class="author">Torsten Schmits</a><div class="metadata"><a href="#202044322" name="202044322"><div>2020-06-26 01:33:08</div></a></div><div class="text"><p>is it also slow if you use <code>combined.packages</code>?</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/cf32e348c646a53534a1a022c022bab8528df176?x=x&amp;version=3"></a><div class="content"><a class="author">Alex Chapman</a><div class="metadata"><a href="#202044413" name="202044413"><div>2020-06-26 01:34:39</div></a></div><div class="text"><p>Where should I use that? In the targets list?</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/cf32e348c646a53534a1a022c022bab8528df176?x=x&amp;version=3"></a><div class="content"><a class="author">Alex Chapman</a><div class="metadata"><a href="#202044509" name="202044509"><div>2020-06-26 01:36:27</div></a></div><div class="text"><div class="codehilite"><pre><span></span><code>λ ~/src/test/ time nix-build -A projectTags
these derivations will be built:
  /nix/store/ny62bvn7b5g35m6j5h821098h7fala3a-test-0.1.0.0-tags.drv
  /nix/store/v6dvswnhb0ydpcifv2nskl7balp76wzg-project-tags.drv
building &#39;/nix/store/ny62bvn7b5g35m6j5h821098h7fala3a-test-0.1.0.0-tags.drv&#39;...
unpacking sources
unpacking source archive /nix/store/h44kigiqmvsir82iwb3bv0pmrdji9m2s-test
source root is test
building
building &#39;/nix/store/v6dvswnhb0ydpcifv2nskl7balp76wzg-project-tags.drv&#39;...
building
/nix/store/3jzlz7hnmmjsa7jmgqk9ij4gfrac67vj-project-tags
nix-build -A projectTags  1.38s user 0.18s system 8% cpu 18.188 total
λ ~/src/test/ time nix-build -A projectTags
these derivations will be built:
  /nix/store/vyfcwyfia4n3r9f1sgmmlfbpbpzj44h2-test-0.1.0.0-tags.drv
  /nix/store/bk2fhhysakxazy809xcflxjzwgpss32c-project-tags.drv
building &#39;/nix/store/vyfcwyfia4n3r9f1sgmmlfbpbpzj44h2-test-0.1.0.0-tags.drv&#39;...
unpacking sources
unpacking source archive /nix/store/9ydv2j4yh0ng79gj7w4qpyf2g9y3m67k-test
source root is test
building
building &#39;/nix/store/bk2fhhysakxazy809xcflxjzwgpss32c-project-tags.drv&#39;...
building
/nix/store/xlg4fr4kf0v0x275z6fkml8q10hyvpni-project-tags
nix-build -A projectTags  1.33s user 0.17s system 8% cpu 16.877 total
</code></pre></div></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/cf32e348c646a53534a1a022c022bab8528df176?x=x&amp;version=3"></a><div class="content"><a class="author">Alex Chapman</a><div class="metadata"><a href="#202044511" name="202044511"><div>2020-06-26 01:36:43</div></a></div><div class="text"><p>Why do all the hashes change despite me not changing anything?</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/7334dc60b6aef6a75cd9284126231f13c76926a5?x=x&amp;version=3"></a><div class="content"><a class="author">Torsten Schmits</a><div class="metadata"><a href="#202044512" name="202044512"><div>2020-06-26 01:36:45</div></a></div><div class="text"><p><code>projectTags = tags.combined.packages { targets = [xyz]; }</code></p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/7334dc60b6aef6a75cd9284126231f13c76926a5?x=x&amp;version=3"></a><div class="content"><a class="author">Torsten Schmits</a><div class="metadata"><a href="#202044524" name="202044524"><div>2020-06-26 01:37:20</div></a></div><div class="text"><p><span class="user-mention silent" data-user-id="282523">Alex Chapman</span> <a href="#narrow/stream/201385-Haskell/topic/nix.20and.20ctags/near/202044511">said</a>:</p>
<blockquote>
<p>Why do all the hashes change despite me not changing anything?</p>
</blockquote>
<p>yeah that <em>is</em> worrying</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/cf32e348c646a53534a1a022c022bab8528df176?x=x&amp;version=3"></a><div class="content"><a class="author">Alex Chapman</a><div class="metadata"><a href="#202044579" name="202044579"><div>2020-06-26 01:38:35</div></a></div><div class="text"><p>Faster with <code>combined.packages</code>:</p>
<div class="codehilite"><pre><span></span><code>λ ~/src/test/ time nix-build -A projectTags
these derivations will be built:
  /nix/store/a0xhi7b18wlmwn33njxdbr2sm4dsmakx-test-0.1.0.0-tags.drv
building &#39;/nix/store/a0xhi7b18wlmwn33njxdbr2sm4dsmakx-test-0.1.0.0-tags.drv&#39;...
unpacking sources
unpacking source archive /nix/store/b510xvfch2lygwv72m2skl2cilrkjprz-test
source root is test
building
/nix/store/xwnps3ydyml8g5ycq13b1sn5m3k960fj-test-0.1.0.0-tags
nix-build -A projectTags  1.26s user 0.18s system 13% cpu 10.618 total
λ ~/src/test/ time nix-build -A projectTags
these derivations will be built:
  /nix/store/p1lw7lzlh50sbaxgs5dr48748mdqkpsf-test-0.1.0.0-tags.drv
building &#39;/nix/store/p1lw7lzlh50sbaxgs5dr48748mdqkpsf-test-0.1.0.0-tags.drv&#39;...
unpacking sources
unpacking source archive /nix/store/cmhw5hk4c3rvz6i67xbw643il54xifdw-test
source root is test
building
/nix/store/y534ck4pd40bzw3i2k3z111j6ji1c7a5-test-0.1.0.0-tags
nix-build -A projectTags  1.27s user 0.17s system 16% cpu 8.761 total
</code></pre></div></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/7334dc60b6aef6a75cd9284126231f13c76926a5?x=x&amp;version=3"></a><div class="content"><a class="author">Torsten Schmits</a><div class="metadata"><a href="#202044600" name="202044600"><div>2020-06-26 01:39:29</div></a></div><div class="text"><p>I see now, this also happens for me, but only in the project where the package is in the root dir</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/cf32e348c646a53534a1a022c022bab8528df176?x=x&amp;version=3"></a><div class="content"><a class="author">Alex Chapman</a><div class="metadata"><a href="#202044654" name="202044654"><div>2020-06-26 01:40:17</div></a></div><div class="text"><p>I'm wondering whether the <code>result</code> symlink to the built package is part of the hashed package, so because it changes every time, the resultant package's hash changes every time...</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/7334dc60b6aef6a75cd9284126231f13c76926a5?x=x&amp;version=3"></a><div class="content"><a class="author">Torsten Schmits</a><div class="metadata"><a href="#202044658" name="202044658"><div>2020-06-26 01:40:34</div></a></div><div class="text"><p>right, try it with <code>--no-link</code></p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/7334dc60b6aef6a75cd9284126231f13c76926a5?x=x&amp;version=3"></a><div class="content"><a class="author">Torsten Schmits</a><div class="metadata"><a href="#202044667" name="202044667"><div>2020-06-26 01:40:57</div></a></div><div class="text"><p>yup, that fixes it for me</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/cf32e348c646a53534a1a022c022bab8528df176?x=x&amp;version=3"></a><div class="content"><a class="author">Alex Chapman</a><div class="metadata"><a href="#202044671" name="202044671"><div>2020-06-26 01:41:16</div></a></div><div class="text"><p>Yeah, much faster after the first build.</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/7334dc60b6aef6a75cd9284126231f13c76926a5?x=x&amp;version=3"></a><div class="content"><a class="author">Torsten Schmits</a><div class="metadata"><a href="#202044685" name="202044685"><div>2020-06-26 01:41:35</div></a></div><div class="text"><p>how do you  integrate the generated file? do you not use the command from the readme?</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/cf32e348c646a53534a1a022c022bab8528df176?x=x&amp;version=3"></a><div class="content"><a class="author">Alex Chapman</a><div class="metadata"><a href="#202044733" name="202044733"><div>2020-06-26 01:42:15</div></a></div><div class="text"><p>I use <code>cp $(nix-build --no-link -A projectTags)/tags tags</code></p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/cf32e348c646a53534a1a022c022bab8528df176?x=x&amp;version=3"></a><div class="content"><a class="author">Alex Chapman</a><div class="metadata"><a href="#202044746" name="202044746"><div>2020-06-26 01:42:54</div></a></div><div class="text"><p>So now if I change <code>Main.hs</code>, it takes longer to build again, ~10s, then back to ~2s on the next run.</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/cf32e348c646a53534a1a022c022bab8528df176?x=x&amp;version=3"></a><div class="content"><a class="author">Alex Chapman</a><div class="metadata"><a href="#202044751" name="202044751"><div>2020-06-26 01:43:08</div></a></div><div class="text"><p>Which would suggest it's compiling the package.</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/7334dc60b6aef6a75cd9284126231f13c76926a5?x=x&amp;version=3"></a><div class="content"><a class="author">Torsten Schmits</a><div class="metadata"><a href="#202044772" name="202044772"><div>2020-06-26 01:43:52</div></a></div><div class="text"><p>10s is reasonable</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/7334dc60b6aef6a75cd9284126231f13c76926a5?x=x&amp;version=3"></a><div class="content"><a class="author">Torsten Schmits</a><div class="metadata"><a href="#202044817" name="202044817"><div>2020-06-26 01:44:12</div></a></div><div class="text"><p>since it's checking all the dependencies again</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/7334dc60b6aef6a75cd9284126231f13c76926a5?x=x&amp;version=3"></a><div class="content"><a class="author">Torsten Schmits</a><div class="metadata"><a href="#202044845" name="202044845"><div>2020-06-26 01:45:28</div></a></div><div class="text"><p>but you could use <code>combined.packages</code> and then manually merge it with the file for the deps that can be generated with <code>combined.deps</code></p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/7334dc60b6aef6a75cd9284126231f13c76926a5?x=x&amp;version=3"></a><div class="content"><a class="author">Torsten Schmits</a><div class="metadata"><a href="#202044897" name="202044897"><div>2020-06-26 01:46:45</div></a></div><div class="text"><p>I call it in the background from vim whenever I hit my "save all" mapping, so I don't really notice that there's a delay</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/7334dc60b6aef6a75cd9284126231f13c76926a5?x=x&amp;version=3"></a><div class="content"><a class="author">Torsten Schmits</a><div class="metadata"><a href="#202044925" name="202044925"><div>2020-06-26 01:47:43</div></a></div><div class="text"><p>but if that's not your workflow, we can come up with something for the tool that's accomodating</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/cf32e348c646a53534a1a022c022bab8528df176?x=x&amp;version=3"></a><div class="content"><a class="author">Alex Chapman</a><div class="metadata"><a href="#202044932" name="202044932"><div>2020-06-26 01:47:50</div></a></div><div class="text"><p>Oh ok, I was thinking that yours took ~5s regardless.</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/cf32e348c646a53534a1a022c022bab8528df176?x=x&amp;version=3"></a><div class="content"><a class="author">Alex Chapman</a><div class="metadata"><a href="#202044984" name="202044984"><div>2020-06-26 01:48:22</div></a></div><div class="text"><p>Running it in the background would be fine, let me see if I can get kakoune to do that...</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/7334dc60b6aef6a75cd9284126231f13c76926a5?x=x&amp;version=3"></a><div class="content"><a class="author">Torsten Schmits</a><div class="metadata"><a href="#202045008" name="202045008"><div>2020-06-26 01:49:00</div></a></div><div class="text"><p>well it's not taking 30 seconds, more like 8</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/7334dc60b6aef6a75cd9284126231f13c76926a5?x=x&amp;version=3"></a><div class="content"><a class="author">Torsten Schmits</a><div class="metadata"><a href="#202045077" name="202045077"><div>2020-06-26 01:50:08</div></a></div><div class="text"><p>the project I've tested this on has its source files split across 14 packages, so not everything is retagged on every save</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/7334dc60b6aef6a75cd9284126231f13c76926a5?x=x&amp;version=3"></a><div class="content"><a class="author">Torsten Schmits</a><div class="metadata"><a href="#202045081" name="202045081"><div>2020-06-26 01:50:21</div></a></div><div class="text"><p>maybe run hasktags manually to see how long that takes</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/cf32e348c646a53534a1a022c022bab8528df176?x=x&amp;version=3"></a><div class="content"><a class="author">Alex Chapman</a><div class="metadata"><a href="#202045111" name="202045111"><div>2020-06-26 01:51:15</div></a></div><div class="text"><p>0.1s</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/cf32e348c646a53534a1a022c022bab8528df176?x=x&amp;version=3"></a><div class="content"><a class="author">Alex Chapman</a><div class="metadata"><a href="#202045124" name="202045124"><div>2020-06-26 01:51:39</div></a></div><div class="text"><p>(on just my own source files)</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/7334dc60b6aef6a75cd9284126231f13c76926a5?x=x&amp;version=3"></a><div class="content"><a class="author">Torsten Schmits</a><div class="metadata"><a href="#202045175" name="202045175"><div>2020-06-26 01:52:05</div></a></div><div class="text"><p>then it's just nix</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/7334dc60b6aef6a75cd9284126231f13c76926a5?x=x&amp;version=3"></a><div class="content"><a class="author">Torsten Schmits</a><div class="metadata"><a href="#202045187" name="202045187"><div>2020-06-26 01:52:41</div></a></div><div class="text"><p>right, my deps are also split, so the subtree that's examined on a change is smaller, maybe that's a reason</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/7334dc60b6aef6a75cd9284126231f13c76926a5?x=x&amp;version=3"></a><div class="content"><a class="author">Torsten Schmits</a><div class="metadata"><a href="#202045204" name="202045204"><div>2020-06-26 01:53:21</div></a></div><div class="text"><p>I'll try to think of some way to avoid the deep dependency rechecking</p></div></div></div></div></div><div class="ui vertical footer segment"><a href="https://github.com/srid/zulip-archive">Powered by Haskell</a> | Questions? Contact <a href="https://www.srid.ca">srid</a></div></div></body></html>