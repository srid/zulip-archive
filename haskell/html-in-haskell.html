<html lang="en"><head><meta content="text/html; charset=utf-8" http-equiv="Content-Type"><meta content="width=device-width, initial-scale=1" name="viewport"><meta content="With RebindableSyntax, HTML in Haskell can be more readable than HTML itself :big_smile: :
example :: HTML
example = html do
  #head do
    #title &quot;This is a title&quot;
  #body do
    &quot;Hello World!&quot;

    #h1 &quot;Heading level 1&quot;
    #h2 &quot;Heading level 2&quot;
    #h3 &quot;Heading level 3&quot;
    #h4 &quot;Heading level 4&quot;
" name="description"><link href="https://funprog.srid.ca/haskell/html-in-haskell.html" rel="canonical"><meta property="og:title" content="HTML in Haskell - Haskell"><meta property="og:site_name" content="Functional Programming Zulip Archive"><meta property="og:type" content="article"><meta property="og:article:section" content="Haskell"><meta property="og:article:modified_time" content="2021-03-31T22:06:58Z"><meta property="og:article:published_time" content="2020-02-20T10:10:06Z"><meta property="og:image" content="https://zulip-avatars.s3.amazonaws.com/13896/20a04d823b7c3891d78ca5f6a188ccd0e4fc5e3d?version=2"><title>HTML in Haskell - Haskell</title><style type="text/css">
div#thesite
{
  font-family   : "Open Sans", sans-serif;
  font-size     : 1em !important;
  margin-top    : 1em;
  margin-bottom : 1em;
}

div#thesite h1
{
  font-family : "Roboto", sans-serif;
  line-height : 1.19999em;
}

div#thesite h2
{
  font-family : "Roboto", sans-serif;
  line-height : 1.19999em;
}

div#thesite h3
{
  font-family : "Roboto", sans-serif;
  line-height : 1.19999em;
}

div#thesite h4
{
  font-family : "Roboto", sans-serif;
  line-height : 1.19999em;
}

div#thesite h5
{
  font-family : "Roboto", sans-serif;
  line-height : 1.19999em;
}

div#thesite h6
{
  font-family : "Roboto", sans-serif;
  line-height : 1.19999em;
}

div#thesite .ui.breadcrumb.rib .section
{
  font-family : "Roboto", sans-serif;
  line-height : 1.19999em;
}

div#thesite .header
{
  font-family : "Roboto", sans-serif;
  line-height : 1.19999em;
}

div#thesite .as-header
{
  font-family : "Roboto", sans-serif;
  line-height : 1.19999em;
}

div#thesite code, pre, tt
{
  font-family : "SFMono-Regular","Menlo","Monaco","Consolas","Liberation Mono","Courier New", monospace;
}

div#thesite .ui.breadcrumb.rib
{
  margin-bottom : 1em;
}



div#thesite .ui.comments.messages .comment .metadata a
{
  color : #808080;
}

div#thesite .ui.comments.messages .comment a.avatar img
{
  height : auto;
}

div#thesite .subtle
{
  color : #808080;
}


div#thesite .messages pre
{
  font-size : 85%;
  overflow  : auto;
  max-width : 100%;
}

div#thesite .messages .message_embed
{
  border-left  : solid 3px #808080;
  padding-left : 0.69999em;
}

div#thesite .messages .message_inline_image img
{
  max-width     : 100%;
  margin-bottom : 1em;
}


/* Generated with Clay, http://fvisser.nl/clay */</style><link href="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.4.1/semantic.min.css" rel="stylesheet"><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.min.css" rel="stylesheet"><link href="https://fonts.googleapis.com/css?family=Open+Sans|Oswald&amp;display=swap" rel="stylesheet"><link href="https://fonts.googleapis.com/css?family=Roboto|Open+Sans&amp;display=swap" rel="stylesheet"></head><body><div id="thesite" class="ui text container"><div class="ui violet inverted top attached center aligned segment"><h1 class="ui huge header">HTML in Haskell - Haskell</h1></div><div class="ui attached segment"><div class="ui message"><p>Welcome to the Functional Programming Zulip Chat Archive. You can join the chat <a href="https://funprog.zulipchat.com">here</a>.</p></div><div class="ui breadcrumb rib"><a href="/" class="section">Home</a><i class="right angle icon divider"></i><a href="/haskell/" class="section">#Haskell</a><i class="right angle icon divider"></i><div class="active section">HTML in Haskell</div></div><div class="ui comments messages"><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/20a04d823b7c3891d78ca5f6a188ccd0e4fc5e3d?version=2"></a><div class="content"><a class="author">TheMatten</a><div class="metadata"><a href="#188624849" name="188624849"><div>2020-02-20 10:10:06</div></a></div><div class="text"><p>With <code>RebindableSyntax</code>, HTML in Haskell can be more readable than HTML itself <span aria-label="big smile" class="emoji emoji-1f604" role="img" title="big smile">:big_smile:</span> :</p>
<div class="codehilite"><pre><span></span><span class="nf">example</span> <span class="ow">::</span> <span class="kt">HTML</span>
<span class="nf">example</span> <span class="ow">=</span> <span class="n">html</span> <span class="kr">do</span>
  <span class="o">#</span><span class="n">head</span> <span class="kr">do</span>
    <span class="o">#</span><span class="n">title</span> <span class="s">&quot;This is a title&quot;</span>
  <span class="o">#</span><span class="n">body</span> <span class="kr">do</span>
    <span class="s">&quot;Hello World!&quot;</span>

    <span class="o">#</span><span class="n">h1</span> <span class="s">&quot;Heading level 1&quot;</span>
    <span class="o">#</span><span class="n">h2</span> <span class="s">&quot;Heading level 2&quot;</span>
    <span class="o">#</span><span class="n">h3</span> <span class="s">&quot;Heading level 3&quot;</span>
    <span class="o">#</span><span class="n">h4</span> <span class="s">&quot;Heading level 4&quot;</span>
    <span class="o">#</span><span class="n">h5</span> <span class="s">&quot;Heading level 5&quot;</span>
    <span class="o">#</span><span class="n">h6</span> <span class="s">&quot;Heading level 6&quot;</span>

    <span class="o">#</span><span class="n">p</span> <span class="s">&quot;Paragraph&quot;</span>

    <span class="o">#</span><span class="n">a</span> <span class="kr">do</span>
      <span class="o">#</span><span class="n">href</span> <span class="o">=:</span> <span class="s">&quot;https://www.wikipedia.org/&quot;</span>

      <span class="s">&quot;A link to Wikipedia!&quot;</span>

    <span class="o">#</span><span class="n">input</span> <span class="o">$</span> <span class="o">#</span><span class="kr">type</span> <span class="o">=:</span> <span class="s">&quot;text&quot;</span>
    <span class="o">#</span><span class="n">input</span> <span class="o">$</span> <span class="o">#</span><span class="kr">type</span> <span class="o">=:</span> <span class="s">&quot;file&quot;</span>
    <span class="o">#</span><span class="n">input</span> <span class="o">$</span> <span class="o">#</span><span class="kr">type</span> <span class="o">=:</span> <span class="s">&quot;checkbox&quot;</span>

    <span class="n">comment</span> <span class="s">&quot;This is a comment&quot;</span>

    <span class="o">#</span><span class="n">abbr</span> <span class="kr">do</span>
      <span class="o">#</span><span class="n">id</span>    <span class="o">=:</span> <span class="s">&quot;anId&quot;</span>
      <span class="o">#</span><span class="kr">class</span> <span class="o">=:</span> <span class="s">&quot;jargon&quot;</span>
      <span class="o">#</span><span class="n">style</span> <span class="o">=:</span> <span class="s">&quot;color:purple;&quot;</span>
      <span class="o">#</span><span class="n">title</span> <span class="o">=:</span> <span class="s">&quot;Hypertext Markup Language&quot;</span>

      <span class="s">&quot;HTML&quot;</span>
</pre></div></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/4429aa8b689608f24a4ad712843ce29862e330d2?version=3"></a><div class="content"><a class="author">Sridhar Ratnakumar</a><div class="metadata"><a href="#188639213" name="188639213"><div>2020-02-20 14:02:56</div></a></div><div class="text"><p>Looks much better, actually. Any reason this can't go in the lucid library (that rib and zulip-archive use)?</p></div></div></div><div class="comment"><a class="avatar"><img src="https://www.gravatar.com/avatar/4ba4faf2fc5818d37c0aed6acb5b69a2"></a><div class="content"><a class="author">James King</a><div class="metadata"><a href="#188639679" name="188639679"><div>2020-02-20 14:08:38</div></a></div><div class="text"><p><span aria-label="thinking" class="emoji emoji-1f914" role="img" title="thinking">:thinking:</span> wonder if this can be interpreted from a data structure.</p>
<p>very neat! <span aria-label="smiley" class="emoji emoji-1f603" role="img" title="smiley">:smiley:</span></p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/20a04d823b7c3891d78ca5f6a188ccd0e4fc5e3d?version=2"></a><div class="content"><a class="author">TheMatten</a><div class="metadata"><a href="#188640021" name="188640021"><div>2020-02-20 14:12:51</div></a></div><div class="text"><p>I will have to fiddle with this a little bit more if I want monadic <code>do</code> to still function properly <span aria-label="sweat smile" class="emoji emoji-1f605" role="img" title="sweat smile">:sweat_smile:</span></p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/4429aa8b689608f24a4ad712843ce29862e330d2?version=3"></a><div class="content"><a class="author">Sridhar Ratnakumar</a><div class="metadata"><a href="#188644080" name="188644080"><div>2020-02-20 14:51:35</div></a></div><div class="text"><p>There is also CSS via the <code>clay</code> library.</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/4429aa8b689608f24a4ad712843ce29862e330d2?version=3"></a><div class="content"><a class="author">Sridhar Ratnakumar</a><div class="metadata"><a href="#188644093" name="188644093"><div>2020-02-20 14:51:49</div></a></div><div class="text"><p>I'd love to get a syntax like this into <code>rib</code> :-)</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/4429aa8b689608f24a4ad712843ce29862e330d2?version=3"></a><div class="content"><a class="author">Sridhar Ratnakumar</a><div class="metadata"><a href="#188644469" name="188644469"><div>2020-02-20 14:56:02</div></a></div><div class="text"><p>Do attributes have to be inside the element body though? What's the rational for it?</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/4429aa8b689608f24a4ad712843ce29862e330d2?version=3"></a><div class="content"><a class="author">Sridhar Ratnakumar</a><div class="metadata"><a href="#188644561" name="188644561"><div>2020-02-20 14:56:55</div></a></div><div class="text"><p>I mean, how about the following?</p>
<div class="codehilite"><pre><span></span><span class="o">#</span><span class="n">a</span> <span class="p">(</span><span class="o">#</span><span class="n">href</span> <span class="o">=:</span> <span class="s">&quot;theurl&quot;</span> <span class="o">&lt;&gt;</span> <span class="o">#</span><span class="n">title</span> <span class="o">=:</span> <span class="s">&quot;some tooltip&quot;</span><span class="p">)</span> <span class="kr">do</span>
  <span class="o">#</span><span class="n">div</span> <span class="kr">do</span>
     <span class="o">...</span>
</pre></div></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/e881cb072eaeddcf2e2c1a570f4ba80eee54f595?version=2"></a><div class="content"><a class="author">Vance Palacio</a><div class="metadata"><a href="#188647373" name="188647373"><div>2020-02-20 15:25:24</div></a></div><div class="text"><p>Wow that's really cool, didn't realize Haskell had something like that</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/20a04d823b7c3891d78ca5f6a188ccd0e4fc5e3d?version=2"></a><div class="content"><a class="author">TheMatten</a><div class="metadata"><a href="#188654429" name="188654429"><div>2020-02-20 16:40:33</div></a></div><div class="text"><p><span class="user-mention" data-user-id="251311">@Sridhar Ratnakumar</span> I found it to be nicer - but it doesn't have to be that way necessarily</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/20a04d823b7c3891d78ca5f6a188ccd0e4fc5e3d?version=2"></a><div class="content"><a class="author">TheMatten</a><div class="metadata"><a href="#188654642" name="188654642"><div>2020-02-20 16:43:26</div></a></div><div class="text"><p><span class="user-mention" data-user-id="264632">@Vance Palacio</span> See <code>RebindableSyntax</code>, <code>OverloadedLabels</code>, <code>OverloadedStrings</code> and <code>DataKinds</code> <span aria-label="slight smile" class="emoji emoji-1f642" role="img" title="slight smile">:slight_smile:</span></p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/20a04d823b7c3891d78ca5f6a188ccd0e4fc5e3d?version=2"></a><div class="content"><a class="author">TheMatten</a><div class="metadata"><a href="#188654730" name="188654730"><div>2020-02-20 16:44:22</div></a></div><div class="text"><p>(And then some other usual stuff from "GHC Haskell")</p></div></div></div><div class="comment"><a class="avatar"><img src="https://www.gravatar.com/avatar/45175015b9eb3dd3f6c740b3fe920fed"></a><div class="content"><a class="author">Joel McCracken</a><div class="metadata"><a href="#188679471" name="188679471"><div>2020-02-20 21:22:22</div></a></div><div class="text"><p>personally i think <code>[href "theurl", title "some tooltip"]</code> is plenty readable</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/20a04d823b7c3891d78ca5f6a188ccd0e4fc5e3d?version=2"></a><div class="content"><a class="author">TheMatten</a><div class="metadata"><a href="#188717582" name="188717582"><div>2020-02-21 10:03:32</div></a></div><div class="text"><p><span class="user-mention" data-user-id="252949">@Joel McCracken</span> problem is that you have to define every possible tag and attribute in library - with labels, user can create arbitrary one, while we can still possibly check that it's a valid tag (consisting of alphanumeric characters) at compile-time</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/20a04d823b7c3891d78ca5f6a188ccd0e4fc5e3d?version=2"></a><div class="content"><a class="author">TheMatten</a><div class="metadata"><a href="#188717667" name="188717667"><div>2020-02-21 10:04:35</div></a></div><div class="text"><p><span class="user-mention" data-user-id="251311">@Sridhar Ratnakumar</span> should I try to integrate this with <code>lucid</code>?</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/20a04d823b7c3891d78ca5f6a188ccd0e4fc5e3d?version=2"></a><div class="content"><a class="author">TheMatten</a><div class="metadata"><a href="#188718056" name="188718056"><div>2020-02-21 10:10:08</div></a></div><div class="text"><p>element by itself in <code>lucid</code>:</p>
<div class="codehilite"><pre><span></span><span class="nf">table_</span> <span class="p">[</span><span class="n">rows_</span> <span class="s">&quot;2&quot;</span><span class="p">]</span>
       <span class="p">(</span><span class="n">tr_</span> <span class="p">(</span><span class="kr">do</span> <span class="n">td_</span> <span class="p">[</span><span class="n">class_</span> <span class="s">&quot;top&quot;</span><span class="p">,</span><span class="n">colspan_</span> <span class="s">&quot;2&quot;</span><span class="p">,</span><span class="n">style_</span> <span class="s">&quot;color:red&quot;</span><span class="p">]</span>
                    <span class="p">(</span><span class="n">p_</span> <span class="s">&quot;Hello, attributes!&quot;</span><span class="p">)</span>
                <span class="n">td_</span> <span class="s">&quot;yay!&quot;</span><span class="p">))</span>
</pre></div>


<p>vs <code>html-do</code></p>
<div class="codehilite"><pre><span></span><span class="nf">element</span> <span class="o">#</span><span class="n">table</span> <span class="p">[</span><span class="o">#</span><span class="n">rows</span> <span class="o">=:</span> <span class="s">&quot;2&quot;</span><span class="p">]</span> <span class="kr">do</span>
  <span class="o">#</span><span class="n">tr</span> <span class="kr">do</span>
    <span class="o">#</span><span class="n">td</span> <span class="p">[</span><span class="o">#</span><span class="kr">class</span> <span class="o">=:</span> <span class="s">&quot;top&quot;</span><span class="p">,</span> <span class="o">#</span><span class="n">colspan</span> <span class="o">=:</span> <span class="s">&quot;2&quot;</span><span class="p">,</span> <span class="o">#</span><span class="n">style</span> <span class="o">=:</span> <span class="s">&quot;color:red&quot;</span><span class="p">]</span> <span class="kr">do</span>
      <span class="o">#</span><span class="n">p</span> <span class="s">&quot;Hello, attributes!&quot;</span>
    <span class="o">#</span><span class="n">td</span> <span class="s">&quot;yay!&quot;</span>
</pre></div></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/20a04d823b7c3891d78ca5f6a188ccd0e4fc5e3d?version=2"></a><div class="content"><a class="author">TheMatten</a><div class="metadata"><a href="#188718113" name="188718113"><div>2020-02-21 10:11:29</div></a></div><div class="text"><p>Without some sort of "html monad" that doesn't really make sense in context of building HTML declaratively</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/20a04d823b7c3891d78ca5f6a188ccd0e4fc5e3d?version=2"></a><div class="content"><a class="author">TheMatten</a><div class="metadata"><a href="#188728693" name="188728693"><div>2020-02-21 13:00:25</div></a></div><div class="text"><p>I've removed <code>(=:)</code> in favour of <code>IsLabel</code> instance:</p>
<div class="codehilite"><pre><span></span><span class="nf">element</span> <span class="o">#</span><span class="n">table</span> <span class="p">[</span><span class="o">#</span><span class="n">rows</span> <span class="s">&quot;2&quot;</span><span class="p">]</span> <span class="kr">do</span>
  <span class="o">#</span><span class="n">tr</span> <span class="kr">do</span>
    <span class="o">#</span><span class="n">td</span> <span class="p">[</span><span class="o">#</span><span class="kr">class</span> <span class="s">&quot;top&quot;</span><span class="p">,</span> <span class="o">#</span><span class="n">colspan</span> <span class="s">&quot;2&quot;</span><span class="p">,</span> <span class="o">#</span><span class="n">style</span> <span class="s">&quot;color:red&quot;</span><span class="p">]</span> <span class="kr">do</span>
      <span class="o">#</span><span class="n">p</span> <span class="s">&quot;Hello, attributes!&quot;</span>
    <span class="o">#</span><span class="n">td</span> <span class="s">&quot;yay!&quot;</span>
</pre></div></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/20a04d823b7c3891d78ca5f6a188ccd0e4fc5e3d?version=2"></a><div class="content"><a class="author">TheMatten</a><div class="metadata"><a href="#188728750" name="188728750"><div>2020-02-21 13:01:18</div></a></div><div class="text"><p>Now, question is - should I integrate this interface with existing library (<code>lucid</code>), or should it be self-contained?</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/4429aa8b689608f24a4ad712843ce29862e330d2?version=3"></a><div class="content"><a class="author">Sridhar Ratnakumar</a><div class="metadata"><a href="#188734521" name="188734521"><div>2020-02-21 14:15:48</div></a></div><div class="text"><p><span class="user-mention" data-user-id="225127">@TheMatten</span> Separate library, I'd think? A couple of things to note: a) not sure Chris would be open to changing the syntax of the lucid library in this manner, b) we could extend this syntax to CSS too, which means <code>html-do</code> could contain <code>css-do</code> ... as well as non-html xml documents like <code>svg-do</code> or <code>rss-do</code>.</p>
<p>Rib can easily switch to it, as long as this HTML monad will support including raw html somewhere inside.</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/4429aa8b689608f24a4ad712843ce29862e330d2?version=3"></a><div class="content"><a class="author">Sridhar Ratnakumar</a><div class="metadata"><a href="#188734764" name="188734764"><div>2020-02-21 14:18:09</div></a></div><div class="text"><p>About the attributes syntax,</p>
<div class="codehilite"><pre><span></span><span class="p">[</span><span class="o">#</span><span class="kr">class</span> <span class="s">&quot;top&quot;</span><span class="p">,</span> <span class="o">#</span><span class="n">colspan</span> <span class="s">&quot;2&quot;</span><span class="p">,</span> <span class="o">#</span><span class="n">style</span> <span class="s">&quot;color:red&quot;</span><span class="p">]</span>
</pre></div>


<p>Syntactically it looks good to me, however semantically it would be better to have this be a map than a list. What happens when there are duplicate attributes? <code>[#class "one", #class "two"]</code>?</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/4429aa8b689608f24a4ad712843ce29862e330d2?version=3"></a><div class="content"><a class="author">Sridhar Ratnakumar</a><div class="metadata"><a href="#188734956" name="188734956"><div>2020-02-21 14:20:38</div></a></div><div class="text"><p>(Okay, not sure about <code>css-do</code> -- because that's not even XML (and the <code>clay</code> library does a good job for now) -- but other formats like svg, and rss could definitely make use of this monadic syntax; in fact, I've been looking for one to generate RSS feeds on my website).</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/20a04d823b7c3891d78ca5f6a188ccd0e4fc5e3d?version=2"></a><div class="content"><a class="author">TheMatten</a><div class="metadata"><a href="#188735707" name="188735707"><div>2020-02-21 14:28:20</div></a></div><div class="text"><p>Ok - we will need to build our own pretty printer then (with sanitization and stuff)?<br>
a) I don't expect him to - I choose to not use <code>Monad</code> for HTML builder and instead expose <code>(&gt;&gt;)</code> for custom behaviour through <code>RebindableSyntax</code><br>
b) Not sure if CSS is as good fit as HTML for something like this - but if we can sort out syntax of selectors, it could be useful</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/4429aa8b689608f24a4ad712843ce29862e330d2?version=3"></a><div class="content"><a class="author">Sridhar Ratnakumar</a><div class="metadata"><a href="#188735809" name="188735809"><div>2020-02-21 14:29:40</div></a></div><div class="text"><p>It is not a monad? <span aria-label="thinking" class="emoji emoji-1f914" role="img" title="thinking">:thinking:</span></p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/20a04d823b7c3891d78ca5f6a188ccd0e4fc5e3d?version=2"></a><div class="content"><a class="author">TheMatten</a><div class="metadata"><a href="#188735857" name="188735857"><div>2020-02-21 14:30:03</div></a></div><div class="text"><div class="codehilite"><pre><span></span><span class="kr">class</span> <span class="kt">Sequence</span> <span class="n">x</span> <span class="n">y</span> <span class="kr">where</span>
  <span class="p">(</span><span class="o">&gt;&gt;</span><span class="p">)</span> <span class="ow">::</span> <span class="n">x</span> <span class="ow">-&gt;</span> <span class="n">y</span> <span class="ow">-&gt;</span> <span class="n">y</span>
</pre></div></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/20a04d823b7c3891d78ca5f6a188ccd0e4fc5e3d?version=2"></a><div class="content"><a class="author">TheMatten</a><div class="metadata"><a href="#188735914" name="188735914"><div>2020-02-21 14:30:28</div></a></div><div class="text"><div class="codehilite"><pre><span></span><span class="c1">-- | &#39;HTMLBuilder&#39;s can be sequenced by appending more children.</span>
<span class="kr">instance</span> <span class="p">(</span><span class="n">builder</span> <span class="o">~</span> <span class="kt">HTMLBuilder</span><span class="p">,</span> <span class="n">builder&#39;</span> <span class="o">~</span> <span class="kt">HTMLBuilder</span><span class="p">)</span>
      <span class="ow">=&gt;</span> <span class="kt">Sequence</span> <span class="n">builder</span> <span class="n">builder&#39;</span> <span class="kr">where</span>
  <span class="p">(</span><span class="o">&gt;&gt;</span><span class="p">)</span> <span class="ow">=</span> <span class="p">(</span><span class="o">&lt;&gt;</span><span class="p">)</span>

<span class="c1">-- | We fall back to &#39;Monad&#39; if type follows shape of @m a@.</span>
<span class="kr">instance</span> <span class="cm">{-# incoherent #-}</span> <span class="p">(</span><span class="kt">Monad</span> <span class="n">m</span><span class="p">,</span> <span class="n">ma</span> <span class="o">~</span> <span class="n">m</span> <span class="n">a</span><span class="p">)</span> <span class="ow">=&gt;</span> <span class="kt">Sequence</span> <span class="n">ma</span> <span class="p">(</span><span class="n">m</span> <span class="n">b</span><span class="p">)</span> <span class="kr">where</span>
  <span class="p">(</span><span class="o">&gt;&gt;</span><span class="p">)</span> <span class="ow">=</span> <span class="p">(</span><span class="kt">P</span><span class="o">.&gt;&gt;</span><span class="p">)</span>
</pre></div></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/20a04d823b7c3891d78ca5f6a188ccd0e4fc5e3d?version=2"></a><div class="content"><a class="author">TheMatten</a><div class="metadata"><a href="#188736120" name="188736120"><div>2020-02-21 14:32:29</div></a></div><div class="text"><p>If we want multiple formats other than HTML, this would be relaxed to:</p>
<div class="codehilite"><pre><span></span><span class="kr">instance</span> <span class="p">(</span><span class="n">builder</span> <span class="o">~</span> <span class="kt">HTMLBuilder</span><span class="p">)</span> <span class="ow">=&gt;</span> <span class="kt">Sequence</span> <span class="n">builder</span> <span class="kt">HTMLBuilder</span>
</pre></div>


<p>dropping <code>incoherent</code></p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/4429aa8b689608f24a4ad712843ce29862e330d2?version=3"></a><div class="content"><a class="author">Sridhar Ratnakumar</a><div class="metadata"><a href="#188736143" name="188736143"><div>2020-02-21 14:32:49</div></a></div><div class="text"><p>I can use <code>let</code> bindings and things in the <code>do</code> block?</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/20a04d823b7c3891d78ca5f6a188ccd0e4fc5e3d?version=2"></a><div class="content"><a class="author">TheMatten</a><div class="metadata"><a href="#188736182" name="188736182"><div>2020-02-21 14:33:19</div></a></div><div class="text"><p>You can use <code>let</code> - it desugars to <code>let .. in ..</code></p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/4429aa8b689608f24a4ad712843ce29862e330d2?version=3"></a><div class="content"><a class="author">Sridhar Ratnakumar</a><div class="metadata"><a href="#188736208" name="188736208"><div>2020-02-21 14:33:40</div></a></div><div class="text"><p>Also, interested in seeing how <code>State</code> can be used when constructing HTML. Looking forward to playing with the library!</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/4429aa8b689608f24a4ad712843ce29862e330d2?version=3"></a><div class="content"><a class="author">Sridhar Ratnakumar</a><div class="metadata"><a href="#188736495" name="188736495"><div>2020-02-21 14:36:39</div></a></div><div class="text"><p>Hmm, because of rebinding of core operators like <code>&gt;&gt;</code>, the HTML thing should be in its own module, right? Eg, this entire <code>renderPage</code> function (and anything else that constructs HTML) should be on its own module: <a href="https://github.com/srid/zulip-archive/blob/641a6fa/src/Main.hs#L111-L193" target="_blank" title="https://github.com/srid/zulip-archive/blob/641a6fa/src/Main.hs#L111-L193">https://github.com/srid/zulip-archive/blob/641a6fa/src/Main.hs#L111-L193</a></p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/srid/zulip-archive/blob/641a6fa/src/Main.hs#L111-L193" style="background-image: url(https://avatars2.githubusercontent.com/u/3998?s=400&amp;v=4)" target="_blank"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/srid/zulip-archive/blob/641a6fa/src/Main.hs#L111-L193" target="_blank" title="srid/zulip-archive">srid/zulip-archive</a></div><div class="message_embed_description">Zulip Archive viewer (statically generated HTML). Contribute to srid/zulip-archive development by creating an account on GitHub.</div></div></div></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/4429aa8b689608f24a4ad712843ce29862e330d2?version=3"></a><div class="content"><a class="author">Sridhar Ratnakumar</a><div class="metadata"><a href="#188736558" name="188736558"><div>2020-02-21 14:37:17</div></a></div><div class="text"><p>Even the clay Css monad cannot be used in the same module because of the rebinding? Is this a necessary limitation?</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/20a04d823b7c3891d78ca5f6a188ccd0e4fc5e3d?version=2"></a><div class="content"><a class="author">TheMatten</a><div class="metadata"><a href="#188736879" name="188736879"><div>2020-02-21 14:40:33</div></a></div><div class="text"><p>It doesn't have to be - you just change imports a little bit:</p>
<div class="codehilite"><pre><span></span><span class="kr">import</span> <span class="nn">Prelude</span> <span class="k">hiding</span> <span class="p">((</span><span class="o">&gt;&gt;</span><span class="p">))</span>
<span class="kr">import</span> <span class="nn">HTML.Do</span>
</pre></div></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/20a04d823b7c3891d78ca5f6a188ccd0e4fc5e3d?version=2"></a><div class="content"><a class="author">TheMatten</a><div class="metadata"><a href="#188736930" name="188736930"><div>2020-02-21 14:41:23</div></a></div><div class="text"><p>If you have some <code>State</code>, you probe it in some outer <code>do</code> - in same way as there's not syntax for binding inside of list literal - it doesn't make much sense</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/4429aa8b689608f24a4ad712843ce29862e330d2?version=3"></a><div class="content"><a class="author">Sridhar Ratnakumar</a><div class="metadata"><a href="#188736933" name="188736933"><div>2020-02-21 14:41:27</div></a></div><div class="text"><p>Well, let's say you use that import. Can you define <code>main :: IO ()</code> in that same module using <code>do</code> block? Wouldn't that use your Sequence's <code>&gt;&gt;</code> (instead of <code>Monad</code>'s <code>&gt;&gt;</code>)?</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/20a04d823b7c3891d78ca5f6a188ccd0e4fc5e3d?version=2"></a><div class="content"><a class="author">TheMatten</a><div class="metadata"><a href="#188736959" name="188736959"><div>2020-02-21 14:41:41</div></a></div><div class="text"><p>No - that's the trick <span aria-label="slight smile" class="emoji emoji-1f642" role="img" title="slight smile">:slight_smile:</span></p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/20a04d823b7c3891d78ca5f6a188ccd0e4fc5e3d?version=2"></a><div class="content"><a class="author">TheMatten</a><div class="metadata"><a href="#188737024" name="188737024"><div>2020-02-21 14:42:12</div></a></div><div class="text"><p>I actually test this to make sure it always works - <a href="https://gitlab.com/thematten/html-do" target="_blank" title="https://gitlab.com/thematten/html-do">https://gitlab.com/thematten/html-do</a></p>
<div class="message_embed"><a class="message_embed_image" href="https://gitlab.com/thematten/html-do" style="background-image: url(https://assets.gitlab-static.net/assets/gitlab_logo-7ae504fe4f68fdebb3c2034e36621930cd36ea87924c11ff65dbcb8ed50dca58.png)" target="_blank"></a><div class="data-container"><div class="message_embed_title"><a href="https://gitlab.com/thematten/html-do" target="_blank" title="TheMatten / html-do">TheMatten / html-do</a></div><div class="message_embed_description">GitLab.com</div></div></div></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/20a04d823b7c3891d78ca5f6a188ccd0e4fc5e3d?version=2"></a><div class="content"><a class="author">TheMatten</a><div class="metadata"><a href="#188737098" name="188737098"><div>2020-02-21 14:43:10</div></a></div><div class="text"><p>Normally, type of do notation is at least <code>m a</code> - that never unifies with <code>HTMLBuilder</code>, and so we can make use of it</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/4429aa8b689608f24a4ad712843ce29862e330d2?version=3"></a><div class="content"><a class="author">Sridhar Ratnakumar</a><div class="metadata"><a href="#188737293" name="188737293"><div>2020-02-21 14:45:22</div></a></div><div class="text"><p>I wonder how that works. IIUC, the compiler desugars <code>do</code> blocks using <code>&gt;&gt;</code> (and <code>&gt;&gt;=</code>), but <code>Monad</code>'s <code>&gt;&gt;</code> is <em>not</em> in scope.</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/4429aa8b689608f24a4ad712843ce29862e330d2?version=3"></a><div class="content"><a class="author">Sridhar Ratnakumar</a><div class="metadata"><a href="#188737491" name="188737491"><div>2020-02-21 14:47:09</div></a></div><div class="text"><p>Ah, because you defined an instance for it.</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/4429aa8b689608f24a4ad712843ce29862e330d2?version=3"></a><div class="content"><a class="author">Sridhar Ratnakumar</a><div class="metadata"><a href="#188738321" name="188738321"><div>2020-02-21 14:54:39</div></a></div><div class="text"><p>In order to switch to your library, I would be replacing (among others) lucid's <code>toHtmlRaw :: String -&gt; Html ()</code> with the corresponding function from html-do: <a href="https://github.com/srid/rib/blob/0351061/src/Rib/Parser/Pandoc.hs#L69" target="_blank" title="https://github.com/srid/rib/blob/0351061/src/Rib/Parser/Pandoc.hs#L69">https://github.com/srid/rib/blob/0351061/src/Rib/Parser/Pandoc.hs#L69</a></p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/srid/rib/blob/0351061/src/Rib/Parser/Pandoc.hs#L69" style="background-image: url(https://avatars2.githubusercontent.com/u/3998?s=400&amp;v=4)" target="_blank"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/srid/rib/blob/0351061/src/Rib/Parser/Pandoc.hs#L69" target="_blank" title="srid/rib">srid/rib</a></div><div class="message_embed_description">Haskell library for writing your own static site generator - srid/rib</div></div></div></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/20a04d823b7c3891d78ca5f6a188ccd0e4fc5e3d?version=2"></a><div class="content"><a class="author">TheMatten</a><div class="metadata"><a href="#188738491" name="188738491"><div>2020-02-21 14:56:11</div></a></div><div class="text"><p>Question is - is all you need one-directional HTML emitting? Because then <code>HTMLBuilder</code> could possibly just build final <code>Text</code> directly</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/4429aa8b689608f24a4ad712843ce29862e330d2?version=3"></a><div class="content"><a class="author">Sridhar Ratnakumar</a><div class="metadata"><a href="#188738585" name="188738585"><div>2020-02-21 14:57:14</div></a></div><div class="text"><p>Bidirectional. There is also <code>Lucid.renderText</code> that needs replacing: <a href="https://github.com/srid/rib/blob/251577b/src/Rib/Shake.hs#L138" target="_blank" title="https://github.com/srid/rib/blob/251577b/src/Rib/Shake.hs#L138">https://github.com/srid/rib/blob/251577b/src/Rib/Shake.hs#L138</a></p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/srid/rib/blob/251577b/src/Rib/Shake.hs#L138" style="background-image: url(https://avatars2.githubusercontent.com/u/3998?s=400&amp;v=4)" target="_blank"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/srid/rib/blob/251577b/src/Rib/Shake.hs#L138" target="_blank" title="srid/rib">srid/rib</a></div><div class="message_embed_description">Haskell library for writing your own static site generator - srid/rib</div></div></div></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/4429aa8b689608f24a4ad712843ce29862e330d2?version=3"></a><div class="content"><a class="author">Sridhar Ratnakumar</a><div class="metadata"><a href="#188738652" name="188738652"><div>2020-02-21 14:57:52</div></a></div><div class="text"><p>(It ultimately goes to a file on disk, so doesn't have to be pretty, but ideally should be small and valid)</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/20a04d823b7c3891d78ca5f6a188ccd0e4fc5e3d?version=2"></a><div class="content"><a class="author">TheMatten</a><div class="metadata"><a href="#188738850" name="188738850"><div>2020-02-21 14:59:52</div></a></div><div class="text"><p>So you're reading some HTML too?</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/4429aa8b689608f24a4ad712843ce29862e330d2?version=3"></a><div class="content"><a class="author">Sridhar Ratnakumar</a><div class="metadata"><a href="#188738852" name="188738852"><div>2020-02-21 14:59:54</div></a></div><div class="text"><p><code>toHtmlRaw</code> is needed when you get raw HTML from some source beyond your control (such as Pandoc's renderer, or the zulip API returning message raw HTML), and would like to incorporate it in your HTML syntactic monad.</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/20a04d823b7c3891d78ca5f6a188ccd0e4fc5e3d?version=2"></a><div class="content"><a class="author">TheMatten</a><div class="metadata"><a href="#188739932" name="188739932"><div>2020-02-21 15:09:12</div></a></div><div class="text"><p>Just to make sure we understand each other - <code>HTMLBuilder</code> isn't a <code>Monad</code>, it's a <code>Monoid</code> and <code>Sequence</code> allows us to use <code>do</code> notation for appending it's values, getting this nice syntax above as a result. This allows for easy HTML construction - parsing HTML is orthogonal problem, but it could be done by lib too, possibly using some mature dependency.</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/4429aa8b689608f24a4ad712843ce29862e330d2?version=3"></a><div class="content"><a class="author">Sridhar Ratnakumar</a><div class="metadata"><a href="#188740069" name="188740069"><div>2020-02-21 15:10:34</div></a></div><div class="text"><p>Gotcha. It is just monadic syntax (without being a monad). Or maybe we should call it do-syntax.</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/4429aa8b689608f24a4ad712843ce29862e330d2?version=3"></a><div class="content"><a class="author">Sridhar Ratnakumar</a><div class="metadata"><a href="#188740273" name="188740273"><div>2020-02-21 15:12:51</div></a></div><div class="text"><p>Can Blaze be used for the parsing HTML problem? Like lucid already does: <a href="https://github.com/chrisdone/lucid/blob/45a01bb14b491f376f498cd5eba8c3944a129681/src/Lucid/Base.hs#L247-L251" target="_blank" title="https://github.com/chrisdone/lucid/blob/45a01bb14b491f376f498cd5eba8c3944a129681/src/Lucid/Base.hs#L247-L251">https://github.com/chrisdone/lucid/blob/45a01bb14b491f376f498cd5eba8c3944a129681/src/Lucid/Base.hs#L247-L251</a></p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/chrisdone/lucid/blob/45a01bb14b491f376f498cd5eba8c3944a129681/src/Lucid/Base.hs#L247-L251" style="background-image: url(https://avatars3.githubusercontent.com/u/11019?s=400&amp;v=4)" target="_blank"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/chrisdone/lucid/blob/45a01bb14b491f376f498cd5eba8c3944a129681/src/Lucid/Base.hs#L247-L251" target="_blank" title="chrisdone/lucid">chrisdone/lucid</a></div><div class="message_embed_description">Clear to write, read and edit DSL for writing HTML - chrisdone/lucid</div></div></div></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/4429aa8b689608f24a4ad712843ce29862e330d2?version=3"></a><div class="content"><a class="author">Sridhar Ratnakumar</a><div class="metadata"><a href="#188740451" name="188740451"><div>2020-02-21 15:14:55</div></a></div><div class="text"><p>I mean, <code>blaze-html</code>: <a href="https://hackage.haskell.org/package/blaze-html-0.9.1.2/docs/Text-Blaze-Html.html" target="_blank" title="https://hackage.haskell.org/package/blaze-html-0.9.1.2/docs/Text-Blaze-Html.html">https://hackage.haskell.org/package/blaze-html-0.9.1.2/docs/Text-Blaze-Html.html</a></p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/4429aa8b689608f24a4ad712843ce29862e330d2?version=3"></a><div class="content"><a class="author">Sridhar Ratnakumar</a><div class="metadata"><a href="#188740518" name="188740518"><div>2020-02-21 15:15:35</div></a></div><div class="text"><p>That is, use Blaze's HTML datastructure (but not its monad) for representing the underlying HTML?</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/20a04d823b7c3891d78ca5f6a188ccd0e4fc5e3d?version=2"></a><div class="content"><a class="author">TheMatten</a><div class="metadata"><a href="#188740536" name="188740536"><div>2020-02-21 15:15:49</div></a></div><div class="text"><p>I guess the only reason for using <code>Monad</code> for HTML building is that it does not require <code>RebindableSyntax</code><br>
If <code>RebindableSyntax</code> is a problem, it could be changed - but to me it feels like a roundabout solution, basically being <code>Writer</code> for no good reason</p>
<p>We can use whatever works well I guess <span aria-label="big smile" class="emoji emoji-1f604" role="img" title="big smile">:big_smile:</span></p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/20a04d823b7c3891d78ca5f6a188ccd0e4fc5e3d?version=2"></a><div class="content"><a class="author">TheMatten</a><div class="metadata"><a href="#188740797" name="188740797"><div>2020-02-21 15:18:26</div></a></div><div class="text"><p>Okay, let's use <code>blaze-html</code> then - last question is if you're okay with reasoning behind <code>Sequence</code> or if <code>HTMLBuilder</code> should be "useless monad" too to avoid <code>RebindableSyntax</code> <span aria-label="slight smile" class="emoji emoji-1f642" role="img" title="slight smile">:slight_smile:</span></p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/4429aa8b689608f24a4ad712843ce29862e330d2?version=3"></a><div class="content"><a class="author">Sridhar Ratnakumar</a><div class="metadata"><a href="#188740805" name="188740805"><div>2020-02-21 15:18:30</div></a></div><div class="text"><p>(though the blaze datastructure is not general enough to incorporate any xml document)</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/4429aa8b689608f24a4ad712843ce29862e330d2?version=3"></a><div class="content"><a class="author">Sridhar Ratnakumar</a><div class="metadata"><a href="#188741084" name="188741084"><div>2020-02-21 15:21:09</div></a></div><div class="text"><p>I don't really know about the last question - I guess it depends on how it would work in practice. So far, all HTML construction I've done have been in pure functions, and that includes the use of <code>State</code>, which I needed to build some state while building the rows of a table. But because lucid used <code>HtmlT</code> monad, I ended up using <code>StateT</code>.</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/4429aa8b689608f24a4ad712843ce29862e330d2?version=3"></a><div class="content"><a class="author">Sridhar Ratnakumar</a><div class="metadata"><a href="#188741258" name="188741258"><div>2020-02-21 15:22:31</div></a></div><div class="text"><p>It seems to me that as an user of your library, it shouldn't matter - unless a real monad is needed when constructing HTML? Is that even a possible use case? (I certainly don't imagine someone doing <code>liftIO</code> in the midst of creating HTML tree)</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/20a04d823b7c3891d78ca5f6a188ccd0e4fc5e3d?version=2"></a><div class="content"><a class="author">TheMatten</a><div class="metadata"><a href="#188741416" name="188741416"><div>2020-02-21 15:24:03</div></a></div><div class="text"><p>I imagine that if one constructs HTML in some context, they build expression in same way as any other normal value:</p>
<div class="codehilite"><pre><span></span><span class="kr">do</span> <span class="n">a</span> <span class="ow">&lt;-</span> <span class="n">b</span>
   <span class="n">c</span> <span class="ow">&lt;-</span> <span class="n">d</span>
   <span class="n">pure</span> <span class="o">$</span> <span class="n">html</span> <span class="kr">do</span> <span class="o">..</span>
</pre></div></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/4429aa8b689608f24a4ad712843ce29862e330d2?version=3"></a><div class="content"><a class="author">Sridhar Ratnakumar</a><div class="metadata"><a href="#188741763" name="188741763"><div>2020-02-21 15:27:15</div></a></div><div class="text"><p>Can't think of what <code>b</code> and <code>d</code> would be, aside from State's <code>get</code> and <code>put</code>.</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/4429aa8b689608f24a4ad712843ce29862e330d2?version=3"></a><div class="content"><a class="author">Sridhar Ratnakumar</a><div class="metadata"><a href="#188741873" name="188741873"><div>2020-02-21 15:28:05</div></a></div><div class="text"><p>If <code>b</code> and <code>d</code> are computed <em>independent</em> of the HTML, they may as well be passed as (pure) arguments to the UI function.</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/4429aa8b689608f24a4ad712843ce29862e330d2?version=3"></a><div class="content"><a class="author">Sridhar Ratnakumar</a><div class="metadata"><a href="#188742030" name="188742030"><div>2020-02-21 15:29:35</div></a></div><div class="text"><p>Wait, can you even use <code>State</code> with your Sequence-based do syntax?</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/20a04d823b7c3891d78ca5f6a188ccd0e4fc5e3d?version=2"></a><div class="content"><a class="author">TheMatten</a><div class="metadata"><a href="#188742183" name="188742183"><div>2020-02-21 15:30:38</div></a></div><div class="text"><p>Can it be <em>dependent</em> on HTML in any way?<br>
You can use do syntax as normally - custom <code>HTMLBuilder</code> instance is only selected when you use custom combinators</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/4429aa8b689608f24a4ad712843ce29862e330d2?version=3"></a><div class="content"><a class="author">Sridhar Ratnakumar</a><div class="metadata"><a href="#188742480" name="188742480"><div>2020-02-21 15:33:20</div></a></div><div class="text"><p>See this example where I use <code>State</code> in the midst of HTML construction: </p>
<div class="codehilite"><pre><span></span><span class="nf">renderBirdsEyeView</span> <span class="ow">::</span> <span class="kt">Monad</span> <span class="n">m</span> <span class="ow">=&gt;</span> <span class="kt">Calendar</span> <span class="p">(</span><span class="kt">DMap</span> <span class="kt">Tracking</span> <span class="kt">Identity</span><span class="p">)</span> <span class="ow">-&gt;</span> <span class="kt">HtmlT</span> <span class="n">m</span> <span class="nb">()</span>
<span class="nf">renderBirdsEyeView</span> <span class="n">entries</span> <span class="ow">=</span> <span class="kr">do</span>
  <span class="n">with</span> <span class="n">table_</span> <span class="p">[</span><span class="n">class_</span> <span class="s">&quot;ui very basic unstackable compact table birdseye&quot;</span><span class="p">]</span> <span class="o">$</span> <span class="kr">do</span>
    <span class="n">thead_</span> <span class="o">$</span> <span class="n">tr_</span> <span class="o">$</span> <span class="kr">do</span>
      <span class="n">with</span> <span class="n">th_</span> <span class="p">[</span><span class="n">class_</span> <span class="s">&quot;two wide&quot;</span><span class="p">]</span> <span class="s">&quot;&quot;</span>
      <span class="n">forM_</span> <span class="n">factors</span> <span class="o">$</span> <span class="nf">\</span><span class="n">a</span> <span class="ow">-&gt;</span>
        <span class="n">with</span> <span class="n">th_</span> <span class="p">[</span><span class="n">class_</span> <span class="s">&quot;two wide&quot;</span><span class="p">]</span> <span class="o">$</span> <span class="n">factorTitle</span> <span class="n">a</span>
    <span class="n">tbody_</span> <span class="o">$</span> <span class="kr">do</span>
      <span class="n">withHtmlT</span> <span class="p">(</span><span class="n">fmap</span> <span class="n">fst</span> <span class="o">.</span> <span class="n">flip</span> <span class="n">runStateT</span> <span class="n">mempty</span><span class="p">)</span>
        <span class="o">$</span> <span class="n">forM_</span> <span class="p">(</span><span class="n">reverse</span> <span class="n">entries</span><span class="p">)</span>
        <span class="o">$</span> <span class="n">renderEntry</span>
  <span class="kr">where</span>
    <span class="n">withHtmlT</span> <span class="n">f</span> <span class="ow">=</span> <span class="kt">HtmlT</span> <span class="o">.</span> <span class="n">f</span> <span class="o">.</span> <span class="n">runHtmlT</span>
    <span class="n">renderEntry</span> <span class="ow">::</span> <span class="p">(</span><span class="kt">Monad</span> <span class="n">m</span><span class="p">,</span> <span class="kt">MonadState</span> <span class="p">(</span><span class="kt">Map</span> <span class="kt">Factor</span> <span class="kt">Int</span><span class="p">)</span> <span class="n">m</span><span class="p">)</span> <span class="ow">=&gt;</span> <span class="p">(</span><span class="kt">Day</span><span class="p">,</span> <span class="kt">DMap</span> <span class="kt">Tracking</span> <span class="kt">Identity</span><span class="p">)</span> <span class="ow">-&gt;</span> <span class="kt">HtmlT</span> <span class="n">m</span> <span class="nb">()</span>
    <span class="n">renderEntry</span> <span class="p">(</span><span class="n">day</span><span class="p">,</span> <span class="n">tracks</span><span class="p">)</span> <span class="ow">=</span>
      <span class="n">tr_</span> <span class="o">$</span> <span class="kr">do</span>
        <span class="kr">let</span> <span class="n">entry</span> <span class="ow">=</span> <span class="n">maybe</span> <span class="p">(</span><span class="ne">error</span> <span class="s">&quot;No activity&quot;</span><span class="p">)</span> <span class="n">runIdentity</span> <span class="o">$</span> <span class="kt">DMap</span><span class="o">.</span><span class="n">lookup</span> <span class="kt">Tracking_Activity</span> <span class="n">tracks</span>
        <span class="c1">-- feelings = runIdentity &lt;$&gt; DMap.lookup Tracking_Feeling tracks</span>
        <span class="n">with</span> <span class="n">td_</span> <span class="p">[</span><span class="n">class_</span> <span class="s">&quot;day&quot;</span><span class="p">]</span> <span class="o">$</span> <span class="kr">do</span>
          <span class="kr">let</span> <span class="n">dayS</span> <span class="ow">=</span> <span class="n">formatTime</span> <span class="n">defaultTimeLocale</span> <span class="s">&quot;%m/%d&quot;</span> <span class="n">day</span>
          <span class="n">renderMood</span> <span class="p">(</span><span class="n">skin</span> <span class="n">entry</span><span class="p">)</span>
            <span class="o">$</span> <span class="n">with</span> <span class="n">a_</span> <span class="p">[</span><span class="n">href_</span> <span class="s">&quot;./&quot;</span><span class="p">]</span>
            <span class="o">$</span> <span class="n">toHtml</span> <span class="n">dayS</span>
        <span class="n">forM_</span> <span class="n">factors</span> <span class="o">$</span> <span class="nf">\</span><span class="n">factor</span> <span class="ow">-&gt;</span> <span class="n">td_</span> <span class="o">$</span>
          <span class="n">renderFactor</span> <span class="n">tracks</span> <span class="n">factor</span> <span class="o">&gt;&gt;=</span> <span class="nf">\</span><span class="kr">case</span>
            <span class="kt">Just</span> <span class="kt">True</span> <span class="ow">-&gt;</span> <span class="kr">do</span>
              <span class="n">fmap</span> <span class="p">(</span><span class="kt">Map</span><span class="o">.</span><span class="n">lookup</span> <span class="n">factor</span><span class="p">)</span> <span class="n">get</span> <span class="o">&gt;&gt;=</span> <span class="nf">\</span><span class="kr">case</span>
                <span class="kt">Just</span> <span class="mi">6</span> <span class="ow">-&gt;</span> <span class="kr">do</span>
                  <span class="n">modify</span> <span class="o">$</span> <span class="kt">Map</span><span class="o">.</span><span class="n">insert</span> <span class="n">factor</span> <span class="mi">0</span>
                  <span class="s">&quot;7&quot;</span>
                <span class="kt">Just</span> <span class="n">n</span> <span class="ow">-&gt;</span>
                  <span class="n">modify</span> <span class="o">$</span> <span class="kt">Map</span><span class="o">.</span><span class="n">insert</span> <span class="n">factor</span> <span class="p">(</span><span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
                <span class="kt">Nothing</span> <span class="ow">-&gt;</span>
                  <span class="n">modify</span> <span class="o">$</span> <span class="kt">Map</span><span class="o">.</span><span class="n">insert</span> <span class="n">factor</span> <span class="mi">1</span>
            <span class="kt">Just</span> <span class="kt">False</span> <span class="ow">-&gt;</span> <span class="kr">do</span>
              <span class="n">modify</span> <span class="o">$</span> <span class="kt">Map</span><span class="o">.</span><span class="n">delete</span> <span class="n">factor</span>
            <span class="kt">Nothing</span> <span class="ow">-&gt;</span>
              <span class="n">pure</span> <span class="nb">()</span>
    <span class="n">acts</span> <span class="ow">=</span> <span class="p">[</span><span class="kt">Ate</span> <span class="n">boneMarrow</span><span class="p">,</span> <span class="kt">Ate</span> <span class="n">costcoScallop</span><span class="p">,</span> <span class="kt">Ate</span> <span class="p">(</span><span class="kt">D</span> <span class="kt">Cheese</span><span class="p">),</span> <span class="kt">WentOut</span><span class="p">]</span>
    <span class="n">factors</span> <span class="ow">=</span> <span class="p">[</span><span class="kt">Factor_Mood</span><span class="p">,</span> <span class="kt">Factor_Meals</span><span class="p">,</span> <span class="kt">Factor_Coffee</span><span class="p">,</span> <span class="kt">Factor_Egg</span><span class="p">,</span> <span class="kt">Factor_Spice</span><span class="p">]</span> <span class="o">&lt;&gt;</span> <span class="n">fmap</span> <span class="kt">Factor_DidAct</span> <span class="n">acts</span>
</pre></div></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/4429aa8b689608f24a4ad712843ce29862e330d2?version=3"></a><div class="content"><a class="author">Sridhar Ratnakumar</a><div class="metadata"><a href="#188742525" name="188742525"><div>2020-02-21 15:33:57</div></a></div><div class="text"><p>Basically it builds a table, and for every 7th row if a particular food item had been consumed every day non-stop, puts the string "7" in that table cell.</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/4429aa8b689608f24a4ad712843ce29862e330d2?version=3"></a><div class="content"><a class="author">Sridhar Ratnakumar</a><div class="metadata"><a href="#188742621" name="188742621"><div>2020-02-21 15:34:36</div></a></div><div class="text"><p>Screenshot: <a href="/user_uploads/13896/ZFX150sQVxoqPUvitlHyXG48/image.png" target="_blank" title="image.png">image.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/13896/ZFX150sQVxoqPUvitlHyXG48/image.png" target="_blank" title="image.png"><img src="/user_uploads/13896/ZFX150sQVxoqPUvitlHyXG48/image.png"></a></div></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/4429aa8b689608f24a4ad712843ce29862e330d2?version=3"></a><div class="content"><a class="author">Sridhar Ratnakumar</a><div class="metadata"><a href="#188743230" name="188743230"><div>2020-02-21 15:40:25</div></a></div><div class="text"><p>Oh, and notice the use of <code>&gt;&gt;=</code>. So I guess monad is useful after all ...</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/4429aa8b689608f24a4ad712843ce29862e330d2?version=3"></a><div class="content"><a class="author">Sridhar Ratnakumar</a><div class="metadata"><a href="#188743306" name="188743306"><div>2020-02-21 15:41:11</div></a></div><div class="text"><p>That function is defined as <code>renderFactor :: Monad m =&gt; DMap Tracking Identity -&gt; Factor -&gt; HtmlT m (Maybe Bool)</code></p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/4429aa8b689608f24a4ad712843ce29862e330d2?version=3"></a><div class="content"><a class="author">Sridhar Ratnakumar</a><div class="metadata"><a href="#188743414" name="188743414"><div>2020-02-21 15:42:05</div></a></div><div class="text"><p>(Idle curiosity: how would this all look if we were to use polysemy instead?)</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/20a04d823b7c3891d78ca5f6a188ccd0e4fc5e3d?version=2"></a><div class="content"><a class="author">TheMatten</a><div class="metadata"><a href="#188743972" name="188743972"><div>2020-02-21 15:47:46</div></a></div><div class="text"><p>Ah, so monadic builder makes sense for making effectful combinators without having to use <code>&lt;$&gt;</code>/<code>&lt;*&gt;</code> I guess</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/20a04d823b7c3891d78ca5f6a188ccd0e4fc5e3d?version=2"></a><div class="content"><a class="author">TheMatten</a><div class="metadata"><a href="#188744840" name="188744840"><div>2020-02-21 15:55:18</div></a></div><div class="text"><p>In <code>polysemy</code> it would be <code>renderBirdsEyeView :: Member HTML r =&gt; Calendar (DMap Tracking Identity) -&gt; Sem r ()</code> with code roughly the same I guess</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/20a04d823b7c3891d78ca5f6a188ccd0e4fc5e3d?version=2"></a><div class="content"><a class="author">TheMatten</a><div class="metadata"><a href="#188746721" name="188746721"><div>2020-02-21 16:13:41</div></a></div><div class="text"><p>Okay - so at the end, let's say we build interface that allows something like:</p>
<div class="codehilite"><pre><span></span><span class="nf">renderBirdsEyeView</span> <span class="n">entries</span> <span class="ow">=</span> <span class="n">element</span>
  <span class="o">#</span><span class="n">table</span> <span class="p">[</span><span class="o">#</span><span class="kr">class</span> <span class="s">&quot;ui very basic unstackable compact table birdseye&quot;</span><span class="p">]</span> <span class="kr">do</span>
    <span class="o">#</span><span class="n">thead</span> <span class="o">$</span> <span class="o">#</span><span class="n">tr</span> <span class="kr">do</span>
      <span class="o">#</span><span class="n">th</span> <span class="p">[</span><span class="o">#</span><span class="kr">class</span> <span class="s">&quot;two wide&quot;</span><span class="p">]</span> <span class="s">&quot;&quot;</span>
      <span class="n">forM_</span> <span class="n">factors</span> <span class="nf">\</span><span class="n">a</span> <span class="ow">-&gt;</span>
        <span class="o">#</span><span class="n">th</span> <span class="p">[</span><span class="o">#</span><span class="kr">class</span> <span class="s">&quot;two wide&quot;</span><span class="p">]</span> <span class="o">$</span> <span class="n">factorTitle</span> <span class="n">a</span>
    <span class="o">#</span><span class="n">tbody</span> <span class="o">$</span> <span class="n">fmap</span> <span class="n">fst</span> <span class="o">$</span> <span class="n">runState</span> <span class="n">mempty</span>
        <span class="o">$</span> <span class="n">forM_</span> <span class="p">(</span><span class="n">reverse</span> <span class="n">entries</span><span class="p">)</span>
        <span class="o">$</span> <span class="n">renderEntry</span>
</pre></div></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/4429aa8b689608f24a4ad712843ce29862e330d2?version=3"></a><div class="content"><a class="author">Sridhar Ratnakumar</a><div class="metadata"><a href="#188750278" name="188750278"><div>2020-02-21 16:48:28</div></a></div><div class="text"><p>That looks good.</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/4429aa8b689608f24a4ad712843ce29862e330d2?version=3"></a><div class="content"><a class="author">Sridhar Ratnakumar</a><div class="metadata"><a href="#188750361" name="188750361"><div>2020-02-21 16:49:35</div></a></div><div class="text"><p>What would be the type of the second argument to <code>runState</code> here?</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/20a04d823b7c3891d78ca5f6a188ccd0e4fc5e3d?version=2"></a><div class="content"><a class="author">TheMatten</a><div class="metadata"><a href="#188751228" name="188751228"><div>2020-02-21 16:58:12</div></a></div><div class="text"><p><code>Sem (State (Map ..) : r) ()</code></p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/20a04d823b7c3891d78ca5f6a188ccd0e4fc5e3d?version=2"></a><div class="content"><a class="author">TheMatten</a><div class="metadata"><a href="#188828665" name="188828665"><div>2020-02-22 18:50:07</div></a></div><div class="text"><p>Now there's version using <code>blaze-markup</code> in <a href="https://gitlab.com/thematten/html-do/-/tree/blaze-html" target="_blank" title="https://gitlab.com/thematten/html-do/-/tree/blaze-html">https://gitlab.com/thematten/html-do/-/tree/blaze-html</a> - see <code>HTML.DoSpec</code> for examples</p>
<div class="message_embed"><a class="message_embed_image" href="https://gitlab.com/thematten/html-do/-/tree/blaze-html" style="background-image: url(https://assets.gitlab-static.net/assets/gitlab_logo-7ae504fe4f68fdebb3c2034e36621930cd36ea87924c11ff65dbcb8ed50dca58.png)" target="_blank"></a><div class="data-container"><div class="message_embed_title"><a href="https://gitlab.com/thematten/html-do/-/tree/blaze-html" target="_blank" title="Files  blaze-html  TheMatten / html-do">Files  blaze-html  TheMatten / html-do</a></div><div class="message_embed_description">GitLab.com</div></div></div></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/20a04d823b7c3891d78ca5f6a188ccd0e4fc5e3d?version=2"></a><div class="content"><a class="author">TheMatten</a><div class="metadata"><a href="#188828670" name="188828670"><div>2020-02-22 18:50:31</div></a></div><div class="text"><p>You can use <code>Text.Blaze.Renderer.Pretty.renderMarkup</code> to print them</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/20a04d823b7c3891d78ca5f6a188ccd0e4fc5e3d?version=2"></a><div class="content"><a class="author">TheMatten</a><div class="metadata"><a href="#188828674" name="188828674"><div>2020-02-22 18:50:52</div></a></div><div class="text"><p>Oh, I need to add <code>raw</code></p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/20a04d823b7c3891d78ca5f6a188ccd0e4fc5e3d?version=2"></a><div class="content"><a class="author">TheMatten</a><div class="metadata"><a href="#188828688" name="188828688"><div>2020-02-22 18:51:59</div></a></div><div class="text"><p>And I'll probably add <code>Prelude.HTML.Do</code> that selects right <code>(&gt;&gt;)</code> for you</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/4429aa8b689608f24a4ad712843ce29862e330d2?version=3"></a><div class="content"><a class="author">Sridhar Ratnakumar</a><div class="metadata"><a href="#188828793" name="188828793"><div>2020-02-22 18:54:08</div></a></div><div class="text"><p>Nice. Once there is both 'raw2html' and 'html2raw' - we can try integrating it with rib ...</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/20a04d823b7c3891d78ca5f6a188ccd0e4fc5e3d?version=2"></a><div class="content"><a class="author">TheMatten</a><div class="metadata"><a href="#188829031" name="188829031"><div>2020-02-22 19:01:17</div></a></div><div class="text"><p>You want <code>raw2html</code> for embedding stringly pieces of HTML or for actual parsing?</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/4429aa8b689608f24a4ad712843ce29862e330d2?version=3"></a><div class="content"><a class="author">Sridhar Ratnakumar</a><div class="metadata"><a href="#188829549" name="188829549"><div>2020-02-22 19:17:17</div></a></div><div class="text"><p>Just to embed it in the HTML do thingy. Think of putting the raw Zulip message HTML coming from their API somewhere in your existing HTML do syntax.</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/4429aa8b689608f24a4ad712843ce29862e330d2?version=3"></a><div class="content"><a class="author">Sridhar Ratnakumar</a><div class="metadata"><a href="#188829560" name="188829560"><div>2020-02-22 19:17:55</div></a></div><div class="text"><p>(No need to actually parse it; but ultimately the raw HTML should appear as expected in the final 'rendered' HTML text)</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/20a04d823b7c3891d78ca5f6a188ccd0e4fc5e3d?version=2"></a><div class="content"><a class="author">TheMatten</a><div class="metadata"><a href="#188834300" name="188834300"><div>2020-02-22 21:38:40</div></a></div><div class="text"><p>Done - I'm now pretty happy with it's interface (though threading <code>Sem</code> through was not feasible - let's just bind effects upfront before using html syntax):<br>
<a href="https://gitlab.com/thematten/html-do" target="_blank" title="https://gitlab.com/thematten/html-do">https://gitlab.com/thematten/html-do</a></p>
<div class="message_embed"><a class="message_embed_image" href="https://gitlab.com/thematten/html-do" style="background-image: url(https://assets.gitlab-static.net/assets/gitlab_logo-7ae504fe4f68fdebb3c2034e36621930cd36ea87924c11ff65dbcb8ed50dca58.png)" target="_blank"></a><div class="data-container"><div class="message_embed_title"><a href="https://gitlab.com/thematten/html-do" target="_blank" title="TheMatten / html-do">TheMatten / html-do</a></div><div class="message_embed_description">GitLab.com</div></div></div></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/20a04d823b7c3891d78ca5f6a188ccd0e4fc5e3d?version=2"></a><div class="content"><a class="author">TheMatten</a><div class="metadata"><a href="#188864992" name="188864992"><div>2020-02-23 11:15:36</div></a></div><div class="text"><p>Added few more small changes<br>
Haha, support for <code>html-do</code> in <code>rib</code> may actually end up being reason for me to use it in the future <span aria-label="big smile" class="emoji emoji-1f604" role="img" title="big smile">:big_smile:</span> <br>
I may later find some time to do <code>css-do</code> too if it turns out to work nicely <span aria-label="slight smile" class="emoji emoji-1f642" role="img" title="slight smile">:slight_smile:</span></p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/20a04d823b7c3891d78ca5f6a188ccd0e4fc5e3d?version=2"></a><div class="content"><a class="author">TheMatten</a><div class="metadata"><a href="#188877198" name="188877198"><div>2020-02-23 17:44:36</div></a></div><div class="text"><p>When it comes to CSS, would something like:</p>
<div class="codehilite"><pre><span></span><span class="s">&quot;strong&quot;</span> <span class="kr">do</span>
  <span class="s">&quot;color&quot;</span> <span class="s">&quot;red&quot;</span>

<span class="s">&quot;div.menu-bar li:hover &gt; ul&quot;</span> <span class="kr">do</span>
  <span class="s">&quot;display&quot;</span> <span class="s">&quot;block&quot;</span>
</pre></div>


<p>be useful in any way?</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/20a04d823b7c3891d78ca5f6a188ccd0e4fc5e3d?version=2"></a><div class="content"><a class="author">TheMatten</a><div class="metadata"><a href="#188877297" name="188877297"><div>2020-02-23 17:47:48</div></a></div><div class="text"><p>We can't use labels, because they can't contain <code>-</code> - this looks a little bit stringy, plus I guess in CSS there's not that much interest in filling values dynamically</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/20a04d823b7c3891d78ca5f6a188ccd0e4fc5e3d?version=2"></a><div class="content"><a class="author">TheMatten</a><div class="metadata"><a href="#188877338" name="188877338"><div>2020-02-23 17:48:06</div></a></div><div class="text"><p><span class="user-mention" data-user-id="251311">@Sridhar Ratnakumar</span> <span aria-label="up" class="emoji emoji-2b06" role="img" title="up">:up:</span></p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/4429aa8b689608f24a4ad712843ce29862e330d2?version=3"></a><div class="content"><a class="author">Sridhar Ratnakumar</a><div class="metadata"><a href="#188877925" name="188877925"><div>2020-02-23 18:04:08</div></a></div><div class="text"><p>The CSS stuff should disallow invalid combinations. Like <code>display: 2px</code>. Clay does this. In Clay you have to use strings for selectors like "div.menu-bar", but Clay also allows plain <code>display</code> function.</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/4429aa8b689608f24a4ad712843ce29862e330d2?version=3"></a><div class="content"><a class="author">Sridhar Ratnakumar</a><div class="metadata"><a href="#188877946" name="188877946"><div>2020-02-23 18:05:36</div></a></div><div class="text"><p>Example: <a href="https://github.com/srid/website/blob/a0e8db4/src/Website/View/CSS.hs" target="_blank" title="https://github.com/srid/website/blob/a0e8db4/src/Website/View/CSS.hs">https://github.com/srid/website/blob/a0e8db4/src/Website/View/CSS.hs</a></p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/srid/website/blob/a0e8db4/src/Website/View/CSS.hs" style="background-image: url(https://avatars2.githubusercontent.com/u/3998?s=400&amp;v=4)" target="_blank"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/srid/website/blob/a0e8db4/src/Website/View/CSS.hs" target="_blank" title="srid/website">srid/website</a></div><div class="message_embed_description">Source for my website. Contribute to srid/website development by creating an account on GitHub.</div></div></div></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/20a04d823b7c3891d78ca5f6a188ccd0e4fc5e3d?version=2"></a><div class="content"><a class="author">TheMatten</a><div class="metadata"><a href="#188878067" name="188878067"><div>2020-02-23 18:09:25</div></a></div><div class="text"><p>I guess with CSS being more rigid and "typed", approach with labels does not make that much sense - you have to define all the properties in library anyway<br>
Are there some pain points in <code>clay</code> that could be solved with new interface, or is it good enough to stay with it?</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/4429aa8b689608f24a4ad712843ce29862e330d2?version=3"></a><div class="content"><a class="author">Sridhar Ratnakumar</a><div class="metadata"><a href="#188878152" name="188878152"><div>2020-02-23 18:11:55</div></a></div><div class="text"><p>I think Clay is good enough.</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/4429aa8b689608f24a4ad712843ce29862e330d2?version=3"></a><div class="content"><a class="author">Sridhar Ratnakumar</a><div class="metadata"><a href="#188878250" name="188878250"><div>2020-02-23 18:14:04</div></a></div><div class="text"><p>Rib might need a small refactoring to avoid assuming HTML builder, but to begin with <a href="https://github.com/srid/rib-sample/blob/7ce0bd6/src/Main.hs#L93-L119" target="_blank" title="https://github.com/srid/rib-sample/blob/7ce0bd6/src/Main.hs#L93-L119">https://github.com/srid/rib-sample/blob/7ce0bd6/src/Main.hs#L93-L119</a> can be replaced with your HTML-do stuff while the <code>Rib.writeHtml</code> above is replaced with <code>Rib.writeFileCached . yourRenderFunction</code>.  </p>
<p>(In case if you are interested in poking around; otherwise I will get to it later)</p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/srid/rib-sample/blob/7ce0bd6/src/Main.hs#L93-L119" style="background-image: url(https://avatars2.githubusercontent.com/u/3998?s=400&amp;v=4)" target="_blank"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/srid/rib-sample/blob/7ce0bd6/src/Main.hs#L93-L119" target="_blank" title="srid/rib-sample">srid/rib-sample</a></div><div class="message_embed_description">Sample site for the Rib static site generator. Contribute to srid/rib-sample development by creating an account on GitHub.</div></div></div></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/4429aa8b689608f24a4ad712843ce29862e330d2?version=3"></a><div class="content"><a class="author">Sridhar Ratnakumar</a><div class="metadata"><a href="#188878260" name="188878260"><div>2020-02-23 18:14:44</div></a></div><div class="text"><p>(I also need to get rid of , or improve, the<code>Rib.{load,write}Target</code> ugliness using this opportunity)</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/4429aa8b689608f24a4ad712843ce29862e330d2?version=3"></a><div class="content"><a class="author">Sridhar Ratnakumar</a><div class="metadata"><a href="#188887366" name="188887366"><div>2020-02-23 22:36:27</div></a></div><div class="text"><p>Hacking on this, if anybody want to pair (tmate)</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/4429aa8b689608f24a4ad712843ce29862e330d2?version=3"></a><div class="content"><a class="author">Sridhar Ratnakumar</a><div class="metadata"><a href="#188888062" name="188888062"><div>2020-02-23 22:58:39</div></a></div><div class="text"><p><span class="user-mention" data-user-id="225127">@TheMatten</span> Think I've found a problem. You can't use a monad as argument to those label thingies? For eg.,</p>
<div class="codehilite"><pre><span></span><span class="o">#</span><span class="n">div</span> <span class="o">$</span> <span class="n">forM_</span> <span class="n">srcs</span> <span class="o">$</span> <span class="nf">\</span><span class="n">src</span> <span class="ow">-&gt;</span>
  <span class="o">#</span><span class="n">li</span> <span class="p">[</span><span class="o">#</span><span class="kr">class</span> <span class="s">&quot;pages&quot;</span><span class="p">]</span> <span class="o">$</span> <span class="kr">do</span>
     <span class="p">[</span><span class="o">...</span><span class="p">]</span>
</pre></div>


<p>gives:</p>
<div class="codehilite"><pre><span></span>     Couldn&#39;t match type m0 () with HTML
        arising from the overloaded label #div
 ```
</pre></div></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/4429aa8b689608f24a4ad712843ce29862e330d2?version=3"></a><div class="content"><a class="author">Sridhar Ratnakumar</a><div class="metadata"><a href="#188888124" name="188888124"><div>2020-02-23 23:00:46</div></a></div><div class="text"><p>To reproduce, follow the README in the <code>html-do</code> branch of this repo: <a href="https://github.com/srid/rib-sample/tree/html-do" target="_blank" title="https://github.com/srid/rib-sample/tree/html-do">https://github.com/srid/rib-sample/tree/html-do</a></p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/srid/rib-sample/tree/html-do" style="background-image: url(https://avatars2.githubusercontent.com/u/3998?s=400&amp;v=4)" target="_blank"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/srid/rib-sample/tree/html-do" target="_blank" title="srid/rib-sample">srid/rib-sample</a></div><div class="message_embed_description">Sample site for the Rib static site generator. Contribute to srid/rib-sample development by creating an account on GitHub.</div></div></div></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/20a04d823b7c3891d78ca5f6a188ccd0e4fc5e3d?version=2"></a><div class="content"><a class="author">TheMatten</a><div class="metadata"><a href="#188924940" name="188924940"><div>2020-02-24 13:22:18</div></a></div><div class="text"><p>Hmmmm, let's just put this thing on top of Lucid - I won't be able to avoid something like <code>HtmlT</code> if we want monadic HTML</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/20a04d823b7c3891d78ca5f6a188ccd0e4fc5e3d?version=2"></a><div class="content"><a class="author">TheMatten</a><div class="metadata"><a href="#190207943" name="190207943"><div>2020-03-10 18:29:03</div></a></div><div class="text"><p>(BTW, I didn't forget about this - once I resolve some inference problems I will push lucid version out <span aria-label="slight smile" class="emoji emoji-1f642" role="img" title="slight smile">:slight_smile:</span> )</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/20a04d823b7c3891d78ca5f6a188ccd0e4fc5e3d?version=2"></a><div class="content"><a class="author">TheMatten</a><div class="metadata"><a href="#198464102" name="198464102"><div>2020-05-22 16:38:36</div></a></div><div class="text"><p>So I forgot about this after all <span aria-label="joy" class="emoji emoji-1f602" role="img" title="joy">:joy:</span> - but <code>QualifiedDo</code> <a href="https://github.com/ghc-proposals/ghc-proposals/pull/216">was accepted</a> and may come in 8.12, so we won't need ugly tricks with <code>RebindableSyntax</code> to use <code>do</code> blocks</p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/ghc-proposals/ghc-proposals/pull/216" style="background-image: url(https://avatars0.githubusercontent.com/u/20374637?s=400&amp;v=4)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/ghc-proposals/ghc-proposals/pull/216" title="Qualified do by aspiwack  Pull Request #216  ghc-proposals/ghc-proposals">Qualified do by aspiwack  Pull Request #216  ghc-proposals/ghc-proposals</a></div><div class="message_embed_description">The proposal has been accepted; the following discussion is mostly of historic interest.

This proposal introduces a mechanism to override the meaning of a do-notation block (a bit like with -XRebi...</div></div></div></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/4429aa8b689608f24a4ad712843ce29862e330d2?version=3"></a><div class="content"><a class="author">Sridhar Ratnakumar</a><div class="metadata"><a href="#232641008" name="232641008"><div>2021-03-31 18:25:20</div></a></div><div class="text"><p><span class="user-mention" data-user-id="225127">@TheMatten</span> Any news on your HTML DSL attempts?</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/4429aa8b689608f24a4ad712843ce29862e330d2?version=3"></a><div class="content"><a class="author">Sridhar Ratnakumar</a><div class="metadata"><a href="#232641237" name="232641237"><div>2021-03-31 18:26:51</div></a></div><div class="text"><p>(btw, this topic comes up in 1st page of google when searching for <code>haskell html dsl</code> <span aria-label="grinning" class="emoji emoji-1f600" role="img" title="grinning">:grinning:</span>)</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/20a04d823b7c3891d78ca5f6a188ccd0e4fc5e3d?version=2"></a><div class="content"><a class="author">TheMatten</a><div class="metadata"><a href="#232651998" name="232651998"><div>2021-03-31 19:36:56</div></a></div><div class="text"><p>So we have <code>QualifiedDo</code> now and thus we could do something like:</p>
<div class="codehilite" data-code-language="Haskell"><pre><span></span><code><span class="kr">module</span> <span class="nn">HTML</span> <span class="kr">where</span>
  <span class="kr">data</span> <span class="kt">HTML</span>
  <span class="p">(</span><span class="o">&gt;&gt;</span><span class="p">)</span> <span class="ow">::</span> <span class="kt">HTML</span> <span class="ow">-&gt;</span> <span class="kt">HTML</span> <span class="ow">-&gt;</span> <span class="kt">HTML</span>
  <span class="o">...</span>
<span class="kr">module</span> <span class="nn">Example</span> <span class="kr">where</span>
  <span class="kr">import</span> <span class="nn">HTML</span> <span class="n">qualified</span> <span class="n">as</span> <span class="kt">H</span>
  <span class="n">example</span> <span class="ow">=</span> <span class="kt">H</span><span class="o">.</span><span class="kr">do</span>
    <span class="kt">H</span><span class="o">.</span><span class="n">div</span> <span class="p">[</span><span class="o">#</span><span class="kr">class</span> <span class="s">"foo"</span><span class="p">]</span> <span class="o">$</span> <span class="kt">H</span><span class="o">.</span><span class="n">form</span> <span class="kt">[]</span> <span class="kr">do</span>
      <span class="s">"Some Form"</span>
      <span class="kt">H</span><span class="o">.</span><span class="n">input</span> <span class="p">[</span><span class="o">#</span><span class="kr">type</span> <span class="s">"text"</span><span class="p">,</span> <span class="o">#</span><span class="n">name</span> <span class="s">"Input"</span><span class="p">]</span>
      <span class="kt">H</span><span class="o">.</span><span class="n">input</span> <span class="p">[</span><span class="o">#</span><span class="kr">type</span> <span class="s">"submit"</span><span class="p">,</span> <span class="o">#</span><span class="n">value</span> <span class="s">"Submit"</span><span class="p">]</span>
</code></pre></div>
<hr>
<p>At the same time, I was thinking a little bit about possible solutions and I think I like the idea of special syntax for this purpose, maybe similar to HSX, that could be checked for correctness at compile-time and would interact well with dynamic client-side functionality<br>
Basically, I would like to see something like JSX/Angular done well, possibly paired with some FRP-like or Shpadoinkle-like framework</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/4429aa8b689608f24a4ad712843ce29862e330d2?version=3"></a><div class="content"><a class="author">Sridhar Ratnakumar</a><div class="metadata"><a href="#232672347" name="232672347"><div>2021-03-31 22:02:10</div></a></div><div class="text"><p>Just came across <a href="https://marketplace.visualstudio.com/items?itemName=s0kil.vscode-hsx">https://marketplace.visualstudio.com/items?itemName=s0kil.vscode-hsx</a></p>
<p><a href="user_uploads/13896/K15fS1naiD9LfgrUKYDK3MY0/image.png">image.png</a></p>
<div class="message_inline_image"><a href="user_uploads/13896/K15fS1naiD9LfgrUKYDK3MY0/image.png" title="image.png"><img src="user_uploads/13896/K15fS1naiD9LfgrUKYDK3MY0/image.png"></a></div></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/4429aa8b689608f24a4ad712843ce29862e330d2?version=3"></a><div class="content"><a class="author">Sridhar Ratnakumar</a><div class="metadata"><a href="#232672465" name="232672465"><div>2021-03-31 22:02:59</div></a></div><div class="text"><blockquote>
<p>HSX can be written pretty much like normal HTML. You can write an HSX expression inside your Haskell code by wrapping it with [hsx|YOUR HSX CODE|]. HSX expressions are just a syntax for blaze HTML and thus are automatically escaped as described in the blaze documentation.</p>
<p>Because the HSX is parsed, you will get a syntax error when you type in invalid HTML. <a href="https://ihp.digitallyinduced.com/Guide/hsx.html">https://ihp.digitallyinduced.com/Guide/hsx.html</a></p>
</blockquote></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/4429aa8b689608f24a4ad712843ce29862e330d2?version=3"></a><div class="content"><a class="author">Sridhar Ratnakumar</a><div class="metadata"><a href="#232672960" name="232672960"><div>2021-03-31 22:06:58</div></a></div><div class="text"><p><a href="https://github.com/digitallyinduced/ihp/blob/master/IHP/HtmlSupport/Parser.hs">https://github.com/digitallyinduced/ihp/blob/master/IHP/HtmlSupport/Parser.hs</a></p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/digitallyinduced/ihp/blob/master/IHP/HtmlSupport/Parser.hs" style="background-image: url(https://repository-images.githubusercontent.com/112953694/5c07cd80-b539-11ea-8419-64ce1fc884dd)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/digitallyinduced/ihp/blob/master/IHP/HtmlSupport/Parser.hs" title="digitallyinduced/ihp">digitallyinduced/ihp</a></div><div class="message_embed_description"> The fastest way to build type safe web apps. IHP is a new batteries-included web framework optimized for longterm productivity and programmer happiness - digitallyinduced/ihp</div></div></div></div></div></div></div></div><div class="ui vertical footer segment"><a href="https://github.com/srid/zulip-archive">Powered by Haskell</a> | Questions? Contact <a href="https://www.srid.ca">srid</a></div></div></body></html>