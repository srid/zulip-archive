<html lang="en"><head><meta content="text/html; charset=utf-8" http-equiv="Content-Type"><meta content="width=device-width, initial-scale=1" name="viewport"><meta content="I am trying to figure a development workflow for Haskell packages using nix, emacs, hls, lsp... 
I am struggling with the nix part and esp. setting up a nix-shell following the instructions here: https://input-output-hk.github.io/haskell.nix/tutorials/development/#how-to-get-a-development-shell 
I h" name="description"><link href="https://funprog.srid.ca/haskell/haskell-nix-hls-setup.html" rel="canonical"><meta property="og:title" content="Haskell/nix/HLS setup - Haskell"><meta property="og:site_name" content="Functional Programming Zulip Archive"><meta property="og:type" content="article"><meta property="og:article:section" content="Haskell"><meta property="og:article:modified_time" content="2021-01-29T12:31:46Z"><meta property="og:article:published_time" content="2021-01-20T13:29:25Z"><meta property="og:image" content="https://secure.gravatar.com/avatar/48469162d45686615c6bf0eb4304bf26?d=identicon&amp;version=1"><title>Haskell/nix/HLS setup - Haskell</title><style type="text/css">
div#thesite
{
  font-family   : "Open Sans", sans-serif;
  font-size     : 1em !important;
  margin-top    : 1em;
  margin-bottom : 1em;
}

div#thesite h1
{
  font-family : "Roboto", sans-serif;
  line-height : 1.19999em;
}

div#thesite h2
{
  font-family : "Roboto", sans-serif;
  line-height : 1.19999em;
}

div#thesite h3
{
  font-family : "Roboto", sans-serif;
  line-height : 1.19999em;
}

div#thesite h4
{
  font-family : "Roboto", sans-serif;
  line-height : 1.19999em;
}

div#thesite h5
{
  font-family : "Roboto", sans-serif;
  line-height : 1.19999em;
}

div#thesite h6
{
  font-family : "Roboto", sans-serif;
  line-height : 1.19999em;
}

div#thesite .ui.breadcrumb.rib .section
{
  font-family : "Roboto", sans-serif;
  line-height : 1.19999em;
}

div#thesite .header
{
  font-family : "Roboto", sans-serif;
  line-height : 1.19999em;
}

div#thesite .as-header
{
  font-family : "Roboto", sans-serif;
  line-height : 1.19999em;
}

div#thesite code, pre, tt
{
  font-family : "SFMono-Regular","Menlo","Monaco","Consolas","Liberation Mono","Courier New", monospace;
}

div#thesite .ui.breadcrumb.rib
{
  margin-bottom : 1em;
}



div#thesite .ui.comments.messages .comment .metadata a
{
  color : #808080;
}

div#thesite .ui.comments.messages .comment a.avatar img
{
  height : auto;
}

div#thesite .subtle
{
  color : #808080;
}


div#thesite .messages pre
{
  font-size : 85%;
  overflow  : auto;
  max-width : 100%;
}

div#thesite .messages .message_embed
{
  border-left  : solid 3px #808080;
  padding-left : 0.69999em;
}

div#thesite .messages .message_inline_image img
{
  max-width     : 100%;
  margin-bottom : 1em;
}


/* Generated with Clay, http://fvisser.nl/clay */</style><link href="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.4.1/semantic.min.css" rel="stylesheet"><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.min.css" rel="stylesheet"><link href="https://fonts.googleapis.com/css?family=Open+Sans|Oswald&amp;display=swap" rel="stylesheet"><link href="https://fonts.googleapis.com/css?family=Roboto|Open+Sans&amp;display=swap" rel="stylesheet"></head><body><div id="thesite" class="ui text container"><div class="ui violet inverted top attached center aligned segment"><h1 class="ui huge header">Haskell/nix/HLS setup - Haskell</h1></div><div class="ui attached segment"><div class="ui message"><p>Welcome to the Functional Programming Zulip Chat Archive. You can join the chat <a href="https://funprog.zulipchat.com">here</a>.</p></div><div class="ui breadcrumb rib"><a href="/" class="section">Home</a><i class="right angle icon divider"></i><a href="/haskell/" class="section">#Haskell</a><i class="right angle icon divider"></i><div class="active section">Haskell/nix/HLS setup</div></div><div class="ui comments messages"><div class="comment"><a class="avatar"><img src="https://secure.gravatar.com/avatar/48469162d45686615c6bf0eb4304bf26?d=identicon&amp;version=1"></a><div class="content"><a class="author">Arnaud Bailly</a><div class="metadata"><a href="#223371873" name="223371873"><div>2021-01-20 13:29:25</div></a></div><div class="text"><p>I am trying to figure a development workflow for Haskell packages using nix, emacs, hls, lsp... <br>
I am struggling with the nix part and esp. setting up a nix-shell following the instructions here: <a href="https://input-output-hk.github.io/haskell.nix/tutorials/development/#how-to-get-a-development-shell">https://input-output-hk.github.io/haskell.nix/tutorials/development/#how-to-get-a-development-shell</a> <br>
I have hoped from links to links on the internet, trying to form a clear mental picture of how those things interact but I am still pretty confused. What are resources that go beyond code snippets I could tap on?</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/7334dc60b6aef6a75cd9284126231f13c76926a5?x=x&amp;version=4"></a><div class="content"><a class="author">Torsten Schmits</a><div class="metadata"><a href="#223372455" name="223372455"><div>2021-01-20 13:35:43</div></a></div><div class="text"><p>nix is used to install dependencies.<br>
the code in you <code>default.nix</code> or <code>shell.nix</code> is supposed to use the <code>cabal2nix</code> tools to analyze your cabal files and translate it to nix packages.<br>
when you run <code>nix-shell</code>, all haskell packages are placed in the environment so that ghc can find them.</p>
<p>so if you start a shell with <code>nix-shell</code>, you can run, for example, <code>ghcid</code> and all the dependencies are there.<br>
you can use <code>nix-shell --run haskell-language-server-wrapper</code> to run a single command with the full environment, like from your emacs language server config.</p></div></div></div><div class="comment"><a class="avatar"><img src="https://secure.gravatar.com/avatar/48469162d45686615c6bf0eb4304bf26?d=identicon&amp;version=1"></a><div class="content"><a class="author">Arnaud Bailly</a><div class="metadata"><a href="#223373453" name="223373453"><div>2021-01-20 13:44:24</div></a></div><div class="text"><p>Thanks <span class="user-mention" data-user-id="260881">@Torsten Schmits</span>  I know what nix is used for and get the general idea of how to use it, but there's a lot of specific parts and details I don't get, and trying to follow the referenced link I ran into errors which I don't know how to troubleshoot. Hence my search for a detailed walkthrough.</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/7334dc60b6aef6a75cd9284126231f13c76926a5?x=x&amp;version=4"></a><div class="content"><a class="author">Torsten Schmits</a><div class="metadata"><a href="#223373542" name="223373542"><div>2021-01-20 13:45:19</div></a></div><div class="text"><p>can you provide some concrete errors?</p></div></div></div><div class="comment"><a class="avatar"><img src="https://secure.gravatar.com/avatar/48469162d45686615c6bf0eb4304bf26?d=identicon&amp;version=1"></a><div class="content"><a class="author">Arnaud Bailly</a><div class="metadata"><a href="#223373916" name="223373916"><div>2021-01-20 13:48:40</div></a></div><div class="text"><p>Sure. So what I am trying to do is take an existing non-nixified package and add the needed nix bits to 1/ build it with nix and 2/ have all the needed dev tools (HLS, ghcid, hoogle, hlint, ormolu...) set up, in order to 3/ hack happily with emacs.<br>
copy-pasting with minor adaptations the default.nix and shell.nix from <a href="https://input-output-hk.github.io/haskell.nix/tutorials/development">https://input-output-hk.github.io/haskell.nix/tutorials/development</a> tutorial, when I do <code>nix-shell</code> I run into the following error:</p>
<div class="codehilite"><pre><span></span><code>error: attribute &#39;haskell-nix&#39; missing, at /home/curry/hydra-sim/default.nix:15:4
</code></pre></div></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/7334dc60b6aef6a75cd9284126231f13c76926a5?x=x&amp;version=4"></a><div class="content"><a class="author">Torsten Schmits</a><div class="metadata"><a href="#223374444" name="223374444"><div>2021-01-20 13:53:21</div></a></div><div class="text"><p>that means either that the haskell-nix nixpkgs are broken, the tutorial is outdated or your minor adaptations changed something that causes the <code>haskell-nix</code> attribute to be absent. can you post your nix file?</p></div></div></div><div class="comment"><a class="avatar"><img src="https://secure.gravatar.com/avatar/48469162d45686615c6bf0eb4304bf26?d=identicon&amp;version=1"></a><div class="content"><a class="author">Arnaud Bailly</a><div class="metadata"><a href="#223374506" name="223374506"><div>2021-01-20 13:53:58</div></a></div><div class="text"><div class="codehilite"><pre><span></span><code>{ # Fetch the latest haskell.nix and import its default.nix
  haskellNix ? import (builtins.fetchTarball &quot;https://github.com/input-output-hk/haskell.nix/archive/master.tar.gz&quot;) {}

# haskell.nix provides access to the nixpkgs pins which are used by our CI,
# hence you will be more likely to get cache hits when using these.
# But you can also just use your own, e.g. &#39;&lt;nixpkgs&gt;&#39;.
, nixpkgsSrc ? haskellNix.sources.nixpkgs-2003

# haskell.nix provides some arguments to be passed to nixpkgs, including some
# patches and also the haskell.nix functionality itself as an overlay.
, nixpkgsArgs ? haskellNix.nixpkgsArgs

# import nixpkgs with overlays
, pkgs ? import nixpkgsSrc nixpkgsArgs
}: pkgs.haskell-nix.project {
  # &#39;cleanGit&#39; cleans a source directory based on the files known by git
  src = pkgs.haskell-nix.haskellLib.cleanGit {
    name = &quot;hydra-sim&quot;;
    src = ./.;
  };
  # Specify the GHC version to use.
  compiler-nix-name = &quot;ghc884&quot;; # Not required for `stack.yaml` based projects.
}
</code></pre></div></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/7334dc60b6aef6a75cd9284126231f13c76926a5?x=x&amp;version=4"></a><div class="content"><a class="author">Torsten Schmits</a><div class="metadata"><a href="#223374810" name="223374810"><div>2021-01-20 13:56:28</div></a></div><div class="text"><ol>
<li>do you call this file with arguments?</li>
<li>if not, does it work with <code>haskellNix.sources.nixpkgs</code>?</li>
</ol></div></div></div><div class="comment"><a class="avatar"><img src="https://secure.gravatar.com/avatar/48469162d45686615c6bf0eb4304bf26?d=identicon&amp;version=1"></a><div class="content"><a class="author">Arnaud Bailly</a><div class="metadata"><a href="#223375187" name="223375187"><div>2021-01-20 13:59:32</div></a></div><div class="text"><p>I don't even understand the question :-D<br>
What I did was:</p>
<div class="codehilite"><pre><span></span><code>nix-build -A hydra-sim.components.exes.hydra-sim
</code></pre></div>
<p>and I got a compilation failure which is probably a problem with the package I am trying to build and that I can solve.<br>
Then I tried </p>
<div class="codehilite"><pre><span></span><code>nix-shell
</code></pre></div>
<p>and got the error I mentioned.<br>
And now I am trying to run <code>nix-shell -A shellFor</code> without a <code>shell.nix</code> file and it is building a whole slew of packages and taking ages. I miss stack...</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/7334dc60b6aef6a75cd9284126231f13c76926a5?x=x&amp;version=4"></a><div class="content"><a class="author">Torsten Schmits</a><div class="metadata"><a href="#223375346" name="223375346"><div>2021-01-20 14:00:44</div></a></div><div class="text"><p>ah. can you post the <code>shell.nix</code> as well?</p></div></div></div><div class="comment"><a class="avatar"><img src="https://secure.gravatar.com/avatar/48469162d45686615c6bf0eb4304bf26?d=identicon&amp;version=1"></a><div class="content"><a class="author">Arnaud Bailly</a><div class="metadata"><a href="#223375640" name="223375640"><div>2021-01-20 14:02:53</div></a></div><div class="text"><p>Sure, here it is</p>
<div class="codehilite"><pre><span></span><code># shell.nix
{pkgs ? import &lt;nixpkgs&gt; {} }:

let
  hsPkgs = import ./default.nix { inherit pkgs; };
  haskellNix = import (builtins.fetchTarball https://github.com/input-output-hk/haskell.nix/archive/master.tar.gz) {};
in
  hsPkgs.shellFor {
    # Include only the *local* packages of your project.
    packages = ps: with ps; [
      hydra-sim
    ];

    # Builds a Hoogle documentation index of all dependencies,
    # and provides a &quot;hoogle&quot; command to search the index.
#    withHoogle = true;

    # You might want some extra tools in the shell (optional).

    # Some common tools can be added with the `tools` argument
    tools = { cabal = &quot;3.2.0.0&quot;; hlint = &quot;2.2.11&quot;; };
    # See overlays/tools.nix for more details

    # Some you may need to get some other way.
    buildInputs = with pkgs.haskellPackages;
      [ ghcid
        # (haskell-language-server.override { supportedGhcVersions = [ &quot;884&quot; &quot;8102&quot; ]; })
      ];



    # Prevents cabal from choosing alternate plans, so that
    # *all* dependencies are provided by Nix.
    exactDeps = true;
  }
</code></pre></div>
<p>I tried adding stuff for HLS but commented it out for now</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/7334dc60b6aef6a75cd9284126231f13c76926a5?x=x&amp;version=4"></a><div class="content"><a class="author">Torsten Schmits</a><div class="metadata"><a href="#223375970" name="223375970"><div>2021-01-20 14:05:28</div></a></div><div class="text"><div class="codehilite"><pre><span></span><code>{pkgs ? import &lt;nixpkgs&gt; {} }:
</code></pre></div>
<p>the problem is this, which you pass on to <code>default.nix</code>, overriding the default (after the <code>?</code>) there. that replaces the nixpkgs from haskell-nix with the system default.</p>
<p>change it to</p>
<div class="codehilite" data-code-language="Nix"><pre><span></span><code><span class="ss">hsPkgs =</span> <span class="nb">import</span> <span class="o">.</span><span class="l">/default.nix</span> <span class="p">{};</span>
</code></pre></div>
<p>and it should be fine.</p></div></div></div><div class="comment"><a class="avatar"><img src="https://secure.gravatar.com/avatar/48469162d45686615c6bf0eb4304bf26?d=identicon&amp;version=1"></a><div class="content"><a class="author">Arnaud Bailly</a><div class="metadata"><a href="#223376406" name="223376406"><div>2021-01-20 14:09:24</div></a></div><div class="text"><p>I have this line  inside the <code>let</code> block so I assume you meant I should simply remove the declaration? But then when I do that, I got another error:</p>
<div class="codehilite"><pre><span></span><code>error: undefined variable &#39;pkgs&#39; at /home/curry/hydra-sim/shell.nix:23:24
</code></pre></div></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/7334dc60b6aef6a75cd9284126231f13c76926a5?x=x&amp;version=4"></a><div class="content"><a class="author">Torsten Schmits</a><div class="metadata"><a href="#223376677" name="223376677"><div>2021-01-20 14:11:58</div></a></div><div class="text"><p>no, no line to remove. just don't pass <code>pkgs</code> on to the import of <code>default.nix</code>.<br>
and I don't see where you use <code>pkgs</code> in <code>shell.nix:23</code></p></div></div></div><div class="comment"><a class="avatar"><img src="https://secure.gravatar.com/avatar/48469162d45686615c6bf0eb4304bf26?d=identicon&amp;version=1"></a><div class="content"><a class="author">Arnaud Bailly</a><div class="metadata"><a href="#223377321" name="223377321"><div>2021-01-20 14:17:04</div></a></div><div class="text"><p>Ah I see. It's used for <code>buildInputs</code></p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/7334dc60b6aef6a75cd9284126231f13c76926a5?x=x&amp;version=4"></a><div class="content"><a class="author">Torsten Schmits</a><div class="metadata"><a href="#223377474" name="223377474"><div>2021-01-20 14:18:09</div></a></div><div class="text"><p>ah, yes</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/7334dc60b6aef6a75cd9284126231f13c76926a5?x=x&amp;version=4"></a><div class="content"><a class="author">Torsten Schmits</a><div class="metadata"><a href="#223377513" name="223377513"><div>2021-01-20 14:18:34</div></a></div><div class="text"><p>then you would have to use <code>hsPkgs</code> there too</p></div></div></div><div class="comment"><a class="avatar"><img src="https://secure.gravatar.com/avatar/48469162d45686615c6bf0eb4304bf26?d=identicon&amp;version=1"></a><div class="content"><a class="author">Arnaud Bailly</a><div class="metadata"><a href="#223398074" name="223398074"><div>2021-01-20 16:30:45</div></a></div><div class="text"><p>Yeah, thanks a lot <span class="user-mention" data-user-id="260881">@Torsten Schmits</span></p></div></div></div><div class="comment"><a class="avatar"><img src="https://secure.gravatar.com/avatar/48469162d45686615c6bf0eb4304bf26?d=identicon&amp;version=1"></a><div class="content"><a class="author">Arnaud Bailly</a><div class="metadata"><a href="#223398452" name="223398452"><div>2021-01-20 16:33:29</div></a></div><div class="text"><p>(I was AFK for a while) So I am into nix-shell and can access installed tools. However, _entering_ the shell is very slow which makes me wonder if this will be bearable when running commands from HLS, or even calling HLS wrapped from emacs. I am missing some important step to make this fast? There is this "materialized" concept which seems to be relevant but unsure about it.</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/7334dc60b6aef6a75cd9284126231f13c76926a5?x=x&amp;version=4"></a><div class="content"><a class="author">Torsten Schmits</a><div class="metadata"><a href="#223398612" name="223398612"><div>2021-01-20 16:34:41</div></a></div><div class="text"><p>it takes about one second for my haskell projects, how slow is it for you?</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/7334dc60b6aef6a75cd9284126231f13c76926a5?x=x&amp;version=4"></a><div class="content"><a class="author">Torsten Schmits</a><div class="metadata"><a href="#223398729" name="223398729"><div>2021-01-20 16:35:45</div></a></div><div class="text"><p>what do you mean by "running commands from HLS"?</p></div></div></div><div class="comment"><a class="avatar"><img src="https://secure.gravatar.com/avatar/48469162d45686615c6bf0eb4304bf26?d=identicon&amp;version=1"></a><div class="content"><a class="author">Arnaud Bailly</a><div class="metadata"><a href="#223399067" name="223399067"><div>2021-01-20 16:38:01</div></a></div><div class="text"><p>Well, it takes about 1 minute or so, with some trace messages that might explain the slowness. <br>
I mean nothing because of course HLS will be run from within nix-shell. But what about running ormolu, or ghcid, or cabal test?</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/7334dc60b6aef6a75cd9284126231f13c76926a5?x=x&amp;version=4"></a><div class="content"><a class="author">Torsten Schmits</a><div class="metadata"><a href="#223399307" name="223399307"><div>2021-01-20 16:39:45</div></a></div><div class="text"><p>one minute is alarming, if this happens on consecutive executions with no changes in between.<br>
if you run ormolu through HLS, there should be no delay, since HLS is already running in that env.<br>
if you run ghcid or cabal test manually, this is a concern for sure.</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/7334dc60b6aef6a75cd9284126231f13c76926a5?x=x&amp;version=4"></a><div class="content"><a class="author">Torsten Schmits</a><div class="metadata"><a href="#223399556" name="223399556"><div>2021-01-20 16:41:48</div></a></div><div class="text"><p>one reason for stuff being recalculated every time could be some kind of self-reference, like using the project directory in an inappropriate way, but it's hard to say</p></div></div></div><div class="comment"><a class="avatar"><img src="https://secure.gravatar.com/avatar/48469162d45686615c6bf0eb4304bf26?d=identicon&amp;version=1"></a><div class="content"><a class="author">Arnaud Bailly</a><div class="metadata"><a href="#223399971" name="223399971"><div>2021-01-20 16:44:31</div></a></div><div class="text"><p>there are warnings at startup about missing sha256 which might be cause of slowness, I will investigate a bit more. At least, I can drop into a nix-shell and it works, I will see what happens when configuring a wrapper in emacs<br>
I must admit I have always refrained from using  nix  before and am a total noob, even though I am understand the concept and the basic principles.</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/7334dc60b6aef6a75cd9284126231f13c76926a5?x=x&amp;version=4"></a><div class="content"><a class="author">Torsten Schmits</a><div class="metadata"><a href="#223400038" name="223400038"><div>2021-01-20 16:44:56</div></a></div><div class="text"><p>is there substantial output on every invocation? if so, post it!</p></div></div></div><div class="comment"><a class="avatar"><img src="https://secure.gravatar.com/avatar/48469162d45686615c6bf0eb4304bf26?d=identicon&amp;version=1"></a><div class="content"><a class="author">Arnaud Bailly</a><div class="metadata"><a href="#223400135" name="223400135"><div>2021-01-20 16:45:43</div></a></div><div class="text"><p>I will! I am now upgrading the compiler to ghc8103 so it will take a while :)</p></div></div></div><div class="comment"><a class="avatar"><img src="https://secure.gravatar.com/avatar/48469162d45686615c6bf0eb4304bf26?d=identicon&amp;version=1"></a><div class="content"><a class="author">Arnaud Bailly</a><div class="metadata"><a href="#223400170" name="223400170"><div>2021-01-20 16:46:01</div></a></div><div class="text"><p>I guess I am not hitting IOHK's binary caches anymore...</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/7334dc60b6aef6a75cd9284126231f13c76926a5?x=x&amp;version=4"></a><div class="content"><a class="author">Torsten Schmits</a><div class="metadata"><a href="#223400290" name="223400290"><div>2021-01-20 16:46:41</div></a></div><div class="text"><p>well compiling ghc should take an hour <span aria-label="sweat smile" class="emoji emoji-1f605" role="img" title="sweat smile">:sweat_smile:</span></p></div></div></div><div class="comment"><a class="avatar"><img src="https://secure.gravatar.com/avatar/48469162d45686615c6bf0eb4304bf26?d=identicon&amp;version=1"></a><div class="content"><a class="author">Arnaud Bailly</a><div class="metadata"><a href="#223400334" name="223400334"><div>2021-01-20 16:47:00</div></a></div><div class="text"><p>I have not done that for years!</p></div></div></div><div class="comment"><a class="avatar"><img src="https://secure.gravatar.com/avatar/48469162d45686615c6bf0eb4304bf26?d=identicon&amp;version=1"></a><div class="content"><a class="author">Arnaud Bailly</a><div class="metadata"><a href="#223400969" name="223400969"><div>2021-01-20 16:51:08</div></a></div><div class="text"><p>How can I fix the version of HLS I want to use? I tried this </p>
<div class="codehilite"><pre><span></span><code>    buildInputs = with pkgs.haskellPackages;
      [ ghcid
         (haskell-language-server.override { supportedGhcVersions = [ &quot;884&quot; &quot;8102&quot; ]; })
      ];
</code></pre></div>
<p>but I got an error saying <code>supportedGhcVersions</code> was not a "parameter"</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/7334dc60b6aef6a75cd9284126231f13c76926a5?x=x&amp;version=4"></a><div class="content"><a class="author">Torsten Schmits</a><div class="metadata"><a href="#223401183" name="223401183"><div>2021-01-20 16:52:41</div></a></div><div class="text"><p>is that from the docs?</p></div></div></div><div class="comment"><a class="avatar"><img src="https://secure.gravatar.com/avatar/48469162d45686615c6bf0eb4304bf26?d=identicon&amp;version=1"></a><div class="content"><a class="author">Arnaud Bailly</a><div class="metadata"><a href="#223401618" name="223401618"><div>2021-01-20 16:55:47</div></a></div><div class="text"><p>From here: <a href="https://haskell4nix.readthedocs.io/nixpkgs-users-guide.html?highlight=language%20server#how-to-install-haskell-language-server">https://haskell4nix.readthedocs.io/nixpkgs-users-guide.html?highlight=language%20server#how-to-install-haskell-language-server</a></p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/7334dc60b6aef6a75cd9284126231f13c76926a5?x=x&amp;version=4"></a><div class="content"><a class="author">Torsten Schmits</a><div class="metadata"><a href="#223401891" name="223401891"><div>2021-01-20 16:57:39</div></a></div><div class="text"><p>ah, that is for a global installation from the default nixpkgs derivation. when you're using haskell.nix, you've already pinned ghc to a version and that is what's going to be used for HLS</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/7334dc60b6aef6a75cd9284126231f13c76926a5?x=x&amp;version=4"></a><div class="content"><a class="author">Torsten Schmits</a><div class="metadata"><a href="#223401927" name="223401927"><div>2021-01-20 16:57:54</div></a></div><div class="text"><p>(I assume)</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/7334dc60b6aef6a75cd9284126231f13c76926a5?x=x&amp;version=4"></a><div class="content"><a class="author">Torsten Schmits</a><div class="metadata"><a href="#223402063" name="223402063"><div>2021-01-20 16:58:33</div></a></div><div class="text"><p>ah yes, <code>compiler-nix-name</code> in your first snippet</p></div></div></div><div class="comment"><a class="avatar"><img src="https://secure.gravatar.com/avatar/48469162d45686615c6bf0eb4304bf26?d=identicon&amp;version=1"></a><div class="content"><a class="author">Arnaud Bailly</a><div class="metadata"><a href="#223402258" name="223402258"><div>2021-01-20 17:00:02</div></a></div><div class="text"><p>Well, that's what I would expect too, but then when I add only <code>haskell-language-server</code> it installs hls-8.10.3 even though the compiler is ghc8.8.4 (hence why I upgraded ghc)</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/7334dc60b6aef6a75cd9284126231f13c76926a5?x=x&amp;version=4"></a><div class="content"><a class="author">Torsten Schmits</a><div class="metadata"><a href="#223402459" name="223402459"><div>2021-01-20 17:01:03</div></a></div><div class="text"><p>don't know what exactly haskell.nix injects into the <code>pkgs</code> set you're using there though. <code>haskellPackages</code> usually points to the default set for nixpkgs, which might be 8.10.3.</p>
<p>instead you should be using the package set that haskell.nix provides. let me check the docs</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/7334dc60b6aef6a75cd9284126231f13c76926a5?x=x&amp;version=4"></a><div class="content"><a class="author">Torsten Schmits</a><div class="metadata"><a href="#223402750" name="223402750"><div>2021-01-20 17:02:48</div></a></div><div class="text"><p>oh, maybe just try using <code>hsPkgs.haskell-language-server</code></p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/7334dc60b6aef6a75cd9284126231f13c76926a5?x=x&amp;version=4"></a><div class="content"><a class="author">Torsten Schmits</a><div class="metadata"><a href="#223402787" name="223402787"><div>2021-01-20 17:03:04</div></a></div><div class="text"><p>or <code>project.ghc</code> or something</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/7334dc60b6aef6a75cd9284126231f13c76926a5?x=x&amp;version=4"></a><div class="content"><a class="author">Torsten Schmits</a><div class="metadata"><a href="#223402982" name="223402982"><div>2021-01-20 17:04:08</div></a></div><div class="text"><p>I find it pretty weird that the example tells you to use <code>import &lt;nixpkgs&gt; {}</code></p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/7334dc60b6aef6a75cd9284126231f13c76926a5?x=x&amp;version=4"></a><div class="content"><a class="author">Torsten Schmits</a><div class="metadata"><a href="#223403323" name="223403323"><div>2021-01-20 17:06:24</div></a></div><div class="text"><p>I have my own little world for haskell dev btw: <a href="https://github.com/tek/tryp-hs">https://github.com/tek/tryp-hs</a></p>
<p>it's very specific to my own needs, but maybe you can find some inspiration <span aria-label="sweat smile" class="emoji emoji-1f605" role="img" title="sweat smile">:sweat_smile:</span></p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/tek/tryp-hs" style="background-image: url(https://avatars0.githubusercontent.com/u/2632?s=400&amp;v=4)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/tek/tryp-hs" title="tek/tryp-hs">tek/tryp-hs</a></div><div class="message_embed_description">Development utilities for Haskell projects with Nix build - tek/tryp-hs</div></div></div></div></div></div><div class="comment"><a class="avatar"><img src="https://secure.gravatar.com/avatar/48469162d45686615c6bf0eb4304bf26?d=identicon&amp;version=1"></a><div class="content"><a class="author">Arnaud Bailly</a><div class="metadata"><a href="#223403702" name="223403702"><div>2021-01-20 17:08:47</div></a></div><div class="text"><p>Thanks, definitely will have a look!</p></div></div></div><div class="comment"><a class="avatar"><img src="https://secure.gravatar.com/avatar/49728c9821ae019b34ffedde4f758018?d=identicon&amp;version=1"></a><div class="content"><a class="author">tristanC</a><div class="metadata"><a href="#223403794" name="223403794"><div>2021-01-20 17:09:25</div></a></div><div class="text"><p>Also don't forget to set the <code>lsp-haskell-server-wrapper-function</code> emacs custom so that lsp-mode picks the right one</p></div></div></div><div class="comment"><a class="avatar"><img src="https://secure.gravatar.com/avatar/48469162d45686615c6bf0eb4304bf26?d=identicon&amp;version=1"></a><div class="content"><a class="author">Arnaud Bailly</a><div class="metadata"><a href="#223403890" name="223403890"><div>2021-01-20 17:10:09</div></a></div><div class="text"><p>Yes, I have that on my radar, thanks <span class="user-mention" data-user-id="282115">@tristanC</span></p></div></div></div><div class="comment"><a class="avatar"><img src="https://secure.gravatar.com/avatar/48469162d45686615c6bf0eb4304bf26?d=identicon&amp;version=1"></a><div class="content"><a class="author">Arnaud Bailly</a><div class="metadata"><a href="#223404120" name="223404120"><div>2021-01-20 17:11:42</div></a></div><div class="text"><p>On another note, I am surprised that packages got installed sequentially and not in parallel, as stack does. I spun up a VM with 16 cores to speed build and, well, I would expect faster turnaround :)</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/7334dc60b6aef6a75cd9284126231f13c76926a5?x=x&amp;version=4"></a><div class="content"><a class="author">Torsten Schmits</a><div class="metadata"><a href="#223404337" name="223404337"><div>2021-01-20 17:13:14</div></a></div><div class="text"><p>they usually are installed in parallel</p></div></div></div><div class="comment"><a class="avatar"><img src="https://secure.gravatar.com/avatar/48469162d45686615c6bf0eb4304bf26?d=identicon&amp;version=1"></a><div class="content"><a class="author">Arnaud Bailly</a><div class="metadata"><a href="#223404780" name="223404780"><div>2021-01-20 17:16:37</div></a></div><div class="text"><p><span aria-label="thinking" class="emoji emoji-1f914" role="img" title="thinking">:thinking:</span> that's not what it is currently reporting to me, is there something to configure?</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/7334dc60b6aef6a75cd9284126231f13c76926a5?x=x&amp;version=4"></a><div class="content"><a class="author">Torsten Schmits</a><div class="metadata"><a href="#223404978" name="223404978"><div>2021-01-20 17:18:08</div></a></div><div class="text"><p>there's <code>-j</code> to specify the concurrency</p></div></div></div><div class="comment"><a class="avatar"><img src="https://secure.gravatar.com/avatar/48469162d45686615c6bf0eb4304bf26?d=identicon&amp;version=1"></a><div class="content"><a class="author">Arnaud Bailly</a><div class="metadata"><a href="#223405016" name="223405016"><div>2021-01-20 17:18:17</div></a></div><div class="text"><p>A more general question: What are the advantages of using nix over using stack, or newer cabal which seems also to support well-isolated toolchain and packages? Assuming I am not _already_ using nix of course</p></div></div></div><div class="comment"><a class="avatar"><img src="https://secure.gravatar.com/avatar/48469162d45686615c6bf0eb4304bf26?d=identicon&amp;version=1"></a><div class="content"><a class="author">Arnaud Bailly</a><div class="metadata"><a href="#223405035" name="223405035"><div>2021-01-20 17:18:30</div></a></div><div class="text"><p>I mean, for haskell development specifically.</p></div></div></div><div class="comment"><a class="avatar"><img src="https://secure.gravatar.com/avatar/33ed1f4a88793f2221d759610e2e8ddb?d=identicon&amp;version=1"></a><div class="content"><a class="author">codygman</a><div class="metadata"><a href="#223405065" name="223405065"><div>2021-01-20 17:18:57</div></a></div><div class="text"><p>Cached libraries for one iirc</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/7334dc60b6aef6a75cd9284126231f13c76926a5?x=x&amp;version=4"></a><div class="content"><a class="author">Torsten Schmits</a><div class="metadata"><a href="#223405071" name="223405071"><div>2021-01-20 17:19:01</div></a></div><div class="text"><p>ah, the default for <code>max-jobs</code> in <code>nix.conf</code> is <code>1</code>, and that's what <code>-j16</code> would override</p></div></div></div><div class="comment"><a class="avatar"><img src="https://secure.gravatar.com/avatar/33ed1f4a88793f2221d759610e2e8ddb?d=identicon&amp;version=1"></a><div class="content"><a class="author">codygman</a><div class="metadata"><a href="#223405214" name="223405214"><div>2021-01-20 17:20:17</div></a></div><div class="text"><p>Cabal caching over CI should work but doesn't without messing with timestamps but nix didn't have that issue last I checked</p></div></div></div><div class="comment"><a class="avatar"><img src="https://secure.gravatar.com/avatar/33ed1f4a88793f2221d759610e2e8ddb?d=identicon&amp;version=1"></a><div class="content"><a class="author">codygman</a><div class="metadata"><a href="#223405431" name="223405431"><div>2021-01-20 17:22:06</div></a></div><div class="text"><p>Nix alone loses incremental building though, unless you use nix just to bootstrap a shell with ghc, cabal, and packages</p></div></div></div><div class="comment"><a class="avatar"><img src="https://secure.gravatar.com/avatar/48469162d45686615c6bf0eb4304bf26?d=identicon&amp;version=1"></a><div class="content"><a class="author">Arnaud Bailly</a><div class="metadata"><a href="#223405440" name="223405440"><div>2021-01-20 17:22:08</div></a></div><div class="text"><p>Ah yes, awesome <span class="user-mention" data-user-id="260881">@Torsten Schmits</span> !</p></div></div></div><div class="comment"><a class="avatar"><img src="https://secure.gravatar.com/avatar/48469162d45686615c6bf0eb4304bf26?d=identicon&amp;version=1"></a><div class="content"><a class="author">Arnaud Bailly</a><div class="metadata"><a href="#223405579" name="223405579"><div>2021-01-20 17:23:23</div></a></div><div class="text"><p><span class="user-mention" data-user-id="325194">@codygman</span> by caching you mean global caching, for example to share binaries across a team? Libraries are also cached by stack when working on a common stackage version.</p></div></div></div><div class="comment"><a class="avatar"><img src="https://secure.gravatar.com/avatar/33ed1f4a88793f2221d759610e2e8ddb?d=identicon&amp;version=1"></a><div class="content"><a class="author">codygman</a><div class="metadata"><a href="#223405807" name="223405807"><div>2021-01-20 17:25:02</div></a></div><div class="text"><p>Libraries are cached locally by stack, but you have to build them first. Correct me if I'm wrong, but you don't have to compile Haskell libraries pulled from <a href="http://cache.nixos.org">cache.nixos.org</a></p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/7334dc60b6aef6a75cd9284126231f13c76926a5?x=x&amp;version=4"></a><div class="content"><a class="author">Torsten Schmits</a><div class="metadata"><a href="#223406189" name="223406189"><div>2021-01-20 17:28:14</div></a></div><div class="text"><p>you can also create a bincache for your team</p></div></div></div><div class="comment"><a class="avatar"><img src="https://secure.gravatar.com/avatar/48469162d45686615c6bf0eb4304bf26?d=identicon&amp;version=1"></a><div class="content"><a class="author">Arnaud Bailly</a><div class="metadata"><a href="#223406317" name="223406317"><div>2021-01-20 17:29:18</div></a></div><div class="text"><p>Well, perhaps. I am following this tutorial <a href="https://input-output-hk.github.io/haskell.nix/">https://input-output-hk.github.io/haskell.nix/</a> and so far it has built a lot of libraries so perhaps it's not using the same cache? According to this section <a href="https://input-output-hk.github.io/haskell.nix/troubleshooting/#why-am-i-building-lots-of-haskell-packages">https://input-output-hk.github.io/haskell.nix/troubleshooting/#why-am-i-building-lots-of-haskell-packages</a> it's expected.</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/7334dc60b6aef6a75cd9284126231f13c76926a5?x=x&amp;version=4"></a><div class="content"><a class="author">Torsten Schmits</a><div class="metadata"><a href="#223406335" name="223406335"><div>2021-01-20 17:29:32</div></a></div><div class="text"><p>it's very helpful if you, for example, work with code from git repos instead of stackage</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/7334dc60b6aef6a75cd9284126231f13c76926a5?x=x&amp;version=4"></a><div class="content"><a class="author">Torsten Schmits</a><div class="metadata"><a href="#223406485" name="223406485"><div>2021-01-20 17:30:35</div></a></div><div class="text"><p>you <em>can</em> add lots of cachixes from other people to your nix setup</p></div></div></div><div class="comment"><a class="avatar"><img src="https://secure.gravatar.com/avatar/48469162d45686615c6bf0eb4304bf26?d=identicon&amp;version=1"></a><div class="content"><a class="author">Arnaud Bailly</a><div class="metadata"><a href="#223406505" name="223406505"><div>2021-01-20 17:30:44</div></a></div><div class="text"><p>I am interested in setting up team-wide cached binaries, this has been a major PITA in past projects as everyone and every machine kept rebuilding everything</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/7334dc60b6aef6a75cd9284126231f13c76926a5?x=x&amp;version=4"></a><div class="content"><a class="author">Torsten Schmits</a><div class="metadata"><a href="#223406519" name="223406519"><div>2021-01-20 17:30:51</div></a></div><div class="text"><p>but that requires you to use the same version of nixpkgs</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/7334dc60b6aef6a75cd9284126231f13c76926a5?x=x&amp;version=4"></a><div class="content"><a class="author">Torsten Schmits</a><div class="metadata"><a href="#223406587" name="223406587"><div>2021-01-20 17:31:30</div></a></div><div class="text"><p>if you're very disciplined with versions (nixpkgs especially), this can speed up builds massively, <span class="user-mention" data-user-id="251436">@Arnaud Bailly</span></p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/7334dc60b6aef6a75cd9284126231f13c76926a5?x=x&amp;version=4"></a><div class="content"><a class="author">Torsten Schmits</a><div class="metadata"><a href="#223406654" name="223406654"><div>2021-01-20 17:32:05</div></a></div><div class="text"><p>myself I use a free tier cachix and push all my built projects regularly, and I barely have to rebuild anything on any of my machines</p></div></div></div><div class="comment"><a class="avatar"><img src="https://secure.gravatar.com/avatar/33ed1f4a88793f2221d759610e2e8ddb?d=identicon&amp;version=1"></a><div class="content"><a class="author">codygman</a><div class="metadata"><a href="#223406696" name="223406696"><div>2021-01-20 17:32:14</div></a></div><div class="text"><p>If you use a different version of ghc and lots of custom libraries you'll want to use cachix. You'll have to build once to populate cachix of course.</p>
<p>Basically it results in "only one person on your team has to build library dependencies" just like I'm guessing you could do with stack+bincache Torsten recommended</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/7334dc60b6aef6a75cd9284126231f13c76926a5?x=x&amp;version=4"></a><div class="content"><a class="author">Torsten Schmits</a><div class="metadata"><a href="#223406726" name="223406726"><div>2021-01-20 17:32:19</div></a></div><div class="text"><p>including dependencies</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/7334dc60b6aef6a75cd9284126231f13c76926a5?x=x&amp;version=4"></a><div class="content"><a class="author">Torsten Schmits</a><div class="metadata"><a href="#223406837" name="223406837"><div>2021-01-20 17:33:14</div></a></div><div class="text"><p><span class="user-mention silent" data-user-id="325194">codygman</span> <a href="#narrow/stream/201385-Haskell/topic/Haskell.2Fnix.2FHLS.20setup/near/223406696">said</a>:</p>
<blockquote>
<p>stack+bincache Torsten recommended</p>
</blockquote>
<p>I meant nix bincache!</p></div></div></div><div class="comment"><a class="avatar"><img src="https://secure.gravatar.com/avatar/48469162d45686615c6bf0eb4304bf26?d=identicon&amp;version=1"></a><div class="content"><a class="author">Arnaud Bailly</a><div class="metadata"><a href="#223406925" name="223406925"><div>2021-01-20 17:34:07</div></a></div><div class="text"><p>cachix looks neat!</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/7334dc60b6aef6a75cd9284126231f13c76926a5?x=x&amp;version=4"></a><div class="content"><a class="author">Torsten Schmits</a><div class="metadata"><a href="#223407039" name="223407039"><div>2021-01-20 17:35:06</div></a></div><div class="text"><p>for something entirely local to your network, you can use <code>nix-copy-closure</code> to copy the entire tree of dependencies to a central host, then add this host as a substituter or even remote build host</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/7334dc60b6aef6a75cd9284126231f13c76926a5?x=x&amp;version=4"></a><div class="content"><a class="author">Torsten Schmits</a><div class="metadata"><a href="#223407089" name="223407089"><div>2021-01-20 17:35:37</div></a></div><div class="text"><p>only needs ssh access</p></div></div></div><div class="comment"><a class="avatar"><img src="https://secure.gravatar.com/avatar/33ed1f4a88793f2221d759610e2e8ddb?d=identicon&amp;version=1"></a><div class="content"><a class="author">codygman</a><div class="metadata"><a href="#223407092" name="223407092"><div>2021-01-20 17:35:39</div></a></div><div class="text"><p>It is! I even use cachix in github actions to build my local machine libraries so they can spend cpu time</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/7334dc60b6aef6a75cd9284126231f13c76926a5?x=x&amp;version=4"></a><div class="content"><a class="author">Torsten Schmits</a><div class="metadata"><a href="#223407185" name="223407185"><div>2021-01-20 17:36:17</div></a></div><div class="text"><p>sneaky!</p></div></div></div><div class="comment"><a class="avatar"><img src="https://secure.gravatar.com/avatar/48469162d45686615c6bf0eb4304bf26?d=identicon&amp;version=1"></a><div class="content"><a class="author">Arnaud Bailly</a><div class="metadata"><a href="#223407434" name="223407434"><div>2021-01-20 17:38:33</div></a></div><div class="text"><p>I tried the following </p>
<div class="codehilite"><pre><span></span><code>    buildInputs = with pkgs.haskellPackages;
      [ ghcid
        (hsPkgs.haskell-language-server.override { supportedGhcVersions = [ &quot;884&quot; &quot;8102&quot; ]; })
      ];
</code></pre></div>
<p>and now I have the following error:</p>
<div class="codehilite"><pre><span></span><code>error: attribute &#39;haskell-language-server&#39; missing, at /home/curry/hydra-sim/shell.nix:27:11
(use &#39;--show-trace&#39; to show detailed location information)
</code></pre></div></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/7334dc60b6aef6a75cd9284126231f13c76926a5?x=x&amp;version=4"></a><div class="content"><a class="author">Torsten Schmits</a><div class="metadata"><a href="#223407676" name="223407676"><div>2021-01-20 17:40:31</div></a></div><div class="text"><p>yeah I already tried sifting through the haskell.nix code to figure out what exactly is in <code>hsPkgs</code>, but didn't find enlightenment. I'd suggest trying <code>hsPkgs.ghc.haskell-lang...</code></p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/7334dc60b6aef6a75cd9284126231f13c76926a5?x=x&amp;version=4"></a><div class="content"><a class="author">Torsten Schmits</a><div class="metadata"><a href="#223407703" name="223407703"><div>2021-01-20 17:40:48</div></a></div><div class="text"><p>and with this method, you can remove the <code>.override { ...</code> part</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/7334dc60b6aef6a75cd9284126231f13c76926a5?x=x&amp;version=4"></a><div class="content"><a class="author">Torsten Schmits</a><div class="metadata"><a href="#223407801" name="223407801"><div>2021-01-20 17:41:37</div></a></div><div class="text"><p>thanks to nix being untyped we have no simple way of inspecting what that set is <span aria-label="sweat smile" class="emoji emoji-1f605" role="img" title="sweat smile">:sweat_smile:</span></p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/7334dc60b6aef6a75cd9284126231f13c76926a5?x=x&amp;version=4"></a><div class="content"><a class="author">Torsten Schmits</a><div class="metadata"><a href="#223407947" name="223407947"><div>2021-01-20 17:42:39</div></a></div><div class="text"><p>you could try <code>nix eval 'builtins.attrNames (import ./default.nix {})'</code> or something</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/7334dc60b6aef6a75cd9284126231f13c76926a5?x=x&amp;version=4"></a><div class="content"><a class="author">Torsten Schmits</a><div class="metadata"><a href="#223408083" name="223408083"><div>2021-01-20 17:43:39</div></a></div><div class="text"><p>or go to <code>nix repl</code> and do <code>project = import ./.</code></p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/7334dc60b6aef6a75cd9284126231f13c76926a5?x=x&amp;version=4"></a><div class="content"><a class="author">Torsten Schmits</a><div class="metadata"><a href="#223408135" name="223408135"><div>2021-01-20 17:44:01</div></a></div><div class="text"><p>then just <code>project</code> and you'll see a bit</p></div></div></div><div class="comment"><a class="avatar"><img src="https://secure.gravatar.com/avatar/48469162d45686615c6bf0eb4304bf26?d=identicon&amp;version=1"></a><div class="content"><a class="author">Arnaud Bailly</a><div class="metadata"><a href="#223408428" name="223408428"><div>2021-01-20 17:45:41</div></a></div><div class="text"><p>thanks  for your help <span class="user-mention" data-user-id="260881">@Torsten Schmits</span> !</p></div></div></div><div class="comment"><a class="avatar"><img src="https://secure.gravatar.com/avatar/48469162d45686615c6bf0eb4304bf26?d=identicon&amp;version=1"></a><div class="content"><a class="author">Arnaud Bailly</a><div class="metadata"><a href="#223471362" name="223471362"><div>2021-01-21 05:23:36</div></a></div><div class="text"><p>Another question about Nix and Haskell. When initialising a package set I get the following error message:</p>
<div class="codehilite"><pre><span></span><code>unpacking &#39;https://github.com/input-output-hk/haskell.nix/archive/master.tar.gz&#39;...
unpacking &#39;https://github.com/input-output-hk/hackage.nix/archive/8ab47a84664f99da20ee5b956851a2431b9073d7.tar.gz&#39;...
warning: dumping very large path (&gt; 256 MiB); this may run out of memory
</code></pre></div>
<p>Should I be worried and if yes, what am I doing wrong?</p></div></div></div><div class="comment"><a class="avatar"><img src="https://secure.gravatar.com/avatar/48469162d45686615c6bf0eb4304bf26?d=identicon&amp;version=1"></a><div class="content"><a class="author">Arnaud Bailly</a><div class="metadata"><a href="#223487843" name="223487843"><div>2021-01-21 09:57:16</div></a></div><div class="text"><p>So, I managed to have a nix setup working and replicate that to "bootstrap"  a simple project. I am still stuck at the haskell-language-server stage, I don't know how to set the correct GHC Version to use (8.10.2), it insists in installing 8.10.3. Here is my <code>shell.nix</code> file:</p>
<div class="codehilite"><pre><span></span><code># shell.nix
{pkgs ? import &lt;nixpkgs&gt; {} }:

let
  hsPkgs = import ./default.nix { };
  haskellNix = import (builtins.fetchTarball https://github.com/input-output-hk/haskell.nix/archive/master.tar.gz) {};
in
  hsPkgs.shellFor {
    # Include only the *local* packages of your project.
    packages = ps: with ps; [
     okiwi-aoc
    ];

    # Builds a Hoogle documentation index of all dependencies,
    # and provides a &quot;hoogle&quot; command to search the index.
#    withHoogle = true;

    # You might want some extra tools in the shell (optional).

    # Some common tools can be added with the `tools` argument
    tools = { cabal = &quot;3.2.0.0&quot;; hlint = &quot;2.2.11&quot;; };
    # See overlays/tools.nix for more details

    # Some you may need to get some other way.
    buildInputs = with pkgs.haskellPackages;
      [ ghcid
        haskell-language-server
      ];

    # Prevents cabal from choosing alternate plans, so that
    # *all* dependencies are provided by Nix.
    exactDeps = true;
  }
</code></pre></div></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/7334dc60b6aef6a75cd9284126231f13c76926a5?x=x&amp;version=4"></a><div class="content"><a class="author">Torsten Schmits</a><div class="metadata"><a href="#223496890" name="223496890"><div>2021-01-21 11:41:15</div></a></div><div class="text"><div class="codehilite" data-code-language="Nix"><pre><span></span><code>    <span class="ss">buildInputs =</span> <span class="k">with</span> pkgs<span class="o">.</span>haskellPackages<span class="p">;</span>
      <span class="p">[</span> ghcid
        haskell-language-server
      <span class="p">];</span>
</code></pre></div>
<p>you're still using <code>pkgs</code> here, which is the global nixpkgs of your system environment.<br>
you need to use what's in <code>hsPkgs</code>.</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/7334dc60b6aef6a75cd9284126231f13c76926a5?x=x&amp;version=4"></a><div class="content"><a class="author">Torsten Schmits</a><div class="metadata"><a href="#223497001" name="223497001"><div>2021-01-21 11:42:31</div></a></div><div class="text"><p><span class="user-mention silent" data-user-id="251436">Arnaud Bailly</span> <a href="#narrow/stream/201385-Haskell/topic/Haskell.2Fnix.2FHLS.20setup/near/223471362">said</a>:</p>
<blockquote>
<p>Should I be worried and if yes, what am I doing wrong?</p>
</blockquote>
<p>that's normal; always happens when it unpacks a nixpkgs snapshot.</p></div></div></div><div class="comment"><a class="avatar"><img src="https://secure.gravatar.com/avatar/48469162d45686615c6bf0eb4304bf26?d=identicon&amp;version=1"></a><div class="content"><a class="author">Arnaud Bailly</a><div class="metadata"><a href="#223505749" name="223505749"><div>2021-01-21 13:16:25</div></a></div><div class="text"><p>Yes, but replacing pkgs with hsPkgs simply does not work. I will fiddle with it a bit more, reading <span class="user-mention" data-user-id="297611">@Gabriel Gonzalez</span>'s  tutorial to make sense of nix :)</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/7334dc60b6aef6a75cd9284126231f13c76926a5?x=x&amp;version=4"></a><div class="content"><a class="author">Torsten Schmits</a><div class="metadata"><a href="#223506230" name="223506230"><div>2021-01-21 13:20:50</div></a></div><div class="text"><p>the problem is:<br>
haskell.nix starts out with a "vanilla" nixpkgs, which is obtained by importing the snapshot in <code>default.nix</code>. then it modifies that snapshot, especially the <code>haskellPackages</code>, to include the tools the library provides, and creates an API set when calling the <code>project</code> function.<br>
in this API set (assigned to <code>hsPkgs</code>), there exists a haskell package set that corresponds to the compiler you selected with that one option. this is what you need to find within <code>hsPkgs</code>. maybe <code>hsPkgs</code> itself is that set, so you could try using <code>with hsPkgs</code> instead of <code>with pkgs.haskellPackages</code>.</p>
<p>otherwise you can try my <code>nix repl</code> suggestion and dig around in <code>hsPkgs</code> manually.</p></div></div></div><div class="comment"><a class="avatar"><img src="https://secure.gravatar.com/avatar/3cea5dd94abba9982d34d28eef71efc0?d=identicon&amp;version=1"></a><div class="content"><a class="author">Mason Mackaman</a><div class="metadata"><a href="#223525721" name="223525721"><div>2021-01-21 15:40:23</div></a></div><div class="text"><p>I have not used this much because I haven't done much haskell, but I have reason to believe this is a good tool for haskell on nix <a href="https://gitlab.com/fresheyeball/snowball">https://gitlab.com/fresheyeball/snowball</a></p>
<div class="message_embed"><a class="message_embed_image" href="https://gitlab.com/fresheyeball/snowball" style="background-image: url(https://assets.gitlab-static.net/uploads/-/system/project/avatar/23035417/jack-frost-image.png)"></a><div class="data-container"><div class="message_embed_title"><a href="https://gitlab.com/fresheyeball/snowball" title="Isaac Shapira / snowball">Isaac Shapira / snowball</a></div><div class="message_embed_description">Build a Haskell project with Nix</div></div></div></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/7334dc60b6aef6a75cd9284126231f13c76926a5?x=x&amp;version=4"></a><div class="content"><a class="author">Torsten Schmits</a><div class="metadata"><a href="#223526321" name="223526321"><div>2021-01-21 15:44:23</div></a></div><div class="text"><p>looks good</p></div></div></div><div class="comment"><a class="avatar"><img src="https://secure.gravatar.com/avatar/48469162d45686615c6bf0eb4304bf26?d=identicon&amp;version=1"></a><div class="content"><a class="author">Arnaud Bailly</a><div class="metadata"><a href="#223531717" name="223531717"><div>2021-01-21 16:19:27</div></a></div><div class="text"><p>Thanks again for your help. I will need to stick to haskell.nix as the code I am working on is part of the iohk ecosystem but thanks for the suggestion <span class="user-mention" data-user-id="338020">@Mason Mackaman</span></p></div></div></div><div class="comment"><a class="avatar"><img src="https://secure.gravatar.com/avatar/48469162d45686615c6bf0eb4304bf26?d=identicon&amp;version=1"></a><div class="content"><a class="author">Arnaud Bailly</a><div class="metadata"><a href="#223608158" name="223608158"><div>2021-01-22 06:35:16</div></a></div><div class="text"><p>So I ended up posting an issue on haskell.nix repo and the solution was to add <code>haskell-language-server = "0.8.0"</code> to the <code>tools</code> attribute set. <span aria-label="rolling eyes" class="emoji emoji-1f644" role="img" title="rolling eyes">:rolling_eyes:</span> I will try to find a way to document that somewhere.</p></div></div></div><div class="comment"><a class="avatar"><img src="https://secure.gravatar.com/avatar/48469162d45686615c6bf0eb4304bf26?d=identicon&amp;version=1"></a><div class="content"><a class="author">Arnaud Bailly</a><div class="metadata"><a href="#224455890" name="224455890"><div>2021-01-29 10:58:52</div></a></div><div class="text"><p><span class="user-mention" data-user-id="260881">@Torsten Schmits</span> finally managed to get a working nix/emacs/haskell/lsp env, after much struggling :)</p></div></div></div><div class="comment"><a class="avatar"><img src="https://secure.gravatar.com/avatar/48469162d45686615c6bf0eb4304bf26?d=identicon&amp;version=1"></a><div class="content"><a class="author">Arnaud Bailly</a><div class="metadata"><a href="#224455897" name="224455897"><div>2021-01-29 10:58:56</div></a></div><div class="text"><p>Thanks a lot for your help</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/7334dc60b6aef6a75cd9284126231f13c76926a5?x=x&amp;version=4"></a><div class="content"><a class="author">Torsten Schmits</a><div class="metadata"><a href="#224463646" name="224463646"><div>2021-01-29 12:31:46</div></a></div><div class="text"><p>awesome!</p></div></div></div></div></div><div class="ui vertical footer segment"><a href="https://github.com/srid/zulip-archive">Powered by Haskell</a> | Questions? Contact <a href="https://www.srid.ca">srid</a></div></div></body></html>