<html lang="en"><head><meta content="text/html; charset=utf-8" http-equiv="Content-Type"><meta content="width=device-width, initial-scale=1" name="viewport"><meta content="I have two questions regarding beam :):
1) I want to add create indexes and unique constraints on multiple columns.

Can I do this with beam? (somehow I assume not)
If not, can I maybe execute raw SQL as part of a migration?

2) Somehow I dont know how translate the following query into beam syntax:" name="description"><link href="https://funprog.srid.ca/haskell/beam-indexes-unique-cols-select-in-join.html" rel="canonical"><meta property="og:title" content="Beam: Indexes/unique cols + select in join? - Haskell"><meta property="og:site_name" content="Functional Programming Zulip Archive"><meta property="og:type" content="article"><meta property="og:article:section" content="Haskell"><meta property="og:article:modified_time" content="2020-05-04T00:34:52Z"><meta property="og:article:published_time" content="2020-04-30T19:16:45Z"><title>Beam: Indexes/unique cols + select in join? - Haskell</title><style type="text/css">
div#thesite
{
  font-family   : "Open Sans", sans-serif;
  font-size     : 1em !important;
  margin-top    : 1em;
  margin-bottom : 1em;
}

div#thesite h1
{
  font-family : "Roboto", sans-serif;
  line-height : 1.19999em;
}

div#thesite h2
{
  font-family : "Roboto", sans-serif;
  line-height : 1.19999em;
}

div#thesite h3
{
  font-family : "Roboto", sans-serif;
  line-height : 1.19999em;
}

div#thesite h4
{
  font-family : "Roboto", sans-serif;
  line-height : 1.19999em;
}

div#thesite h5
{
  font-family : "Roboto", sans-serif;
  line-height : 1.19999em;
}

div#thesite h6
{
  font-family : "Roboto", sans-serif;
  line-height : 1.19999em;
}

div#thesite .ui.breadcrumb.rib .section
{
  font-family : "Roboto", sans-serif;
  line-height : 1.19999em;
}

div#thesite .header
{
  font-family : "Roboto", sans-serif;
  line-height : 1.19999em;
}

div#thesite .as-header
{
  font-family : "Roboto", sans-serif;
  line-height : 1.19999em;
}

div#thesite code, pre, tt
{
  font-family : "SFMono-Regular","Menlo","Monaco","Consolas","Liberation Mono","Courier New", monospace;
}

div#thesite .ui.breadcrumb.rib
{
  margin-bottom : 1em;
}



div#thesite .ui.comments.messages .comment .metadata a
{
  color : #808080;
}

div#thesite .ui.comments.messages .comment a.avatar img
{
  height : auto;
}

div#thesite .subtle
{
  color : #808080;
}


div#thesite .messages pre
{
  font-size : 85%;
  overflow  : auto;
  max-width : 100%;
}

div#thesite .messages .message_embed
{
  border-left  : solid 3px #808080;
  padding-left : 0.69999em;
}

div#thesite .messages .message_inline_image img
{
  max-width     : 100%;
  margin-bottom : 1em;
}


/* Generated with Clay, http://fvisser.nl/clay */</style><link href="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.4.1/semantic.min.css" rel="stylesheet"><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.min.css" rel="stylesheet"><link href="https://fonts.googleapis.com/css?family=Open+Sans|Oswald&amp;display=swap" rel="stylesheet"><link href="https://fonts.googleapis.com/css?family=Roboto|Open+Sans&amp;display=swap" rel="stylesheet"></head><body><div id="thesite" class="ui text container"><div class="ui violet inverted top attached center aligned segment"><h1 class="ui huge header">Beam: Indexes/unique cols + select in join? - Haskell</h1></div><div class="ui attached segment"><div class="ui message"><p>Welcome to the Functional Programming Zulip Chat Archive. You can join the chat <a href="https://funprog.zulipchat.com">here</a>.</p></div><div class="ui breadcrumb rib"><a href="/" class="section">Home</a><i class="right angle icon divider"></i><a href="/haskell/" class="section">#Haskell</a><i class="right angle icon divider"></i><div class="active section">Beam: Indexes/unique cols + select in join?</div></div><div class="ui comments messages"><div class="comment"><a class="avatar"><img src="https://www.gravatar.com/avatar/30489c253fb604dad7c3d547e3099d8c"></a><div class="content"><a class="author">Matthias Putz</a><div class="metadata"><a href="#195888052" name="195888052"><div>2020-04-30 19:16:45</div></a></div><div class="text"><p>I have two questions regarding beam :):</p>
<p>1) I want to add create indexes and unique constraints on multiple columns.</p>
<ul>
<li>Can I do this with beam? (somehow I assume not)</li>
<li>If not, can I maybe execute raw SQL as part of a migration?</li>
</ul>
<p>2) Somehow I dont know how translate the following query into beam syntax:</p>
<div class="codehilite"><pre><span></span><code>SELECT *
FROM vehicle AS b
LEFT JOIN vehicle_position as bp
ON (b.id = bp.position_vehicle_id__id AND bp.position_id =
    (SELECT bp_.position_id FROM vehicle_position AS bp_ ORDER BY position_updated DESC limit 1));
</code></pre></div>


<p>In essence: I want to combine every entry in the main table with the latest value (regarding time) of another table. If there is no entry present, the entry should be combined with Nothing.<br>
How can I achieve this?</p></div></div></div><div class="comment"><a class="avatar"><img src="https://www.gravatar.com/avatar/30489c253fb604dad7c3d547e3099d8c"></a><div class="content"><a class="author">Matthias Putz</a><div class="metadata"><a href="#196097144" name="196097144"><div>2020-05-03 10:56:40</div></a></div><div class="text"><p><span class="user-mention silent" data-user-id="255639">Matthias Putz</span> <a href="#narrow/stream/201385-Haskell/topic/Beam.3A.20Indexes.2Funique.20cols.20.2B.20select.20in.20join.3F/near/195888052" title="#narrow/stream/201385-Haskell/topic/Beam.3A.20Indexes.2Funique.20cols.20.2B.20select.20in.20join.3F/near/195888052">said</a>:</p>
<blockquote>
<p>I have two questions regarding beam :):</p>
<p>1) I want to add create indexes and unique constraints on multiple columns.</p>
<ul>
<li>Can I do this with beam? (somehow I assume not)</li>
<li>If not, can I maybe execute raw SQL as part of a migration?</li>
</ul>
<p>2) Somehow I dont know how translate the following query into beam syntax:</p>
<div class="codehilite"><pre><span></span><code>SELECT *
FROM vehicle AS b
LEFT JOIN vehicle_position as bp
ON (b.id = bp.position_vehicle_id__id AND bp.position_id =
    (SELECT bp_.position_id FROM vehicle_position AS bp_ ORDER BY position_updated DESC limit 1));
</code></pre></div>


<p>In essence: I want to combine every entry in the main table with the latest value (regarding time) of another table. If there is no entry present, the entry should be combined with Nothing.<br>
How can I achieve this?</p>
</blockquote>
<p>Hm, d**n, thought especially the first one is an easy one since anybody doing something "serious" with a SQL database needs these features, not?<br>
May I "summon" you <span class="user-mention" data-user-id="251045">@Ben Kolera</span> and ask how you are managing this since you at OS apparently prefer using beam :D (I gave beam another try because of what you said :) ). Sorry for bothering :D.</p></div></div></div><div class="comment"><a class="avatar"><img src="https://www.gravatar.com/avatar/a3a40b5b547344370d45ad0f805b4d81"></a><div class="content"><a class="author">Ben Kolera</a><div class="metadata"><a href="#196130792" name="196130792"><div>2020-05-04 00:34:52</div></a></div><div class="text"><p>Not sure, actually. I currently work on a project that's not IV or even obelisk, lol. I know from poking around that we are on a forked copy of beam migrate (and maybe beam / beam postgres too), though, so it may well be that we've fixed that but not quite upstreamed such things yet.</p></div></div></div></div></div><div class="ui vertical footer segment"><a href="https://github.com/srid/zulip-archive">Powered by Haskell</a> | Questions? Contact <a href="https://www.srid.ca">srid</a></div></div></body></html>