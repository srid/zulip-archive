<html lang="en"><head><meta content="text/html; charset=utf-8" http-equiv="Content-Type"><meta content="width=device-width, initial-scale=1" name="viewport"><meta content="Let T be a type with the default derived Eq instance and x and y elements of type T. If x == y evaluates to True did GHC fully evaluate both types or could GHC have taken some short cut such as comparing if they are the same pointer before comparing structural equality?
data T = ... deriving Eq

x, " name="description"><link href="https://funprog.srid.ca/haskell/does-ghc-do-any-trickery-with-equality.html" rel="canonical"><meta property="og:title" content="Does GHC do any trickery with equality? - Haskell"><meta property="og:site_name" content="Functional Programming Zulip Archive"><meta property="og:type" content="article"><meta property="og:article:section" content="Haskell"><meta property="og:article:modified_time" content="2022-08-03T11:57:22Z"><meta property="og:article:published_time" content="2022-08-01T21:38:19Z"><meta property="og:image" content="https://zulip-avatars.s3.amazonaws.com/13896/3fd04473065250c8eec3f222ba3a974b28940e8a?version=2"><title>Does GHC do any trickery with equality? - Haskell</title><style type="text/css">
div#thesite
{
  font-family   : "Open Sans", sans-serif;
  font-size     : 1em !important;
  margin-top    : 1em;
  margin-bottom : 1em;
}

div#thesite h1
{
  font-family : "Roboto", sans-serif;
  line-height : 1.19999em;
}

div#thesite h2
{
  font-family : "Roboto", sans-serif;
  line-height : 1.19999em;
}

div#thesite h3
{
  font-family : "Roboto", sans-serif;
  line-height : 1.19999em;
}

div#thesite h4
{
  font-family : "Roboto", sans-serif;
  line-height : 1.19999em;
}

div#thesite h5
{
  font-family : "Roboto", sans-serif;
  line-height : 1.19999em;
}

div#thesite h6
{
  font-family : "Roboto", sans-serif;
  line-height : 1.19999em;
}

div#thesite .ui.breadcrumb.rib .section
{
  font-family : "Roboto", sans-serif;
  line-height : 1.19999em;
}

div#thesite .header
{
  font-family : "Roboto", sans-serif;
  line-height : 1.19999em;
}

div#thesite .as-header
{
  font-family : "Roboto", sans-serif;
  line-height : 1.19999em;
}

div#thesite code, pre, tt
{
  font-family : "SFMono-Regular","Menlo","Monaco","Consolas","Liberation Mono","Courier New", monospace;
}

div#thesite .ui.breadcrumb.rib
{
  margin-bottom : 1em;
}



div#thesite .ui.comments.messages .comment .metadata a
{
  color : #808080;
}

div#thesite .ui.comments.messages .comment a.avatar img
{
  height : auto;
}

div#thesite .subtle
{
  color : #808080;
}


div#thesite .messages pre
{
  font-size : 85%;
  overflow  : auto;
  max-width : 100%;
}

div#thesite .messages .message_embed
{
  border-left  : solid 3px #808080;
  padding-left : 0.69999em;
}

div#thesite .messages .message_inline_image img
{
  max-width     : 100%;
  margin-bottom : 1em;
}


/* Generated with Clay, http://fvisser.nl/clay */</style><link href="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.4.1/semantic.min.css" rel="stylesheet"><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.min.css" rel="stylesheet"><link href="https://fonts.googleapis.com/css?family=Open+Sans|Oswald&amp;display=swap" rel="stylesheet"><link href="https://fonts.googleapis.com/css?family=Roboto|Open+Sans&amp;display=swap" rel="stylesheet"></head><body><div id="thesite" class="ui text container"><div class="ui violet inverted top attached center aligned segment"><h1 class="ui huge header">Does GHC do any trickery with equality? - Haskell</h1></div><div class="ui attached segment"><div class="ui message"><p>Welcome to the Functional Programming Zulip Chat Archive. You can join the chat <a href="https://funprog.zulipchat.com">here</a>.</p></div><div class="ui breadcrumb rib"><a href="/" class="section">Home</a><i class="right angle icon divider"></i><a href="/haskell/" class="section">#Haskell</a><i class="right angle icon divider"></i><div class="active section">Does GHC do any trickery with equality?</div></div><div class="ui comments messages"><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/3fd04473065250c8eec3f222ba3a974b28940e8a?version=2"></a><div class="content"><a class="author">Pedro Minicz</a><div class="metadata"><a href="#291636920" name="291636920"><div>2022-08-01 21:38:19</div></a></div><div class="text"><p>Let <code>T</code> be a type with the default derived <code>Eq</code> instance and <code>x</code> and <code>y</code> elements of type <code>T</code>. If <code>x == y</code> evaluates to <code>True</code> did GHC fully evaluate both types or could GHC have taken some short cut such as comparing if they are the same pointer before comparing structural equality?</p>
<div class="codehilite" data-code-language="Haskell"><pre><span></span><code><span class="kr">data</span><span class="w"> </span><span class="kt">T</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="o">...</span><span class="w"> </span><span class="kr">deriving</span><span class="w"> </span><span class="kt">Eq</span><span class="w"></span>

<span class="nf">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="ow">::</span><span class="w"> </span><span class="kt">T</span><span class="w"></span>
<span class="nf">x</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="o">...</span><span class="w"></span>
<span class="nf">y</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="o">...</span><span class="w"></span>

<span class="nf">main</span><span class="w"> </span><span class="ow">::</span><span class="w"> </span><span class="kt">IO</span><span class="w"> </span><span class="nb">()</span><span class="w"></span>
<span class="nf">main</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="n">print</span><span class="w"> </span><span class="o">$</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">y</span><span class="w"></span>
</code></pre></div>
<p>In particular, if <code>main</code> above prints <code>True</code>, does that mean that <code>x</code> and <code>y</code> are both structurally equal and not infinite (and not bottom)?</p></div></div></div><div class="comment"><a class="avatar"><img src="https://www.gravatar.com/avatar/1114fd8de67671f83d3a3ef7594b1950"></a><div class="content"><a class="author">Georgi Lyubenov // googleson78</a><div class="metadata"><a href="#291810546" name="291810546"><div>2022-08-03 07:30:50</div></a></div><div class="text"><p>It depends on what types <code>T</code> contains</p></div></div></div><div class="comment"><a class="avatar"><img src="https://www.gravatar.com/avatar/1114fd8de67671f83d3a3ef7594b1950"></a><div class="content"><a class="author">Georgi Lyubenov // googleson78</a><div class="metadata"><a href="#291810596" name="291810596"><div>2022-08-03 07:31:20</div></a></div><div class="text"><p>This statement is not true for <code>Data.Void</code> for example:</p>
<div class="codehilite" data-code-language="Haskell"><pre><span></span><code><span class="o">&gt;</span><span class="w"> </span><span class="p">(</span><span class="n">undefined</span><span class="w"> </span><span class="ow">::</span><span class="w"> </span><span class="kt">Void</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">undefined</span><span class="w"></span>
<span class="kt">True</span><span class="w"></span>
</code></pre></div></div></div></div><div class="comment"><a class="avatar"><img src="https://www.gravatar.com/avatar/1114fd8de67671f83d3a3ef7594b1950"></a><div class="content"><a class="author">Georgi Lyubenov // googleson78</a><div class="metadata"><a href="#291810698" name="291810698"><div>2022-08-03 07:32:41</div></a></div><div class="text"><div class="codehilite" data-code-language="Haskell"><pre><span></span><code><span class="o">&gt;</span><span class="w"> </span><span class="kt">:</span><span class="n">set</span><span class="w"> </span><span class="o">-</span><span class="kt">XEmptyDataDeriving</span><span class="w"></span>
<span class="o">&gt;</span><span class="w"> </span><span class="kr">data</span><span class="w"> </span><span class="kt">Bla</span><span class="w"> </span><span class="kr">deriving</span><span class="w"> </span><span class="kt">Eq</span><span class="w"></span>
<span class="o">&gt;</span><span class="w"> </span><span class="p">(</span><span class="n">undefined</span><span class="w"> </span><span class="ow">::</span><span class="w"> </span><span class="kt">Bla</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">undefined</span><span class="w"></span>
<span class="kt">True</span><span class="w"></span>
</code></pre></div></div></div></div><div class="comment"><a class="avatar"><img src="https://www.gravatar.com/avatar/1114fd8de67671f83d3a3ef7594b1950"></a><div class="content"><a class="author">Georgi Lyubenov // googleson78</a><div class="metadata"><a href="#291810782" name="291810782"><div>2022-08-03 07:33:37</div></a></div><div class="text"><p>so maybe it's true if you require</p>
<ul>
<li>all types "contained" in <code>T</code> have a default deriving</li>
<li><code>T</code> doesn't have any <code>Void</code>s in it (or alternatively, rephrase the question to only be about non-bottom values)</li>
</ul></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/3fd04473065250c8eec3f222ba3a974b28940e8a?version=2"></a><div class="content"><a class="author">Pedro Minicz</a><div class="metadata"><a href="#291837828" name="291837828"><div>2022-08-03 11:57:22</div></a></div><div class="text"><p>The type I was thinking when I asked the question was this one:</p>
<div class="codehilite" data-code-language="Haskell"><pre><span></span><code><span class="kr">import</span><span class="w"> </span><span class="nn">Data.Text</span><span class="w"> </span><span class="p">(</span><span class="kt">Text</span><span class="p">)</span><span class="w"></span>

<span class="kr">type</span><span class="w"> </span><span class="kt">Name</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="p">(</span><span class="kt">Text</span><span class="p">,</span><span class="w"> </span><span class="kt">Maybe</span><span class="w"> </span><span class="kt">Int</span><span class="p">)</span><span class="w"></span>

<span class="kr">data</span><span class="w"> </span><span class="kt">Expr</span><span class="w"></span>
<span class="w">  </span><span class="ow">=</span><span class="w"> </span><span class="kt">Var</span><span class="w"> </span><span class="kt">Name</span><span class="w"></span>
<span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="kt">Sort</span><span class="w"> </span><span class="kt">Int</span><span class="w"></span>
<span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="kt">Pi</span><span class="w"> </span><span class="kt">Abstraction</span><span class="w"></span>
<span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="kt">Lam</span><span class="w"> </span><span class="kt">Abstraction</span><span class="w"></span>
<span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="kt">App</span><span class="w"> </span><span class="kt">Expr</span><span class="w"> </span><span class="kt">Expr</span><span class="w"></span>
<span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="kt">Annotation</span><span class="w"> </span><span class="kt">Expr</span><span class="w"> </span><span class="kt">Expr</span><span class="w"></span>
<span class="w">  </span><span class="kr">deriving</span><span class="w"> </span><span class="kt">Eq</span><span class="w"></span>

<span class="kr">type</span><span class="w"> </span><span class="kt">Abstraction</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="p">(</span><span class="kt">Maybe</span><span class="w"> </span><span class="kt">Name</span><span class="p">,</span><span class="w"> </span><span class="kt">Expr</span><span class="p">,</span><span class="w"> </span><span class="kt">Expr</span><span class="p">)</span><span class="w"></span>
</code></pre></div>
<p>It think the answer should be yes then, because it fulfills the required criteria.</p></div></div></div></div></div><div class="ui vertical footer segment"><a href="https://github.com/srid/zulip-archive">Powered by Haskell</a> | Questions? Contact <a href="https://www.srid.ca">srid</a></div></div></body></html>