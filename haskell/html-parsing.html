<html lang="en"><head><meta content="text/html; charset=utf-8" http-equiv="Content-Type"><meta content="width=device-width, initial-scale=1" name="viewport"><meta content="Is tagsoup/scalpel the best option for HTML parsing right now? I&#39;m running into performance issues with it and wondering if there is a better option already or if I should try to dig into the mess that is HTML parsing myself and try to make some improvements." name="description"><link href="https://funprog.srid.ca/haskell/html-parsing.html" rel="canonical"><meta property="og:title" content="HTML Parsing - Haskell"><meta property="og:site_name" content="Functional Programming Zulip Archive"><meta property="og:type" content="article"><meta property="og:article:section" content="Haskell"><meta property="og:article:modified_time" content="2020-04-30T17:50:35Z"><meta property="og:article:published_time" content="2020-04-30T15:18:21Z"><title>HTML Parsing - Haskell</title><style type="text/css">
div#thesite
{
  font-family   : "Open Sans", sans-serif;
  font-size     : 1em !important;
  margin-top    : 1em;
  margin-bottom : 1em;
}

div#thesite h1
{
  font-family : "Roboto", sans-serif;
  line-height : 1.19999em;
}

div#thesite h2
{
  font-family : "Roboto", sans-serif;
  line-height : 1.19999em;
}

div#thesite h3
{
  font-family : "Roboto", sans-serif;
  line-height : 1.19999em;
}

div#thesite h4
{
  font-family : "Roboto", sans-serif;
  line-height : 1.19999em;
}

div#thesite h5
{
  font-family : "Roboto", sans-serif;
  line-height : 1.19999em;
}

div#thesite h6
{
  font-family : "Roboto", sans-serif;
  line-height : 1.19999em;
}

div#thesite .ui.breadcrumb.rib .section
{
  font-family : "Roboto", sans-serif;
  line-height : 1.19999em;
}

div#thesite .header
{
  font-family : "Roboto", sans-serif;
  line-height : 1.19999em;
}

div#thesite .as-header
{
  font-family : "Roboto", sans-serif;
  line-height : 1.19999em;
}

div#thesite code, pre, tt
{
  font-family : "SFMono-Regular","Menlo","Monaco","Consolas","Liberation Mono","Courier New", monospace;
}

div#thesite .ui.breadcrumb.rib
{
  margin-bottom : 1em;
}



div#thesite .ui.comments.messages .comment .metadata a
{
  color : #808080;
}

div#thesite .ui.comments.messages .comment a.avatar img
{
  height : auto;
}

div#thesite .subtle
{
  color : #808080;
}


div#thesite .messages pre
{
  font-size : 85%;
  overflow  : auto;
  max-width : 100%;
}

div#thesite .messages .message_embed
{
  border-left  : solid 3px #808080;
  padding-left : 0.69999em;
}

div#thesite .messages .message_inline_image img
{
  max-width     : 100%;
  margin-bottom : 1em;
}


/* Generated with Clay, http://fvisser.nl/clay */</style><link href="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.4.1/semantic.min.css" rel="stylesheet"><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.min.css" rel="stylesheet"><link href="https://fonts.googleapis.com/css?family=Open+Sans|Oswald&amp;display=swap" rel="stylesheet"><link href="https://fonts.googleapis.com/css?family=Roboto|Open+Sans&amp;display=swap" rel="stylesheet"></head><body><div id="thesite" class="ui text container"><div class="ui violet inverted top attached center aligned segment"><h1 class="ui huge header">HTML Parsing - Haskell</h1></div><div class="ui attached segment"><div class="ui message"><p>Welcome to the Functional Programming Zulip Chat Archive. You can join the chat <a href="https://funprog.zulipchat.com">here</a>.</p></div><div class="ui breadcrumb rib"><a href="/" class="section">Home</a><i class="right angle icon divider"></i><a href="/haskell/" class="section">#Haskell</a><i class="right angle icon divider"></i><div class="active section">HTML Parsing</div></div><div class="ui comments messages"><div class="comment"><a class="avatar"><img src="https://www.gravatar.com/avatar/854c978d9927614eb1dd2148403f469d"></a><div class="content"><a class="author">jkeuhlen</a><div class="metadata"><a href="#195854712" name="195854712"><div>2020-04-30 15:18:21</div></a></div><div class="text"><p>Is tagsoup/scalpel the best option for HTML parsing right now? I'm running into performance issues with it and wondering if there is a better option already or if I should try to dig into the mess that is HTML parsing myself and try to make some improvements.</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/7334dc60b6aef6a75cd9284126231f13c76926a5?x=x&amp;version=4"></a><div class="content"><a class="author">Torsten Schmits</a><div class="metadata"><a href="#195856940" name="195856940"><div>2020-04-30 15:33:06</div></a></div><div class="text"><p>I've only used html-conduit for some simple things, which uses blaze as a backend. It advertises itself as <strong>blazingly fast</strong> <span aria-label="wink" class="emoji emoji-1f609" role="img" title="wink">:wink:</span></p></div></div></div><div class="comment"><a class="avatar"><img src="https://www.gravatar.com/avatar/4ba4faf2fc5818d37c0aed6acb5b69a2"></a><div class="content"><a class="author">James King</a><div class="metadata"><a href="#195857927" name="195857927"><div>2020-04-30 15:39:47</div></a></div><div class="text"><p>In general, HTML parsing is messy business. If you limit yourself to well-formed, strict HTML you can write things that are optimally performant.</p></div></div></div><div class="comment"><a class="avatar"><img src="https://www.gravatar.com/avatar/4ba4faf2fc5818d37c0aed6acb5b69a2"></a><div class="content"><a class="author">James King</a><div class="metadata"><a href="#195858143" name="195858143"><div>2020-04-30 15:40:55</div></a></div><div class="text"><p>But if you need to be able to parse a broad range of HTML documents, parsers can use plenty of heuristics to clean up the data which can be slow.</p></div></div></div><div class="comment"><a class="avatar"><img src="https://www.gravatar.com/avatar/4ba4faf2fc5818d37c0aed6acb5b69a2"></a><div class="content"><a class="author">James King</a><div class="metadata"><a href="#195858169" name="195858169"><div>2020-04-30 15:41:07</div></a></div><div class="text"><p>It's trade offs</p></div></div></div><div class="comment"><a class="avatar"><img src="https://www.gravatar.com/avatar/854c978d9927614eb1dd2148403f469d"></a><div class="content"><a class="author">jkeuhlen</a><div class="metadata"><a href="#195858987" name="195858987"><div>2020-04-30 15:46:56</div></a></div><div class="text"><p>Yeah I'm using <code>sanitizeBalance</code> to clean up some untrusted HTML that can definitely be malformed, but it uses tagsoup under the hood which has performance issues <span aria-label="frown" class="emoji emoji-1f641" role="img" title="frown">:frown:</span></p></div></div></div><div class="comment"><a class="avatar"><img src="https://www.gravatar.com/avatar/4ba4faf2fc5818d37c0aed6acb5b69a2"></a><div class="content"><a class="author">James King</a><div class="metadata"><a href="#195873740" name="195873740"><div>2020-04-30 17:29:12</div></a></div><div class="text"><p>I don't know that there are any better algorithms that what they use for parsing malformed HTML. That's the trade off you need to deal with in that area. <span aria-label="shrug" class="emoji emoji-1f937" role="img" title="shrug">:shrug:</span></p></div></div></div><div class="comment"><a class="avatar"><img src="https://www.gravatar.com/avatar/4ba4faf2fc5818d37c0aed6acb5b69a2"></a><div class="content"><a class="author">James King</a><div class="metadata"><a href="#195873873" name="195873873"><div>2020-04-30 17:30:03</div></a></div><div class="text"><p>But if, after parsing the malformed, and you need to revisit the data again you could at least serialize out the fixed HTML so that later batch jobs will be much faster.... <span aria-label="thinking" class="emoji emoji-1f914" role="img" title="thinking">:thinking:</span></p></div></div></div><div class="comment"><a class="avatar"><img src="https://www.gravatar.com/avatar/854c978d9927614eb1dd2148403f469d"></a><div class="content"><a class="author">jkeuhlen</a><div class="metadata"><a href="#195876458" name="195876458"><div>2020-04-30 17:50:35</div></a></div><div class="text"><p>Yeah I'm doing it all in real-time right now, but I'll probably do that in the future as an optimization.</p></div></div></div></div></div><div class="ui vertical footer segment"><a href="https://github.com/srid/zulip-archive">Powered by Haskell</a> | Questions? Contact <a href="https://www.srid.ca">srid</a></div></div></body></html>