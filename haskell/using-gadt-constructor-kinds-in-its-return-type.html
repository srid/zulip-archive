<html lang="en"><head><meta content="text/html; charset=utf-8" http-equiv="Content-Type"><meta content="width=device-width, initial-scale=1" name="viewport"><meta content="I&#39;m using DataKinds to promote the GADT constructors as types, such that I can restrict the FooList return type to contain just a list of Foo. In Foo this type is duplicated, but in Bar we use constructor kind to respect DRY.
data Foo a where
  FooOne :: Text -&gt; Foo Int
  FooList :: Foo [(Text, Int)" name="description"><link href="https://funprog.srid.ca/haskell/using-gadt-constructor-kinds-in-its-return-type.html" rel="canonical"><meta property="og:title" content="Using GADT constructor kinds in its return type - Haskell"><meta property="og:site_name" content="Functional Programming Zulip Archive"><meta property="og:type" content="article"><meta property="og:article:section" content="Haskell"><meta property="og:article:modified_time" content="2020-02-14T02:55:38Z"><meta property="og:article:published_time" content="2020-02-12T15:35:49Z"><meta property="og:image" content="https://zulip-avatars.s3.amazonaws.com/13896/4429aa8b689608f24a4ad712843ce29862e330d2?x=x&amp;version=2"><title>Using GADT constructor kinds in its return type - Haskell</title><style type="text/css">
div#thesite
{
  font-family   : "Open Sans", sans-serif;
  font-size     : 1em !important;
  margin-top    : 1em;
  margin-bottom : 1em;
}

div#thesite h1
{
  font-family : "Roboto", sans-serif;
  line-height : 1.19999em;
}

div#thesite h2
{
  font-family : "Roboto", sans-serif;
  line-height : 1.19999em;
}

div#thesite h3
{
  font-family : "Roboto", sans-serif;
  line-height : 1.19999em;
}

div#thesite h4
{
  font-family : "Roboto", sans-serif;
  line-height : 1.19999em;
}

div#thesite h5
{
  font-family : "Roboto", sans-serif;
  line-height : 1.19999em;
}

div#thesite h6
{
  font-family : "Roboto", sans-serif;
  line-height : 1.19999em;
}

div#thesite .ui.breadcrumb.rib .section
{
  font-family : "Roboto", sans-serif;
  line-height : 1.19999em;
}

div#thesite .header
{
  font-family : "Roboto", sans-serif;
  line-height : 1.19999em;
}

div#thesite .as-header
{
  font-family : "Roboto", sans-serif;
  line-height : 1.19999em;
}

div#thesite code, pre, tt
{
  font-family : "SFMono-Regular","Menlo","Monaco","Consolas","Liberation Mono","Courier New", monospace;
}

div#thesite .ui.breadcrumb.rib
{
  margin-bottom : 1em;
}



div#thesite .ui.comments.messages .comment .metadata a
{
  color : #808080;
}

div#thesite .ui.comments.messages .comment a.avatar img
{
  height : auto;
}

div#thesite .subtle
{
  color : #808080;
}


div#thesite .messages pre
{
  font-size : 85%;
  overflow  : auto;
  max-width : 100%;
}

div#thesite .messages .message_embed
{
  border-left  : solid 3px #808080;
  padding-left : 0.69999em;
}

div#thesite .messages .message_inline_image img
{
  max-width     : 100%;
  margin-bottom : 1em;
}


/* Generated with Clay, http://fvisser.nl/clay */</style><link href="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.4.1/semantic.min.css" rel="stylesheet"><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.min.css" rel="stylesheet"><link href="https://fonts.googleapis.com/css?family=Open+Sans|Oswald&amp;display=swap" rel="stylesheet"><link href="https://fonts.googleapis.com/css?family=Roboto|Open+Sans&amp;display=swap" rel="stylesheet"></head><body><div id="thesite" class="ui text container"><div class="ui violet inverted top attached center aligned segment"><h1 class="ui huge header">Using GADT constructor kinds in its return type - Haskell</h1></div><div class="ui attached segment"><div class="ui message"><p>Welcome to the Functional Programming Zulip Chat Archive. You can join the chat <a href="https://funprog.zulipchat.com">here</a>.</p></div><div class="ui breadcrumb rib"><a href="/" class="section">Home</a><i class="right angle icon divider"></i><a href="/haskell/" class="section">#Haskell</a><i class="right angle icon divider"></i><div class="active section">Using GADT constructor kinds in its return type</div></div><div class="ui comments messages"><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/4429aa8b689608f24a4ad712843ce29862e330d2?x=x&amp;version=2"></a><div class="content"><a class="author">Sridhar Ratnakumar</a><div class="metadata"><a href="#188020662" name="188020662"><div>2020-02-12 15:35:49</div></a></div><div class="text"><p>I'm using <code>DataKinds</code> to promote the GADT constructors as types, such that I can restrict the <code>FooList</code> return type to contain just a list of <code>Foo</code>. In Foo this type is duplicated, but in Bar we use constructor kind to respect DRY.</p>
<div class="codehilite"><pre><span></span><span class="kr">data</span> <span class="kt">Foo</span> <span class="n">a</span> <span class="kr">where</span>
  <span class="kt">FooOne</span> <span class="ow">::</span> <span class="kt">Text</span> <span class="ow">-&gt;</span> <span class="kt">Foo</span> <span class="kt">Int</span>
  <span class="kt">FooList</span> <span class="ow">::</span> <span class="kt">Foo</span> <span class="p">[(</span><span class="kt">Text</span><span class="p">,</span> <span class="kt">Int</span><span class="p">)]</span>

<span class="kr">type</span> <span class="kt">C</span> <span class="p">(</span><span class="n">c</span> <span class="ow">::</span> <span class="kt">Bar</span> <span class="n">a</span><span class="p">)</span> <span class="ow">=</span> <span class="p">(</span><span class="kt">Bar</span> <span class="n">a</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>

<span class="kr">data</span> <span class="kt">Bar</span> <span class="n">a</span> <span class="kr">where</span>
  <span class="kt">BarOne</span> <span class="ow">::</span> <span class="kt">Text</span> <span class="ow">-&gt;</span> <span class="kt">Bar</span> <span class="kt">Int</span>
  <span class="kt">BarList</span> <span class="ow">::</span> <span class="kt">Bar</span> <span class="p">[</span><span class="kt">C</span> <span class="p">(</span><span class="kt">&#39;BarOne</span> <span class="n">arg</span><span class="p">)]</span>
</pre></div>


<p>However GHC does not compile <code>Bar</code> as it throws: </p>
<div class="codehilite"><pre><span></span>error:
    • Type constructor ‘Bar’ cannot be used here
        (it is defined and used in the same recursive group)
    • In the kind ‘Bar a’
   |
30 | type C (c :: Bar a) = (Bar a, a)
   |              ^^^
</pre></div>


<p>Is there a different way to achieve this?</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/4429aa8b689608f24a4ad712843ce29862e330d2?x=x&amp;version=2"></a><div class="content"><a class="author">Sridhar Ratnakumar</a><div class="metadata"><a href="#188020829" name="188020829"><div>2020-02-12 15:37:31</div></a></div><div class="text"><p>(Imagine <code>Foo</code> having many such pairs of constructors (one for singleton, and another for list of it), and our goal here is to have the list constructors to use the same type as the singletone constructor in its return type, without duplicating the types by hand (which makes it error-prone, and more complex to read)</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/20a04d823b7c3891d78ca5f6a188ccd0e4fc5e3d?x=x&amp;version=2"></a><div class="content"><a class="author">TheMatten</a><div class="metadata"><a href="#188035770" name="188035770"><div>2020-02-12 17:57:24</div></a></div><div class="text"><p><span class="user-mention" data-user-id="251311">@Sridhar Ratnakumar</span>  Sometimes you can "tie the knot" in type (as we do with <code>Sem</code>'s row in <code>polysemy</code>), but personally I don't see how to make this work<br>
Maybe try splitting that list thing into separate GADT and parametrize by types involved?</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/20a04d823b7c3891d78ca5f6a188ccd0e4fc5e3d?x=x&amp;version=2"></a><div class="content"><a class="author">TheMatten</a><div class="metadata"><a href="#188035915" name="188035915"><div>2020-02-12 17:58:36</div></a></div><div class="text"><p>Or maybe you want something completely different? What's the use case?</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/4429aa8b689608f24a4ad712843ce29862e330d2?x=x&amp;version=2"></a><div class="content"><a class="author">Sridhar Ratnakumar</a><div class="metadata"><a href="#188036276" name="188036276"><div>2020-02-12 18:01:52</div></a></div><div class="text"><p><span class="user-mention" data-user-id="225127">@TheMatten</span> The use case is to represent the different "routes" in my static web site, such that each route specifies (in the type parameter of GADT) the type of the data used to generate the final HTML. Here's the real definition: <a href="https://github.com/srid/website/blob/0d36d459b5f226192d5138ab75a2f8d8aed6735d/src/Website/Page.hs#L30-L39" target="_blank" title="https://github.com/srid/website/blob/0d36d459b5f226192d5138ab75a2f8d8aed6735d/src/Website/Page.hs#L30-L39">https://github.com/srid/website/blob/0d36d459b5f226192d5138ab75a2f8d8aed6735d/src/Website/Page.hs#L30-L39</a></p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/srid/website/blob/0d36d459b5f226192d5138ab75a2f8d8aed6735d/src/Website/Page.hs#L30-L39" style="background-image: url(https://avatars2.githubusercontent.com/u/3998?s=400&amp;v=4)" target="_blank"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/srid/website/blob/0d36d459b5f226192d5138ab75a2f8d8aed6735d/src/Website/Page.hs#L30-L39" target="_blank" title="srid/website">srid/website</a></div><div class="message_embed_description">Source for my website. Contribute to srid/website development by creating an account on GitHub.</div></div></div></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/4429aa8b689608f24a4ad712843ce29862e330d2?x=x&amp;version=2"></a><div class="content"><a class="author">Sridhar Ratnakumar</a><div class="metadata"><a href="#188036445" name="188036445"><div>2020-02-12 18:03:15</div></a></div><div class="text"><p>So <code>Route_Note</code> represents an individual note page, whereas <code>Route_Index</code> represents the main page which links to all the note pages, and thus its value type includes a list of routes to those notes (along with the 'value' of each route)</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/4429aa8b689608f24a4ad712843ce29862e330d2?x=x&amp;version=2"></a><div class="content"><a class="author">Sridhar Ratnakumar</a><div class="metadata"><a href="#188036595" name="188036595"><div>2020-02-12 18:04:37</div></a></div><div class="text"><p>The  main reason for pushing the date value type to GADT type parameter is so that I can write functions like <code>urlForRoute :: Route a -&gt; Text</code> without requiring that data to be present. If I'm passing a list of routes to a <code>breadcrumb</code> function, for example, I just won't have the value for all routes obviously.</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/4429aa8b689608f24a4ad712843ce29862e330d2?x=x&amp;version=2"></a><div class="content"><a class="author">Sridhar Ratnakumar</a><div class="metadata"><a href="#188036657" name="188036657"><div>2020-02-12 18:05:14</div></a></div><div class="text"><p>(Where I <em>do</em> need the value, such as in a function that renders the HTML, I would use <code>DSum Route Identity</code>)</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/20a04d823b7c3891d78ca5f6a188ccd0e4fc5e3d?x=x&amp;version=2"></a><div class="content"><a class="author">TheMatten</a><div class="metadata"><a href="#188037806" name="188037806"><div>2020-02-12 18:15:50</div></a></div><div class="text"><p>I would maybe consider something like:</p>
<div class="codehilite"><pre><span></span><span class="kr">data</span> <span class="kt">Route</span> <span class="ow">=</span> <span class="kt">Index</span> <span class="o">|</span> <span class="kt">Note</span> <span class="o">|</span> <span class="kt">Tidbit</span>

<span class="kr">data</span> <span class="kt">SRoute</span> <span class="ow">::</span> <span class="kt">Route</span> <span class="ow">-&gt;</span> <span class="kt">Type</span> <span class="kr">where</span>
  <span class="kt">SIndex</span>  <span class="ow">::</span> <span class="kt">SRoute</span> <span class="kt">&#39;Index</span>
  <span class="kt">SNote</span>   <span class="ow">::</span> <span class="kt">SRoute</span> <span class="kt">&#39;Note</span>
  <span class="kt">STidbit</span> <span class="ow">::</span> <span class="kt">SRoute</span> <span class="kt">&#39;Tidbit</span>

<span class="kr">type</span> <span class="kr">family</span> <span class="kt">RouteData</span> <span class="ow">::</span> <span class="kt">Route</span> <span class="ow">-&gt;</span> <span class="kt">Type</span> <span class="kr">where</span>
  <span class="kt">RouteData</span> <span class="kt">&#39;Index</span>  <span class="ow">=</span> <span class="p">(</span><span class="kt">MMark</span><span class="p">,</span> <span class="p">[(</span><span class="kt">SourcePath</span><span class="p">,</span> <span class="kt">MMark</span><span class="p">)])</span>
  <span class="kt">RouteData</span> <span class="kt">&#39;Note</span>   <span class="ow">=</span> <span class="kt">MMark</span>
  <span class="kt">RouteData</span> <span class="kt">&#39;Tidbit</span> <span class="ow">=</span> <span class="p">[(</span><span class="kt">SourcePath</span><span class="p">,</span> <span class="kt">Tidbit</span><span class="p">)]</span>

<span class="kr">type</span> <span class="kr">family</span> <span class="kt">RouteOutput</span> <span class="ow">::</span> <span class="kt">Route</span> <span class="ow">-&gt;</span> <span class="kt">Type</span> <span class="kr">where</span>
  <span class="kt">RouteOutput</span> <span class="kt">&#39;Index</span>  <span class="ow">=</span> <span class="kt">&#39;HTML</span>
  <span class="kt">RouteOutput</span> <span class="kt">&#39;Note</span>   <span class="ow">=</span> <span class="kt">&#39;HTML</span>
  <span class="kt">RouteOutput</span> <span class="kt">&#39;Tidbit</span> <span class="ow">=</span> <span class="kt">&#39;HTML</span>

<span class="nf">getPageMeta</span> <span class="ow">::</span> <span class="kt">SRoute</span> <span class="n">r</span> <span class="ow">-&gt;</span> <span class="kt">RouteData</span> <span class="n">r</span> <span class="ow">-&gt;</span> <span class="kt">Maybe</span> <span class="kt">SrcMeta</span>
</pre></div></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/4429aa8b689608f24a4ad712843ce29862e330d2?x=x&amp;version=2"></a><div class="content"><a class="author">Sridhar Ratnakumar</a><div class="metadata"><a href="#188037999" name="188037999"><div>2020-02-12 18:17:07</div></a></div><div class="text"><p>Interesting; <a href="https://downloads.haskell.org/ghc/latest/docs/html/users_guide/glasgow_exts.html#type-families" target="_blank" title="https://downloads.haskell.org/ghc/latest/docs/html/users_guide/glasgow_exts.html#type-families">type families</a> is something I've never considered ...</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/4429aa8b689608f24a4ad712843ce29862e330d2?x=x&amp;version=2"></a><div class="content"><a class="author">Sridhar Ratnakumar</a><div class="metadata"><a href="#188038179" name="188038179"><div>2020-02-12 18:18:55</div></a></div><div class="text"><p>(One thing I'd eventually like to support is recursive routes, so: <code>data Route = Index | Note | Tidbit TidbitRoute</code>)</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/4429aa8b689608f24a4ad712843ce29862e330d2?x=x&amp;version=2"></a><div class="content"><a class="author">Sridhar Ratnakumar</a><div class="metadata"><a href="#188038477" name="188038477"><div>2020-02-12 18:21:37</div></a></div><div class="text"><p><span class="user-mention" data-user-id="225127">@TheMatten</span> How would you define a function that renders only HTML routes (<code>renderHtml :: DSum (Route 'HTML) Identity -&gt; Html ()</code>) for these type-family based types?</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/4429aa8b689608f24a4ad712843ce29862e330d2?x=x&amp;version=2"></a><div class="content"><a class="author">Sridhar Ratnakumar</a><div class="metadata"><a href="#188038575" name="188038575"><div>2020-02-12 18:22:14</div></a></div><div class="text"><p>Real code: <a href="https://github.com/srid/website/blob/0d36d459b5f226192d5138ab75a2f8d8aed6735d/src/Main.hs#L103-L104" target="_blank" title="https://github.com/srid/website/blob/0d36d459b5f226192d5138ab75a2f8d8aed6735d/src/Main.hs#L103-L104">https://github.com/srid/website/blob/0d36d459b5f226192d5138ab75a2f8d8aed6735d/src/Main.hs#L103-L104</a></p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/srid/website/blob/0d36d459b5f226192d5138ab75a2f8d8aed6735d/src/Main.hs#L103-L104" style="background-image: url(https://avatars2.githubusercontent.com/u/3998?s=400&amp;v=4)" target="_blank"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/srid/website/blob/0d36d459b5f226192d5138ab75a2f8d8aed6735d/src/Main.hs#L103-L104" target="_blank" title="srid/website">srid/website</a></div><div class="message_embed_description">Source for my website. Contribute to srid/website development by creating an account on GitHub.</div></div></div></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/20a04d823b7c3891d78ca5f6a188ccd0e4fc5e3d?x=x&amp;version=2"></a><div class="content"><a class="author">TheMatten</a><div class="metadata"><a href="#188038594" name="188038594"><div>2020-02-12 18:22:24</div></a></div><div class="text"><p><code>renderHtml :: RouteOutput r ~ 'HTML =&gt; SRoute r -&gt; RouteData r -&gt; Html ()</code></p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/4429aa8b689608f24a4ad712843ce29862e330d2?x=x&amp;version=2"></a><div class="content"><a class="author">Sridhar Ratnakumar</a><div class="metadata"><a href="#188038641" name="188038641"><div>2020-02-12 18:22:56</div></a></div><div class="text"><p>Constraining without type classes. Hmm.</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/20a04d823b7c3891d78ca5f6a188ccd0e4fc5e3d?x=x&amp;version=2"></a><div class="content"><a class="author">TheMatten</a><div class="metadata"><a href="#188039383" name="188039383"><div>2020-02-12 18:30:05</div></a></div><div class="text"><p>By having simple singleton and branching in type level functions I avoid coupling potentially unrelated information in one GADT - in a way, your original datatype was sort of "double function", computing two different things at the same time. That doesn't scale when you decide track some new property of route - you would have to unnecessarily update and clutter bunch of unrelated code.</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/20a04d823b7c3891d78ca5f6a188ccd0e4fc5e3d?x=x&amp;version=2"></a><div class="content"><a class="author">TheMatten</a><div class="metadata"><a href="#188039436" name="188039436"><div>2020-02-12 18:30:49</div></a></div><div class="text"><p>I try to think in "dependent" way - If Haskell was a dependent language, how would I write such code? I would take normal ADTs and compute types based on them.<br>
And then in real Haskell, I simply swap dependent quantifiers for singletons.</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/4429aa8b689608f24a4ad712843ce29862e330d2?x=x&amp;version=2"></a><div class="content"><a class="author">Sridhar Ratnakumar</a><div class="metadata"><a href="#188039651" name="188039651"><div>2020-02-12 18:32:59</div></a></div><div class="text"><p>As an aside: I'm quite happy to have stumbled upon type famillies through an actual use case need ... because this makes 'connecting the dots' easier, and learning intermediate/ advanced Haskell more practical (rather than as a detached academic knowledge)</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/20a04d823b7c3891d78ca5f6a188ccd0e4fc5e3d?x=x&amp;version=2"></a><div class="content"><a class="author">TheMatten</a><div class="metadata"><a href="#188039961" name="188039961"><div>2020-02-12 18:36:09</div></a></div><div class="text"><p>Once you start working with values at type level, they're somewhat inevitable <span aria-label="big smile" class="emoji emoji-1f604" role="img" title="big smile">:big_smile:</span> (Ignoring <code>MultiParamTypeClasses</code> with <code>FunctionalDependencies</code>, which were used for same purposes historically)</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/4429aa8b689608f24a4ad712843ce29862e330d2?x=x&amp;version=2"></a><div class="content"><a class="author">Sridhar Ratnakumar</a><div class="metadata"><a href="#188040358" name="188040358"><div>2020-02-12 18:41:23</div></a></div><div class="text"><p>This is rad. Case on the singleton, <em>and then</em> unpack the actual route data. <del>Can you do this without anonymous functions though? </del></p>
<div class="codehilite"><pre><span></span><span class="nf">renderHtml</span> <span class="ow">::</span> <span class="kt">RouteOutput</span> <span class="n">r</span> <span class="o">~</span> <span class="kt">&#39;HTML</span> <span class="ow">=&gt;</span> <span class="kt">SRoute</span> <span class="n">r</span> <span class="ow">-&gt;</span> <span class="kt">RouteData</span> <span class="n">r</span> <span class="ow">-&gt;</span> <span class="kt">Html</span> <span class="nb">()</span>
<span class="nf">renderHtml</span> <span class="ow">=</span> <span class="nf">\</span><span class="kr">case</span>
  <span class="kt">SIndex</span> <span class="ow">-&gt;</span> <span class="nf">\</span><span class="p">(</span><span class="n">_doc</span><span class="p">,</span> <span class="n">_notes</span><span class="p">)</span> <span class="ow">-&gt;</span> <span class="n">undefined</span>
  <span class="kt">SNote</span> <span class="ow">-&gt;</span> <span class="nf">\</span><span class="n">_doc</span> <span class="ow">-&gt;</span> <span class="n">undefined</span>
  <span class="kt">STidbit</span> <span class="ow">-&gt;</span> <span class="nf">\</span><span class="n">_tidbits</span> <span class="ow">-&gt;</span> <span class="n">undefined</span>
</pre></div></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/4429aa8b689608f24a4ad712843ce29862e330d2?x=x&amp;version=2"></a><div class="content"><a class="author">Sridhar Ratnakumar</a><div class="metadata"><a href="#188041507" name="188041507"><div>2020-02-12 18:53:45</div></a></div><div class="text"><p>So, to resolve the original problem I replaced <code>RouteData 'Index  = (MMark, [(SourcePath, MMark)])</code> with <code>RouteData 'Index = (MMark, [(Route 'Note, RouteData 'Note)])</code> (and then enabled UndecidableInstances).</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/4429aa8b689608f24a4ad712843ce29862e330d2?x=x&amp;version=2"></a><div class="content"><a class="author">Sridhar Ratnakumar</a><div class="metadata"><a href="#188045024" name="188045024"><div>2020-02-12 19:28:24</div></a></div><div class="text"><p>I think the next step is to group this singleton type and the type families in a type class <code>IsRoute</code>, so that recursive route kinds can simply implement an instance of it. And throw in utility functions like <code>routeFile</code> or <code>routeUrl</code> in it.</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/20a04d823b7c3891d78ca5f6a188ccd0e4fc5e3d?x=x&amp;version=2"></a><div class="content"><a class="author">TheMatten</a><div class="metadata"><a href="#188045472" name="188045472"><div>2020-02-12 19:32:43</div></a></div><div class="text"><p>Not sure if I see how that would work</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/4429aa8b689608f24a4ad712843ce29862e330d2?x=x&amp;version=2"></a><div class="content"><a class="author">Sridhar Ratnakumar</a><div class="metadata"><a href="#188045887" name="188045887"><div>2020-02-12 19:37:15</div></a></div><div class="text"><p>Trying to make it work. Seems I need either <code>IsRoute</code> and/or a kind of kind? (kind of all route <em>kinds</em>)</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/20a04d823b7c3891d78ca5f6a188ccd0e4fc5e3d?x=x&amp;version=2"></a><div class="content"><a class="author">TheMatten</a><div class="metadata"><a href="#188046094" name="188046094"><div>2020-02-12 19:39:32</div></a></div><div class="text"><p><code>IsRoute</code> makes sense for cases where route is statically determined - is that case in methods you want it to have?</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/4429aa8b689608f24a4ad712843ce29862e330d2?x=x&amp;version=2"></a><div class="content"><a class="author">Sridhar Ratnakumar</a><div class="metadata"><a href="#188046217" name="188046217"><div>2020-02-12 19:40:40</div></a></div><div class="text"><p>All routes are static. It is just that I'll have sub routes in separate modules, with the "top level" route pulling them all in.</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/4429aa8b689608f24a4ad712843ce29862e330d2?x=x&amp;version=2"></a><div class="content"><a class="author">Sridhar Ratnakumar</a><div class="metadata"><a href="#188046391" name="188046391"><div>2020-02-12 19:42:35</div></a></div><div class="text"><p>Real code example: added a <code>TidbitRoute</code> sub route (and the associated type familly declarations): <a href="https://github.com/srid/website/blob/e0e4b3de3e5c4db8d61ec4d2475e61016be7ea17/src/Website/Route.hs#L26-L29" target="_blank" title="https://github.com/srid/website/blob/e0e4b3de3e5c4db8d61ec4d2475e61016be7ea17/src/Website/Route.hs#L26-L29">https://github.com/srid/website/blob/e0e4b3de3e5c4db8d61ec4d2475e61016be7ea17/src/Website/Route.hs#L26-L29</a></p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/srid/website/blob/e0e4b3de3e5c4db8d61ec4d2475e61016be7ea17/src/Website/Route.hs#L26-L29" style="background-image: url(https://avatars2.githubusercontent.com/u/3998?s=400&amp;v=4)" target="_blank"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/srid/website/blob/e0e4b3de3e5c4db8d61ec4d2475e61016be7ea17/src/Website/Route.hs#L26-L29" target="_blank" title="srid/website">srid/website</a></div><div class="message_embed_description">Source for my website. Contribute to srid/website development by creating an account on GitHub.</div></div></div></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/20a04d823b7c3891d78ca5f6a188ccd0e4fc5e3d?x=x&amp;version=2"></a><div class="content"><a class="author">TheMatten</a><div class="metadata"><a href="#188046395" name="188046395"><div>2020-02-12 19:42:38</div></a></div><div class="text"><p>Wait, so you know what route you're passing to e.g. <code>renderHtml</code>?</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/4429aa8b689608f24a4ad712843ce29862e330d2?x=x&amp;version=2"></a><div class="content"><a class="author">Sridhar Ratnakumar</a><div class="metadata"><a href="#188046414" name="188046414"><div>2020-02-12 19:42:53</div></a></div><div class="text"><p>(see the modified <code>renderHtml</code> in that link)</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/4429aa8b689608f24a4ad712843ce29862e330d2?x=x&amp;version=2"></a><div class="content"><a class="author">Sridhar Ratnakumar</a><div class="metadata"><a href="#188046484" name="188046484"><div>2020-02-12 19:43:53</div></a></div><div class="text"><p>I wouldn't know what route I'm passing to it, no. It can be any <code>r</code>, as long as <code>RouteOutput r ~ 'HTML</code>.</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/20a04d823b7c3891d78ca5f6a188ccd0e4fc5e3d?x=x&amp;version=2"></a><div class="content"><a class="author">TheMatten</a><div class="metadata"><a href="#188046501" name="188046501"><div>2020-02-12 19:44:02</div></a></div><div class="text"><p>Because then you don't want singletons at all - they can all be methods of <code>IsRoute</code></p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/4429aa8b689608f24a4ad712843ce29862e330d2?x=x&amp;version=2"></a><div class="content"><a class="author">Sridhar Ratnakumar</a><div class="metadata"><a href="#188046616" name="188046616"><div>2020-02-12 19:45:27</div></a></div><div class="text"><p>I assume singleton type is being defined here <em>only because</em> non-Type kinds cannot be inhabited in Haskell.</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/4429aa8b689608f24a4ad712843ce29862e330d2?x=x&amp;version=2"></a><div class="content"><a class="author">Sridhar Ratnakumar</a><div class="metadata"><a href="#188046754" name="188046754"><div>2020-02-12 19:46:50</div></a></div><div class="text"><p>Also notice how in that link a new type family (eg: <code>TidbitRouteData</code>) gets defined for <em>each</em> sub route. This is one reason behind the type class approach, as I thought that putting the type family inside the type class would obviate new definitions.</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/20a04d823b7c3891d78ca5f6a188ccd0e4fc5e3d?x=x&amp;version=2"></a><div class="content"><a class="author">TheMatten</a><div class="metadata"><a href="#188046853" name="188046853"><div>2020-02-12 19:47:54</div></a></div><div class="text"><p>Singletons are used to lift values to type level - there's no way of saying "this value determines that type" - so they "cheat" by having only one value for every different final type</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/20a04d823b7c3891d78ca5f6a188ccd0e4fc5e3d?x=x&amp;version=2"></a><div class="content"><a class="author">TheMatten</a><div class="metadata"><a href="#188047011" name="188047011"><div>2020-02-12 19:49:34</div></a></div><div class="text"><p>But if they're available at compile time, you can just as well put them directly into types and not use singletons at all</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/4429aa8b689608f24a4ad712843ce29862e330d2?x=x&amp;version=2"></a><div class="content"><a class="author">Sridhar Ratnakumar</a><div class="metadata"><a href="#188047315" name="188047315"><div>2020-02-12 19:52:06</div></a></div><div class="text"><p>How would the above <code>renderHtml</code> look like without singletons?</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/4429aa8b689608f24a4ad712843ce29862e330d2?x=x&amp;version=2"></a><div class="content"><a class="author">Sridhar Ratnakumar</a><div class="metadata"><a href="#188047347" name="188047347"><div>2020-02-12 19:52:24</div></a></div><div class="text"><p>Note that each route has its own "datum" and "output" type.</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/20a04d823b7c3891d78ca5f6a188ccd0e4fc5e3d?x=x&amp;version=2"></a><div class="content"><a class="author">TheMatten</a><div class="metadata"><a href="#188051281" name="188051281"><div>2020-02-12 20:40:48</div></a></div><div class="text"><p>This would typecheck:</p>
<div class="codehilite"><pre><span></span><span class="kr">data</span> <span class="kt">Foo</span> <span class="ow">=</span> <span class="kt">Bar</span> <span class="o">|</span> <span class="kt">Baz</span>

<span class="kr">data</span> <span class="kt">SFoo</span> <span class="ow">::</span> <span class="kt">Foo</span> <span class="ow">-&gt;</span> <span class="kt">Type</span> <span class="kr">where</span>
  <span class="kt">SBar</span> <span class="ow">::</span> <span class="kt">SFoo</span> <span class="kt">&#39;Bar</span>
  <span class="kt">SBaz</span> <span class="ow">::</span> <span class="kt">SFoo</span> <span class="kt">&#39;Baz</span>

<span class="kr">class</span> <span class="kt">IsFoo</span> <span class="p">(</span><span class="n">foo</span> <span class="ow">::</span> <span class="kt">Foo</span><span class="p">)</span> <span class="kr">where</span>
  <span class="n">withBar</span> <span class="ow">::</span> <span class="n">foo</span> <span class="o">~</span> <span class="kt">&#39;Bar</span> <span class="ow">=&gt;</span> <span class="nb">()</span>

<span class="kr">instance</span> <span class="kt">IsFoo</span> <span class="kt">&#39;Bar</span> <span class="kr">where</span>
  <span class="n">withBar</span> <span class="ow">=</span> <span class="nb">()</span>

<span class="kr">instance</span> <span class="kt">IsFoo</span> <span class="kt">&#39;Baz</span> <span class="kr">where</span>
  <span class="n">withBar</span> <span class="ow">=</span> <span class="kr">case</span> <span class="n">refl</span> <span class="o">@</span><span class="kr">_</span> <span class="o">@</span><span class="kt">&#39;Baz</span> <span class="o">@</span><span class="kt">&#39;Bar</span> <span class="kr">of</span> <span class="p">{}</span>

<span class="nf">refl</span> <span class="ow">::</span> <span class="n">forall</span> <span class="n">k</span> <span class="p">(</span><span class="n">a</span> <span class="ow">::</span> <span class="n">k</span><span class="p">)</span> <span class="p">(</span><span class="n">b</span> <span class="ow">::</span> <span class="n">k</span><span class="p">)</span><span class="o">.</span> <span class="n">a</span> <span class="o">~</span> <span class="n">b</span> <span class="ow">=&gt;</span> <span class="n">a</span> <span class="kt">:~:</span> <span class="n">b</span>
<span class="nf">refl</span> <span class="ow">=</span> <span class="kt">Refl</span>
</pre></div>


<p>But I guess it wouldn't be that convenient to write - thing is, keeping value at type level for as long as possible makes working with them easier</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/4429aa8b689608f24a4ad712843ce29862e330d2?x=x&amp;version=2"></a><div class="content"><a class="author">Sridhar Ratnakumar</a><div class="metadata"><a href="#188051620" name="188051620"><div>2020-02-12 20:45:54</div></a></div><div class="text"><p>My attempt at writing a <code>IsRoute</code> mostly succeeded, except when it came to implementing the type family. Apparently you cannot write multiple instances for it (one for each kind constructor) <em>inside a type class instance</em>, as the compile disallows it. Anyway, it seemed to me that type-class'fying it would complicate things a bit for little benefit.</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/4429aa8b689608f24a4ad712843ce29862e330d2?x=x&amp;version=2"></a><div class="content"><a class="author">Sridhar Ratnakumar</a><div class="metadata"><a href="#188174016" name="188174016"><div>2020-02-14 02:55:38</div></a></div><div class="text"><p><span class="user-mention" data-user-id="225127">@TheMatten</span> I've incorporated your suggestions in here: <a href="https://github.com/srid/website/pull/15/files" target="_blank" title="https://github.com/srid/website/pull/15/files">https://github.com/srid/website/pull/15/files</a> ... the new route system is a little more complex than I'd like, but things are much easier to modify from now. Thanks for the help! Good to learn about type families ...</p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/srid/website/pull/15/files" style="background-image: url(https://avatars2.githubusercontent.com/u/3998?s=400&amp;v=4)" target="_blank"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/srid/website/pull/15/files" target="_blank" title="Route revamp by srid · Pull Request #15 · srid/website">Route revamp by srid · Pull Request #15 · srid/website</a></div><div class="message_embed_description">resurrect breadcrumbs
 ...
 stash feed code (for another PR)</div></div></div></div></div></div></div></div><div class="ui vertical footer segment"><a href="https://github.com/srid/zulip-archive">Powered by Haskell</a></div></div></body></html>