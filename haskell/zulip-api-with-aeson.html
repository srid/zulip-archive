<html lang="en"><head><meta content="text/html; charset=utf-8" http-equiv="Content-Type"><meta content="width=device-width, initial-scale=1" name="viewport"><meta content="aeson makes it super easy to interact for JSON APIs - I&#39;m building Zulip bindings and this is all I need to write to bind concrete endpoint:
newtype MessageHistory = MessageHistory{
    mhMessageHistory :: [MessageSnapshot]
  } deriving stock (Show, Generic)
    deriving FromJSON via ZulipJSON Messa" name="description"><link href="https://funprog.srid.ca/haskell/zulip-api-with-aeson.html" rel="canonical"><meta property="og:title" content="Zulip API with `aeson` - Haskell"><meta property="og:site_name" content="Functional Programming Zulip Archive"><meta property="og:type" content="article"><meta property="og:article:section" content="Haskell"><meta property="og:article:modified_time" content="2020-03-31T18:46:07Z"><meta property="og:article:published_time" content="2020-03-10T18:03:09Z"><meta property="og:image" content="https://zulip-avatars.s3.amazonaws.com/13896/20a04d823b7c3891d78ca5f6a188ccd0e4fc5e3d?version=2"><title>Zulip API with `aeson` - Haskell</title><style type="text/css">
div#thesite
{
  font-family   : "Open Sans", sans-serif;
  font-size     : 1em !important;
  margin-top    : 1em;
  margin-bottom : 1em;
}

div#thesite h1
{
  font-family : "Roboto", sans-serif;
  line-height : 1.19999em;
}

div#thesite h2
{
  font-family : "Roboto", sans-serif;
  line-height : 1.19999em;
}

div#thesite h3
{
  font-family : "Roboto", sans-serif;
  line-height : 1.19999em;
}

div#thesite h4
{
  font-family : "Roboto", sans-serif;
  line-height : 1.19999em;
}

div#thesite h5
{
  font-family : "Roboto", sans-serif;
  line-height : 1.19999em;
}

div#thesite h6
{
  font-family : "Roboto", sans-serif;
  line-height : 1.19999em;
}

div#thesite .ui.breadcrumb.rib .section
{
  font-family : "Roboto", sans-serif;
  line-height : 1.19999em;
}

div#thesite .header
{
  font-family : "Roboto", sans-serif;
  line-height : 1.19999em;
}

div#thesite .as-header
{
  font-family : "Roboto", sans-serif;
  line-height : 1.19999em;
}

div#thesite code, pre, tt
{
  font-family : "SFMono-Regular","Menlo","Monaco","Consolas","Liberation Mono","Courier New", monospace;
}

div#thesite .ui.breadcrumb.rib
{
  margin-bottom : 1em;
}



div#thesite .ui.comments.messages .comment .metadata a
{
  color : #808080;
}

div#thesite .ui.comments.messages .comment a.avatar img
{
  height : auto;
}

div#thesite .subtle
{
  color : #808080;
}


div#thesite .messages pre
{
  font-size : 85%;
  overflow  : auto;
  max-width : 100%;
}

div#thesite .messages .message_embed
{
  border-left  : solid 3px #808080;
  padding-left : 0.69999em;
}

div#thesite .messages .message_inline_image img
{
  max-width     : 100%;
  margin-bottom : 1em;
}


/* Generated with Clay, http://fvisser.nl/clay */</style><link href="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.4.1/semantic.min.css" rel="stylesheet"><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.min.css" rel="stylesheet"><link href="https://fonts.googleapis.com/css?family=Open+Sans|Oswald&amp;display=swap" rel="stylesheet"><link href="https://fonts.googleapis.com/css?family=Roboto|Open+Sans&amp;display=swap" rel="stylesheet"></head><body><div id="thesite" class="ui text container"><div class="ui violet inverted top attached center aligned segment"><h1 class="ui huge header">Zulip API with `aeson` - Haskell</h1></div><div class="ui attached segment"><div class="ui message"><p>Welcome to the Functional Programming Zulip Chat Archive. You can join the chat <a href="https://funprog.zulipchat.com">here</a>.</p></div><div class="ui breadcrumb rib"><a href="/" class="section">Home</a><i class="right angle icon divider"></i><a href="/haskell/" class="section">#Haskell</a><i class="right angle icon divider"></i><div class="active section">Zulip API with `aeson`</div></div><div class="ui comments messages"><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/20a04d823b7c3891d78ca5f6a188ccd0e4fc5e3d?version=2"></a><div class="content"><a class="author">TheMatten</a><div class="metadata"><a href="#190205035" name="190205035"><div>2020-03-10 18:03:09</div></a></div><div class="text"><p><code>aeson</code> makes it super easy to interact for JSON APIs - I'm building Zulip bindings and this is all I need to write to bind concrete endpoint:</p>
<div class="codehilite"><pre><span></span><span class="kr">newtype</span> <span class="kt">MessageHistory</span> <span class="ow">=</span> <span class="kt">MessageHistory</span><span class="p">{</span>
    <span class="n">mhMessageHistory</span> <span class="ow">::</span> <span class="p">[</span><span class="kt">MessageSnapshot</span><span class="p">]</span>
  <span class="p">}</span> <span class="kr">deriving</span> <span class="n">stock</span> <span class="p">(</span><span class="kt">Show</span><span class="p">,</span> <span class="kt">Generic</span><span class="p">)</span>
    <span class="kr">deriving</span> <span class="kt">FromJSON</span> <span class="n">via</span> <span class="kt">ZulipJSON</span> <span class="kt">MessageHistory</span>

<span class="kr">data</span> <span class="kt">MessageSnapshot</span> <span class="ow">=</span> <span class="kt">MessageSnapshot</span><span class="p">{</span>
    <span class="n">msTopic</span>               <span class="ow">::</span> <span class="kt">Text</span>
  <span class="p">,</span> <span class="n">msContent</span>             <span class="ow">::</span> <span class="kt">Text</span>
  <span class="p">,</span> <span class="n">msRenderedContent</span>     <span class="ow">::</span> <span class="kt">Text</span>
  <span class="p">,</span> <span class="n">msPrevContent</span>         <span class="ow">::</span> <span class="kt">Maybe</span> <span class="kt">Text</span>
  <span class="p">,</span> <span class="n">msPrevRenderedContent</span> <span class="ow">::</span> <span class="kt">Maybe</span> <span class="kt">Text</span>
  <span class="p">,</span> <span class="n">msUserId</span>              <span class="ow">::</span> <span class="kt">UserId</span>
  <span class="p">,</span> <span class="n">msContentHtmlDiff</span>     <span class="ow">::</span> <span class="kt">Maybe</span> <span class="kt">Text</span>
  <span class="p">,</span> <span class="n">msTimestamp</span>           <span class="ow">::</span> <span class="kt">Timestamp</span>
  <span class="p">}</span> <span class="kr">deriving</span> <span class="n">stock</span> <span class="p">(</span><span class="kt">Show</span><span class="p">,</span> <span class="kt">Generic</span><span class="p">)</span>
    <span class="kr">deriving</span> <span class="kt">FromJSON</span> <span class="n">via</span> <span class="kt">ZulipJSON</span> <span class="kt">MessageSnapshot</span>

<span class="kr">type</span> <span class="kr">instance</span> <span class="kt">Args</span> <span class="kt">MessageHistory</span> <span class="ow">=</span> <span class="nb">()</span>

<span class="nf">getMessageHistory</span> <span class="ow">::</span> <span class="kt">MonadIO</span> <span class="n">m</span>
                  <span class="ow">=&gt;</span> <span class="kt">MessageId</span> <span class="ow">-&gt;</span> <span class="kt">ZulipT</span> <span class="n">m</span> <span class="p">(</span><span class="kt">Either</span> <span class="kt">ZulipError</span> <span class="kt">MessageHistory</span><span class="p">)</span>
<span class="nf">getMessageHistory</span> <span class="n">msgId</span> <span class="ow">=</span> <span class="n">zulipGet</span> <span class="p">(</span><span class="s">&quot;messages/&quot;</span> <span class="o">++</span> <span class="n">show</span> <span class="n">msgId</span> <span class="o">++</span> <span class="s">&quot;/history&quot;</span><span class="p">)</span> <span class="nb">()</span>
</pre></div></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/4429aa8b689608f24a4ad712843ce29862e330d2?version=3"></a><div class="content"><a class="author">Sridhar Ratnakumar</a><div class="metadata"><a href="#190206150" name="190206150"><div>2020-03-10 18:13:05</div></a></div><div class="text"><p><span class="user-mention" data-user-id="225127">@TheMatten</span> What's <code>ZulipJSON</code>? Does it do anything more than <code>fieldLabelMomd</code> of <a href="https://github.com/srid/zulip-archive/blob/d2a3267/src/Zulip/Internal.hs#L9-L13" target="_blank" title="https://github.com/srid/zulip-archive/blob/d2a3267/src/Zulip/Internal.hs#L9-L13">https://github.com/srid/zulip-archive/blob/d2a3267/src/Zulip/Internal.hs#L9-L13</a> ?</p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/srid/zulip-archive/blob/d2a3267/src/Zulip/Internal.hs#L9-L13" style="background-image: url(https://avatars2.githubusercontent.com/u/3998?s=400&amp;v=4)" target="_blank"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/srid/zulip-archive/blob/d2a3267/src/Zulip/Internal.hs#L9-L13" target="_blank" title="srid/zulip-archive">srid/zulip-archive</a></div><div class="message_embed_description">Zulip Archive viewer (statically generated HTML). Contribute to srid/zulip-archive development by creating an account on GitHub.</div></div></div></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/4429aa8b689608f24a4ad712843ce29862e330d2?version=3"></a><div class="content"><a class="author">Sridhar Ratnakumar</a><div class="metadata"><a href="#190206206" name="190206206"><div>2020-03-10 18:13:41</div></a></div><div class="text"><p>I wonder: are you writing Zulip bindings for creating a Zulip bot in Haskell? In any case, we could use your bindings in zulip-archive!</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/20a04d823b7c3891d78ca5f6a188ccd0e4fc5e3d?version=2"></a><div class="content"><a class="author">TheMatten</a><div class="metadata"><a href="#190206238" name="190206238"><div>2020-03-10 18:13:57</div></a></div><div class="text"><p>It uses custom <code>genericParseJSON</code> <code>Options</code> - less verbose that making instance directly</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/4429aa8b689608f24a4ad712843ce29862e330d2?version=3"></a><div class="content"><a class="author">Sridhar Ratnakumar</a><div class="metadata"><a href="#190206287" name="190206287"><div>2020-03-10 18:14:06</div></a></div><div class="text"><p>(I hope you are using <code>req</code> for http requests)</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/20a04d823b7c3891d78ca5f6a188ccd0e4fc5e3d?version=2"></a><div class="content"><a class="author">TheMatten</a><div class="metadata"><a href="#190206455" name="190206455"><div>2020-03-10 18:15:46</div></a></div><div class="text"><p>I use <code>http-client</code> <span aria-label="grimacing" class="emoji emoji-1f62c" role="img" title="grimacing">:grimacing:</span> - I found it to get the least in the way</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/20a04d823b7c3891d78ca5f6a188ccd0e4fc5e3d?version=2"></a><div class="content"><a class="author">TheMatten</a><div class="metadata"><a href="#190206551" name="190206551"><div>2020-03-10 18:16:21</div></a></div><div class="text"><p>And I've tried <code>hreq</code> and <code>req</code></p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/4429aa8b689608f24a4ad712843ce29862e330d2?version=3"></a><div class="content"><a class="author">Sridhar Ratnakumar</a><div class="metadata"><a href="#190206594" name="190206594"><div>2020-03-10 18:16:49</div></a></div><div class="text"><p>Come on, isn't <code>req</code> more modern? :-D</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/4429aa8b689608f24a4ad712843ce29862e330d2?version=3"></a><div class="content"><a class="author">Sridhar Ratnakumar</a><div class="metadata"><a href="#190206630" name="190206630"><div>2020-03-10 18:17:12</div></a></div><div class="text"><p>I'm not familiar with <code>http-client</code> - but <code>req</code> says "type-safe" - and that appealed to me</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/4429aa8b689608f24a4ad712843ce29862e330d2?version=3"></a><div class="content"><a class="author">Sridhar Ratnakumar</a><div class="metadata"><a href="#190206773" name="190206773"><div>2020-03-10 18:18:23</div></a></div><div class="text"><p>I found <code>req</code> to be pretty easy to write REST API clients, actually. Disclaimer: never used any other client library (aside from <code>wreq</code>) in the past.</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/20a04d823b7c3891d78ca5f6a188ccd0e4fc5e3d?version=2"></a><div class="content"><a class="author">TheMatten</a><div class="metadata"><a href="#190207118" name="190207118"><div>2020-03-10 18:21:22</div></a></div><div class="text"><p>For my purpose of having few basic combinators for actual interaction wrapped in custom transformer, I find it's powerful interface unnecessary - I'm not interacting with it directly that often</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/20a04d823b7c3891d78ca5f6a188ccd0e4fc5e3d?version=2"></a><div class="content"><a class="author">TheMatten</a><div class="metadata"><a href="#190207361" name="190207361"><div>2020-03-10 18:23:41</div></a></div><div class="text"><p>But the way I'm doing this, if it turns out to be a better alternative, It should be simple enough to switch to it</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/20a04d823b7c3891d78ca5f6a188ccd0e4fc5e3d?version=2"></a><div class="content"><a class="author">TheMatten</a><div class="metadata"><a href="#190213222" name="190213222"><div>2020-03-10 19:15:43</div></a></div><div class="text"><div class="codehilite"><pre><span></span><span class="kr">newtype</span> <span class="kt">RGB</span> <span class="ow">=</span> <span class="kt">RGB</span> <span class="kt">Text</span>
  <span class="kr">deriving</span> <span class="p">(</span><span class="kt">Show</span><span class="p">,</span> <span class="kt">IsString</span><span class="p">,</span> <span class="kt">FromJSON</span><span class="p">,</span> <span class="kt">ToJSON</span><span class="p">)</span> <span class="n">via</span> <span class="kt">RGB</span>
</pre></div>


<p><span aria-label="face palm" class="emoji emoji-1f926" role="img" title="face palm">:face_palm:</span></p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/20a04d823b7c3891d78ca5f6a188ccd0e4fc5e3d?version=2"></a><div class="content"><a class="author">TheMatten</a><div class="metadata"><a href="#190213279" name="190213279"><div>2020-03-10 19:16:05</div></a></div><div class="text"><p>Can we have like warning for this? <span aria-label="big smile" class="emoji emoji-1f604" role="img" title="big smile">:big_smile:</span></p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/4429aa8b689608f24a4ad712843ce29862e330d2?version=3"></a><div class="content"><a class="author">Sridhar Ratnakumar</a><div class="metadata"><a href="#190213396" name="190213396"><div>2020-03-10 19:17:35</div></a></div><div class="text"><p>That reminds me of <code>modern-uri</code>'s <code>RText</code> type: <a href="https://hackage.haskell.org/package/modern-uri-0.3.1.0/docs/Text-URI.html#t:RText" target="_blank" title="https://hackage.haskell.org/package/modern-uri-0.3.1.0/docs/Text-URI.html#t:RText">https://hackage.haskell.org/package/modern-uri-0.3.1.0/docs/Text-URI.html#t:RText</a></p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/20a04d823b7c3891d78ca5f6a188ccd0e4fc5e3d?version=2"></a><div class="content"><a class="author">TheMatten</a><div class="metadata"><a href="#190213704" name="190213704"><div>2020-03-10 19:20:16</div></a></div><div class="text"><p>Yeah - I want to avoid pulling dependencies because of newtypes, at least for now<br>
But like, I was wondering why I'm suddenly stuck in infinite loop for no good reason for at least a few minutes... <span aria-label="sweat smile" class="emoji emoji-1f605" role="img" title="sweat smile">:sweat_smile:</span></p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/20a04d823b7c3891d78ca5f6a188ccd0e4fc5e3d?version=2"></a><div class="content"><a class="author">TheMatten</a><div class="metadata"><a href="#190333805" name="190333805"><div>2020-03-11 21:29:53</div></a></div><div class="text"><p>This message was sent from Haskell using Zulip API <span aria-label="big smile" class="emoji emoji-1f604" role="img" title="big smile">:big_smile:</span></p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/20a04d823b7c3891d78ca5f6a188ccd0e4fc5e3d?version=2"></a><div class="content"><a class="author">TheMatten</a><div class="metadata"><a href="#190333965" name="190333965"><div>2020-03-11 21:31:35</div></a></div><div class="text"><p>Yay! <span aria-label="party ball" class="emoji emoji-1f38a" role="img" title="party ball">:party_ball:</span></p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/4429aa8b689608f24a4ad712843ce29862e330d2?version=3"></a><div class="content"><a class="author">Sridhar Ratnakumar</a><div class="metadata"><a href="#190343308" name="190343308"><div>2020-03-11 23:28:40</div></a></div><div class="text"><p><span class="user-mention" data-user-id="225127">@TheMatten</span> So what do you plan to create with it? Lambdabot-like?</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/20a04d823b7c3891d78ca5f6a188ccd0e4fc5e3d?version=2"></a><div class="content"><a class="author">TheMatten</a><div class="metadata"><a href="#190358441" name="190358441"><div>2020-03-12 05:45:29</div></a></div><div class="text"><p>Yeah - once I map rest of the API</p>
<p><code>zulip-api</code> already seems to cover more of the API than <code>hzulip</code>, but being more exhaustive means that a lot of functions take whole records of arguments to be manageable, which are pretty inconvenient to fill in - I guess I'll need some sort of anonymous records with optional fields</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/20a04d823b7c3891d78ca5f6a188ccd0e4fc5e3d?version=2"></a><div class="content"><a class="author">TheMatten</a><div class="metadata"><a href="#190424441" name="190424441"><div>2020-03-12 18:07:39</div></a></div><div class="text"><p>I guess I will use <a href="https://hackage.haskell.org/package/named-0.3.0.1/docs/Named.html" target="_blank" title="https://hackage.haskell.org/package/named-0.3.0.1/docs/Named.html">https://hackage.haskell.org/package/named-0.3.0.1/docs/Named.html</a> to avoid those ugly record arguments</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/20a04d823b7c3891d78ca5f6a188ccd0e4fc5e3d?version=2"></a><div class="content"><a class="author">TheMatten</a><div class="metadata"><a href="#190439912" name="190439912"><div>2020-03-12 20:20:43</div></a></div><div class="text"><div class="codehilite"><pre><span></span><span class="gd">-  getMessages MessagesArgs{</span>
<span class="gd">-      maAnchor               = Just AOldest</span>
<span class="gd">-    , maUseFirstUnreadAnchor = Nothing</span>
<span class="gd">-    , maNumBefore            = 10</span>
<span class="gd">-    , maNumAfter             = 10</span>
<span class="gd">-    , maNarrow               = [Narrow NOStream &quot;General&quot; False]</span>
<span class="gd">-    , maClientGravatar       = False</span>
<span class="gd">-    , maApplyMarkdown        = False</span>
<span class="gd">-    }</span>
<span class="gi">+  getMessages</span>
<span class="gi">+    ! #anchor    AOldest</span>
<span class="gi">+    ! #numBefore 10</span>
<span class="gi">+    ! #numAfter  10</span>
<span class="gi">+    ! #narrow    [Narrow NOStream &quot;General&quot; False]</span>
<span class="gi">+    ! defaults</span>
</pre></div></div></div></div><div class="comment"><a class="avatar"><img src="https://www.gravatar.com/avatar/3d24a4100b3eab34d8ce3059d789c543"></a><div class="content"><a class="author">Sandy Maguire</a><div class="metadata"><a href="#190443152" name="190443152"><div>2020-03-12 20:48:17</div></a></div><div class="text"><p>bye bye helpful type errors</p></div></div></div><div class="comment"><a class="avatar"><img src="https://www.gravatar.com/avatar/3d24a4100b3eab34d8ce3059d789c543"></a><div class="content"><a class="author">Sandy Maguire</a><div class="metadata"><a href="#190443390" name="190443390"><div>2020-03-12 20:50:10</div></a></div><div class="text"><p>i hate to say it, but i think those boring haskell guys are right here</p></div></div></div><div class="comment"><a class="avatar"><img src="https://www.gravatar.com/avatar/3d24a4100b3eab34d8ce3059d789c543"></a><div class="content"><a class="author">Sandy Maguire</a><div class="metadata"><a href="#190443417" name="190443417"><div>2020-03-12 20:50:27</div></a></div><div class="text"><p>there is a lot of magic here in order to get trivial syntactic sugar</p></div></div></div><div class="comment"><a class="avatar"><img src="https://www.gravatar.com/avatar/3d24a4100b3eab34d8ce3059d789c543"></a><div class="content"><a class="author">Sandy Maguire</a><div class="metadata"><a href="#190443423" name="190443423"><div>2020-03-12 20:50:33</div></a></div><div class="text"><p>does it pay for itself?</p></div></div></div><div class="comment"><a class="avatar"><img src="https://www.gravatar.com/avatar/4ba4faf2fc5818d37c0aed6acb5b69a2"></a><div class="content"><a class="author">James King</a><div class="metadata"><a href="#190444572" name="190444572"><div>2020-03-12 21:00:16</div></a></div><div class="text"><p>Hm, for the public API of a module I might consider <em>not</em> prefixing the fields as <code>aeson</code> and others do: <a href="https://hackage.haskell.org/package/aeson-1.2.4.0/docs/src/Data-Aeson-Types-Internal.html#Options" target="_blank" title="https://hackage.haskell.org/package/aeson-1.2.4.0/docs/src/Data-Aeson-Types-Internal.html#Options">https://hackage.haskell.org/package/aeson-1.2.4.0/docs/src/Data-Aeson-Types-Internal.html#Options</a></p></div></div></div><div class="comment"><a class="avatar"><img src="https://www.gravatar.com/avatar/4ba4faf2fc5818d37c0aed6acb5b69a2"></a><div class="content"><a class="author">James King</a><div class="metadata"><a href="#190444879" name="190444879"><div>2020-03-12 21:02:51</div></a></div><div class="text"><p>Exporting a default value that users can override is a nice API pattern.</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/20a04d823b7c3891d78ca5f6a188ccd0e4fc5e3d?version=2"></a><div class="content"><a class="author">TheMatten</a><div class="metadata"><a href="#190445226" name="190445226"><div>2020-03-12 21:05:48</div></a></div><div class="text"><p><span class="user-mention" data-user-id="251120">@Sandy Maguire</span>  You would be surprised how well it works - <code>(!)</code> just locates right named argument, and if it doesn't, it throws a nice error</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/20a04d823b7c3891d78ca5f6a188ccd0e4fc5e3d?version=2"></a><div class="content"><a class="author">TheMatten</a><div class="metadata"><a href="#190445401" name="190445401"><div>2020-03-12 21:07:14</div></a></div><div class="text"><p>It <em>really</em> pays for itself - filing in of those records gets crazy pretty quickly</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/20a04d823b7c3891d78ca5f6a188ccd0e4fc5e3d?version=2"></a><div class="content"><a class="author">TheMatten</a><div class="metadata"><a href="#190445593" name="190445593"><div>2020-03-12 21:09:27</div></a></div><div class="text"><p>If I wanted default values with records, I would have to make stuff optional and require users to use <code>Just</code> everywhere - I can't avoid prefixes because there's a lot of overlapping names and I want to follow API closely</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/20a04d823b7c3891d78ca5f6a188ccd0e4fc5e3d?version=2"></a><div class="content"><a class="author">TheMatten</a><div class="metadata"><a href="#190445670" name="190445670"><div>2020-03-12 21:10:03</div></a></div><div class="text"><p>This is nicer, has no prefixes, has default values and no inference problems AFAIK</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/4429aa8b689608f24a4ad712843ce29862e330d2?version=3"></a><div class="content"><a class="author">Sridhar Ratnakumar</a><div class="metadata"><a href="#190449177" name="190449177"><div>2020-03-12 21:47:36</div></a></div><div class="text"><p>Named library is great for actual function arguments, but for filling up records ... well, I have never used it for that purpose, so I wouldn't know. FWIW, Reflex uses Data.Default and lenses to solve the default value problem.</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/4429aa8b689608f24a4ad712843ce29862e330d2?version=3"></a><div class="content"><a class="author">Sridhar Ratnakumar</a><div class="metadata"><a href="#190449303" name="190449303"><div>2020-03-12 21:48:52</div></a></div><div class="text"><p><code>getMessages $ def &amp; anchor .~ AOldest &amp; numBefore .~ 10 ...</code></p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/4429aa8b689608f24a4ad712843ce29862e330d2?version=3"></a><div class="content"><a class="author">Sridhar Ratnakumar</a><div class="metadata"><a href="#190449817" name="190449817"><div>2020-03-12 21:54:13</div></a></div><div class="text"><p><span class="user-mention" data-user-id="225127">@TheMatten</span> what's <code>:t getMessages</code>?</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/20a04d823b7c3891d78ca5f6a188ccd0e4fc5e3d?version=2"></a><div class="content"><a class="author">TheMatten</a><div class="metadata"><a href="#190449983" name="190449983"><div>2020-03-12 21:55:51</div></a></div><div class="text"><p><span class="user-mention" data-user-id="251311">@Sridhar Ratnakumar</span> </p>
<div class="codehilite"><pre><span></span><span class="nf">getMessages</span>
  <span class="ow">::</span> <span class="kt">MonadIO</span> <span class="n">m</span> <span class="ow">=&gt;</span>
     <span class="p">(</span><span class="s">&quot;anchor&quot;</span> <span class="kt">:?</span> <span class="kt">Anchor</span><span class="p">)</span>
     <span class="ow">-&gt;</span> <span class="p">(</span><span class="s">&quot;useFirstUnreadAnchor&quot;</span> <span class="kt">:?</span> <span class="kt">Bool</span><span class="p">)</span>
     <span class="ow">-&gt;</span> <span class="p">(</span><span class="s">&quot;numBefore&quot;</span> <span class="kt">:!</span> <span class="kt">GHC</span><span class="o">.</span><span class="kt">Natural</span><span class="o">.</span><span class="kt">Natural</span><span class="p">)</span>
     <span class="ow">-&gt;</span> <span class="p">(</span><span class="s">&quot;numAfter&quot;</span> <span class="kt">:!</span> <span class="kt">GHC</span><span class="o">.</span><span class="kt">Natural</span><span class="o">.</span><span class="kt">Natural</span><span class="p">)</span>
     <span class="ow">-&gt;</span> <span class="p">(</span><span class="s">&quot;narrow&quot;</span> <span class="kt">:?</span> <span class="p">[</span><span class="kt">Narrow</span><span class="p">])</span>
     <span class="ow">-&gt;</span> <span class="p">(</span><span class="s">&quot;clientGravatar&quot;</span> <span class="kt">:?</span> <span class="kt">Bool</span><span class="p">)</span>
     <span class="ow">-&gt;</span> <span class="p">(</span><span class="s">&quot;applyMarkdown&quot;</span> <span class="kt">:?</span> <span class="kt">Bool</span><span class="p">)</span>
     <span class="ow">-&gt;</span> <span class="kt">ZulipT</span> <span class="n">m</span> <span class="p">(</span><span class="kt">Either</span> <span class="kt">ZulipError</span> <span class="kt">Messages</span><span class="p">)</span>
</pre></div></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/20a04d823b7c3891d78ca5f6a188ccd0e4fc5e3d?version=2"></a><div class="content"><a class="author">TheMatten</a><div class="metadata"><a href="#190450081" name="190450081"><div>2020-03-12 21:56:40</div></a></div><div class="text"><p>I mean, it hardly gets better with any other solution</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/20a04d823b7c3891d78ca5f6a188ccd0e4fc5e3d?version=2"></a><div class="content"><a class="author">TheMatten</a><div class="metadata"><a href="#190450096" name="190450096"><div>2020-03-12 21:56:53</div></a></div><div class="text"><p>(in Haskell - I want anonymous records soo much)</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/4429aa8b689608f24a4ad712843ce29862e330d2?version=3"></a><div class="content"><a class="author">Sridhar Ratnakumar</a><div class="metadata"><a href="#190450148" name="190450148"><div>2020-03-12 21:57:25</div></a></div><div class="text"><p>Okay, that looks nice. <code>:?</code> are optional arguments? I can see the value of it, especially if from the API user point of view you don't have to care about records. You just call the API method, pass it the parameters and get back result.</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/4429aa8b689608f24a4ad712843ce29862e330d2?version=3"></a><div class="content"><a class="author">Sridhar Ratnakumar</a><div class="metadata"><a href="#190450445" name="190450445"><div>2020-03-12 22:00:26</div></a></div><div class="text"><p>Interesting, I didn't know about <code>:?</code> and <code>defaults</code> from <a href="http://hackage.haskell.org/package/named-0.3.0.1/docs/Named.html" target="_blank" title="http://hackage.haskell.org/package/named-0.3.0.1/docs/Named.html">Named</a>.  This is one way to implement variable arguments with default values in Haskell.</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/4429aa8b689608f24a4ad712843ce29862e330d2?version=3"></a><div class="content"><a class="author">Sridhar Ratnakumar</a><div class="metadata"><a href="#190450712" name="190450712"><div>2020-03-12 22:03:08</div></a></div><div class="text"><p>I wonder if this trick can be used in GADT constructor arguments.</p>
<div class="codehilite"><pre><span></span><span class="kr">data</span> <span class="kt">ZulipApi</span> <span class="n">res</span> <span class="kr">where</span>
  <span class="kt">GetMessages</span> <span class="ow">::</span> <span class="p">(</span><span class="s">&quot;anchor&quot;</span> <span class="kt">:?</span> <span class="kt">Anchor</span><span class="p">)</span> <span class="ow">-&gt;</span> <span class="o">...</span> <span class="ow">-&gt;</span> <span class="p">(</span><span class="s">&quot;applyMarkdown&quot;</span> <span class="kt">:?</span> <span class="kt">Bool</span><span class="p">)</span> <span class="ow">-&gt;</span> <span class="kt">ZulipApi</span> <span class="kt">Messages</span>
  <span class="o">...</span>
</pre></div></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/20a04d823b7c3891d78ca5f6a188ccd0e4fc5e3d?version=2"></a><div class="content"><a class="author">TheMatten</a><div class="metadata"><a href="#190450769" name="190450769"><div>2020-03-12 22:04:01</div></a></div><div class="text"><p>Yeah, it should work</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/20a04d823b7c3891d78ca5f6a188ccd0e4fc5e3d?version=2"></a><div class="content"><a class="author">TheMatten</a><div class="metadata"><a href="#190450818" name="190450818"><div>2020-03-12 22:04:16</div></a></div><div class="text"><p>They're just functions after all (on expression side)</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/4429aa8b689608f24a4ad712843ce29862e330d2?version=3"></a><div class="content"><a class="author">Sridhar Ratnakumar</a><div class="metadata"><a href="#190450829" name="190450829"><div>2020-03-12 22:04:30</div></a></div><div class="text"><ul>
<li><code>$(makeApiMethods ''ZulipApi)</code></li>
<li>???</li>
<li>Profit!</li>
</ul></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/20a04d823b7c3891d78ca5f6a188ccd0e4fc5e3d?version=2"></a><div class="content"><a class="author">TheMatten</a><div class="metadata"><a href="#190451267" name="190451267"><div>2020-03-12 22:10:07</div></a></div><div class="text"><p>Thing is, sometimes I need to work around API's and Haskell's quirks, so it wouldn't be possible in general - But I guess it's pretty good already:</p>
<div class="codehilite"><pre><span></span><span class="kr">data</span> <span class="kt">Stream</span> <span class="ow">=</span> <span class="kt">Stream</span><span class="p">{</span>
    <span class="n">sStreamId</span>    <span class="ow">::</span> <span class="kt">StreamId</span>
  <span class="p">,</span> <span class="n">sName</span>        <span class="ow">::</span> <span class="kt">Text</span>
  <span class="p">,</span> <span class="n">sDescription</span> <span class="ow">::</span> <span class="kt">Text</span>
  <span class="p">,</span> <span class="n">sInviteOnly</span>  <span class="ow">::</span> <span class="kt">Bool</span>
  <span class="p">}</span> <span class="kr">deriving</span> <span class="n">stock</span> <span class="p">(</span><span class="kt">Show</span><span class="p">,</span> <span class="kt">Generic</span><span class="p">)</span>
    <span class="kr">deriving</span> <span class="kt">FromJSON</span> <span class="n">via</span> <span class="kt">ZulipJSON</span> <span class="kt">Stream</span>

<span class="nf">getStreams</span> <span class="ow">::</span> <span class="kt">MonadIO</span> <span class="n">m</span>
           <span class="ow">=&gt;</span> <span class="s">&quot;includePublic&quot;</span>          <span class="kt">:?</span> <span class="kt">Bool</span>
           <span class="ow">-&gt;</span> <span class="s">&quot;includeSubscribed&quot;</span>      <span class="kt">:?</span> <span class="kt">Bool</span>
           <span class="ow">-&gt;</span> <span class="s">&quot;includeAllActive&quot;</span>       <span class="kt">:?</span> <span class="kt">Bool</span>
           <span class="ow">-&gt;</span> <span class="s">&quot;includeDefault&quot;</span>         <span class="kt">:?</span> <span class="kt">Bool</span>
           <span class="ow">-&gt;</span> <span class="s">&quot;includeOwnerSubscribed&quot;</span> <span class="kt">:?</span> <span class="kt">Bool</span>
           <span class="ow">-&gt;</span> <span class="kt">ZulipT</span> <span class="n">m</span> <span class="p">(</span><span class="kt">Either</span> <span class="kt">ZulipError</span> <span class="p">[</span><span class="kt">Stream</span><span class="p">])</span>
<span class="nf">getStreams</span> <span class="p">(</span><span class="kt">P</span> <span class="n">p</span><span class="p">)</span> <span class="p">(</span><span class="kt">P</span> <span class="n">s</span><span class="p">)</span> <span class="p">(</span><span class="kt">P</span> <span class="n">a</span><span class="p">)</span> <span class="p">(</span><span class="kt">P</span> <span class="n">d</span><span class="p">)</span> <span class="p">(</span><span class="kt">P</span> <span class="n">o</span><span class="p">)</span> <span class="ow">=</span>
  <span class="n">deField</span> <span class="o">@</span><span class="s">&quot;streams&quot;</span> <span class="o">$</span> <span class="n">zulipGet</span> <span class="s">&quot;streams&quot;</span> <span class="o">$</span> <span class="n">p</span> <span class="o">&lt;&gt;</span> <span class="n">s</span> <span class="o">&lt;&gt;</span> <span class="n">a</span> <span class="o">&lt;&gt;</span> <span class="n">d</span> <span class="o">&lt;&gt;</span> <span class="n">o</span>
</pre></div></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/20a04d823b7c3891d78ca5f6a188ccd0e4fc5e3d?version=2"></a><div class="content"><a class="author">TheMatten</a><div class="metadata"><a href="#190451314" name="190451314"><div>2020-03-12 22:11:11</div></a></div><div class="text"><p>(I may be able to get rid of that pattern matching too at some point)</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/20a04d823b7c3891d78ca5f6a188ccd0e4fc5e3d?version=2"></a><div class="content"><a class="author">TheMatten</a><div class="metadata"><a href="#190451491" name="190451491"><div>2020-03-12 22:13:48</div></a></div><div class="text"><p>Oh, and I probably want to use <code>MonadZulip</code> that could be implemented over  <code>Sem</code> etc.</p></div></div></div><div class="comment"><a class="avatar"><img src="https://www.gravatar.com/avatar/520889f20a2c66a8f4bd5be6f37d2923"></a><div class="content"><a class="author">Asad Saeeduddin</a><div class="metadata"><a href="#190452031" name="190452031"><div>2020-03-12 22:20:35</div></a></div><div class="text"><p><span class="user-mention" data-user-id="225127">@TheMatten</span> Have you considered generically deriving an isomorphism between some actual record type and the datatype of interest?</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/20a04d823b7c3891d78ca5f6a188ccd0e4fc5e3d?version=2"></a><div class="content"><a class="author">TheMatten</a><div class="metadata"><a href="#190452081" name="190452081"><div>2020-03-12 22:21:47</div></a></div><div class="text"><p><span class="user-mention" data-user-id="225136">@Asad Saeeduddin</span> Not sure what you mean exactly <span aria-label="sweat smile" class="emoji emoji-1f605" role="img" title="sweat smile">:sweat_smile:</span></p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/20a04d823b7c3891d78ca5f6a188ccd0e4fc5e3d?version=2"></a><div class="content"><a class="author">TheMatten</a><div class="metadata"><a href="#190452168" name="190452168"><div>2020-03-12 22:22:33</div></a></div><div class="text"><p>Actual record type as <code>SomethingArgs</code> I was using previously?</p></div></div></div><div class="comment"><a class="avatar"><img src="https://www.gravatar.com/avatar/520889f20a2c66a8f4bd5be6f37d2923"></a><div class="content"><a class="author">Asad Saeeduddin</a><div class="metadata"><a href="#190452377" name="190452377"><div>2020-03-12 22:25:58</div></a></div><div class="text"><p>what i mean is if you've got some big complicated datatype like <code>data MessagesArgs = MessagesArgs { a :: Int, bajillion :: Bool, fields :: String, ... }</code>, and some record library that lets you construct <code>R ( #a := 42, #bajillion := True, #fields := "", ... )</code>, you can have a generic isomorphism that converts between the two representations, and generic lenses onto partial subsets of fields, and if it's a big sum type, generic prisms, etc.</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/20a04d823b7c3891d78ca5f6a188ccd0e4fc5e3d?version=2"></a><div class="content"><a class="author">TheMatten</a><div class="metadata"><a href="#190452702" name="190452702"><div>2020-03-12 22:29:40</div></a></div><div class="text"><p>Yeah - well, it doesn't really solve my problem of having to fully fill in those big records, every time I want to call some API function</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/20a04d823b7c3891d78ca5f6a188ccd0e4fc5e3d?version=2"></a><div class="content"><a class="author">TheMatten</a><div class="metadata"><a href="#190452802" name="190452802"><div>2020-03-12 22:30:33</div></a></div><div class="text"><p>Unless user would be using such <code>R</code> - but then Sandy's argument applies I guess, it just becomes overkill for what I need</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/20a04d823b7c3891d78ca5f6a188ccd0e4fc5e3d?version=2"></a><div class="content"><a class="author">TheMatten</a><div class="metadata"><a href="#190452867" name="190452867"><div>2020-03-12 22:31:38</div></a></div><div class="text"><p><span class="user-mention" data-user-id="250737">@Jan van Brügge</span> was there some progress on anonymous records in Haskell? <span aria-label="sweat smile" class="emoji emoji-1f605" role="img" title="sweat smile">:sweat_smile:</span></p></div></div></div><div class="comment"><a class="avatar"><img src="https://www.gravatar.com/avatar/93ea3d19789047de293970e997237325"></a><div class="content"><a class="author">Jan van Brügge</a><div class="metadata"><a href="#190452941" name="190452941"><div>2020-03-12 22:32:37</div></a></div><div class="text"><p>not yet, I had exams until this week, but wanted to work on it at ghc week</p></div></div></div><div class="comment"><a class="avatar"><img src="https://www.gravatar.com/avatar/520889f20a2c66a8f4bd5be6f37d2923"></a><div class="content"><a class="author">Asad Saeeduddin</a><div class="metadata"><a href="#190452963" name="190452963"><div>2020-03-12 22:33:03</div></a></div><div class="text"><p>yes, the user has to be exposed to whatever solution helps them call the API more conveniently ultimately. that said, the user could start with a <code>mempty</code> value to avoid filling every field themselves</p></div></div></div><div class="comment"><a class="avatar"><img src="https://www.gravatar.com/avatar/93ea3d19789047de293970e997237325"></a><div class="content"><a class="author">Jan van Brügge</a><div class="metadata"><a href="#190452994" name="190452994"><div>2020-03-12 22:33:34</div></a></div><div class="text"><p>I am a bit struggeling with the formal definition, ie the extention of System FC</p></div></div></div><div class="comment"><a class="avatar"><img src="https://www.gravatar.com/avatar/93ea3d19789047de293970e997237325"></a><div class="content"><a class="author">Jan van Brügge</a><div class="metadata"><a href="#190453061" name="190453061"><div>2020-03-12 22:34:14</div></a></div><div class="text"><p>now that ghc week was canceled, I will work on it at home</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/20a04d823b7c3891d78ca5f6a188ccd0e4fc5e3d?version=2"></a><div class="content"><a class="author">TheMatten</a><div class="metadata"><a href="#190453403" name="190453403"><div>2020-03-12 22:38:43</div></a></div><div class="text"><p><span class="user-mention" data-user-id="225136">@Asad Saeeduddin</span>  that's <code>defaults</code> above basically - which won't work for normal records without <code>Maybe</code>s all over the place, or some funky anonymous records impl (I've tried implementing those myself - it's not that it's not possible, but it never ends up being friendly)</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/20a04d823b7c3891d78ca5f6a188ccd0e4fc5e3d?version=2"></a><div class="content"><a class="author">TheMatten</a><div class="metadata"><a href="#190453521" name="190453521"><div>2020-03-12 22:40:05</div></a></div><div class="text"><p><span class="user-mention" data-user-id="250737">@Jan van Brügge</span> I guess Purescript's implementation is informal too, right?</p></div></div></div><div class="comment"><a class="avatar"><img src="https://www.gravatar.com/avatar/520889f20a2c66a8f4bd5be6f37d2923"></a><div class="content"><a class="author">Asad Saeeduddin</a><div class="metadata"><a href="#190453705" name="190453705"><div>2020-03-12 22:42:36</div></a></div><div class="text"><p>Could you elaborate on why it wouldn't work with normal records?</p></div></div></div><div class="comment"><a class="avatar"><img src="https://www.gravatar.com/avatar/3d24a4100b3eab34d8ce3059d789c543"></a><div class="content"><a class="author">Sandy Maguire</a><div class="metadata"><a href="#190457419" name="190457419"><div>2020-03-12 23:39:53</div></a></div><div class="text"><p>it works with normal records</p>
<div class="codehilite"><pre><span></span>defaults :: Foo
defaults = Foo
   { blah = 5
  , blam = 6
  }

myFunc :: Foo -&gt; whatever

callMyFunc = myFunc defaults { blam = 8 }
</pre></div></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/20a04d823b7c3891d78ca5f6a188ccd0e4fc5e3d?version=2"></a><div class="content"><a class="author">TheMatten</a><div class="metadata"><a href="#190477110" name="190477110"><div>2020-03-13 07:17:47</div></a></div><div class="text"><p>Because not all fields are optional</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/20a04d823b7c3891d78ca5f6a188ccd0e4fc5e3d?version=2"></a><div class="content"><a class="author">TheMatten</a><div class="metadata"><a href="#190484050" name="190484050"><div>2020-03-13 09:19:47</div></a></div><div class="text"><p>I find <code>named</code> to be strictly better solution for my problem, because:</p>
<ul>
<li>result of <code>:t</code> is the same as of Haddock</li>
<li>it describes arguments in signature itself, instead of separate datatype which does not have other use anyway</li>
<li>it avoids <code>Just</code> wrapping on optional arguments</li>
<li>type errors are great - <code>(!)</code> forces type of argument to <code>Named</code> immediately, tells user when name is wrong and given concrete type (which is my case), it infers return type</li>
<li>optional arguments can be easily filled in using <code>defaults</code></li>
<li>I can have overlapping argument names in same module easily - so no need for ugly prefixes</li>
<li>according to author, it has no runtime overhead</li>
<li>higher-level interface could be written in terms of low-level bindings simply by filling in specific arguments - no need for creating new argument records</li>
<li>no duplication of whole argument records between functions with slightly different arguments - named arguments are part of signature</li>
</ul></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/20a04d823b7c3891d78ca5f6a188ccd0e4fc5e3d?version=2"></a><div class="content"><a class="author">TheMatten</a><div class="metadata"><a href="#190607831" name="190607831"><div>2020-03-14 18:24:50</div></a></div><div class="text"><p>Haha, 4th point is actually pretty important - trying to generalize interface to <code>MonadZulip</code>, I've realized that <code>named</code> now can't be sure if <code>m</code> is some transformer or yet another argument and so it won't work....<br>
I guess I still need some sort of structure passed as an argument after all</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/20a04d823b7c3891d78ca5f6a188ccd0e4fc5e3d?version=2"></a><div class="content"><a class="author">TheMatten</a><div class="metadata"><a href="#190647010" name="190647010"><div>2020-03-15 13:23:14</div></a></div><div class="text"><p>Does anyone know of <em>any language</em> that has typed anonymous records with optional values? I'm not able to find anything...</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/20a04d823b7c3891d78ca5f6a188ccd0e4fc5e3d?version=2"></a><div class="content"><a class="author">TheMatten</a><div class="metadata"><a href="#190652414" name="190652414"><div>2020-03-15 15:38:20</div></a></div><div class="text"><p>I completely missed option of using HKD <span aria-label="sweat smile" class="emoji emoji-1f605" role="img" title="sweat smile">:sweat_smile:</span>  : <a href="https://www.reddit.com/r/haskell/comments/fiaddl/record_construction_vs_optional_named_parameters/fkitghn?utm_source=share&amp;utm_medium=web2x" target="_blank" title="https://www.reddit.com/r/haskell/comments/fiaddl/record_construction_vs_optional_named_parameters/fkitghn?utm_source=share&amp;utm_medium=web2x">https://www.reddit.com/r/haskell/comments/fiaddl/record_construction_vs_optional_named_parameters/fkitghn?utm_source=share&amp;utm_medium=web2x</a><br>
I guess this sorta solves my problem - I can use generics to transform record into query as previously, plus derive value filled with bottoms that I immediately replace with specific defaults before exposing <br>
<span class="user-mention" data-user-id="251120">@Sandy Maguire</span> I guess <em>Boring Haskeller</em> in you should be satisfied enough <span aria-label="wink" class="emoji emoji-1f609" role="img" title="wink">:wink:</span></p>
<div class="message_embed"><a class="message_embed_image" href="https://www.reddit.com/r/haskell/comments/fiaddl/record_construction_vs_optional_named_parameters/fkitghn?utm_source=share&amp;utm_medium=web2x" style="background-image: url(https://external-preview.redd.it/7bu0V3spgIZOe4f7nDiGQYXuCemIm7s_O66TwJEhL-4.jpg?auto=webp&amp;s=83822a3de17e60cda700f43ca94f2a3c0873f372)" target="_blank"></a><div class="data-container"><div class="message_embed_title"><a href="https://www.reddit.com/r/haskell/comments/fiaddl/record_construction_vs_optional_named_parameters/fkitghn?utm_source=share&amp;utm_medium=web2x" target="_blank" title="r/haskell - Record construction vs optional named parameters">r/haskell - Record construction vs optional named parameters</a></div><div class="message_embed_description">5 votes and 2 comments so far on Reddit</div></div></div></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/20a04d823b7c3891d78ca5f6a188ccd0e4fc5e3d?version=2"></a><div class="content"><a class="author">TheMatten</a><div class="metadata"><a href="#190666804" name="190666804"><div>2020-03-15 21:02:49</div></a></div><div class="text"><p>Alright, so now:</p>
<div class="codehilite"><pre><span></span><span class="nf">getMessages</span> <span class="n">with</span><span class="p">{</span>
    <span class="n">gmAnchor</span>    <span class="ow">=</span> <span class="kt">FirstUnread</span>
  <span class="p">,</span> <span class="n">gmNumBefore</span> <span class="ow">=</span> <span class="mi">10</span>
  <span class="p">,</span> <span class="n">gmNumAfter</span>  <span class="ow">=</span> <span class="mi">10</span>
  <span class="p">}</span>
</pre></div></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/20a04d823b7c3891d78ca5f6a188ccd0e4fc5e3d?version=2"></a><div class="content"><a class="author">TheMatten</a><div class="metadata"><a href="#190666879" name="190666879"><div>2020-03-15 21:03:51</div></a></div><div class="text"><p>And what's cool, omitting required field results in:</p>
<div class="codehilite"><pre><span></span>    • Couldn&#39;t match type ‘&#39;MissingRequired’ with ‘&#39;Complete’
      Expected type: GetMessages &#39;Complete
        Actual type: GetMessages &#39;MissingRequired
</pre></div></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/20a04d823b7c3891d78ca5f6a188ccd0e4fc5e3d?version=2"></a><div class="content"><a class="author">TheMatten</a><div class="metadata"><a href="#190761814" name="190761814"><div>2020-03-16 18:22:16</div></a></div><div class="text"><p>Is there some reason for <code>aeson</code>'s <code>Parser</code> to fail with <code>mempty</code>, instead of lifting <code>mzero</code> of inner <code>Monoid</code> as other <code>Monad</code>s do?</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/20a04d823b7c3891d78ca5f6a188ccd0e4fc5e3d?version=2"></a><div class="content"><a class="author">TheMatten</a><div class="metadata"><a href="#190880162" name="190880162"><div>2020-03-17 17:05:28</div></a></div><div class="text"><p>There're few places where endpoint takes many arguments, all of which are optional (like changing settings) - should I go with <code>Maybe Field</code> and accept <code>Just</code> everywhere or something like list/map of ADT of unary constructors?</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/4429aa8b689608f24a4ad712843ce29862e330d2?version=3"></a><div class="content"><a class="author">Sridhar Ratnakumar</a><div class="metadata"><a href="#190893987" name="190893987"><div>2020-03-17 18:46:48</div></a></div><div class="text"><p>dependent-map?</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/4429aa8b689608f24a4ad712843ce29862e330d2?version=3"></a><div class="content"><a class="author">Sridhar Ratnakumar</a><div class="metadata"><a href="#190894072" name="190894072"><div>2020-03-17 18:47:35</div></a></div><div class="text"><p><code>DMap.fromList [Foo :=&gt; Identity "stuff", ...]</code> where </p>
<div class="codehilite"><pre><span></span>data Args a where
  Foo :: Args Text
</pre></div>


<p>But then now <em>all</em> arguments become optional.</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/20a04d823b7c3891d78ca5f6a188ccd0e4fc5e3d?version=2"></a><div class="content"><a class="author">TheMatten</a><div class="metadata"><a href="#190894079" name="190894079"><div>2020-03-17 18:47:38</div></a></div><div class="text"><p>I guess that's equivalent to the latter in my case</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/20a04d823b7c3891d78ca5f6a188ccd0e4fc5e3d?version=2"></a><div class="content"><a class="author">TheMatten</a><div class="metadata"><a href="#190894262" name="190894262"><div>2020-03-17 18:49:06</div></a></div><div class="text"><p>And wrapping with <code>Identity</code> it doesn't really bring benefits over <code>Just "stuff"</code> - I'm interested in reducing verbosity</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/4429aa8b689608f24a4ad712843ce29862e330d2?version=3"></a><div class="content"><a class="author">Sridhar Ratnakumar</a><div class="metadata"><a href="#190894271" name="190894271"><div>2020-03-17 18:49:10</div></a></div><div class="text"><p>Why not the lens approach reflex has taken? <code>callApi $ def &amp; gmLimit ?~ 10 &amp; gmFrom .~ 120201</code></p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/20a04d823b7c3891d78ca5f6a188ccd0e4fc5e3d?version=2"></a><div class="content"><a class="author">TheMatten</a><div class="metadata"><a href="#190894860" name="190894860"><div>2020-03-17 18:53:49</div></a></div><div class="text"><p>And then I have to decide between <code>lens</code> and <code>optics</code> - and some people may not be interested in using optics in their project at all... <span aria-label="slight smile" class="emoji emoji-1f642" role="img" title="slight smile">:slight_smile:</span> <br>
(Though I wouldn't mind supporting even both options as separate packages if someone finds them useful)</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/20a04d823b7c3891d78ca5f6a188ccd0e4fc5e3d?version=2"></a><div class="content"><a class="author">TheMatten</a><div class="metadata"><a href="#191290898" name="191290898"><div>2020-03-20 19:25:53</div></a></div><div class="text"><p>Wow - this <code>zulip-api</code> journey makes me think that structural typing is actually pretty useful feature to have - I guess Unison got it right in this area</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/4429aa8b689608f24a4ad712843ce29862e330d2?version=3"></a><div class="content"><a class="author">Sridhar Ratnakumar</a><div class="metadata"><a href="#191293370" name="191293370"><div>2020-03-20 19:47:16</div></a></div><div class="text"><p>Structural typing?</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/20a04d823b7c3891d78ca5f6a188ccd0e4fc5e3d?version=2"></a><div class="content"><a class="author">TheMatten</a><div class="metadata"><a href="#191293800" name="191293800"><div>2020-03-20 19:50:51</div></a></div><div class="text"><p><span class="user-mention" data-user-id="251311">@Sridhar Ratnakumar</span>  see <a href="https://en.wikipedia.org/wiki/Structural_type_system" target="_blank" title="https://en.wikipedia.org/wiki/Structural_type_system">https://en.wikipedia.org/wiki/Structural_type_system</a> and <a href="https://www.unisonweb.org/docs/language-reference#unique-types" target="_blank" title="https://www.unisonweb.org/docs/language-reference#unique-types">https://www.unisonweb.org/docs/language-reference#unique-types</a></p>
<p>Basically, two types are structurally equal if they have the same representation - as with <code>Coercible</code> types in Haskell, though e.g. Unison allows you to use (non-unique) structurally equal types interchangeably, without need for coercions</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/20a04d823b7c3891d78ca5f6a188ccd0e4fc5e3d?version=2"></a><div class="content"><a class="author">TheMatten</a><div class="metadata"><a href="#191294265" name="191294265"><div>2020-03-20 19:54:11</div></a></div><div class="text"><p>I'm not saying that I don't want nominal types - I want both</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/20a04d823b7c3891d78ca5f6a188ccd0e4fc5e3d?version=2"></a><div class="content"><a class="author">TheMatten</a><div class="metadata"><a href="#191295136" name="191295136"><div>2020-03-20 20:01:49</div></a></div><div class="text"><p>Oh, and namespaced constructors/fields <span aria-label="stuck out tongue wink" class="emoji emoji-1f61c" role="img" title="stuck out tongue wink">:stuck_out_tongue_wink:</span></p></div></div></div><div class="comment"><a class="avatar"><img src="https://www.gravatar.com/avatar/1114fd8de67671f83d3a3ef7594b1950"></a><div class="content"><a class="author">Georgi Lyubenov // googleson78</a><div class="metadata"><a href="#192432653" name="192432653"><div>2020-03-31 18:46:07</div></a></div><div class="text"><p>structural types for derivingvia would be a dream come true..</p></div></div></div></div></div><div class="ui vertical footer segment"><a href="https://github.com/srid/zulip-archive">Powered by Haskell</a> | Questions? Contact <a href="https://www.srid.ca">srid</a></div></div></body></html>