<html lang="en"><head><meta content="text/html; charset=utf-8" http-equiv="Content-Type"><meta content="width=device-width, initial-scale=1" name="viewport"><meta content="I&#39;m working on the notion of (for lack of better term) &quot;typed forests&quot; - which is a forest type (a tree with several roots) in which each node &quot;determines&quot; its children types (so, dependent types?). I use GADTs to represent the node types. Each GADT constructor represents the possible choice for a n" name="description"><link href="https://funprog.srid.ca/haskell/typed-forest.html" rel="canonical"><meta property="og:title" content="Typed forest - Haskell"><meta property="og:site_name" content="Functional Programming Zulip Archive"><meta property="og:type" content="article"><meta property="og:article:section" content="Haskell"><meta property="og:article:modified_time" content="2020-02-23T18:26:03Z"><meta property="og:article:published_time" content="2020-02-22T17:33:13Z"><meta property="og:image" content="https://zulip-avatars.s3.amazonaws.com/13896/4429aa8b689608f24a4ad712843ce29862e330d2?version=3"><title>Typed forest - Haskell</title><style type="text/css">
div#thesite
{
  font-family   : "Open Sans", sans-serif;
  font-size     : 1em !important;
  margin-top    : 1em;
  margin-bottom : 1em;
}

div#thesite h1
{
  font-family : "Roboto", sans-serif;
  line-height : 1.19999em;
}

div#thesite h2
{
  font-family : "Roboto", sans-serif;
  line-height : 1.19999em;
}

div#thesite h3
{
  font-family : "Roboto", sans-serif;
  line-height : 1.19999em;
}

div#thesite h4
{
  font-family : "Roboto", sans-serif;
  line-height : 1.19999em;
}

div#thesite h5
{
  font-family : "Roboto", sans-serif;
  line-height : 1.19999em;
}

div#thesite h6
{
  font-family : "Roboto", sans-serif;
  line-height : 1.19999em;
}

div#thesite .ui.breadcrumb.rib .section
{
  font-family : "Roboto", sans-serif;
  line-height : 1.19999em;
}

div#thesite .header
{
  font-family : "Roboto", sans-serif;
  line-height : 1.19999em;
}

div#thesite .as-header
{
  font-family : "Roboto", sans-serif;
  line-height : 1.19999em;
}

div#thesite code, pre, tt
{
  font-family : "SFMono-Regular","Menlo","Monaco","Consolas","Liberation Mono","Courier New", monospace;
}

div#thesite .ui.breadcrumb.rib
{
  margin-bottom : 1em;
}



div#thesite .ui.comments.messages .comment .metadata a
{
  color : #808080;
}

div#thesite .ui.comments.messages .comment a.avatar img
{
  height : auto;
}

div#thesite .subtle
{
  color : #808080;
}


div#thesite .messages pre
{
  font-size : 85%;
  overflow  : auto;
  max-width : 100%;
}

div#thesite .messages .message_embed
{
  border-left  : solid 3px #808080;
  padding-left : 0.69999em;
}

div#thesite .messages .message_inline_image img
{
  max-width     : 100%;
  margin-bottom : 1em;
}


/* Generated with Clay, http://fvisser.nl/clay */</style><link href="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.4.1/semantic.min.css" rel="stylesheet"><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.min.css" rel="stylesheet"><link href="https://fonts.googleapis.com/css?family=Open+Sans|Oswald&amp;display=swap" rel="stylesheet"><link href="https://fonts.googleapis.com/css?family=Roboto|Open+Sans&amp;display=swap" rel="stylesheet"></head><body><div id="thesite" class="ui text container"><div class="ui violet inverted top attached center aligned segment"><h1 class="ui huge header">Typed forest - Haskell</h1></div><div class="ui attached segment"><div class="ui message"><p>Welcome to the Functional Programming Zulip Chat Archive. You can join the chat <a href="https://funprog.zulipchat.com">here</a>.</p></div><div class="ui breadcrumb rib"><a href="/" class="section">Home</a><i class="right angle icon divider"></i><a href="/haskell/" class="section">#Haskell</a><i class="right angle icon divider"></i><div class="active section">Typed forest</div></div><div class="ui comments messages"><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/4429aa8b689608f24a4ad712843ce29862e330d2?version=3"></a><div class="content"><a class="author">Sridhar Ratnakumar</a><div class="metadata"><a href="#188825940" name="188825940"><div>2020-02-22 17:33:13</div></a></div><div class="text"><p>I'm working on the notion of (for lack of better term) "typed forests" - which is a forest type (a tree with several roots) in which each node "determines" its children types (so, dependent types?). I use GADTs to represent the node types. Each GADT constructor represents the possible choice for a node in that location, with the GADT type <code>a</code> of that constructor being the children type allowed.</p>
<p>I posted an example in Slack, to represent food groups (each function below represents a single "path" in the food forest):</p>
<div class="codehilite"><pre><span></span><span class="nf">costcoRibEye</span> <span class="ow">::</span> <span class="kt">X</span> <span class="kt">Food</span>
<span class="nf">costcoRibEye</span> <span class="ow">=</span> <span class="kt">Meat</span> <span class="kt">:/</span> <span class="kt">Beef</span> <span class="kt">:/</span> <span class="kt">RibEye</span> <span class="kt">:/</span> <span class="kt">Costco</span>

<span class="nf">cheddar</span> <span class="ow">::</span> <span class="kt">X</span> <span class="kt">Food</span>
<span class="nf">cheddar</span> <span class="ow">=</span> <span class="kt">Dairy</span> <span class="kt">:/</span> <span class="kt">Cheese</span> <span class="kt">:/</span> <span class="kt">AncetreCheddar</span>
</pre></div>


<p>I am writing a blog post of sorts, to explain the concept. I'm likely to be missing the type system lingo to understand this concept better, but hopefully others would point me in the right direction.</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/4429aa8b689608f24a4ad712843ce29862e330d2?version=3"></a><div class="content"><a class="author">Sridhar Ratnakumar</a><div class="metadata"><a href="#188826005" name="188826005"><div>2020-02-22 17:35:06</div></a></div><div class="text"><p>( Inspiration for it came from obelisk-route library: <a href="https://github.com/obsidiansystems/obelisk/blob/master/lib/route/src/Obelisk/Route.hs" target="_blank" title="https://github.com/obsidiansystems/obelisk/blob/master/lib/route/src/Obelisk/Route.hs">https://github.com/obsidiansystems/obelisk/blob/master/lib/route/src/Obelisk/Route.hs</a> )</p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/obsidiansystems/obelisk/blob/master/lib/route/src/Obelisk/Route.hs" style="background-image: url(https://avatars2.githubusercontent.com/u/11916262?s=400&amp;v=4)" target="_blank"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/obsidiansystems/obelisk/blob/master/lib/route/src/Obelisk/Route.hs" target="_blank" title="obsidiansystems/obelisk">obsidiansystems/obelisk</a></div><div class="message_embed_description">Obelisk provides an easy way to develop and deploy your Reflex project for web and mobile - obsidiansystems/obelisk</div></div></div></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/89529ef093c72e16a5ce3ac00d88f354ccc08cf9?version=2"></a><div class="content"><a class="author">Lysxia</a><div class="metadata"><a href="#188827362" name="188827362"><div>2020-02-22 18:11:07</div></a></div><div class="text"><p>Is this similar to <code>Fix</code>/recursion-schemes?</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/20a04d823b7c3891d78ca5f6a188ccd0e4fc5e3d?version=2"></a><div class="content"><a class="author">TheMatten</a><div class="metadata"><a href="#188827481" name="188827481"><div>2020-02-22 18:14:23</div></a></div><div class="text"><p>It seems like sort of nested sigma type?</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/4429aa8b689608f24a4ad712843ce29862e330d2?version=3"></a><div class="content"><a class="author">Sridhar Ratnakumar</a><div class="metadata"><a href="#188827572" name="188827572"><div>2020-02-22 18:17:43</div></a></div><div class="text"><p>The ultimate goal is to represent food hierarchy. "Ribeye" can only be a food item under the "Beef" group, which itself can only be positioned under "Meat". Every path (leading all the way to the leaf node) is considered an "item" to track in a journal. <code>X Food</code> = <code>DSum Food Identity</code>. And Food is defined like this:</p>
<div class="codehilite"><pre><span></span><span class="kr">data</span> <span class="kt">Food</span> <span class="n">a</span> <span class="kr">where</span>
  <span class="kt">Meat</span> <span class="ow">::</span> <span class="kt">Food</span> <span class="p">(</span><span class="kt">X</span> <span class="kt">Meat</span><span class="p">)</span>
  <span class="o">...</span>
<span class="kr">data</span> <span class="kt">Meat</span> <span class="n">a</span> <span class="kr">where</span>
  <span class="kt">Beef</span> <span class="ow">::</span> <span class="kt">Meat</span> <span class="p">(</span><span class="kt">X</span> <span class="kt">Beef</span><span class="p">)</span>
  <span class="o">..</span>
<span class="kr">data</span> <span class="kt">Beef</span> <span class="n">a</span> <span class="kr">where</span>
  <span class="kt">RibEye</span> <span class="ow">::</span> <span class="kt">Beef</span> <span class="kt">Producer</span>
  <span class="o">..</span>
<span class="kr">data</span> <span class="kt">Producer</span> <span class="ow">=</span> <span class="kt">Costco</span> <span class="o">|</span> <span class="o">...</span>
</pre></div></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/4429aa8b689608f24a4ad712843ce29862e330d2?version=3"></a><div class="content"><a class="author">Sridhar Ratnakumar</a><div class="metadata"><a href="#188827679" name="188827679"><div>2020-02-22 18:20:23</div></a></div><div class="text"><p>The leaf node is either <code>()</code> or some non-<code>X</code> type.</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/89529ef093c72e16a5ce3ac00d88f354ccc08cf9?version=2"></a><div class="content"><a class="author">Lysxia</a><div class="metadata"><a href="#188828094" name="188828094"><div>2020-02-22 18:33:29</div></a></div><div class="text"><p>I'm looking forward to reading your blogpost!</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/4429aa8b689608f24a4ad712843ce29862e330d2?version=3"></a><div class="content"><a class="author">Sridhar Ratnakumar</a><div class="metadata"><a href="#188829756" name="188829756"><div>2020-02-22 19:22:33</div></a></div><div class="text"><p>As a bonus, creating a polysemy DSL for (monadically) building the forest is in my mind as well (I already use polysemy, but just not in an abstract fashion)</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/4429aa8b689608f24a4ad712843ce29862e330d2?version=3"></a><div class="content"><a class="author">Sridhar Ratnakumar</a><div class="metadata"><a href="#188829773" name="188829773"><div>2020-02-22 19:23:55</div></a></div><div class="text"><p>I think it would be nice to auto-generate polysemy effect for a given GADT. Maybe polysemy is an overkill; I only want to monadically build the tree. Funny how this problem domain is now coming to resemble HTML building using do syntax (which <span class="user-mention" data-user-id="225127">@TheMatten</span> is doing in another topic).</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/4429aa8b689608f24a4ad712843ce29862e330d2?version=3"></a><div class="content"><a class="author">Sridhar Ratnakumar</a><div class="metadata"><a href="#188838746" name="188838746"><div>2020-02-23 00:02:01</div></a></div><div class="text"><p>Yup, a small amount of polysemy code comes in handy to define monads for building this tree/forest:</p>
<div class="codehilite"><pre><span></span>demo :: [X Mood]
demo = xlist do
  addX $ Mood_Good :/ xlist do
    addX $ Theme&#39; :/ Theme_Learning
    addX $ Explore&#39; (Markdown &quot;This is too difficult&quot;) :/ mempty
    addX $ Belief&#39; (Markdown &quot;I can&#39;t solve this&quot;) :/ xlist do
      addX $ Fact&#39; (Markdown &quot;I will never know until I try&quot;) :/ mempty
</pre></div></div></div></div><div class="comment"><a class="avatar"><img src="https://www.gravatar.com/avatar/45175015b9eb3dd3f6c740b3fe920fed"></a><div class="content"><a class="author">Joel McCracken</a><div class="metadata"><a href="#188874032" name="188874032"><div>2020-02-23 16:05:49</div></a></div><div class="text"><p>Curious, are you using a tree when a graph is more suited? It seems like a "costco" might be used for more than ribeye</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/4429aa8b689608f24a4ad712843ce29862e330d2?version=3"></a><div class="content"><a class="author">Sridhar Ratnakumar</a><div class="metadata"><a href="#188878013" name="188878013"><div>2020-02-23 18:08:01</div></a></div><div class="text"><p>You are right. It is actually a graph (DAG) in practice.</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/4429aa8b689608f24a4ad712843ce29862e330d2?version=3"></a><div class="content"><a class="author">Sridhar Ratnakumar</a><div class="metadata"><a href="#188878062" name="188878062"><div>2020-02-23 18:09:03</div></a></div><div class="text"><p>And I've got a nice polysemy DSL to monadically build it.</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/4429aa8b689608f24a4ad712843ce29862e330d2?version=3"></a><div class="content"><a class="author">Sridhar Ratnakumar</a><div class="metadata"><a href="#188878066" name="188878066"><div>2020-02-23 18:09:24</div></a></div><div class="text"><p>Also, the whole thing is converging on looking to be XML like - _but_ fully type-safe.</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/4429aa8b689608f24a4ad712843ce29862e330d2?version=3"></a><div class="content"><a class="author">Sridhar Ratnakumar</a><div class="metadata"><a href="#188878073" name="188878073"><div>2020-02-23 18:09:55</div></a></div><div class="text"><p>eg: in XML node, we say "this node type can only contain this particular node types as children".</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/4429aa8b689608f24a4ad712843ce29862e330d2?version=3"></a><div class="content"><a class="author">Sridhar Ratnakumar</a><div class="metadata"><a href="#188878128" name="188878128"><div>2020-02-23 18:10:53</div></a></div><div class="text"><p>and the children can be either sum type (1 child), list (variable number children) or dependent map ( 0 to n children, corresponding to one or many of the n constructors in a sum type (GADT))</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/4429aa8b689608f24a4ad712843ce29862e330d2?version=3"></a><div class="content"><a class="author">Sridhar Ratnakumar</a><div class="metadata"><a href="#188878386" name="188878386"><div>2020-02-23 18:19:02</div></a></div><div class="text"><p>Well, actually, it is a graph (with or without cycles) only in type-level, but a tree at value-level. You can't have two arrows coming to one value.</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/4429aa8b689608f24a4ad712843ce29862e330d2?version=3"></a><div class="content"><a class="author">Sridhar Ratnakumar</a><div class="metadata"><a href="#188878467" name="188878467"><div>2020-02-23 18:21:44</div></a></div><div class="text"><p>Scratch all that ... it is best to think of this as a <em>tree</em>. A typed tree.</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/4429aa8b689608f24a4ad712843ce29862e330d2?version=3"></a><div class="content"><a class="author">Sridhar Ratnakumar</a><div class="metadata"><a href="#188878511" name="188878511"><div>2020-02-23 18:22:14</div></a></div><div class="text"><p>As for your example, the <code>Costco</code> value is simply replicated at the various nodes where it is used.</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/4429aa8b689608f24a4ad712843ce29862e330d2?version=3"></a><div class="content"><a class="author">Sridhar Ratnakumar</a><div class="metadata"><a href="#188878571" name="188878571"><div>2020-02-23 18:24:10</div></a></div><div class="text"><p>The <code>Food</code> tree type above, can be used in larger trees, for example: </p>
<div class="codehilite"><pre><span></span><span class="kr">data</span> <span class="kt">Health</span> <span class="n">a</span> <span class="kr">where</span>
  <span class="kt">SkinCondition</span> <span class="ow">::</span> <span class="kt">Health</span> <span class="kt">Skin</span>
  <span class="kt">Note</span> <span class="ow">::</span> <span class="kt">Health</span> <span class="p">(</span><span class="kt">XList</span> <span class="kt">Note</span><span class="p">)</span>
  <span class="kt">Meals</span> <span class="ow">::</span> <span class="kt">Health</span> <span class="kt">Natural</span>
  <span class="kt">Consumed</span> <span class="ow">::</span> <span class="kt">Health</span> <span class="p">(</span><span class="kt">XList</span> <span class="kt">Food</span><span class="p">)</span>  <span class="c1">-- Food tree (forest actually, because XList f = [X f])</span>

<span class="kr">data</span> <span class="kt">Note</span> <span class="n">a</span> <span class="kr">where</span>
  <span class="kt">Note_Normal</span> <span class="ow">::</span> <span class="kt">Note</span> <span class="kt">Text</span>
  <span class="kt">Note_Highlight</span> <span class="ow">::</span> <span class="kt">Note</span> <span class="kt">Text</span>
</pre></div></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/4429aa8b689608f24a4ad712843ce29862e330d2?version=3"></a><div class="content"><a class="author">Sridhar Ratnakumar</a><div class="metadata"><a href="#188878590" name="188878590"><div>2020-02-23 18:25:34</div></a></div><div class="text"><p>And that tree can further be positioned in an even higher tree:</p>
<div class="codehilite"><pre><span></span><span class="kr">data</span> <span class="kt">Tracking</span> <span class="ow">::</span> <span class="kt">Type</span> <span class="ow">-&gt;</span> <span class="kt">Type</span> <span class="kr">where</span>
  <span class="kt">Tracking_Health</span> <span class="ow">::</span> <span class="kt">Tracking</span> <span class="p">(</span><span class="kt">XMap</span> <span class="kt">Health</span><span class="o">.</span><span class="kt">Health</span><span class="p">)</span>
  <span class="kt">Tracking_Feeling</span> <span class="ow">::</span> <span class="kt">Tracking</span> <span class="p">(</span><span class="kt">XList</span> <span class="kt">Feeling</span><span class="o">.</span><span class="kt">Mood</span><span class="p">)</span>
  <span class="kt">Tracking_Calisthenics</span> <span class="ow">::</span> <span class="kt">Tracking</span> <span class="p">(</span><span class="kt">XMap</span> <span class="kt">Calisthenics</span><span class="o">.</span><span class="kt">Move</span><span class="p">)</span>
</pre></div>


<p>Here, we introduce <code>XMap f</code> which is <code>DMap f Identity</code>. The 'dependent map of children' above.</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/4429aa8b689608f24a4ad712843ce29862e330d2?version=3"></a><div class="content"><a class="author">Sridhar Ratnakumar</a><div class="metadata"><a href="#188878623" name="188878623"><div>2020-02-23 18:26:03</div></a></div><div class="text"><p>Even higher, the whole "Tracking" thing is positioned in a "calendar tree" (a tree of years, then months, then days)</p></div></div></div></div></div><div class="ui vertical footer segment"><a href="https://github.com/srid/zulip-archive">Powered by Haskell</a> | Questions? Contact <a href="https://www.srid.ca">srid</a></div></div></body></html>