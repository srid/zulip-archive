<html lang="en"><head><meta content="text/html; charset=utf-8" http-equiv="Content-Type"><meta content="width=device-width, initial-scale=1" name="viewport"><meta content="can anyone explain why this parses:
a :: IO Int
a = do a &lt;- pure 5
       pure a
 &gt;&gt;= pure
       pure 5

is there a rule about operators that overrides normal layouting rules? it appears that the indent of that line must be larger than the parent layout (like in case of a nested do, it&#39;s the outer " name="description"><link href="https://funprog.srid.ca/haskell/hanging-indent-with-symbolic-operators.html" rel="canonical"><meta property="og:title" content="hanging indent with symbolic operators - Haskell"><meta property="og:site_name" content="Functional Programming Zulip Archive"><meta property="og:type" content="article"><meta property="og:article:section" content="Haskell"><meta property="og:article:modified_time" content="2021-03-04T12:44:43Z"><meta property="og:article:published_time" content="2021-03-04T11:09:33Z"><meta property="og:image" content="https://zulip-avatars.s3.amazonaws.com/13896/7334dc60b6aef6a75cd9284126231f13c76926a5?version=6"><title>hanging indent with symbolic operators - Haskell</title><style type="text/css">
div#thesite
{
  font-family   : "Open Sans", sans-serif;
  font-size     : 1em !important;
  margin-top    : 1em;
  margin-bottom : 1em;
}

div#thesite h1
{
  font-family : "Roboto", sans-serif;
  line-height : 1.19999em;
}

div#thesite h2
{
  font-family : "Roboto", sans-serif;
  line-height : 1.19999em;
}

div#thesite h3
{
  font-family : "Roboto", sans-serif;
  line-height : 1.19999em;
}

div#thesite h4
{
  font-family : "Roboto", sans-serif;
  line-height : 1.19999em;
}

div#thesite h5
{
  font-family : "Roboto", sans-serif;
  line-height : 1.19999em;
}

div#thesite h6
{
  font-family : "Roboto", sans-serif;
  line-height : 1.19999em;
}

div#thesite .ui.breadcrumb.rib .section
{
  font-family : "Roboto", sans-serif;
  line-height : 1.19999em;
}

div#thesite .header
{
  font-family : "Roboto", sans-serif;
  line-height : 1.19999em;
}

div#thesite .as-header
{
  font-family : "Roboto", sans-serif;
  line-height : 1.19999em;
}

div#thesite code, pre, tt
{
  font-family : "SFMono-Regular","Menlo","Monaco","Consolas","Liberation Mono","Courier New", monospace;
}

div#thesite .ui.breadcrumb.rib
{
  margin-bottom : 1em;
}



div#thesite .ui.comments.messages .comment .metadata a
{
  color : #808080;
}

div#thesite .ui.comments.messages .comment a.avatar img
{
  height : auto;
}

div#thesite .subtle
{
  color : #808080;
}


div#thesite .messages pre
{
  font-size : 85%;
  overflow  : auto;
  max-width : 100%;
}

div#thesite .messages .message_embed
{
  border-left  : solid 3px #808080;
  padding-left : 0.69999em;
}

div#thesite .messages .message_inline_image img
{
  max-width     : 100%;
  margin-bottom : 1em;
}


/* Generated with Clay, http://fvisser.nl/clay */</style><link href="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.4.1/semantic.min.css" rel="stylesheet"><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.min.css" rel="stylesheet"><link href="https://fonts.googleapis.com/css?family=Open+Sans|Oswald&amp;display=swap" rel="stylesheet"><link href="https://fonts.googleapis.com/css?family=Roboto|Open+Sans&amp;display=swap" rel="stylesheet"></head><body><div id="thesite" class="ui text container"><div class="ui violet inverted top attached center aligned segment"><h1 class="ui huge header">hanging indent with symbolic operators - Haskell</h1></div><div class="ui attached segment"><div class="ui message"><p>Welcome to the Functional Programming Zulip Chat Archive. You can join the chat <a href="https://funprog.zulipchat.com">here</a>.</p></div><div class="ui breadcrumb rib"><a href="/" class="section">Home</a><i class="right angle icon divider"></i><a href="/haskell/" class="section">#Haskell</a><i class="right angle icon divider"></i><div class="active section">hanging indent with symbolic operators</div></div><div class="ui comments messages"><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/7334dc60b6aef6a75cd9284126231f13c76926a5?version=6"></a><div class="content"><a class="author">Torsten Schmits</a><div class="metadata"><a href="#228753104" name="228753104"><div>2021-03-04 11:09:33</div></a></div><div class="text"><p>can anyone explain why this parses:</p>
<div class="codehilite" data-code-language="Haskell"><pre><span></span><code><span class="nf">a</span> <span class="ow">::</span> <span class="kt">IO</span> <span class="kt">Int</span>
<span class="nf">a</span> <span class="ow">=</span> <span class="kr">do</span> <span class="n">a</span> <span class="ow">&lt;-</span> <span class="n">pure</span> <span class="mi">5</span>
       <span class="n">pure</span> <span class="n">a</span>
 <span class="o">&gt;&gt;=</span> <span class="n">pure</span>
       <span class="n">pure</span> <span class="mi">5</span>
</code></pre></div>
<p>is there a rule about operators that overrides normal layouting rules? it appears that the indent of that line must be larger than the parent layout (like in case of a nested do, it's the outer do's layout indent). it also only works for expression statements, not binders.</p>
<p>if someone can point me to documentation, that would be great</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/20a04d823b7c3891d78ca5f6a188ccd0e4fc5e3d?version=2"></a><div class="content"><a class="author">TheMatten</a><div class="metadata"><a href="#228756601" name="228756601"><div>2021-03-04 11:38:22</div></a></div><div class="text"><p><a href="https://www.haskell.org/onlinereport/haskell2010/haskellch10.html#x17-17800010.3">https://www.haskell.org/onlinereport/haskell2010/haskellch10.html#x17-17800010.3</a> provides algorithmic description of layout resolution - if you look at lines mentioning <code>&lt;n&gt;</code> (line fold), in your case they'll add <code>}</code> before the operator, because indent is lower than one set by <code>do</code>, and pop the <code>&lt;n&gt;</code>, because it's bigger than outer context</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/20a04d823b7c3891d78ca5f6a188ccd0e4fc5e3d?version=2"></a><div class="content"><a class="author">TheMatten</a><div class="metadata"><a href="#228756728" name="228756728"><div>2021-03-04 11:39:47</div></a></div><div class="text"><p>Oh, wait, I've now realized you mean line after that <span aria-label="sweat smile" class="emoji emoji-1f605" role="img" title="sweat smile">:sweat_smile:</span></p></div></div></div><div class="comment"><a class="avatar"><img src="https://www.gravatar.com/avatar/1114fd8de67671f83d3a3ef7594b1950"></a><div class="content"><a class="author">Georgi Lyubenov // googleson78</a><div class="metadata"><a href="#228756900" name="228756900"><div>2021-03-04 11:41:05</div></a></div><div class="text"><p>ghc parser confirmed that in fact the whole do is the arg to the bind</p></div></div></div><div class="comment"><a class="avatar"><img src="https://www.gravatar.com/avatar/1114fd8de67671f83d3a3ef7594b1950"></a><div class="content"><a class="author">Georgi Lyubenov // googleson78</a><div class="metadata"><a href="#228756935" name="228756935"><div>2021-03-04 11:41:17</div></a></div><div class="text"><p>I would have guessed this requires BlockArguments tbh</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/20a04d823b7c3891d78ca5f6a188ccd0e4fc5e3d?version=2"></a><div class="content"><a class="author">TheMatten</a><div class="metadata"><a href="#228756976" name="228756976"><div>2021-03-04 11:41:41</div></a></div><div class="text"><p>Okay, but how's</p>
<div class="codehilite"><pre><span></span><code>pure
  pure 5
</code></pre></div>
<p>valid?</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/7334dc60b6aef6a75cd9284126231f13c76926a5?version=6"></a><div class="content"><a class="author">Torsten Schmits</a><div class="metadata"><a href="#228756991" name="228756991"><div>2021-03-04 11:41:48</div></a></div><div class="text"><p><span aria-label="grinning" class="emoji emoji-1f600" role="img" title="grinning">:grinning:</span></p></div></div></div><div class="comment"><a class="avatar"><img src="https://www.gravatar.com/avatar/1114fd8de67671f83d3a3ef7594b1950"></a><div class="content"><a class="author">Georgi Lyubenov // googleson78</a><div class="metadata"><a href="#228756996" name="228756996"><div>2021-03-04 11:41:52</div></a></div><div class="text"><p>hahaha</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/7334dc60b6aef6a75cd9284126231f13c76926a5?version=6"></a><div class="content"><a class="author">Torsten Schmits</a><div class="metadata"><a href="#228757006" name="228757006"><div>2021-03-04 11:41:57</div></a></div><div class="text"><p><code>Applicative (r-&gt;)</code></p></div></div></div><div class="comment"><a class="avatar"><img src="https://www.gravatar.com/avatar/1114fd8de67671f83d3a3ef7594b1950"></a><div class="content"><a class="author">Georgi Lyubenov // googleson78</a><div class="metadata"><a href="#228757004" name="228757004"><div>2021-03-04 11:41:57</div></a></div><div class="text"><p>the first pure is const</p></div></div></div><div class="comment"><a class="avatar"><img src="https://www.gravatar.com/avatar/1114fd8de67671f83d3a3ef7594b1950"></a><div class="content"><a class="author">Georgi Lyubenov // googleson78</a><div class="metadata"><a href="#228757075" name="228757075"><div>2021-03-04 11:42:15</div></a></div><div class="text"><p>it's <code>const pure 5</code></p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/20a04d823b7c3891d78ca5f6a188ccd0e4fc5e3d?version=2"></a><div class="content"><a class="author">TheMatten</a><div class="metadata"><a href="#228757103" name="228757103"><div>2021-03-04 11:42:31</div></a></div><div class="text"><p>Ah, I see now <span aria-label="joy" class="emoji emoji-1f602" role="img" title="joy">:joy:</span></p></div></div></div><div class="comment"><a class="avatar"><img src="https://www.gravatar.com/avatar/1114fd8de67671f83d3a3ef7594b1950"></a><div class="content"><a class="author">Georgi Lyubenov // googleson78</a><div class="metadata"><a href="#228757129" name="228757129"><div>2021-03-04 11:42:47</div></a></div><div class="text"><p>maybe we should assassinate that instance from the ghc codebase</p></div></div></div><div class="comment"><a class="avatar"><img src="https://www.gravatar.com/avatar/1114fd8de67671f83d3a3ef7594b1950"></a><div class="content"><a class="author">Georgi Lyubenov // googleson78</a><div class="metadata"><a href="#228757152" name="228757152"><div>2021-03-04 11:43:07</div></a></div><div class="text"><p>while nobody is watching</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/7334dc60b6aef6a75cd9284126231f13c76926a5?version=6"></a><div class="content"><a class="author">Torsten Schmits</a><div class="metadata"><a href="#228757178" name="228757178"><div>2021-03-04 11:43:14</div></a></div><div class="text"><p>now how to parse this:</p>
<div class="codehilite" data-code-language="Haskell"><pre><span></span><code><span class="nf">a</span> <span class="ow">::</span> <span class="kt">IO</span> <span class="kt">Int</span>
<span class="nf">a</span> <span class="ow">=</span>
  <span class="kr">do</span>
       <span class="n">pure</span> <span class="mi">5</span>
       <span class="o">&gt;&gt;=</span> <span class="n">f</span>
</code></pre></div></div></div></div><div class="comment"><a class="avatar"><img src="https://www.gravatar.com/avatar/1114fd8de67671f83d3a3ef7594b1950"></a><div class="content"><a class="author">Georgi Lyubenov // googleson78</a><div class="metadata"><a href="#228757194" name="228757194"><div>2021-03-04 11:43:22</div></a></div><div class="text"><p>whoever is using it can't be up to any good</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/7334dc60b6aef6a75cd9284126231f13c76926a5?version=6"></a><div class="content"><a class="author">Torsten Schmits</a><div class="metadata"><a href="#228757202" name="228757202"><div>2021-03-04 11:43:32</div></a></div><div class="text"><p>(inspired by a file from HLS breaking my parser)</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/7334dc60b6aef6a75cd9284126231f13c76926a5?version=6"></a><div class="content"><a class="author">Torsten Schmits</a><div class="metadata"><a href="#228757228" name="228757228"><div>2021-03-04 11:43:55</div></a></div><div class="text"><p>apparently it might be <code>(do pure 5) &gt;&gt;= f</code></p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/7334dc60b6aef6a75cd9284126231f13c76926a5?version=6"></a><div class="content"><a class="author">Torsten Schmits</a><div class="metadata"><a href="#228757371" name="228757371"><div>2021-03-04 11:44:41</div></a></div><div class="text"><p><span class="user-mention silent" data-user-id="254032">Georgi Lyubenov // googleson78</span> <a href="#narrow/stream/201385-Haskell/topic/hanging.20indent.20with.20symbolic.20operators/near/228757129">said</a>:</p>
<blockquote>
<p>maybe we should assassinate that instance from the ghc codebase</p>
</blockquote>
<p><em>hacker in hoodie gif</em></p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/7334dc60b6aef6a75cd9284126231f13c76926a5?version=6"></a><div class="content"><a class="author">Torsten Schmits</a><div class="metadata"><a href="#228757517" name="228757517"><div>2021-03-04 11:46:03</div></a></div><div class="text"><p><a href="/user_uploads/13896/bLWCFXuFNBmDCdUYgrR4pd_Z/image.png">image.png</a> </p>
<div class="message_inline_image"><a href="/user_uploads/13896/bLWCFXuFNBmDCdUYgrR4pd_Z/image.png" title="image.png"><img src="/user_uploads/13896/bLWCFXuFNBmDCdUYgrR4pd_Z/image.png"></a></div><p>indeed!</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/20a04d823b7c3891d78ca5f6a188ccd0e4fc5e3d?version=2"></a><div class="content"><a class="author">TheMatten</a><div class="metadata"><a href="#228757709" name="228757709"><div>2021-03-04 11:47:17</div></a></div><div class="text"><p>I would expect GHC to do <code>do (pure 5 &gt;&gt;= f)</code> because of <code>NonDecreasingIndentation</code></p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/7334dc60b6aef6a75cd9284126231f13c76926a5?version=6"></a><div class="content"><a class="author">Torsten Schmits</a><div class="metadata"><a href="#228757754" name="228757754"><div>2021-03-04 11:47:44</div></a></div><div class="text"><p>not in a layout</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/7334dc60b6aef6a75cd9284126231f13c76926a5?version=6"></a><div class="content"><a class="author">Torsten Schmits</a><div class="metadata"><a href="#228757857" name="228757857"><div>2021-03-04 11:48:24</div></a></div><div class="text"><p>if you move the <code>&gt;&gt;=</code> one char to the right, it's like you wrote</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/20a04d823b7c3891d78ca5f6a188ccd0e4fc5e3d?version=2"></a><div class="content"><a class="author">TheMatten</a><div class="metadata"><a href="#228757885" name="228757885"><div>2021-03-04 11:48:47</div></a></div><div class="text"><p>Oh, it's for <code>{n}</code>, not <code>&lt;n&gt;</code>, right</p></div></div></div><div class="comment"><a class="avatar"><img src="https://www.gravatar.com/avatar/1114fd8de67671f83d3a3ef7594b1950"></a><div class="content"><a class="author">Georgi Lyubenov // googleson78</a><div class="metadata"><a href="#228758193" name="228758193"><div>2021-03-04 11:51:30</div></a></div><div class="text"><p><a href="https://giphy.com/gifs/theoffice-the-office-tv-frame-toby-vyTnNTrs3wqQ0UIvwE">https://giphy.com/gifs/theoffice-the-office-tv-frame-toby-vyTnNTrs3wqQ0UIvwE</a></p>
<div class="message_embed"><a class="message_embed_image" href="https://giphy.com/gifs/theoffice-the-office-tv-frame-toby-vyTnNTrs3wqQ0UIvwE" style="background-image: url(https://media3.giphy.com/media/vyTnNTrs3wqQ0UIvwE/giphy.gif)"></a><div class="data-container"><div class="message_embed_title"><a href="https://giphy.com/gifs/theoffice-the-office-tv-frame-toby-vyTnNTrs3wqQ0UIvwE" title="Season 5 No GIF by The Office - Find &amp; Share on GIPHY">Season 5 No GIF by The Office - Find &amp; Share on GIPHY</a></div><div class="message_embed_description">Discover &amp; share this The Office GIF with everyone you know. GIPHY is how you search, share, discover, and create GIFs.</div></div></div></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/20a04d823b7c3891d78ca5f6a188ccd0e4fc5e3d?version=2"></a><div class="content"><a class="author">TheMatten</a><div class="metadata"><a href="#228758407" name="228758407"><div>2021-03-04 11:53:14</div></a></div><div class="text"><p>We need<code>-Wimplicit-layout</code> in GHC, so than we can safely forget about it and write braces everywhere <span aria-label="sweat smile" class="emoji emoji-1f605" role="img" title="sweat smile">:sweat_smile:</span></p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/7334dc60b6aef6a75cd9284126231f13c76926a5?version=6"></a><div class="content"><a class="author">Torsten Schmits</a><div class="metadata"><a href="#228758449" name="228758449"><div>2021-03-04 11:53:46</div></a></div><div class="text"><p>doesn't help if you want to parse other people's code!</p></div></div></div><div class="comment"><a class="avatar"><img src="https://www.gravatar.com/avatar/1114fd8de67671f83d3a3ef7594b1950"></a><div class="content"><a class="author">Georgi Lyubenov // googleson78</a><div class="metadata"><a href="#228758763" name="228758763"><div>2021-03-04 11:55:54</div></a></div><div class="text"><p>or be more strict about what is allowed <span aria-label="sweat" class="emoji emoji-1f613" role="img" title="sweat">:sweat:</span></p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/7334dc60b6aef6a75cd9284126231f13c76926a5?version=6"></a><div class="content"><a class="author">Torsten Schmits</a><div class="metadata"><a href="#228758825" name="228758825"><div>2021-03-04 11:56:08</div></a></div><div class="text"><p>that will never happen <span aria-label="cry" class="emoji emoji-1f622" role="img" title="cry">:cry:</span></p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/7334dc60b6aef6a75cd9284126231f13c76926a5?version=6"></a><div class="content"><a class="author">Torsten Schmits</a><div class="metadata"><a href="#228758873" name="228758873"><div>2021-03-04 11:56:31</div></a></div><div class="text"><p>two spaces indent enforced everywhere. newline after layout open</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/20a04d823b7c3891d78ca5f6a188ccd0e4fc5e3d?version=2"></a><div class="content"><a class="author">TheMatten</a><div class="metadata"><a href="#228759075" name="228759075"><div>2021-03-04 11:58:04</div></a></div><div class="text"><p>Thing is though, we often write stuff that seems completely reasonable to humans but requires this flexibility, like </p>
<div class="codehilite"><pre><span></span><code>if _ then do
  _
else do
  _
</code></pre></div></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/7334dc60b6aef6a75cd9284126231f13c76926a5?version=6"></a><div class="content"><a class="author">Torsten Schmits</a><div class="metadata"><a href="#228759202" name="228759202"><div>2021-03-04 11:59:13</div></a></div><div class="text"><p>looks like it matches my rules</p></div></div></div><div class="comment"><a class="avatar"><img src="https://www.gravatar.com/avatar/1114fd8de67671f83d3a3ef7594b1950"></a><div class="content"><a class="author">Georgi Lyubenov // googleson78</a><div class="metadata"><a href="#228759368" name="228759368"><div>2021-03-04 12:00:07</div></a></div><div class="text"><p><code>then</code> opens a layout, but no newline after it?</p></div></div></div><div class="comment"><a class="avatar"><img src="https://www.gravatar.com/avatar/1114fd8de67671f83d3a3ef7594b1950"></a><div class="content"><a class="author">Georgi Lyubenov // googleson78</a><div class="metadata"><a href="#228759386" name="228759386"><div>2021-03-04 12:00:11</div></a></div><div class="text"><p>right?</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/7334dc60b6aef6a75cd9284126231f13c76926a5?version=6"></a><div class="content"><a class="author">Torsten Schmits</a><div class="metadata"><a href="#228759413" name="228759413"><div>2021-03-04 12:00:22</div></a></div><div class="text"><p><code>then</code> don't open no layout</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/20a04d823b7c3891d78ca5f6a188ccd0e4fc5e3d?version=2"></a><div class="content"><a class="author">TheMatten</a><div class="metadata"><a href="#228759434" name="228759434"><div>2021-03-04 12:00:31</div></a></div><div class="text"><p>only <code>do</code> does for expressions</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/7334dc60b6aef6a75cd9284126231f13c76926a5?version=6"></a><div class="content"><a class="author">Torsten Schmits</a><div class="metadata"><a href="#228759442" name="228759442"><div>2021-03-04 12:00:37</div></a></div><div class="text"><p>only <code>let</code>, <code>of</code>, <code>where</code>, <code>do</code></p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/20a04d823b7c3891d78ca5f6a188ccd0e4fc5e3d?version=2"></a><div class="content"><a class="author">TheMatten</a><div class="metadata"><a href="#228759549" name="228759549"><div>2021-03-04 12:01:13</div></a></div><div class="text"><p><span class="user-mention" data-user-id="254032">@Georgi Lyubenov // googleson78</span> what you see with newlines after tokens like <code>=</code> is indentation rule for surrounding layout</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/20a04d823b7c3891d78ca5f6a188ccd0e4fc5e3d?version=2"></a><div class="content"><a class="author">TheMatten</a><div class="metadata"><a href="#228759903" name="228759903"><div>2021-03-04 12:03:39</div></a></div><div class="text"><div class="codehilite"><pre><span></span><code>L (&lt; n &gt;: ts) (m : ms) = ; : (L ts (m : ms)) if m = n
                       = } : (L (&lt; n &gt;: ts) ms) if n &lt; m
L (&lt; n &gt;: ts) ms = L ts ms -- this line
</code></pre></div></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/7334dc60b6aef6a75cd9284126231f13c76926a5?version=6"></a><div class="content"><a class="author">Torsten Schmits</a><div class="metadata"><a href="#228760095" name="228760095"><div>2021-03-04 12:04:51</div></a></div><div class="text"><blockquote>
<p><div class="codehilite" data-code-language="Haskell"><pre><span></span><code><span class="nf">a</span> <span class="ow">::</span> <span class="kt">IO</span> <span class="kt">Int</span>
<span class="nf">a</span> <span class="ow">=</span>
  <span class="kr">do</span>
       <span class="n">pure</span> <span class="mi">5</span>
       <span class="o">&gt;&gt;=</span> <span class="n">f</span>
</code></pre></div><br>
</p>
</blockquote>
<p>my question now is: what is the condition in the layout algorithm that detects that <code>&gt;&gt;=</code> closes the <code>do</code> instead of only starting a new statement? is it because the op is symbolic?</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/7334dc60b6aef6a75cd9284126231f13c76926a5?version=6"></a><div class="content"><a class="author">Torsten Schmits</a><div class="metadata"><a href="#228760233" name="228760233"><div>2021-03-04 12:05:51</div></a></div><div class="text"><p>or are there more cases that cause this?</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/7334dc60b6aef6a75cd9284126231f13c76926a5?version=6"></a><div class="content"><a class="author">Torsten Schmits</a><div class="metadata"><a href="#228760269" name="228760269"><div>2021-03-04 12:06:04</div></a></div><div class="text"><p>it can't be type-directed, right?</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/20a04d823b7c3891d78ca5f6a188ccd0e4fc5e3d?version=2"></a><div class="content"><a class="author">TheMatten</a><div class="metadata"><a href="#228760288" name="228760288"><div>2021-03-04 12:06:06</div></a></div><div class="text"><div class="codehilite"><pre><span></span><code> L (t : ts) (m : ms) = } : (L (t : ts) ms) if mâˆ• = 0 and parse-error(t)
</code></pre></div>
<p><code>parse-error(&gt;&gt;=)</code> should be true, shouldn't it?</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/7334dc60b6aef6a75cd9284126231f13c76926a5?version=6"></a><div class="content"><a class="author">Torsten Schmits</a><div class="metadata"><a href="#228760332" name="228760332"><div>2021-03-04 12:06:20</div></a></div><div class="text"><p>huh</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/20a04d823b7c3891d78ca5f6a188ccd0e4fc5e3d?version=2"></a><div class="content"><a class="author">TheMatten</a><div class="metadata"><a href="#228760342" name="228760342"><div>2021-03-04 12:06:27</div></a></div><div class="text"><p>it expects expression, but gets some operator</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/7334dc60b6aef6a75cd9284126231f13c76926a5?version=6"></a><div class="content"><a class="author">Torsten Schmits</a><div class="metadata"><a href="#228760344" name="228760344"><div>2021-03-04 12:06:28</div></a></div><div class="text"><p>that sucks</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/20a04d823b7c3891d78ca5f6a188ccd0e4fc5e3d?version=2"></a><div class="content"><a class="author">TheMatten</a><div class="metadata"><a href="#228760377" name="228760377"><div>2021-03-04 12:06:47</div></a></div><div class="text"><p>Yeah - reason why lexer and parser have to be entangled in Haskell</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/7334dc60b6aef6a75cd9284126231f13c76926a5?version=6"></a><div class="content"><a class="author">Torsten Schmits</a><div class="metadata"><a href="#228760427" name="228760427"><div>2021-03-04 12:07:10</div></a></div><div class="text"><p>guess I'll have to use the symbolic character as a condition for layout_end and hope for the best</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/20a04d823b7c3891d78ca5f6a188ccd0e4fc5e3d?version=2"></a><div class="content"><a class="author">TheMatten</a><div class="metadata"><a href="#228760662" name="228760662"><div>2021-03-04 12:08:42</div></a></div><div class="text"><p>One more case is <code>then</code> BTW</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/7334dc60b6aef6a75cd9284126231f13c76926a5?version=6"></a><div class="content"><a class="author">Torsten Schmits</a><div class="metadata"><a href="#228760701" name="228760701"><div>2021-03-04 12:09:04</div></a></div><div class="text"><p>how so?</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/20a04d823b7c3891d78ca5f6a188ccd0e4fc5e3d?version=2"></a><div class="content"><a class="author">TheMatten</a><div class="metadata"><a href="#228760767" name="228760767"><div>2021-03-04 12:09:32</div></a></div><div class="text"><p>You can do <code>if do True then ...</code></p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/7334dc60b6aef6a75cd9284126231f13c76926a5?version=6"></a><div class="content"><a class="author">Torsten Schmits</a><div class="metadata"><a href="#228760920" name="228760920"><div>2021-03-04 12:10:37</div></a></div><div class="text"><p>indeed, that confuses my parser as well</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/20a04d823b7c3891d78ca5f6a188ccd0e4fc5e3d?version=2"></a><div class="content"><a class="author">TheMatten</a><div class="metadata"><a href="#228760945" name="228760945"><div>2021-03-04 12:10:50</div></a></div><div class="text"><p>Or</p>
<div class="codehilite" data-code-language="Haskell"><pre><span></span><code><span class="kr">if</span> <span class="kr">do</span> <span class="kt">True</span>
      <span class="kr">then</span> <span class="kt">True</span> <span class="kr">else</span> <span class="kt">False</span>
</code></pre></div></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/7334dc60b6aef6a75cd9284126231f13c76926a5?version=6"></a><div class="content"><a class="author">Torsten Schmits</a><div class="metadata"><a href="#228761019" name="228761019"><div>2021-03-04 12:11:30</div></a></div><div class="text"><p>does that apply to other layouts or only <code>do</code>?</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/7334dc60b6aef6a75cd9284126231f13c76926a5?version=6"></a><div class="content"><a class="author">Torsten Schmits</a><div class="metadata"><a href="#228761055" name="228761055"><div>2021-03-04 12:11:54</div></a></div><div class="text"><p><code>if a where a = 1 then</code></p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/7334dc60b6aef6a75cd9284126231f13c76926a5?version=6"></a><div class="content"><a class="author">Torsten Schmits</a><div class="metadata"><a href="#228761148" name="228761148"><div>2021-03-04 12:12:30</div></a></div><div class="text"><p>nope that's a parse error</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/7334dc60b6aef6a75cd9284126231f13c76926a5?version=6"></a><div class="content"><a class="author">Torsten Schmits</a><div class="metadata"><a href="#228761176" name="228761176"><div>2021-03-04 12:12:56</div></a></div><div class="text"><p>right, <code>where</code> isn't allowed after just any expression</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/20a04d823b7c3891d78ca5f6a188ccd0e4fc5e3d?version=2"></a><div class="content"><a class="author">TheMatten</a><div class="metadata"><a href="#228761229" name="228761229"><div>2021-03-04 12:13:19</div></a></div><div class="text"><p>Hmm, <code>let</code> is always guarded by something, and <code>where</code> could only appear inside of it or in top level block</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/7334dc60b6aef6a75cd9284126231f13c76926a5?version=6"></a><div class="content"><a class="author">Torsten Schmits</a><div class="metadata"><a href="#228761246" name="228761246"><div>2021-03-04 12:13:35</div></a></div><div class="text"><p>I'm beginning to think that I should track <code>do</code> separately from the other layouts</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/20a04d823b7c3891d78ca5f6a188ccd0e4fc5e3d?version=2"></a><div class="content"><a class="author">TheMatten</a><div class="metadata"><a href="#228761368" name="228761368"><div>2021-03-04 12:14:21</div></a></div><div class="text"><p>I mean, if you did the same trick for all of them, what would happen? It will end up with parse error anyway, won't it?</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/7334dc60b6aef6a75cd9284126231f13c76926a5?version=6"></a><div class="content"><a class="author">Torsten Schmits</a><div class="metadata"><a href="#228761413" name="228761413"><div>2021-03-04 12:14:52</div></a></div><div class="text"><p><code>a = if case 5 of 5 -&gt; True then 1 else 1 </code></p>
<p>this is weird</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/20a04d823b7c3891d78ca5f6a188ccd0e4fc5e3d?version=2"></a><div class="content"><a class="author">TheMatten</a><div class="metadata"><a href="#228761485" name="228761485"><div>2021-03-04 12:15:38</div></a></div><div class="text"><p>But if you want to be GHC-complaint, you do have to support <code>NonDecreasingIndetation</code>, so <code>do</code> actually ends up being different after  all</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/7334dc60b6aef6a75cd9284126231f13c76926a5?version=6"></a><div class="content"><a class="author">Torsten Schmits</a><div class="metadata"><a href="#228761488" name="228761488"><div>2021-03-04 12:15:41</div></a></div><div class="text"><blockquote>
<p>I mean, if you did the same trick for all of them, what would happen? It will end up with parse error anyway, won't it?</p>
</blockquote>
<p><span aria-label="thinking" class="emoji emoji-1f914" role="img" title="thinking">:thinking:</span></p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/7334dc60b6aef6a75cd9284126231f13c76926a5?version=6"></a><div class="content"><a class="author">Torsten Schmits</a><div class="metadata"><a href="#228762994" name="228762994"><div>2021-03-04 12:28:05</div></a></div><div class="text"><p><span class="user-mention silent" data-user-id="225127">TheMatten</span> <a href="#narrow/stream/201385-Haskell/topic/hanging.20indent.20with.20symbolic.20operators/near/228761485">said</a>:</p>
<blockquote>
<p>But if you want to be GHC-complaint, you do have to support <code>NonDecreasingIndetation</code>, so <code>do</code> actually ends up being different after  all</p>
</blockquote>
<p>why does that make it different?</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/20a04d823b7c3891d78ca5f6a188ccd0e4fc5e3d?version=2"></a><div class="content"><a class="author">TheMatten</a><div class="metadata"><a href="#228763077" name="228763077"><div>2021-03-04 12:28:44</div></a></div><div class="text"><p>You accept layout of <code>do</code> starting at the same level as the previous one</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/20a04d823b7c3891d78ca5f6a188ccd0e4fc5e3d?version=2"></a><div class="content"><a class="author">TheMatten</a><div class="metadata"><a href="#228763108" name="228763108"><div>2021-03-04 12:29:07</div></a></div><div class="text"><div class="codehilite"><pre><span></span><code>do _
   if _ then _ else do
   _
</code></pre></div></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/20a04d823b7c3891d78ca5f6a188ccd0e4fc5e3d?version=2"></a><div class="content"><a class="author">TheMatten</a><div class="metadata"><a href="#228763189" name="228763189"><div>2021-03-04 12:29:56</div></a></div><div class="text"><p>This doesn't apply to other layouts AFAIK</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/7334dc60b6aef6a75cd9284126231f13c76926a5?version=6"></a><div class="content"><a class="author">Torsten Schmits</a><div class="metadata"><a href="#228763317" name="228763317"><div>2021-03-04 12:30:42</div></a></div><div class="text"><p>ugh come <em>on</em>!</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/7334dc60b6aef6a75cd9284126231f13c76926a5?version=6"></a><div class="content"><a class="author">Torsten Schmits</a><div class="metadata"><a href="#228763409" name="228763409"><div>2021-03-04 12:31:23</div></a></div><div class="text"><p>welp, guess it's time to rewrite the layout handler</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/7334dc60b6aef6a75cd9284126231f13c76926a5?version=6"></a><div class="content"><a class="author">Torsten Schmits</a><div class="metadata"><a href="#228763573" name="228763573"><div>2021-03-04 12:32:42</div></a></div><div class="text"><p>do you have a link for <code>NonDecreasingIndentation</code>?</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/7334dc60b6aef6a75cd9284126231f13c76926a5?version=6"></a><div class="content"><a class="author">Torsten Schmits</a><div class="metadata"><a href="#228763694" name="228763694"><div>2021-03-04 12:33:40</div></a></div><div class="text"><p>or is that encoded in the layout section of the syntax reference?</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/20a04d823b7c3891d78ca5f6a188ccd0e4fc5e3d?version=2"></a><div class="content"><a class="author">TheMatten</a><div class="metadata"><a href="#228763788" name="228763788"><div>2021-03-04 12:34:05</div></a></div><div class="text"><p><a href="https://downloads.haskell.org/ghc/latest/docs/html/users_guide/bugs.html?highlight=nondecreasingindentation#context-free-syntax">https://downloads.haskell.org/ghc/latest/docs/html/users_guide/bugs.html?highlight=nondecreasingindentation#context-free-syntax</a></p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/7334dc60b6aef6a75cd9284126231f13c76926a5?version=6"></a><div class="content"><a class="author">Torsten Schmits</a><div class="metadata"><a href="#228763882" name="228763882"><div>2021-03-04 12:35:04</div></a></div><div class="text"><p>"bugs"</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/20a04d823b7c3891d78ca5f6a188ccd0e4fc5e3d?version=2"></a><div class="content"><a class="author">TheMatten</a><div class="metadata"><a href="#228763881" name="228763881"><div>2021-03-04 12:35:04</div></a></div><div class="text"><p>In principle it's matter of switching <code>&gt;</code> for <code>&gt;=</code> in case of <code>do</code> layout</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/7334dc60b6aef6a75cd9284126231f13c76926a5?version=6"></a><div class="content"><a class="author">Torsten Schmits</a><div class="metadata"><a href="#228763965" name="228763965"><div>2021-03-04 12:35:35</div></a></div><div class="text"><p>"but not in Haskell2010 mode"?</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/7334dc60b6aef6a75cd9284126231f13c76926a5?version=6"></a><div class="content"><a class="author">Torsten Schmits</a><div class="metadata"><a href="#228764157" name="228764157"><div>2021-03-04 12:36:57</div></a></div><div class="text"><p>does that mean it's impossible to tell whether it's legal to use the same indent?</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/7334dc60b6aef6a75cd9284126231f13c76926a5?version=6"></a><div class="content"><a class="author">Torsten Schmits</a><div class="metadata"><a href="#228764204" name="228764204"><div>2021-03-04 12:37:15</div></a></div><div class="text"><p>(just by parsing the file)</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/20a04d823b7c3891d78ca5f6a188ccd0e4fc5e3d?version=2"></a><div class="content"><a class="author">TheMatten</a><div class="metadata"><a href="#228764481" name="228764481"><div>2021-03-04 12:39:24</div></a></div><div class="text"><p>I guess that applies to all syntactic extensions</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/7334dc60b6aef6a75cd9284126231f13c76926a5?version=6"></a><div class="content"><a class="author">Torsten Schmits</a><div class="metadata"><a href="#228764577" name="228764577"><div>2021-03-04 12:40:04</div></a></div><div class="text"><p>well it's simple to assume that a <code>\case</code> means we want LambdaCase</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/20a04d823b7c3891d78ca5f6a188ccd0e4fc5e3d?version=2"></a><div class="content"><a class="author">TheMatten</a><div class="metadata"><a href="#228764720" name="228764720"><div>2021-03-04 12:40:56</div></a></div><div class="text"><p>But what about <code>static</code> keyword? <span aria-label="big smile" class="emoji emoji-1f604" role="img" title="big smile">:big_smile:</span></p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/7334dc60b6aef6a75cd9284126231f13c76926a5?version=6"></a><div class="content"><a class="author">Torsten Schmits</a><div class="metadata"><a href="#228764738" name="228764738"><div>2021-03-04 12:41:03</div></a></div><div class="text"><p>right</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/20a04d823b7c3891d78ca5f6a188ccd0e4fc5e3d?version=2"></a><div class="content"><a class="author">TheMatten</a><div class="metadata"><a href="#228764792" name="228764792"><div>2021-03-04 12:41:29</div></a></div><div class="text"><p>or <code>proc do</code></p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/20a04d823b7c3891d78ca5f6a188ccd0e4fc5e3d?version=2"></a><div class="content"><a class="author">TheMatten</a><div class="metadata"><a href="#228764806" name="228764806"><div>2021-03-04 12:41:37</div></a></div><div class="text"><p>or <code>rec</code></p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/20a04d823b7c3891d78ca5f6a188ccd0e4fc5e3d?version=2"></a><div class="content"><a class="author">TheMatten</a><div class="metadata"><a href="#228765027" name="228765027"><div>2021-03-04 12:43:05</div></a></div><div class="text"><p>That's  basically why I've decided to work with <code>Haskell2010</code> in Hask - there's just too much stuff in GHC <span aria-label="sweat smile" class="emoji emoji-1f605" role="img" title="sweat smile">:sweat_smile:</span></p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/7334dc60b6aef6a75cd9284126231f13c76926a5?version=6"></a><div class="content"><a class="author">Torsten Schmits</a><div class="metadata"><a href="#228765119" name="228765119"><div>2021-03-04 12:43:47</div></a></div><div class="text"><p>well if you're lucky the parser will just decide the right variant of <code>rec</code> being keyword or identifier</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/7334dc60b6aef6a75cd9284126231f13c76926a5?version=6"></a><div class="content"><a class="author">Torsten Schmits</a><div class="metadata"><a href="#228765254" name="228765254"><div>2021-03-04 12:44:43</div></a></div><div class="text"><p>in my case, the parse tree isn't used for typing afterwards, so it doesn't matter</p></div></div></div></div></div><div class="ui vertical footer segment"><a href="https://github.com/srid/zulip-archive">Powered by Haskell</a> | Questions? Contact <a href="https://www.srid.ca">srid</a></div></div></body></html>