<html lang="en"><head><meta content="text/html; charset=utf-8" http-equiv="Content-Type"><meta content="width=device-width, initial-scale=1" name="viewport"><meta content="Joel McCracken said:

yep. I agree with Kris fwiw, its better to have your business logic in pure types, and have a monad transformer stack &quot;at the edges&quot;. I&#39;d like to keep PersistT out of things as much as possible just because of the principle of least power!

@Joel McCracken to avoid discussing d" name="description"><link href="https://funprog.srid.ca/haskell/do-we-need-to-separate-domain-types-and-db-access-type.html" rel="canonical"><meta property="og:title" content="Do we need to separate domain types and db access type? - Haskell"><meta property="og:site_name" content="Functional Programming Zulip Archive"><meta property="og:type" content="article"><meta property="og:article:section" content="Haskell"><meta property="og:article:modified_time" content="2020-09-24T13:22:37Z"><meta property="og:article:published_time" content="2020-09-10T08:11:22Z"><meta property="og:image" content="https://zulip-avatars.s3.amazonaws.com/13896/8084ff35e892945a460a7ed9885325c7804e1b87?version=2"><title>Do we need to separate domain types and db access type? - Haskell</title><style type="text/css">
div#thesite
{
  font-family   : "Open Sans", sans-serif;
  font-size     : 1em !important;
  margin-top    : 1em;
  margin-bottom : 1em;
}

div#thesite h1
{
  font-family : "Roboto", sans-serif;
  line-height : 1.19999em;
}

div#thesite h2
{
  font-family : "Roboto", sans-serif;
  line-height : 1.19999em;
}

div#thesite h3
{
  font-family : "Roboto", sans-serif;
  line-height : 1.19999em;
}

div#thesite h4
{
  font-family : "Roboto", sans-serif;
  line-height : 1.19999em;
}

div#thesite h5
{
  font-family : "Roboto", sans-serif;
  line-height : 1.19999em;
}

div#thesite h6
{
  font-family : "Roboto", sans-serif;
  line-height : 1.19999em;
}

div#thesite .ui.breadcrumb.rib .section
{
  font-family : "Roboto", sans-serif;
  line-height : 1.19999em;
}

div#thesite .header
{
  font-family : "Roboto", sans-serif;
  line-height : 1.19999em;
}

div#thesite .as-header
{
  font-family : "Roboto", sans-serif;
  line-height : 1.19999em;
}

div#thesite code, pre, tt
{
  font-family : "SFMono-Regular","Menlo","Monaco","Consolas","Liberation Mono","Courier New", monospace;
}

div#thesite .ui.breadcrumb.rib
{
  margin-bottom : 1em;
}



div#thesite .ui.comments.messages .comment .metadata a
{
  color : #808080;
}

div#thesite .ui.comments.messages .comment a.avatar img
{
  height : auto;
}

div#thesite .subtle
{
  color : #808080;
}


div#thesite .messages pre
{
  font-size : 85%;
  overflow  : auto;
  max-width : 100%;
}

div#thesite .messages .message_embed
{
  border-left  : solid 3px #808080;
  padding-left : 0.69999em;
}

div#thesite .messages .message_inline_image img
{
  max-width     : 100%;
  margin-bottom : 1em;
}


/* Generated with Clay, http://fvisser.nl/clay */</style><link href="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.4.1/semantic.min.css" rel="stylesheet"><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.min.css" rel="stylesheet"><link href="https://fonts.googleapis.com/css?family=Open+Sans|Oswald&amp;display=swap" rel="stylesheet"><link href="https://fonts.googleapis.com/css?family=Roboto|Open+Sans&amp;display=swap" rel="stylesheet"></head><body><div id="thesite" class="ui text container"><div class="ui violet inverted top attached center aligned segment"><h1 class="ui huge header">Do we need to separate domain types and db access type? - Haskell</h1></div><div class="ui attached segment"><div class="ui message"><p>Welcome to the Functional Programming Zulip Chat Archive. You can join the chat <a href="https://funprog.zulipchat.com">here</a>.</p></div><div class="ui breadcrumb rib"><a href="/" class="section">Home</a><i class="right angle icon divider"></i><a href="/haskell/" class="section">#Haskell</a><i class="right angle icon divider"></i><div class="active section">Do we need to separate domain types and db access type?</div></div><div class="ui comments messages"><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/8084ff35e892945a460a7ed9885325c7804e1b87?version=2"></a><div class="content"><a class="author">Rizary</a><div class="metadata"><a href="#209607361" name="209607361"><div>2020-09-10 08:11:22</div></a></div><div class="text"><p><span class="user-mention silent" data-user-id="252949">Joel McCracken</span> <a href="#narrow/stream/201385-Haskell/topic/Boring.20Haskell.20.2F.3D.20Resenting.20Types/near/209532031">said</a>:</p>
<blockquote>
<p>yep. I agree with Kris fwiw, its better to have your business logic in pure types, and have a monad transformer stack "at the edges". I'd like to keep PersistT out of things as much as possible just because of the principle of least power!</p>
</blockquote>
<p><span class="user-mention" data-user-id="252949">@Joel McCracken</span> to avoid discussing different topic in the same stream, I dig a little about this and found MaxGabriel's comment on this issue <a href="https://github.com/yesodweb/persistent/issues/1115">https://github.com/yesodweb/persistent/issues/1115</a>. looking at this, I'm not sure if what Kris's said is true in all cases.</p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/yesodweb/persistent/issues/1115" style="background-image: url(https://avatars3.githubusercontent.com/u/930379?s=400&amp;v=4)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/yesodweb/persistent/issues/1115" title="Documentation re intended use and best practices 路 Issue #1115 路 yesodweb/persistent">Documentation re intended use and best practices 路 Issue #1115 路 yesodweb/persistent</a></div><div class="message_embed_description">It has been reported that persistent encourages you to use your database types in your domain. We should investigate the documentation for persistent and ensure that is not the case. We should inst...</div></div></div></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/bd1c2dd9ab5e95cae3e7a38c2f373739e5a1acba?version=2"></a><div class="content"><a class="author">Georgi Lyubenov // googleson78</a><div class="metadata"><a href="#209609108" name="209609108"><div>2020-09-10 08:31:51</div></a></div><div class="text"><p>it may be possible to share the types sometimes, but I think it's a much safer to always separate them by default</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/bd1c2dd9ab5e95cae3e7a38c2f373739e5a1acba?version=2"></a><div class="content"><a class="author">Georgi Lyubenov // googleson78</a><div class="metadata"><a href="#209609181" name="209609181"><div>2020-09-10 08:32:27</div></a></div><div class="text"><p>and only merge them if you have to optimise (although I don't imagine this deconstructing/constructing of types with one constructor to really cost much in most cases)</p></div></div></div><div class="comment"><a class="avatar"><img src="https://www.gravatar.com/avatar/374affb4db58caa9507f265d7fdf03fe"></a><div class="content"><a class="author">Fintan Halpenny</a><div class="metadata"><a href="#209612987" name="209612987"><div>2020-09-10 09:14:17</div></a></div><div class="text"><p>I think another issue for said database was that the representation of the domain was tied to how you could formulate it in terms of the types the database could handle.<br>
In reality, we could have had a better representation in the Haskell domain and have boundary conversions to/from the database representation.</p></div></div></div><div class="comment"><a class="avatar"><img src="https://www.gravatar.com/avatar/45175015b9eb3dd3f6c740b3fe920fed"></a><div class="content"><a class="author">Joel McCracken</a><div class="metadata"><a href="#209640502" name="209640502"><div>2020-09-10 13:38:23</div></a></div><div class="text"><p>Well, what Kris said is certainly an opinion; i don't think its the <em>only</em> valid one. I do agree though, its much easier to reason with pure code instead of code that is interspersed with a monad transformer stack, so that take that for what its worth</p></div></div></div><div class="comment"><a class="avatar"><img src="https://www.gravatar.com/avatar/45175015b9eb3dd3f6c740b3fe920fed"></a><div class="content"><a class="author">Joel McCracken</a><div class="metadata"><a href="#209640665" name="209640665"><div>2020-09-10 13:39:38</div></a></div><div class="text"><p>There are two separate issues here though and im not sure which one is being discussed exactly; are we talking about having separate domain logic and persistence types, or are we discussing if it makes sense to have PersistT interspersed throughout your business code?</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/bd1c2dd9ab5e95cae3e7a38c2f373739e5a1acba?version=2"></a><div class="content"><a class="author">Georgi Lyubenov // googleson78</a><div class="metadata"><a href="#209640991" name="209640991"><div>2020-09-10 13:40:33</div></a></div><div class="text"><p>we were discussing the domain vs persistence types, as far as I can tell</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/bd1c2dd9ab5e95cae3e7a38c2f373739e5a1acba?version=2"></a><div class="content"><a class="author">Georgi Lyubenov // googleson78</a><div class="metadata"><a href="#209641096" name="209641096"><div>2020-09-10 13:41:13</div></a></div><div class="text"><p>ofcourse it's also better to not have <code>SqlPersistT</code> around in your business logic, the same way it's better not to have IO directly</p></div></div></div><div class="comment"><a class="avatar"><img src="https://www.gravatar.com/avatar/45175015b9eb3dd3f6c740b3fe920fed"></a><div class="content"><a class="author">Joel McCracken</a><div class="metadata"><a href="#209641685" name="209641685"><div>2020-09-10 13:42:15</div></a></div><div class="text"><p>yeah so i mean there are several things here; generally the preferred domain type you might have is not going to be be the same as the preferred type for persistence</p></div></div></div><div class="comment"><a class="avatar"><img src="https://www.gravatar.com/avatar/45175015b9eb3dd3f6c740b3fe920fed"></a><div class="content"><a class="author">Joel McCracken</a><div class="metadata"><a href="#209641803" name="209641803"><div>2020-09-10 13:42:25</div></a></div><div class="text"><p><a href="https://github.com/yesodweb/persistent/issues/1115#issuecomment-690094112">https://github.com/yesodweb/persistent/issues/1115#issuecomment-690094112</a> <span class="user-mention" data-user-id="254032">@Georgi Lyubenov // googleson78</span> has a great example there</p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/yesodweb/persistent/issues/1115#issuecomment-690094112" style="background-image: url(https://avatars3.githubusercontent.com/u/930379?s=400&amp;v=4)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/yesodweb/persistent/issues/1115#issuecomment-690094112" title="Documentation re intended use and best practices 路 Issue #1115 路 yesodweb/persistent">Documentation re intended use and best practices 路 Issue #1115 路 yesodweb/persistent</a></div><div class="message_embed_description">It has been reported that persistent encourages you to use your database types in your domain. We should investigate the documentation for persistent and ensure that is not the case. We should inst...</div></div></div></div></div></div><div class="comment"><a class="avatar"><img src="https://www.gravatar.com/avatar/45175015b9eb3dd3f6c740b3fe920fed"></a><div class="content"><a class="author">Joel McCracken</a><div class="metadata"><a href="#209642309" name="209642309"><div>2020-09-10 13:43:10</div></a></div><div class="text"><p>now, you <em>can</em> actually use them sometimes, but you just need to be aware that you have implicit coupling, and you <em>may</em> need to split them out at some point</p></div></div></div><div class="comment"><a class="avatar"><img src="https://www.gravatar.com/avatar/45175015b9eb3dd3f6c740b3fe920fed"></a><div class="content"><a class="author">Joel McCracken</a><div class="metadata"><a href="#209642596" name="209642596"><div>2020-09-10 13:44:37</div></a></div><div class="text"><p>would an example help illuminate the issue <span class="user-mention" data-user-id="251394">@Rizary</span> ?</p></div></div></div><div class="comment"><a class="avatar"><img src="https://www.gravatar.com/avatar/33ed1f4a88793f2221d759610e2e8ddb"></a><div class="content"><a class="author">codygman</a><div class="metadata"><a href="#209645724" name="209645724"><div>2020-09-10 14:01:49</div></a></div><div class="text"><p>I bet an example would help. Seperating domain types and persistent entities are a hard sell if many things end up like:</p>
<div class="codehilite"><pre><span></span><code>[persistLowerCase |
    PersonDBO
      age Int
]

data Person = Person { _id :: Int64, age :: Int}

personDBOToPerson :: PersonDBO -&gt; Person
</code></pre></div>


<p>If the two types end up being the same, it seems kind of pointless.</p></div></div></div><div class="comment"><a class="avatar"><img src="https://www.gravatar.com/avatar/4ba4faf2fc5818d37c0aed6acb5b69a2"></a><div class="content"><a class="author">James King</a><div class="metadata"><a href="#209648441" name="209648441"><div>2020-09-10 14:11:43</div></a></div><div class="text"><p>It can seem like extra work. But it does give you some flexibility to change representation at the database layer without having to change your business logic.</p>
<p>It doesn't happen a lot in straight-forward CRUD web applications in my experience... but it can be nice for lazy loading related data, changing underlying representations for performance reasons, sharding, etc.</p></div></div></div><div class="comment"><a class="avatar"><img src="https://www.gravatar.com/avatar/4ba4faf2fc5818d37c0aed6acb5b69a2"></a><div class="content"><a class="author">James King</a><div class="metadata"><a href="#209649102" name="209649102"><div>2020-09-10 14:12:49</div></a></div><div class="text"><p>I usually do this stuff in the database itself with physical tables being separated by views and materialized views. <span aria-label="shrug" class="emoji emoji-1f937" role="img" title="shrug">:shrug:</span></p></div></div></div><div class="comment"><a class="avatar"><img src="https://www.gravatar.com/avatar/4ba4faf2fc5818d37c0aed6acb5b69a2"></a><div class="content"><a class="author">James King</a><div class="metadata"><a href="#209650918" name="209650918"><div>2020-09-10 14:17:07</div></a></div><div class="text"><p>You might also have some meta-information on the DB type that you could discharge to <code>Either</code> in the <code>personDBOToPerson</code> function... <span aria-label="thinking" class="emoji emoji-1f914" role="img" title="thinking">:thinking:</span></p></div></div></div><div class="comment"><a class="avatar"><img src="https://www.gravatar.com/avatar/4ba4faf2fc5818d37c0aed6acb5b69a2"></a><div class="content"><a class="author">James King</a><div class="metadata"><a href="#209651776" name="209651776"><div>2020-09-10 14:18:47</div></a></div><div class="text"><p>That's pretty random. Never mind me. <span aria-label="sweat smile" class="emoji emoji-1f605" role="img" title="sweat smile">:sweat_smile:</span></p></div></div></div><div class="comment"><a class="avatar"><img src="https://www.gravatar.com/avatar/374affb4db58caa9507f265d7fdf03fe"></a><div class="content"><a class="author">Fintan Halpenny</a><div class="metadata"><a href="#209654127" name="209654127"><div>2020-09-10 14:35:56</div></a></div><div class="text"><p>Well, the <code>Person</code> example above is already broken. A <code>Person</code> shouldn't be able to have negative age <span aria-label="stuck out tongue wink" class="emoji emoji-1f61c" role="img" title="stuck out tongue wink">:stuck_out_tongue_wink:</span></p></div></div></div><div class="comment"><a class="avatar"><img src="https://www.gravatar.com/avatar/33ed1f4a88793f2221d759610e2e8ddb"></a><div class="content"><a class="author">codygman</a><div class="metadata"><a href="#209654676" name="209654676"><div>2020-09-10 14:36:39</div></a></div><div class="text"><p>I think sometimes it can be good to separate, but for CRUD apps I can't make a good argument for separating all the time.</p></div></div></div><div class="comment"><a class="avatar"><img src="https://www.gravatar.com/avatar/33ed1f4a88793f2221d759610e2e8ddb"></a><div class="content"><a class="author">codygman</a><div class="metadata"><a href="#209654967" name="209654967"><div>2020-09-10 14:37:30</div></a></div><div class="text"><p>Right, so making smart constructors for person from personDbo justifies separation</p></div></div></div><div class="comment"><a class="avatar"><img src="https://www.gravatar.com/avatar/374affb4db58caa9507f265d7fdf03fe"></a><div class="content"><a class="author">Fintan Halpenny</a><div class="metadata"><a href="#209655234" name="209655234"><div>2020-09-10 14:39:22</div></a></div><div class="text"><p>You might also want migration paths. If your DB representation changes doesn't necessarily mean your logic needs to</p></div></div></div><div class="comment"><a class="avatar"><img src="https://www.gravatar.com/avatar/33ed1f4a88793f2221d759610e2e8ddb"></a><div class="content"><a class="author">codygman</a><div class="metadata"><a href="#209655304" name="209655304"><div>2020-09-10 14:39:46</div></a></div><div class="text"><p>Thing is, the lazier thing is to say "eh that's not a big deal". I think using entities directly discourages type safety, esp in the "parse don't validate" sense</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/8084ff35e892945a460a7ed9885325c7804e1b87?version=2"></a><div class="content"><a class="author">Rizary</a><div class="metadata"><a href="#209655736" name="209655736"><div>2020-09-10 14:42:00</div></a></div><div class="text"><p><span class="user-mention silent" data-user-id="252949">Joel McCracken</span> <a href="#narrow/stream/201385-Haskell/topic/Do.20we.20need.20to.20separate.20domain.20types.20and.20db.20access.20type.3F/near/209642596">said</a>:</p>
<blockquote>
<p>would an example help illuminate the issue <span class="user-mention silent" data-user-id="251394">Rizary</span> ?</p>
</blockquote>
<p>it will if you don't mind!! thanks, always appreciate your response.</p></div></div></div><div class="comment"><a class="avatar"><img src="https://www.gravatar.com/avatar/45175015b9eb3dd3f6c740b3fe920fed"></a><div class="content"><a class="author">Joel McCracken</a><div class="metadata"><a href="#209655883" name="209655883"><div>2020-09-10 14:42:50</div></a></div><div class="text"><p>lemmie think on it; i think the issues would be best illustrated in a reasonably sizable example</p></div></div></div><div class="comment"><a class="avatar"><img src="https://www.gravatar.com/avatar/45175015b9eb3dd3f6c740b3fe920fed"></a><div class="content"><a class="author">Joel McCracken</a><div class="metadata"><a href="#209655989" name="209655989"><div>2020-09-10 14:43:37</div></a></div><div class="text"><p>one of the abasolutely most useful techniques in haskell is having your domain types be correct-by-construction, like is referenced above</p></div></div></div><div class="comment"><a class="avatar"><img src="https://www.gravatar.com/avatar/33ed1f4a88793f2221d759610e2e8ddb"></a><div class="content"><a class="author">codygman</a><div class="metadata"><a href="#209657284" name="209657284"><div>2020-09-10 14:50:48</div></a></div><div class="text"><p>If your team isn't already sold on correct by construction or the default is "just use the entity", you'll need some pretty good motivating examples though.</p></div></div></div><div class="comment"><a class="avatar"><img src="https://www.gravatar.com/avatar/33ed1f4a88793f2221d759610e2e8ddb"></a><div class="content"><a class="author">codygman</a><div class="metadata"><a href="#209657559" name="209657559"><div>2020-09-10 14:52:21</div></a></div><div class="text"><p>I think I'll add the person example and how it can go wrong to the GitHub thread when I'm at a computer. Then after it's motivated show how in the domain type we parse instead of validating</p></div></div></div><div class="comment"><a class="avatar"><img src="https://www.gravatar.com/avatar/33ed1f4a88793f2221d759610e2e8ddb"></a><div class="content"><a class="author">codygman</a><div class="metadata"><a href="#209678615" name="209678615"><div>2020-09-10 17:09:30</div></a></div><div class="text"><p>I posted a pretty good sized comment with many examples talking about this in the issue:</p>
<p><a href="https://github.com/yesodweb/persistent/issues/1115#issuecomment-690504252">https://github.com/yesodweb/persistent/issues/1115#issuecomment-690504252</a></p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/yesodweb/persistent/issues/1115#issuecomment-690504252" style="background-image: url(https://avatars3.githubusercontent.com/u/930379?s=400&amp;v=4)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/yesodweb/persistent/issues/1115#issuecomment-690504252" title="Documentation re intended use and best practices 路 Issue #1115 路 yesodweb/persistent">Documentation re intended use and best practices 路 Issue #1115 路 yesodweb/persistent</a></div><div class="message_embed_description">It has been reported that persistent encourages you to use your database types in your domain. We should investigate the documentation for persistent and ensure that is not the case. We should inst...</div></div></div></div></div></div><div class="comment"><a class="avatar"><img src="https://www.gravatar.com/avatar/45175015b9eb3dd3f6c740b3fe920fed"></a><div class="content"><a class="author">Joel McCracken</a><div class="metadata"><a href="#209679214" name="209679214"><div>2020-09-10 17:14:48</div></a></div><div class="text"><p>Can I just say, i'm really glad this conversation is happening</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/8084ff35e892945a460a7ed9885325c7804e1b87?version=2"></a><div class="content"><a class="author">Rizary</a><div class="metadata"><a href="#209742189" name="209742189"><div>2020-09-11 05:29:14</div></a></div><div class="text"><p>Thank you <span class="user-mention" data-user-id="325194">@codygman</span> and <span class="user-mention" data-user-id="252949">@Joel McCracken</span> for the discussion. Although sometime I really wish I have a bigger project so I can learn more about this.</p>
<p>I really like about the lexi's blog on "parse don't validate" and I think that the way I directly access my entities is against what advised in that blog</p></div></div></div><div class="comment"><a class="avatar"><img src="https://www.gravatar.com/avatar/45175015b9eb3dd3f6c740b3fe920fed"></a><div class="content"><a class="author">Joel McCracken</a><div class="metadata"><a href="#210419754" name="210419754"><div>2020-09-17 17:09:19</div></a></div><div class="text"><p>So I have an example -- its not for a DB, but it is for another data layer. </p>
<p>Right now at work I am writing a system for pulling data in  to then be reuploaded to our internal services. This thing should run on a regular basis, etc. the system acts on what is contained in a configuration file. Here is an example file:</p>
<div class="codehilite"><pre><span></span><code>api:
  version: &quot;0.1.0&quot;
init:
  name: &quot;getFileForProcessing&quot;
  module:
    tag: &quot;file.getFileForProcessing&quot;
    contents:
      fileLocation: &quot;test/fixtures/appTest.csv&quot;
      validate: True
  logLevel: error
  next: &quot;mapFileForOutput&quot;
actions:
- name: &quot;makeOutput&quot;
  module:
    tag:  &quot;file.output&quot;
    contents:
      destination: &quot;test/fixtures/result2.out&quot;
  next: log
- name: &quot;log&quot;
  module:
    tag:  &quot;log&quot;
    contents:
      level: error
      text: this is log output in worker
- name: &quot;mapFileForOutput&quot;
  module:
    tag:  &quot;mapping.basic&quot;
    contents:
      strict: False
      mappings:
        inputColumnName: output-column-name
    next: &quot;makeOutput&quot;
  logLevel: debug
  next: &quot;makeOutput&quot;
</code></pre></div>


<p>In this example, this process would read a file from the filesystem (presumably put there by another process)<br>
and it would output it to the filesystem (to also be sent along to something that expects it there).<br>
This is just to give you a simple idea how how the system works; its not a realistic example, in reality we are<br>
doing pulling data in via HTTP, modifying it, and then submitting it to graphql. </p>
<p>Anyway, so imagine this scenario:</p>
<div class="codehilite"><pre><span></span><code>api:
  version: &quot;0.1.0&quot;
init:
  name: &quot;getFileForProcessing&quot;
  module:
    tag: &quot;file.getFileForProcessing&quot;
    contents:
      fileLocation: &quot;test/fixtures/appTest.csv&quot;
      validate: True
  logLevel: error
  next: &quot;mapFileForOutput&quot;
actions: []
</code></pre></div>


<p>notice that <code>next</code> does not match any action name. However, it IS valid yaml. And the way our data types that <br>
the yaml parses into works is that <code>next</code> is a <code>Maybe Text</code>, because it may or may not be there (the final<br>
step in an process will not have a <code>next</code> value set).</p>
<p>The problem with this data representation is that it correctly parses this example. The only way this <br>
issue is discovered is while the process is executing the steps, and it looks up the next step in actions, and <br>
it finds that no action with that name exists. If we imagine that this is a very long running process, a user<br>
might not get an alert that the error has occurred until hours after initiating the process with this config.</p>
<p>Now, we <em>could</em> write a post-parsing validation step that indicates if there is an error or not. But this still<br>
leaves us with an annoying data model. Any time you want to figure out what the next step is in a process, you <br>
have to do a lookup which <em>might</em> fail, which is just following the types. If we have a list of actions, then <br>
looking for one with a matching name <em>might</em> not return any, or it might return multiple with the same name. </p>
<p>You can choose to ignore that possibility, but that is considered bad haskell style. Instead, whenever possible<br>
we try to make illegal states unrepresentable. So lets say that the data model is like this today:</p>
<div class="codehilite"><pre><span></span><code><span class="kr">data</span> <span class="kt">ConfigAction</span>
  <span class="ow">=</span> <span class="kt">ConfigAction</span>
  <span class="p">{</span> <span class="n">nextActionName</span> <span class="ow">::</span> <span class="kt">Maybe</span> <span class="kt">Text</span>
  <span class="o">...</span>
  <span class="p">}</span>
</code></pre></div>


<p>We would <em>rather</em> have a type that looks like this:</p>
<div class="codehilite"><pre><span></span><code><span class="kr">data</span> <span class="kt">Action</span>
  <span class="ow">=</span> <span class="kt">Config</span>
  <span class="p">{</span> <span class="n">actionConfigAction</span> <span class="ow">::</span> <span class="kt">ConfigAction</span>
  <span class="p">,</span> <span class="n">actionNextAction</span> <span class="ow">::</span> <span class="kt">Maybe</span> <span class="kt">ConfigAction</span>
  <span class="o">...</span>
  <span class="p">}</span>
</code></pre></div>


<p>That way our code can use <code>nextAction</code> to access the next action; of course this might be the last one (hence the <code>Maybe</code>), <br>
but this removes the possibiliby of there incorrectly being a named action that doesn't exist, or <br>
multiple actions named the same thing.</p>
<p>So basically the idea is to "make illegal states unrepresentable", but also its just more convenient to have datatypes that <br>
map to your business rules. This is essentially the same as this <a href="https://lexi-lambda.github.io/blog/2019/11/05/parse-don-t-validate/">https://lexi-lambda.github.io/blog/2019/11/05/parse-don-t-validate/</a></p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/8084ff35e892945a460a7ed9885325c7804e1b87?version=2"></a><div class="content"><a class="author">Rizary</a><div class="metadata"><a href="#211094785" name="211094785"><div>2020-09-24 06:48:47</div></a></div><div class="text"><p>Interesting, I still need time to digest it at first, but that's make sense. One question to clarify my understanding, this <code>nextAction</code> help us to access the next action in "next" <code>ConfigAction</code>, right?</p></div></div></div><div class="comment"><a class="avatar"><img src="https://www.gravatar.com/avatar/45175015b9eb3dd3f6c740b3fe920fed"></a><div class="content"><a class="author">Joel McCracken</a><div class="metadata"><a href="#211129865" name="211129865"><div>2020-09-24 13:22:37</div></a></div><div class="text"><p>yessir!</p></div></div></div></div></div><div class="ui vertical footer segment"><a href="https://github.com/srid/zulip-archive">Powered by Haskell</a> | Questions? Contact <a href="https://www.srid.ca">srid</a></div></div></body></html>