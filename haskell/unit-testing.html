<html lang="en"><head><meta content="text/html; charset=utf-8" http-equiv="Content-Type"><meta content="width=device-width, initial-scale=1" name="viewport"><meta content="Hello guys!
Could you, please, share your thoughts how you would go about unit testing the following code.
It has interpreters for making http GET and POST requests. The implementation has internal state,
that stores cookies between requests, as well as adds a constant user agent string to all reque" name="description"><link href="https://funprog.srid.ca/haskell/unit-testing.html" rel="canonical"><meta property="og:title" content="Unit Testing - Haskell"><meta property="og:site_name" content="Functional Programming Zulip Archive"><meta property="og:type" content="article"><meta property="og:article:section" content="Haskell"><meta property="og:article:modified_time" content="2020-12-13T20:38:33Z"><meta property="og:article:published_time" content="2020-12-13T09:04:43Z"><title>Unit Testing - Haskell</title><style type="text/css">
div#thesite
{
  font-family   : "Open Sans", sans-serif;
  font-size     : 1em !important;
  margin-top    : 1em;
  margin-bottom : 1em;
}

div#thesite h1
{
  font-family : "Roboto", sans-serif;
  line-height : 1.19999em;
}

div#thesite h2
{
  font-family : "Roboto", sans-serif;
  line-height : 1.19999em;
}

div#thesite h3
{
  font-family : "Roboto", sans-serif;
  line-height : 1.19999em;
}

div#thesite h4
{
  font-family : "Roboto", sans-serif;
  line-height : 1.19999em;
}

div#thesite h5
{
  font-family : "Roboto", sans-serif;
  line-height : 1.19999em;
}

div#thesite h6
{
  font-family : "Roboto", sans-serif;
  line-height : 1.19999em;
}

div#thesite .ui.breadcrumb.rib .section
{
  font-family : "Roboto", sans-serif;
  line-height : 1.19999em;
}

div#thesite .header
{
  font-family : "Roboto", sans-serif;
  line-height : 1.19999em;
}

div#thesite .as-header
{
  font-family : "Roboto", sans-serif;
  line-height : 1.19999em;
}

div#thesite code, pre, tt
{
  font-family : "SFMono-Regular","Menlo","Monaco","Consolas","Liberation Mono","Courier New", monospace;
}

div#thesite .ui.breadcrumb.rib
{
  margin-bottom : 1em;
}



div#thesite .ui.comments.messages .comment .metadata a
{
  color : #808080;
}

div#thesite .ui.comments.messages .comment a.avatar img
{
  height : auto;
}

div#thesite .subtle
{
  color : #808080;
}


div#thesite .messages pre
{
  font-size : 85%;
  overflow  : auto;
  max-width : 100%;
}

div#thesite .messages .message_embed
{
  border-left  : solid 3px #808080;
  padding-left : 0.69999em;
}

div#thesite .messages .message_inline_image img
{
  max-width     : 100%;
  margin-bottom : 1em;
}


/* Generated with Clay, http://fvisser.nl/clay */</style><link href="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.4.1/semantic.min.css" rel="stylesheet"><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.min.css" rel="stylesheet"><link href="https://fonts.googleapis.com/css?family=Open+Sans|Oswald&amp;display=swap" rel="stylesheet"><link href="https://fonts.googleapis.com/css?family=Roboto|Open+Sans&amp;display=swap" rel="stylesheet"></head><body><div id="thesite" class="ui text container"><div class="ui violet inverted top attached center aligned segment"><h1 class="ui huge header">Unit Testing - Haskell</h1></div><div class="ui attached segment"><div class="ui message"><p>Welcome to the Functional Programming Zulip Chat Archive. You can join the chat <a href="https://funprog.zulipchat.com">here</a>.</p></div><div class="ui breadcrumb rib"><a href="/" class="section">Home</a><i class="right angle icon divider"></i><a href="/haskell/" class="section">#Haskell</a><i class="right angle icon divider"></i><div class="active section">Unit Testing</div></div><div class="ui comments messages"><div class="comment"><a class="avatar"></a><div class="content"><a class="author">Martins</a><div class="metadata"><a href="#219752522" name="219752522"><div>2020-12-13 09:04:43</div></a></div><div class="text"><p>Hello guys!</p>
<p>Could you, please, share your thoughts how you would go about <strong>unit testing</strong> the following code.<br>
It has interpreters for making http <em>GET</em> and <em>POST</em> requests. The implementation has internal state,<br>
that stores cookies between requests, as well as adds a constant user agent string to all requests.</p>
<p><a href="https://gist.github.com/martinserts/d206b7778f3a4f4782dcf16077d4b794">https://gist.github.com/martinserts/d206b7778f3a4f4782dcf16077d4b794</a></p>
<p>I would like to test at least the following scenarios:</p>
<ol>
<li>Requests are delegated to <em>Network.HTTP.Req</em>.</li>
<li>Cookies are retained between multiple requests.</li>
<li>Outgoing requests contain our custom user agent string</li>
</ol>
<p>In <strong>Scala</strong>, I would use a <em>mocking framework</em> such as <strong>mockito,</strong> and verify outgoing calls.<br>
In <strong>Haskell</strong> it's probably much different.</p>
<p>May be you could share some Haskell projects with exemplary unit testing that I could learn from?</p>
<div class="message_embed"><a class="message_embed_image" href="https://gist.github.com/martinserts/d206b7778f3a4f4782dcf16077d4b794" style="background-image: url(https://github.githubassets.com/images/modules/gists/gist-og-image.png)"></a><div class="data-container"><div class="message_embed_title"><a href="https://gist.github.com/martinserts/d206b7778f3a4f4782dcf16077d4b794" title="HttpClient.hs">HttpClient.hs</a></div><div class="message_embed_description">GitHub Gist: instantly share code, notes, and snippets.</div></div></div></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/7334dc60b6aef6a75cd9284126231f13c76926a5?x=x&amp;version=4"></a><div class="content"><a class="author">Torsten Schmits</a><div class="metadata"><a href="#219759331" name="219759331"><div>2020-12-13 12:17:37</div></a></div><div class="text"><p>you're using <code>in-other-words</code>!!! <span aria-label="scream" class="emoji emoji-1f631" role="img" title="scream">:scream:</span></p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/7334dc60b6aef6a75cd9284126231f13c76926a5?x=x&amp;version=4"></a><div class="content"><a class="author">Torsten Schmits</a><div class="metadata"><a href="#219759547" name="219759547"><div>2020-12-13 12:24:56</div></a></div><div class="text"><p>I see two ways how I would do it:</p>
<ol>
<li>use an internal effect abstracting <code>R.Option -&gt; m response</code>, then use a pure interpreter in your test</li>
<li>spin up a servant in a bracket in your test</li>
</ol></div></div></div><div class="comment"><a class="avatar"></a><div class="content"><a class="author">Martins</a><div class="metadata"><a href="#219759655" name="219759655"><div>2020-12-13 12:28:17</div></a></div><div class="text"><p><span class="user-mention silent" data-user-id="260881">Torsten Schmits</span> <a href="#narrow/stream/201385-Haskell/topic/Unit.20Testing/near/219759547">said</a>:</p>
<blockquote>
<p>I see two ways how I would do it:</p>
<ol>
<li>use an internal effect abstracting <code>R.Option -&gt; m response</code>, then use a pure interpreter in your test</li>
<li>spin up a servant in a bracket in your test</li>
</ol>
</blockquote>
<p>Great ideas! I will contemplate them!</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/7334dc60b6aef6a75cd9284126231f13c76926a5?x=x&amp;version=4"></a><div class="content"><a class="author">Torsten Schmits</a><div class="metadata"><a href="#219760582" name="219760582"><div>2020-12-13 12:59:14</div></a></div><div class="text"><p>FYI I'm doing method 2. in my tests for the Polysemy variant of your issue: <a href="https://github.com/tek/polysemy-http/blob/master/packages/polysemy-http/integration/Polysemy/Http/Server.hs">https://github.com/tek/polysemy-http/blob/master/packages/polysemy-http/integration/Polysemy/Http/Server.hs</a></p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/tek/polysemy-http/blob/master/packages/polysemy-http/integration/Polysemy/Http/Server.hs" style="background-image: url(https://avatars0.githubusercontent.com/u/2632?s=400&amp;v=4)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/tek/polysemy-http/blob/master/packages/polysemy-http/integration/Polysemy/Http/Server.hs" title="tek/polysemy-http">tek/polysemy-http</a></div><div class="message_embed_description">polysemy effect for http-client. Contribute to tek/polysemy-http development by creating an account on GitHub.</div></div></div></div></div></div><div class="comment"><a class="avatar"></a><div class="content"><a class="author">Martins</a><div class="metadata"><a href="#219760912" name="219760912"><div>2020-12-13 13:08:43</div></a></div><div class="text"><p>Wow such a complete solution!</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/7334dc60b6aef6a75cd9284126231f13c76926a5?x=x&amp;version=4"></a><div class="content"><a class="author">Torsten Schmits</a><div class="metadata"><a href="#219760926" name="219760926"><div>2020-12-13 13:09:20</div></a></div><div class="text"><p>have fun! <span aria-label="sweat smile" class="emoji emoji-1f605" role="img" title="sweat smile">:sweat_smile:</span></p></div></div></div><div class="comment"><a class="avatar"></a><div class="content"><a class="author">Martins</a><div class="metadata"><a href="#219760980" name="219760980"><div>2020-12-13 13:10:47</div></a></div><div class="text"><p>Thanks!</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/f1ec33bcc6144366b30e479d6b3bed74cdb9f611?x=x&amp;version=4"></a><div class="content"><a class="author">Love Waern (King of the Homeless)</a><div class="metadata"><a href="#219765385" name="219765385"><div>2020-12-13 15:09:47</div></a></div><div class="text"><p>Nice to see someone try out <code>in-other-words</code>! How's your experience with it been so far?<br>
Small optimization, by the way: since you're using <code>Embed IO</code> in <code>httpClientToIO</code>, you could use <code>fmap snd . stateToIOSimple</code> instead of <code>evalState</code>. That way, you can also get rid of the <code>StateThreads</code> threading constraint.</p></div></div></div><div class="comment"><a class="avatar"></a><div class="content"><a class="author">Martins</a><div class="metadata"><a href="#219766805" name="219766805"><div>2020-12-13 15:46:34</div></a></div><div class="text"><p>Thanks for the tip and a great library. I am not an advanced Haskell programmer, so this<br>
stuff is actually over my head :) But that does not discourage me, since <code>in-other-words</code> has really good<br>
documentation. I read and reread it several times, and each time understand something a tiny bit better.<br>
I see how much effort you have put in!</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/f1ec33bcc6144366b30e479d6b3bed74cdb9f611?x=x&amp;version=4"></a><div class="content"><a class="author">Love Waern (King of the Homeless)</a><div class="metadata"><a href="#219767002" name="219767002"><div>2020-12-13 15:52:54</div></a></div><div class="text"><p>That's encouraging to hear! I knew <code>in-other-words</code> is at the very top end of the scale when it comes to effect system complexity, so I poured everything I had into documenting it.<br>
Fortunately, I think most of the REALLY complicated stuff will only rarely be relevant for the end user, and the basics of the library are still fairly simple. It helps that it's pretty similar to <code>polysemy</code> and <code>fused-effects</code>.</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/7334dc60b6aef6a75cd9284126231f13c76926a5?x=x&amp;version=4"></a><div class="content"><a class="author">Torsten Schmits</a><div class="metadata"><a href="#219780187" name="219780187"><div>2020-12-13 20:38:33</div></a></div><div class="text"><p>amazing. I started the same way with polysemy and there was almost no documentation around <span aria-label="sweat smile" class="emoji emoji-1f605" role="img" title="sweat smile">:sweat_smile:</span></p></div></div></div></div></div><div class="ui vertical footer segment"><a href="https://github.com/srid/zulip-archive">Powered by Haskell</a> | Questions? Contact <a href="https://www.srid.ca">srid</a></div></div></body></html>