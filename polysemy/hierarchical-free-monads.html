<html lang="en"><head><meta content="text/html; charset=utf-8" http-equiv="Content-Type"><meta content="width=device-width, initial-scale=1" name="viewport"><meta content="How does all of this relate (in terminology) to polysemy? 
https://old.reddit.com/r/haskell/comments/ggm494/hierarchical_free_monads_mostly_pointless/
Hierarchical Free Monads: Mostly PointlessPosted in r/haskell by u/effectfully • 4 points and 1 comment" name="description"><link href="https://funprog.srid.ca/polysemy/hierarchical-free-monads.html" rel="canonical"><meta property="og:title" content="Hierarchical Free Monads - Polysemy"><meta property="og:site_name" content="Functional Programming Zulip Archive"><meta property="og:type" content="article"><meta property="og:article:section" content="Polysemy"><meta property="og:article:modified_time" content="2020-05-10T08:36:52Z"><meta property="og:article:published_time" content="2020-05-09T21:19:17Z"><meta property="og:image" content="https://zulip-avatars.s3.amazonaws.com/13896/4429aa8b689608f24a4ad712843ce29862e330d2?x=x&amp;version=2"><title>Hierarchical Free Monads - Polysemy</title><style type="text/css">
div#thesite
{
  font-family   : "Open Sans", sans-serif;
  font-size     : 1em !important;
  margin-top    : 1em;
  margin-bottom : 1em;
}

div#thesite h1
{
  font-family : "Roboto", sans-serif;
  line-height : 1.19999em;
}

div#thesite h2
{
  font-family : "Roboto", sans-serif;
  line-height : 1.19999em;
}

div#thesite h3
{
  font-family : "Roboto", sans-serif;
  line-height : 1.19999em;
}

div#thesite h4
{
  font-family : "Roboto", sans-serif;
  line-height : 1.19999em;
}

div#thesite h5
{
  font-family : "Roboto", sans-serif;
  line-height : 1.19999em;
}

div#thesite h6
{
  font-family : "Roboto", sans-serif;
  line-height : 1.19999em;
}

div#thesite .ui.breadcrumb.rib .section
{
  font-family : "Roboto", sans-serif;
  line-height : 1.19999em;
}

div#thesite .header
{
  font-family : "Roboto", sans-serif;
  line-height : 1.19999em;
}

div#thesite .as-header
{
  font-family : "Roboto", sans-serif;
  line-height : 1.19999em;
}

div#thesite code, pre, tt
{
  font-family : "SFMono-Regular","Menlo","Monaco","Consolas","Liberation Mono","Courier New", monospace;
}

div#thesite .ui.breadcrumb.rib
{
  margin-bottom : 1em;
}



div#thesite .ui.comments.messages .comment .metadata a
{
  color : #808080;
}

div#thesite .ui.comments.messages .comment a.avatar img
{
  height : auto;
}

div#thesite .subtle
{
  color : #808080;
}


div#thesite .messages pre
{
  font-size : 85%;
  overflow  : auto;
  max-width : 100%;
}

div#thesite .messages .message_embed
{
  border-left  : solid 3px #808080;
  padding-left : 0.69999em;
}

div#thesite .messages .message_inline_image img
{
  max-width     : 100%;
  margin-bottom : 1em;
}


/* Generated with Clay, http://fvisser.nl/clay */</style><link href="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.4.1/semantic.min.css" rel="stylesheet"><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.min.css" rel="stylesheet"><link href="https://fonts.googleapis.com/css?family=Open+Sans|Oswald&amp;display=swap" rel="stylesheet"><link href="https://fonts.googleapis.com/css?family=Roboto|Open+Sans&amp;display=swap" rel="stylesheet"></head><body><div id="thesite" class="ui text container"><div class="ui violet inverted top attached center aligned segment"><h1 class="ui huge header">Hierarchical Free Monads - Polysemy</h1></div><div class="ui attached segment"><div class="ui message"><p>Welcome to the Functional Programming Zulip Chat Archive. You can join the chat <a href="https://funprog.zulipchat.com">here</a>.</p></div><div class="ui breadcrumb rib"><a href="/" class="section">Home</a><i class="right angle icon divider"></i><a href="/polysemy/" class="section">#Polysemy</a><i class="right angle icon divider"></i><div class="active section">Hierarchical Free Monads</div></div><div class="ui comments messages"><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/4429aa8b689608f24a4ad712843ce29862e330d2?x=x&amp;version=2"></a><div class="content"><a class="author">Sridhar Ratnakumar</a><div class="metadata"><a href="#197013491" name="197013491"><div>2020-05-09 21:19:17</div></a></div><div class="text"><p>How does all of this relate (in terminology) to polysemy? </p>
<p><a href="https://old.reddit.com/r/haskell/comments/ggm494/hierarchical_free_monads_mostly_pointless/" title="https://old.reddit.com/r/haskell/comments/ggm494/hierarchical_free_monads_mostly_pointless/">https://old.reddit.com/r/haskell/comments/ggm494/hierarchical_free_monads_mostly_pointless/</a></p>
<div class="message_embed"><a class="message_embed_image" href="https://old.reddit.com/r/haskell/comments/ggm494/hierarchical_free_monads_mostly_pointless/" style="background-image: url(https://b.thumbs.redditmedia.com/J5Gh3j5KCkMuY9SypY9Y9bfvNJ3O52i3B3LW17a9g5k.jpg)"></a><div class="data-container"><div class="message_embed_title"><a href="https://old.reddit.com/r/haskell/comments/ggm494/hierarchical_free_monads_mostly_pointless/" title="Hierarchical Free Monads: Mostly Pointless">Hierarchical Free Monads: Mostly Pointless</a></div><div class="message_embed_description">Posted in r/haskell by u/effectfully • 4 points and 1 comment</div></div></div></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/20a04d823b7c3891d78ca5f6a188ccd0e4fc5e3d?x=x&amp;version=2"></a><div class="content"><a class="author">TheMatten</a><div class="metadata"><a href="#197042203" name="197042203"><div>2020-05-10 08:36:52</div></a></div><div class="text"><p>Well, <code>polysemy</code> uses final encoding of free monad, with interface that resembles that of final tagless approach, so comparing to those approaches it's sort of hybrid:</p>
<ul>
<li>because actions are embedded into free encoding (in <code>Sem</code>) instead of directly into concrete final monad, we're free to introduce multiple interpretations of same effect without having to do "newtype wrangling" on final monad</li>
<li>because membership of effects in application code is described in constraint instead of final type, embedding of "subsystems" happens sort of "automatically" - final row just gets more constraints to satisfy</li>
</ul>
<p>That example from "The straw man argument" section would be something like:</p>
<div class="codehilite"><pre><span></span><code><span class="kr">import</span> <span class="nn">System.Random</span>

<span class="kr">import</span> <span class="nn">Polysemy</span>
<span class="kr">import</span> <span class="nn">Control.Category</span> <span class="p">((</span><span class="o">&gt;&gt;&gt;</span><span class="p">))</span>

<span class="kr">data</span> <span class="kt">LogLevel</span> <span class="ow">=</span> <span class="kt">Info</span>
<span class="kr">type</span> <span class="kt">Message</span>  <span class="ow">=</span> <span class="kt">String</span>

<span class="kr">data</span> <span class="kt">Log</span> <span class="ow">::</span> <span class="kt">Effect</span> <span class="kr">where</span>
  <span class="kt">LogMessage</span> <span class="ow">::</span> <span class="kt">LogLevel</span> <span class="ow">-&gt;</span> <span class="kt">Message</span> <span class="ow">-&gt;</span> <span class="kt">Log</span> <span class="n">m</span> <span class="nb">()</span>

<span class="nf">mkSem</span> <span class="kt">&#39;&#39;Log</span>

<span class="kr">data</span> <span class="kt">RandomInt</span> <span class="ow">::</span> <span class="kt">Effect</span> <span class="kr">where</span>
  <span class="kt">GetRandomInt</span> <span class="ow">::</span> <span class="p">(</span><span class="kt">Int</span><span class="p">,</span> <span class="kt">Int</span><span class="p">)</span> <span class="ow">-&gt;</span> <span class="kt">RandomInt</span> <span class="n">m</span> <span class="kt">Int</span>

<span class="nf">mkSem</span> <span class="kt">&#39;&#39;RandomInt</span>

<span class="kr">type</span> <span class="kt">App</span> <span class="n">r</span> <span class="ow">=</span> <span class="kt">Members</span> <span class="kt">&#39;[Log, RandomInt]</span> <span class="n">r</span>

<span class="nf">runApp</span> <span class="ow">::</span> <span class="kt">Sem</span> <span class="kt">&#39;[Log, RandomInt, Embed IO]</span> <span class="n">a</span> <span class="ow">-&gt;</span> <span class="kt">IO</span> <span class="n">a</span>
<span class="nf">runApp</span> <span class="ow">=</span> <span class="n">interpret</span> <span class="p">(</span><span class="nf">\</span><span class="p">(</span><span class="kt">LogMessage</span> <span class="kr">_</span> <span class="n">m</span><span class="p">)</span> <span class="ow">-&gt;</span> <span class="n">embed</span> <span class="o">$</span> <span class="n">putStrLn</span> <span class="n">m</span> <span class="p">)</span>
     <span class="o">&gt;&gt;&gt;</span> <span class="n">interpret</span> <span class="p">(</span><span class="nf">\</span><span class="p">(</span><span class="kt">RandomInt</span> <span class="n">r</span>   <span class="p">)</span> <span class="ow">-&gt;</span> <span class="n">embed</span> <span class="o">$</span> <span class="n">randomRIO</span> <span class="n">r</span><span class="p">)</span>
     <span class="o">&gt;&gt;&gt;</span> <span class="n">runM</span>


<span class="nf">logInfo</span> <span class="ow">::</span> <span class="kt">App</span> <span class="n">r</span> <span class="ow">=&gt;</span> <span class="kt">Message</span> <span class="ow">-&gt;</span> <span class="kt">Sem</span> <span class="n">r</span> <span class="nb">()</span>
<span class="nf">logInfo</span> <span class="ow">=</span> <span class="n">logMessage</span> <span class="kt">Info</span>

<span class="nf">printRandomFactorial</span> <span class="ow">::</span> <span class="kt">App</span> <span class="n">r</span> <span class="ow">=&gt;</span> <span class="kt">Sem</span> <span class="n">r</span> <span class="nb">()</span>
<span class="nf">printRandomFactorial</span> <span class="ow">=</span> <span class="kr">do</span>
  <span class="n">n</span> <span class="ow">&lt;-</span> <span class="n">getRandomInt</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
  <span class="n">logInfo</span> <span class="o">$</span> <span class="n">show</span> <span class="o">$</span> <span class="n">product</span> <span class="p">[</span><span class="mi">1</span><span class="o">..</span><span class="n">n</span><span class="p">]</span>
</code></pre></div>


<p>in <code>polysemy</code> (haven't typechecked though <span aria-label="big smile" class="emoji emoji-1f604" role="img" title="big smile">:big_smile:</span>)</p></div></div></div></div></div><div class="ui vertical footer segment"><a href="https://github.com/srid/zulip-archive">Powered by Haskell</a> | Questions? Contact <a href="https://www.srid.ca">srid</a></div></div></body></html>