<html lang="en"><head><meta content="text/html; charset=utf-8" http-equiv="Content-Type"><meta content="width=device-width, initial-scale=1" name="viewport"><meta content="@Love Waern (King of the Homeless) @Georgi Lyubenov // googleson78 We should talk a little bit about polysemy&#39;s roadmap - there&#39;re a few things that I think would be worth sorting out. My thoughs:


performance - 8.10 is slowly approaching and with it&#39;s release we would probably expect polysemy to f" name="description"><link href="https://funprog.srid.ca/polysemy/roadmap.html" rel="canonical"><meta property="og:title" content="Roadmap - Polysemy"><meta property="og:site_name" content="Functional Programming Zulip Archive"><meta property="og:type" content="article"><meta property="og:article:section" content="Polysemy"><meta property="og:article:modified_time" content="2020-07-29T19:29:39Z"><meta property="og:article:published_time" content="2020-01-15T10:01:46Z"><meta property="og:image" content="https://zulip-avatars.s3.amazonaws.com/13896/20a04d823b7c3891d78ca5f6a188ccd0e4fc5e3d?x=x&amp;version=2"><title>Roadmap - Polysemy</title><style type="text/css">
div#thesite
{
  font-family   : "Open Sans", sans-serif;
  font-size     : 1em !important;
  margin-top    : 1em;
  margin-bottom : 1em;
}

div#thesite h1
{
  font-family : "Roboto", sans-serif;
  line-height : 1.19999em;
}

div#thesite h2
{
  font-family : "Roboto", sans-serif;
  line-height : 1.19999em;
}

div#thesite h3
{
  font-family : "Roboto", sans-serif;
  line-height : 1.19999em;
}

div#thesite h4
{
  font-family : "Roboto", sans-serif;
  line-height : 1.19999em;
}

div#thesite h5
{
  font-family : "Roboto", sans-serif;
  line-height : 1.19999em;
}

div#thesite h6
{
  font-family : "Roboto", sans-serif;
  line-height : 1.19999em;
}

div#thesite .ui.breadcrumb.rib .section
{
  font-family : "Roboto", sans-serif;
  line-height : 1.19999em;
}

div#thesite .header
{
  font-family : "Roboto", sans-serif;
  line-height : 1.19999em;
}

div#thesite .as-header
{
  font-family : "Roboto", sans-serif;
  line-height : 1.19999em;
}

div#thesite code, pre, tt
{
  font-family : "SFMono-Regular","Menlo","Monaco","Consolas","Liberation Mono","Courier New", monospace;
}

div#thesite .ui.breadcrumb.rib
{
  margin-bottom : 1em;
}



div#thesite .ui.comments.messages .comment .metadata a
{
  color : #808080;
}

div#thesite .ui.comments.messages .comment a.avatar img
{
  height : auto;
}

div#thesite .subtle
{
  color : #808080;
}


div#thesite .messages pre
{
  font-size : 85%;
  overflow  : auto;
  max-width : 100%;
}

div#thesite .messages .message_embed
{
  border-left  : solid 3px #808080;
  padding-left : 0.69999em;
}

div#thesite .messages .message_inline_image img
{
  max-width     : 100%;
  margin-bottom : 1em;
}


/* Generated with Clay, http://fvisser.nl/clay */</style><link href="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.4.1/semantic.min.css" rel="stylesheet"><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.min.css" rel="stylesheet"><link href="https://fonts.googleapis.com/css?family=Open+Sans|Oswald&amp;display=swap" rel="stylesheet"><link href="https://fonts.googleapis.com/css?family=Roboto|Open+Sans&amp;display=swap" rel="stylesheet"></head><body><div id="thesite" class="ui text container"><div class="ui violet inverted top attached center aligned segment"><h1 class="ui huge header">Roadmap - Polysemy</h1></div><div class="ui attached segment"><div class="ui message"><p>Welcome to the Functional Programming Zulip Chat Archive. You can join the chat <a href="https://funprog.zulipchat.com">here</a>.</p></div><div class="ui breadcrumb rib"><a href="/" class="section">Home</a><i class="right angle icon divider"></i><a href="/polysemy/" class="section">#Polysemy</a><i class="right angle icon divider"></i><div class="active section">Roadmap</div></div><div class="ui comments messages"><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/20a04d823b7c3891d78ca5f6a188ccd0e4fc5e3d?x=x&amp;version=2"></a><div class="content"><a class="author">TheMatten</a><div class="metadata"><a href="#185683601" name="185683601"><div>2020-01-15 10:01:46</div></a></div><div class="text"><p><span class="user-mention" data-user-id="254034">@Love Waern (King of the Homeless)</span> <span class="user-mention" data-user-id="254032">@Georgi Lyubenov // googleson78</span> We should talk a little bit about <code>polysemy</code>'s roadmap - there're a few things that I think would be worth sorting out. My thoughs:</p>
<hr>
<ul>
<li>performance - 8.10 is slowly approaching and with it's release we would probably expect <code>polysemy</code> to fulfil expectations that Sandy set in our README - that means we want to make sure we thoroughly test it's behaviour in both microbenchmarks and more real-world-like examples. Plus, I guess it could be helpful to coordinate forces with Alexis - her work on <code>eff</code> could help us point out flaws in our own system.</li>
</ul>
<hr>
<ul>
<li>fake fundeps - I think it would be good idea to investigate possibility of splitting plugin from the library - currently it's strongly tied to internal machinery, even though the concept could potentially work for any type of constraints and could be useful for other libraries. Plus, building some exact model around how it should work would possibly help us make sure that it's actually sound and safe - typechecker plugins are moving on very thin ice by being able to prove whatever bogus constraint they want.</li>
</ul>
<hr>
<ul>
<li>named effects - We should investigate problems related with having multiple effects of same type in stack - is the type of effect it's key identifier or should we move towards model based on named effects to avoid ambiguity? Can row polymorphism help us? Or we want to get aggressive at <code>newtype</code>-ing?</li>
</ul>
<hr>
<ul>
<li>tactics - Last year during Sandy's visit to Bratislava we sat down and discussed implementation of <code>Weaving</code> to make sure I have good idea about how it behaves - but even after building my own toy version of <code>polysemy</code>, I'm not sure if I can hold reasonable model of it's behaviour in my head in real world scenarios. Problem is, while users don't have to interact with internals directly, they tend to return back to us with all sorts of questions and issues related to tactics/strategies, simply because why they can write higher-order interpretations that typecheck, they can't reason about heir behaviour efficiently. I remember that at some point, Sandy himself considered idea of <code>Sem</code> fixed in <code>IO</code> as final effect, simply to make reasoning about library's behaviour easier. What are your thoughts on this?</li>
</ul>
<hr>
<p>This is obviously my point of view and I may be missing something - what do you think?</p></div></div></div><div class="comment"><a class="avatar"><img src="https://secure.gravatar.com/avatar/1114fd8de67671f83d3a3ef7594b1950?d=identicon&amp;version=1"></a><div class="content"><a class="author">Georgi Lyubenov // googleson78</a><div class="metadata"><a href="#185740651" name="185740651"><div>2020-01-15 20:29:54</div></a></div><div class="text"><p>re: named effects, what is your opinion on tagged, it seems to be very related? I haven't tried it out in practice.<br>
I think tactics/strategy stuff could use a lot of examples with comments/explanations, and if/when I get a grasp of what's going on there I would sit down to write some, but that is unfortunately not the case right now</p>
<p>There are also some "hanging" prs that seem to have been put on hold? Particularly <a href="https://github.com/polysemy-research/polysemy/pull/239" target="_blank" title="https://github.com/polysemy-research/polysemy/pull/239">239</a> and <a href="https://github.com/polysemy-research/polysemy/pull/242" target="_blank" title="https://github.com/polysemy-research/polysemy/pull/242">242</a> seem of interest</p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/polysemy-research/polysemy/pull/239" style="background-image: url(https://avatars1.githubusercontent.com/u/52079915?s=400&amp;v=4)" target="_blank"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/polysemy-research/polysemy/pull/239" target="_blank" title="No more strategy by isovector · Pull Request #239 · polysemy-research/polysemy">No more strategy by isovector · Pull Request #239 · polysemy-research/polysemy</a></div><div class="message_embed_description">@TheMatten and I are hanging out this weekend and cleaning up things. This PR gets rid of Strategy as a unique concept, though doesn't clean up the *S functions.</div></div></div><div class="message_embed"><a class="message_embed_image" href="https://github.com/polysemy-research/polysemy/pull/242" style="background-image: url(https://avatars1.githubusercontent.com/u/52079915?s=400&amp;v=4)" target="_blank"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/polysemy-research/polysemy/pull/242" target="_blank" title="Delete deprecated by isovector · Pull Request #242 · polysemy-research/polysemy">Delete deprecated by isovector · Pull Request #242 · polysemy-research/polysemy</a></div><div class="message_embed_description">fuck deprecated code!!</div></div></div></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/20a04d823b7c3891d78ca5f6a188ccd0e4fc5e3d?x=x&amp;version=2"></a><div class="content"><a class="author">TheMatten</a><div class="metadata"><a href="#185744321" name="185744321"><div>2020-01-15 21:09:10</div></a></div><div class="text"><p><span class="user-mention" data-user-id="254032">@Georgi Lyubenov // googleson78</span> I've mixed feelings about using <code>Symbol</code>s (~ <code>String</code>s) for choosing effects - if they're worth a name, shouldn't that be real identifier instead of a string? I mean, if two module define <code>Tagged "counter" (State Int)</code>, I doubt they're going to mean the same thing - but compiler will treat them the same...</p>
<p>In general, we give values names, because real types usually have multiple inhabitants - isn't it the same with effects? The fact that some two effects have the same type does not imply they are the same - need for <code>Tagged</code> basically points that out.</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/20a04d823b7c3891d78ca5f6a188ccd0e4fc5e3d?x=x&amp;version=2"></a><div class="content"><a class="author">TheMatten</a><div class="metadata"><a href="#185744723" name="185744723"><div>2020-01-15 21:12:35</div></a></div><div class="text"><p>What I imagine is model where omitting effect's identifier in signature means "I work over arbitrary effect of such type" - that's the case of common combinators. And in user code, identifiers that tell me "this is the state that counts team members", "this is the reader that keeps fallback config".</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/20a04d823b7c3891d78ca5f6a188ccd0e4fc5e3d?x=x&amp;version=2"></a><div class="content"><a class="author">TheMatten</a><div class="metadata"><a href="#185744794" name="185744794"><div>2020-01-15 21:13:28</div></a></div><div class="text"><p>Without identifier, we could do fake fundeps - if we fail, we ask for it.</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/f1ec33bcc6144366b30e479d6b3bed74cdb9f611?x=x&amp;version=4"></a><div class="content"><a class="author">Love Waern (King of the Homeless)</a><div class="metadata"><a href="#185759629" name="185759629"><div>2020-01-16 00:36:46</div></a></div><div class="text"><ul>
<li>Performance - I definitely agree. This is one of my weak spots, both preparing a benchmarking environment, doing proper benchmarks, and analyzing core.</li>
<li>It would be difficult to split the plugin from the library seeing how the plugin needs some kind of idea of what constraints it should focus on. Regarding the safety; from what I understood, what the fundep library does is generate additional type equality constraints which provides enough information for the type-checker to eliminate ambiguities and resolve type-checking. Does it actually generate bogus proofs?</li>
<li>Multiple completely identical effects can definitely be part of the same effect stack, and the type of the effect is not its key identifier. The way ambiguities are resolved is that<code>Member</code> targets the first instance of the named effect in the effect stack, which usually results in the behaviour you'd want. The effects in <code>polysemy</code> are mostly intended as primitives, of which you can reinterpret other effects to, or build newtypes upon; so named effects are already (mostly) the way to go the way to go for more intricate applications.. I'd favour effect newtypes/reinterpretation rather than <code>Tagged</code> here.</li>
<li>I feel that the confusion about tactics can be resolved through good documentation and a tutorial. I can help a lot with this. Regarding <code>Sem</code> fixed in <code>IO</code>: that would be very sad, because we'd lose a big chunk of the testing/mocking story. Despite how much I rag on the <code>weave</code> abstraction, it works well enough for most purposes, and once we document tactics well enough, it will become sufficiently usable.<br>
<strong>Edit</strong>: missed the semantic behaviour part of your comment. Yeah, this is where the use of the <code>weave</code> abstraction hurts -- it can get really damn stupid and confusing -- and there's no way to fix this without shifting abstractions (which I'm hesitant towards unless we can find a drop-in replacement that is pretty much strictly better), or documenting the hell out of it. And since <code>weave</code> is so confusing, the documentation will be hard to write.</li>
</ul>
<p>I'd also like to add the additional point:</p>
<ul>
<li>Documentation. There's a lot of documentation work I want to get done, especially making it clear how tactics work. This includes tutorials. <a href="https://github.com/polysemy-research/polysemy/issues/232" target="_blank" title="https://github.com/polysemy-research/polysemy/issues/232">232</a> and <a href="https://github.com/polysemy-research/polysemy/issues/234" target="_blank" title="https://github.com/polysemy-research/polysemy/issues/234">234</a> are the main issues here (but there are other marked as <code>better-docs</code>).</li>
</ul>
<p>My thoughts was that the <code>Strategy</code> rework, deletion of deprecated code, documentation, and potentially even 8.10-oriented optimizations would all be released as part of v2.0. I can compile what we said here into a check-list issue for v2.0 on Friday - if there's anything (small or big) that we haven't mentioned already, toss it here.</p>
<p>Thoughts?</p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/polysemy-research/polysemy/issues/232" style="background-image: url(https://avatars1.githubusercontent.com/u/52079915?s=400&amp;v=4)" target="_blank"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/polysemy-research/polysemy/issues/232" target="_blank" title="Advanced guide / in-depth documentation and explanation · Issue #232 · polysemy-research/polysemy">Advanced guide / in-depth documentation and explanation · Issue #232 · polysemy-research/polysemy</a></div><div class="message_embed_description">From a recent discussion on reddit, it&#39;s clear we need some way to provide a better understanding of the architecture of the library. Here are some points I can think of: What Tactics/Strategy ...</div></div></div><div class="message_embed"><a class="message_embed_image" href="https://github.com/polysemy-research/polysemy/issues/234" style="background-image: url(https://avatars1.githubusercontent.com/u/52079915?s=400&amp;v=4)" target="_blank"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/polysemy-research/polysemy/issues/234" target="_blank" title="More noob-friendly documentation · Issue #234 · polysemy-research/polysemy">More noob-friendly documentation · Issue #234 · polysemy-research/polysemy</a></div><div class="message_embed_description">In the same spirit as #232 but for the other side of the spectrum: I feel like the documentation (particularly the main readme displayed on Hackage/Stackage, but also in each module doc) could be i...</div></div></div></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/20a04d823b7c3891d78ca5f6a188ccd0e4fc5e3d?x=x&amp;version=2"></a><div class="content"><a class="author">TheMatten</a><div class="metadata"><a href="#185799971" name="185799971"><div>2020-01-16 10:00:22</div></a></div><div class="text"><p><span class="user-mention" data-user-id="254034">@Love Waern (King of the Homeless)</span></p>
<ul>
<li>It seems to me that the idea of plugin is basically "functional dependency that get's dropped if it isn't satisfied" - <code>polysemy-plugin</code> does some other things too I think, but if they're domain-specific, they could just stay where they are. The thing is, I can imagine this plugin being helpful for something like <code>eff</code> or <code>mtl</code>-wthout-fundeps, or even something like implicit arguments or field access - I hope that if we split it, we can possibly attract more contributors into it, simply because they find it useful in their own libraries - And we'll be able to reason about it separately. When it comes to safety, It already blow up a few times in type-incorrect code for me - it's not that bad, because I still get other errors and it seems to be fine once I resolve them, but this is something that will need to be investigated and something that's harder to test being limited just to <code>Member</code> machinery.</li>
<li>Yeah, my question basically boils down to "identifiers or <code>newtypes</code> for giving concrete meaning to effect?"</li>
<li>Yeah, it's the <code>weave</code> I find problematic here. Some time ago, based on thoughts around fixed result, I've created this sort of "compiler"-style prototype, that treat's set of effects as "high-level language" that can be "compiled" into "low-level" monad/stack - this implementation is basically <code>Reader</code> of interpretations over final monad. Such model seems strictly less expressive  - you can't "pop" effects from the stack, but they should be arbitrarily "mixable and split-able", with unlifting being pretty easy and completely general: <a href="https://gitlab.com/snippets/1903905" target="_blank" title="https://gitlab.com/snippets/1903905">https://gitlab.com/snippets/1903905</a></li>
<li>That would be really cool! <span aria-label="slight smile" class="emoji emoji-1f642" role="img" title="slight smile">:slight_smile:</span></li>
<li>2.0 is a big version bump - If we have some breaking changes to make, they should probably be part of it</li>
</ul>
<div class="message_embed"><a class="message_embed_image" href="https://gitlab.com/snippets/1903905" style="background-image: url(https://assets.gitlab-static.net/assets/gitlab_logo-7ae504fe4f68fdebb3c2034e36621930cd36ea87924c11ff65dbcb8ed50dca58.png)" target="_blank"></a><div class="data-container"><div class="message_embed_title"><a href="https://gitlab.com/snippets/1903905" target="_blank" title="Effects transformer (or algebraic effects with fixed target monad) ($1903905) · Snippets">Effects transformer (or algebraic effects with fixed target monad) ($1903905) · Snippets</a></div><div class="message_embed_description">GitLab.com</div></div></div></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/f1ec33bcc6144366b30e479d6b3bed74cdb9f611?x=x&amp;version=4"></a><div class="content"><a class="author">Love Waern (King of the Homeless)</a><div class="metadata"><a href="#185967351" name="185967351"><div>2020-01-17 23:21:39</div></a></div><div class="text"><p>The check-list is gonna be delayed a day, am busy today</p></div></div></div><div class="comment"><a class="avatar"><img src="https://secure.gravatar.com/avatar/3d24a4100b3eab34d8ce3059d789c543?d=identicon&amp;version=1"></a><div class="content"><a class="author">Sandy Maguire</a><div class="metadata"><a href="#185991197" name="185991197"><div>2020-01-18 11:19:28</div></a></div><div class="text"><p>hi</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/f1ec33bcc6144366b30e479d6b3bed74cdb9f611?x=x&amp;version=4"></a><div class="content"><a class="author">Love Waern (King of the Homeless)</a><div class="metadata"><a href="#186007989" name="186007989"><div>2020-01-18 19:11:27</div></a></div><div class="text"><p><span class="user-mention" data-user-id="225127">@TheMatten</span> I'd like to talk more about named effects because I don't feel I understand what the issue is about. Is it about what philosophy we should promote when it comes to user-defined effects? Like, the question if they should use out-of-the-box effects like <code>State</code>, with newtyped type parameters, or if they should<code>newtype</code> the effect itself, or create a completely new effect which is then reinterpreted to <code>State</code>, or if they should use <code>Tagged</code>?</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/f1ec33bcc6144366b30e479d6b3bed74cdb9f611?x=x&amp;version=4"></a><div class="content"><a class="author">Love Waern (King of the Homeless)</a><div class="metadata"><a href="#186008043" name="186008043"><div>2020-01-18 19:12:16</div></a></div><div class="text"><p>What do you mean by "identifiers"?</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/20a04d823b7c3891d78ca5f6a188ccd0e4fc5e3d?x=x&amp;version=2"></a><div class="content"><a class="author">TheMatten</a><div class="metadata"><a href="#186008604" name="186008604"><div>2020-01-18 19:28:15</div></a></div><div class="text"><p><span class="user-mention" data-user-id="254034">@Love Waern (King of the Homeless)</span> At value level, we have values that have types:</p>
<div class="codehilite"><pre><span></span><span class="nf">foo</span> <span class="ow">::</span> <span class="kt">Bar</span>
<span class="nf">foo</span> <span class="ow">=</span> <span class="o">...</span>
</pre></div>


<p>When we want to use some specific value, we name it by it's identifier - simply because most types aren't singletons and so they values may differ.<br>
One could get rid of using identifiers by using <code>newtype</code>s that determine concrete values - you could e.g. define:</p>
<div class="codehilite"><pre><span></span><span class="kr">class</span> <span class="kt">Value</span> <span class="n">t</span> <span class="kr">where</span>
  <span class="n">value</span> <span class="ow">::</span> <span class="n">t</span>

<span class="kr">newtype</span> <span class="kt">FortyTwo</span> <span class="ow">=</span> <span class="kt">FortyTwo</span> <span class="kt">Int</span>

<span class="kr">instance</span> <span class="kt">Value</span> <span class="kt">FortyTwo</span> <span class="kr">where</span>
  <span class="n">value</span> <span class="ow">=</span> <span class="kt">FortyTwo</span> <span class="mi">42</span>

<span class="kr">newtype</span> <span class="kt">HelloWorld</span> <span class="ow">=</span> <span class="kt">HelloWorld</span> <span class="kt">String</span>

<span class="kr">instance</span> <span class="kt">Value</span> <span class="kt">HelloWorld</span> <span class="kr">where</span>
  <span class="n">value</span> <span class="ow">=</span> <span class="kt">HelloWorld</span> <span class="s">&quot;Hello world!&quot;</span>
</pre></div>


<p>This sounds completely ridiculous, right?</p>
<p>But question is, how does it differ from what we do with effects? What if treat effect in row as a value containing some group of actions to be executed, where I can use interpreter to merge that value into other effects, like when you e.g. remove duplicates from the list. What if we instead saw concrete effects in row as values identified by type variables? So instead of:</p>
<div class="codehilite"><pre><span></span><span class="kr">data</span> <span class="kt">PlayerCount</span> <span class="n">m</span> <span class="n">a</span> <span class="kr">where</span> <span class="o">..</span>

<span class="c1">-- stuff around interpreting it to primitive effect, e.g. State Int</span>

<span class="nf">foo</span> <span class="ow">::</span> <span class="kt">Members</span> <span class="kt">&#39;[PlayerCount]</span> <span class="n">r</span> <span class="ow">=&gt;</span> <span class="o">...</span>
</pre></div>


<p>we would have:</p>
<div class="codehilite"><pre><span></span><span class="nf">foo</span> <span class="ow">::</span> <span class="kt">Members</span> <span class="p">{</span> <span class="n">playerCount</span> <span class="ow">::</span> <span class="kt">State</span> <span class="kt">Int</span> <span class="p">}</span> <span class="n">r</span> <span class="ow">=&gt;</span> <span class="o">...</span>
</pre></div>


<p>because <code>PlayerCount</code> is actually <code>State Int</code> in same way as <code>42</code> is an <code>Int</code>.</p>
<p>Of course, you may encounter effects where concrete representation is internal information - but's already something we experience with <code>newtype</code>d values, e.g. when I have <code>Username</code> represented as <code>Text</code> hidden under <code>newtype</code>. In same way, we would use <code>newtype</code>s to say "I hold some concrete invariants additionally to the actual representation". While in case of <code>playerCount</code>, we're simply talking about mutable <code>Int</code>, with nothing else to hide or capture.</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/20a04d823b7c3891d78ca5f6a188ccd0e4fc5e3d?x=x&amp;version=2"></a><div class="content"><a class="author">TheMatten</a><div class="metadata"><a href="#186008681" name="186008681"><div>2020-01-18 19:30:35</div></a></div><div class="text"><p>Then, anonymous effects would be the same situation as e.g. use of currying:</p>
<div class="codehilite"><pre><span></span><span class="nf">showText</span> <span class="ow">::</span> <span class="kt">Show</span> <span class="n">a</span> <span class="ow">=&gt;</span> <span class="n">a</span> <span class="ow">-&gt;</span> <span class="kt">Text</span>
<span class="nf">showText</span> <span class="ow">=</span> <span class="kt">T</span><span class="o">.</span><span class="n">pack</span> <span class="o">.</span> <span class="n">show</span>
</pre></div>


<p>has argument, but it's not worth naming - we know it's the one passed to expression inside</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/20a04d823b7c3891d78ca5f6a188ccd0e4fc5e3d?x=x&amp;version=2"></a><div class="content"><a class="author">TheMatten</a><div class="metadata"><a href="#186008700" name="186008700"><div>2020-01-18 19:31:49</div></a></div><div class="text"><p>in same way, <code>State a</code> in:</p>
<div class="codehilite"><pre><span></span><span class="nf">get</span> <span class="ow">::</span> <span class="kt">Member</span> <span class="p">{</span> <span class="kr">_</span> <span class="ow">::</span> <span class="kt">State</span> <span class="n">a</span> <span class="p">}</span> <span class="n">r</span> <span class="ow">=&gt;</span> <span class="kt">Sem</span> <span class="n">r</span> <span class="n">a</span>
</pre></div>


<p>is not worth naming - there's just one we can talk about</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/20a04d823b7c3891d78ca5f6a188ccd0e4fc5e3d?x=x&amp;version=2"></a><div class="content"><a class="author">TheMatten</a><div class="metadata"><a href="#186008762" name="186008762"><div>2020-01-18 19:33:43</div></a></div><div class="text"><p>This would allow us to avoid <code>coerce</code>-ing when we simply want to manipulate properties of effect's representation, in cases where we actually aren't interested in hiding it - where it's type actually describes it's meaning, with identifier specifying concrete group of actions it belongs to</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/f1ec33bcc6144366b30e479d6b3bed74cdb9f611?x=x&amp;version=4"></a><div class="content"><a class="author">Love Waern (King of the Homeless)</a><div class="metadata"><a href="#186009266" name="186009266"><div>2020-01-18 19:48:12</div></a></div><div class="text"><p>Ok, I think I maybe get it. But can't you do all of this using <code>Tagged</code>? Modolu <code>coerce</code>, of course, and we can't really avoid having to un/wrap newtypes without proper row polymorphism.</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/f1ec33bcc6144366b30e479d6b3bed74cdb9f611?x=x&amp;version=4"></a><div class="content"><a class="author">Love Waern (King of the Homeless)</a><div class="metadata"><a href="#186009346" name="186009346"><div>2020-01-18 19:51:09</div></a></div><div class="text"><p>Or perhaps a variant of <code>Member</code> that accepts an identifier parameter... hm. But that would require changing the representation of the effect stack so that each effect is associated with an identifier, so effects can be targeted, which just invites confusion when the identifier doesn't matter. Feels like having <code>Tagged</code> is preferable to doing that, so that identifiers are opt-in.</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/f1ec33bcc6144366b30e479d6b3bed74cdb9f611?x=x&amp;version=4"></a><div class="content"><a class="author">Love Waern (King of the Homeless)</a><div class="metadata"><a href="#186009357" name="186009357"><div>2020-01-18 19:51:48</div></a></div><div class="text"><p>I don't know, but it does warrant discussion, and now I get what it's about. Thanks.</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/20a04d823b7c3891d78ca5f6a188ccd0e4fc5e3d?x=x&amp;version=2"></a><div class="content"><a class="author">TheMatten</a><div class="metadata"><a href="#186009412" name="186009412"><div>2020-01-18 19:53:05</div></a></div><div class="text"><p>When it comes to row polymorphism... (Disclaimer: I don't want to do anything of this right now, I'm just thinking about future possibilites <span aria-label="big smile" class="emoji emoji-1f604" role="img" title="big smile">:big_smile:</span>):</p>
<ul>
<li>we could do custom-operator-to-construct-field-in-list-thing and implement it in terms of type-level programming or plugin</li>
<li>we could actually get <code>{ a :: B, c :: D }</code> syntax in <em>current</em> Haskell, with a plugin - fact is that GHC parser parses rows just fine, it just throws error during later stages - we can transform them into our representation before that happens</li>
</ul></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/20a04d823b7c3891d78ca5f6a188ccd0e4fc5e3d?x=x&amp;version=2"></a><div class="content"><a class="author">TheMatten</a><div class="metadata"><a href="#186009477" name="186009477"><div>2020-01-18 19:54:34</div></a></div><div class="text"><p>Yeah, it's probably not reasonable to do that now - but I would like to think about way we want to move in the future</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/20a04d823b7c3891d78ca5f6a188ccd0e4fc5e3d?x=x&amp;version=2"></a><div class="content"><a class="author">TheMatten</a><div class="metadata"><a href="#186009609" name="186009609"><div>2020-01-18 19:58:43</div></a></div><div class="text"><p>I'm still scared of ambiguity of <code>Tagged</code> strings, and coercing just doesn't look right - there are actually two ways of understanding identifiers:</p>
<ul>
<li>they're sort of "named constraints", where names apply in current definition as with function arguments</li>
<li>they're defined at top level, can be imported/exported</li>
</ul>
<p>That's basically "safe <code>Tagged</code> vs <code>newtype</code>"</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/20a04d823b7c3891d78ca5f6a188ccd0e4fc5e3d?x=x&amp;version=2"></a><div class="content"><a class="author">TheMatten</a><div class="metadata"><a href="#186009629" name="186009629"><div>2020-01-18 19:59:48</div></a></div><div class="text"><p>except it behaves differently in cases I mentioned above</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/f1ec33bcc6144366b30e479d6b3bed74cdb9f611?x=x&amp;version=4"></a><div class="content"><a class="author">Love Waern (King of the Homeless)</a><div class="metadata"><a href="#186009775" name="186009775"><div>2020-01-18 20:03:25</div></a></div><div class="text"><p>Wait, won't identifier names be just as ambiguous as using <code>Tagged</code> with strings as the phantom type parameter? Or do you mean type ambiguity? What makes <code>Tagged</code> (potentially) unsafe?</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/20a04d823b7c3891d78ca5f6a188ccd0e4fc5e3d?x=x&amp;version=2"></a><div class="content"><a class="author">TheMatten</a><div class="metadata"><a href="#186009981" name="186009981"><div>2020-01-18 20:09:44</div></a></div><div class="text"><p>Let's say I have:</p>
<div class="codehilite"><pre><span></span><span class="kr">module</span> <span class="nn">A</span> <span class="kr">where</span>
  <span class="n">foo</span> <span class="ow">::</span> <span class="kt">Member</span> <span class="p">(</span><span class="kt">Tagged</span> <span class="s">&quot;log&quot;</span> <span class="p">(</span><span class="kt">Output</span> <span class="kt">String</span><span class="p">))</span> <span class="n">r</span> <span class="ow">=&gt;</span> <span class="kr">_</span>

<span class="kr">module</span> <span class="nn">B</span> <span class="kr">where</span>
  <span class="n">bar</span> <span class="ow">::</span> <span class="kt">Member</span> <span class="p">(</span><span class="kt">Tagged</span> <span class="s">&quot;log&quot;</span> <span class="p">(</span><span class="kt">Output</span> <span class="kt">String</span><span class="p">))</span> <span class="n">r</span> <span class="ow">=&gt;</span> <span class="kr">_</span>
</pre></div>


<p>In some other part of code, I use them together, but forget to point them into corresponding "foo log" and "bar log", having <code>Tagged "log" _</code> in scope again, because I find it to be a useful pattern for some terrible reason:</p>
<div class="codehilite"><pre><span></span><span class="kr">do</span>
  <span class="o">..</span>
  <span class="n">foo</span> <span class="kr">_</span>
  <span class="n">bar</span> <span class="kr">_</span>
  <span class="o">..</span>
</pre></div>


<p>It happily typechecks - with local model, it would ask "which one is <code>log</code>?", with global it would ask "where is my <code>A.log</code> and <code>B.log</code>?"</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/f1ec33bcc6144366b30e479d6b3bed74cdb9f611?x=x&amp;version=4"></a><div class="content"><a class="author">Love Waern (King of the Homeless)</a><div class="metadata"><a href="#186010021" name="186010021"><div>2020-01-18 20:10:04</div></a></div><div class="text"><p>Gotcha.</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/20a04d823b7c3891d78ca5f6a188ccd0e4fc5e3d?x=x&amp;version=2"></a><div class="content"><a class="author">TheMatten</a><div class="metadata"><a href="#186010034" name="186010034"><div>2020-01-18 20:10:24</div></a></div><div class="text"><p>It's obviously a contrived example - but this "What if?" makes me stay awake at night <span aria-label="slight smile" class="emoji emoji-1f642" role="img" title="slight smile">:slight_smile:</span></p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/f1ec33bcc6144366b30e479d6b3bed74cdb9f611?x=x&amp;version=4"></a><div class="content"><a class="author">Love Waern (King of the Homeless)</a><div class="metadata"><a href="#186010085" name="186010085"><div>2020-01-18 20:12:16</div></a></div><div class="text"><p>Usually it won't be an issue, seeing how named effects are usually only relevant within the scope of a single application - in which case it would be easy to stay consistent. But nevertheless, it is an issue.</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/20a04d823b7c3891d78ca5f6a188ccd0e4fc5e3d?x=x&amp;version=2"></a><div class="content"><a class="author">TheMatten</a><div class="metadata"><a href="#186010091" name="186010091"><div>2020-01-18 20:13:00</div></a></div><div class="text"><p>I'm worried about possibility of issues popping up - it will be too late if we find out that common uses of <code>Tagged</code> trigger this problem</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/f1ec33bcc6144366b30e479d6b3bed74cdb9f611?x=x&amp;version=4"></a><div class="content"><a class="author">Love Waern (King of the Homeless)</a><div class="metadata"><a href="#186010102" name="186010102"><div>2020-01-18 20:13:38</div></a></div><div class="text"><p>Yeah.</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/20a04d823b7c3891d78ca5f6a188ccd0e4fc5e3d?x=x&amp;version=2"></a><div class="content"><a class="author">TheMatten</a><div class="metadata"><a href="#186010103" name="186010103"><div>2020-01-18 20:13:45</div></a></div><div class="text"><p>They may not, they may though - and then such model would be at least a little bit more ergonomic</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/f1ec33bcc6144366b30e479d6b3bed74cdb9f611?x=x&amp;version=4"></a><div class="content"><a class="author">Love Waern (King of the Homeless)</a><div class="metadata"><a href="#186010144" name="186010144"><div>2020-01-18 20:14:05</div></a></div><div class="text"><p>How the hell would we solve it though? Wouldn't we have the same problem even with row polymorphism?</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/f1ec33bcc6144366b30e479d6b3bed74cdb9f611?x=x&amp;version=4"></a><div class="content"><a class="author">Love Waern (King of the Homeless)</a><div class="metadata"><a href="#186010150" name="186010150"><div>2020-01-18 20:14:45</div></a></div><div class="text"><p>We'd need a system to have module-local type identifiers</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/20a04d823b7c3891d78ca5f6a188ccd0e4fc5e3d?x=x&amp;version=2"></a><div class="content"><a class="author">TheMatten</a><div class="metadata"><a href="#186010160" name="186010160"><div>2020-01-18 20:15:08</div></a></div><div class="text"><p>I guess I don't want typical row polymorphism - I just want it's syntax, but with different meaning of field names</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/f1ec33bcc6144366b30e479d6b3bed74cdb9f611?x=x&amp;version=4"></a><div class="content"><a class="author">Love Waern (King of the Homeless)</a><div class="metadata"><a href="#186010166" name="186010166"><div>2020-01-18 20:15:48</div></a></div><div class="text"><p>Is the API for GHC plugins powerful enough to add type identifiers to the type system?</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/f1ec33bcc6144366b30e479d6b3bed74cdb9f611?x=x&amp;version=4"></a><div class="content"><a class="author">Love Waern (King of the Homeless)</a><div class="metadata"><a href="#186010214" name="186010214"><div>2020-01-18 20:16:49</div></a></div><div class="text"><p>If you can say off-hand - you have more experience with it than I have.</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/20a04d823b7c3891d78ca5f6a188ccd0e4fc5e3d?x=x&amp;version=2"></a><div class="content"><a class="author">TheMatten</a><div class="metadata"><a href="#186010227" name="186010227"><div>2020-01-18 20:17:49</div></a></div><div class="text"><p><span class="user-mention" data-user-id="254034">@Love Waern (King of the Homeless)</span> GHC plugins are like "I let you run at the end of my pass, do whatever you want, but be nice please <span aria-label="joy" class="emoji emoji-1f602" role="img" title="joy">:joy:</span>" - You have access to basically <em>everything</em>, including AST and uniques generator we need</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/f1ec33bcc6144366b30e479d6b3bed74cdb9f611?x=x&amp;version=4"></a><div class="content"><a class="author">Love Waern (King of the Homeless)</a><div class="metadata"><a href="#186010271" name="186010271"><div>2020-01-18 20:18:38</div></a></div><div class="text"><p>Neat!</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/20a04d823b7c3891d78ca5f6a188ccd0e4fc5e3d?x=x&amp;version=2"></a><div class="content"><a class="author">TheMatten</a><div class="metadata"><a href="#186010288" name="186010288"><div>2020-01-18 20:19:24</div></a></div><div class="text"><p>Though, we may need some tricks to make output on <code>:t</code>/<code>:i</code> look nice - plus, parser plugins don't work yet in ghci - if we don't mind making <code>QuasiQuoter</code> for that for now, it wouldn't be that big of problem though</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/f1ec33bcc6144366b30e479d6b3bed74cdb9f611?x=x&amp;version=4"></a><div class="content"><a class="author">Love Waern (King of the Homeless)</a><div class="metadata"><a href="#186010287" name="186010287"><div>2020-01-18 20:19:24</div></a></div><div class="text"><p>Ok, now I'll just try to find a way to summarize this discussion and put it on the roadmap.</p></div></div></div><div class="comment"><a class="avatar"><img src="https://secure.gravatar.com/avatar/1114fd8de67671f83d3a3ef7594b1950?d=identicon&amp;version=1"></a><div class="content"><a class="author">Georgi Lyubenov // googleson78</a><div class="metadata"><a href="#186010297" name="186010297"><div>2020-01-18 20:19:54</div></a></div><div class="text"><p>isn't this a problem of the user? or rather if he wants to avoid having "stringly-typed" effects, he can just use an empty datatype (which is internal to the module) for the tag?</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/20a04d823b7c3891d78ca5f6a188ccd0e4fc5e3d?x=x&amp;version=2"></a><div class="content"><a class="author">TheMatten</a><div class="metadata"><a href="#186010402" name="186010402"><div>2020-01-18 20:22:07</div></a></div><div class="text"><p><span class="user-mention" data-user-id="254032">@Georgi Lyubenov // googleson78</span> good question - sort of, because you still have that ugly <code>newtype</code> - it's sort of "new effect with uncovered representation"</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/20a04d823b7c3891d78ca5f6a188ccd0e4fc5e3d?x=x&amp;version=2"></a><div class="content"><a class="author">TheMatten</a><div class="metadata"><a href="#186010423" name="186010423"><div>2020-01-18 20:23:40</div></a></div><div class="text"><p>This sort of "global" behaviour - I'm more inclined to using named effects to resolve local ambiguities honestly - I want to pass my effects of interest to actions as arguments</p></div></div></div><div class="comment"><a class="avatar"><img src="https://secure.gravatar.com/avatar/1114fd8de67671f83d3a3ef7594b1950?d=identicon&amp;version=1"></a><div class="content"><a class="author">Georgi Lyubenov // googleson78</a><div class="metadata"><a href="#186010424" name="186010424"><div>2020-01-18 20:23:52</div></a></div><div class="text"><p>ah yeah, I forgot that your suggestion is to entirely do away with having to use a <code>newtype</code></p></div></div></div><div class="comment"><a class="avatar"><img src="https://secure.gravatar.com/avatar/1114fd8de67671f83d3a3ef7594b1950?d=identicon&amp;version=1"></a><div class="content"><a class="author">Georgi Lyubenov // googleson78</a><div class="metadata"><a href="#186010633" name="186010633"><div>2020-01-18 20:29:19</div></a></div><div class="text"><p>this sounds like a more generally useful plugin, beyond <code>polysemy</code> btw</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/20a04d823b7c3891d78ca5f6a188ccd0e4fc5e3d?x=x&amp;version=2"></a><div class="content"><a class="author">TheMatten</a><div class="metadata"><a href="#186010754" name="186010754"><div>2020-01-18 20:33:05</div></a></div><div class="text"><p>There's this identifier thing though - most libraries (I guess those for anonymous records) would want "stringy" fields probably - here we want some unique identifiers.<br>
We need to create interface that doesn't care about how they work or allows one to "plug-in with their own plugin".</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/f1ec33bcc6144366b30e479d6b3bed74cdb9f611?x=x&amp;version=4"></a><div class="content"><a class="author">Love Waern (King of the Homeless)</a><div class="metadata"><a href="#186012210" name="186012210"><div>2020-01-18 21:19:58</div></a></div><div class="text"><p>Issue created: <a href="https://github.com/polysemy-research/polysemy/issues/307" target="_blank" title="https://github.com/polysemy-research/polysemy/issues/307">https://github.com/polysemy-research/polysemy/issues/307</a></p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/polysemy-research/polysemy/issues/307" style="background-image: url(https://avatars1.githubusercontent.com/u/52079915?s=400&amp;v=4)" target="_blank"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/polysemy-research/polysemy/issues/307" target="_blank" title="v2 roadmap · Issue #307 · polysemy-research/polysemy">v2 roadmap · Issue #307 · polysemy-research/polysemy</a></div><div class="message_embed_description">GHC 8.10 is coming up soon-ish, and we&#39;ve got plenty of old issues, pull-requests and ideas put on the backburner we should get resolved. Some of these are pretty breaking changes, so I&#39;m a...</div></div></div></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/20a04d823b7c3891d78ca5f6a188ccd0e4fc5e3d?x=x&amp;version=2"></a><div class="content"><a class="author">TheMatten</a><div class="metadata"><a href="#186012599" name="186012599"><div>2020-01-18 21:30:35</div></a></div><div class="text"><p><span class="user-mention" data-user-id="254034">@Love Waern (King of the Homeless)</span> Thanks a lot! <span aria-label="slight smile" class="emoji emoji-1f642" role="img" title="slight smile">:slight_smile:</span><br>
Alright, would it be reasonable to say that for v2, we want to fix issues that currently trouble users, possibly in breaking way if absolutely needed and for v3, we'll think about things like named effects - basically "what should <code>polysemy</code> become in the future"?</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/f1ec33bcc6144366b30e479d6b3bed74cdb9f611?x=x&amp;version=4"></a><div class="content"><a class="author">Love Waern (King of the Homeless)</a><div class="metadata"><a href="#186012612" name="186012612"><div>2020-01-18 21:31:08</div></a></div><div class="text"><p>Sounds good.</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/20a04d823b7c3891d78ca5f6a188ccd0e4fc5e3d?x=x&amp;version=2"></a><div class="content"><a class="author">TheMatten</a><div class="metadata"><a href="#186012663" name="186012663"><div>2020-01-18 21:32:17</div></a></div><div class="text"><p>Nice - lI'll fill in v2 roadmap with current issues in checklist and look for others that should be considered</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/f1ec33bcc6144366b30e479d6b3bed74cdb9f611?x=x&amp;version=4"></a><div class="content"><a class="author">Love Waern (King of the Homeless)</a><div class="metadata"><a href="#186012676" name="186012676"><div>2020-01-18 21:32:57</div></a></div><div class="text"><p>Already added the ones I've linked to the milestone</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/f1ec33bcc6144366b30e479d6b3bed74cdb9f611?x=x&amp;version=4"></a><div class="content"><a class="author">Love Waern (King of the Homeless)</a><div class="metadata"><a href="#186012689" name="186012689"><div>2020-01-18 21:33:32</div></a></div><div class="text"><p>But I'd appreciate any others</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/f1ec33bcc6144366b30e479d6b3bed74cdb9f611?x=x&amp;version=4"></a><div class="content"><a class="author">Love Waern (King of the Homeless)</a><div class="metadata"><a href="#186012924" name="186012924"><div>2020-01-18 21:41:07</div></a></div><div class="text"><p>Fixing <a href="https://github.com/polysemy-research/polysemy/issues/246" target="_blank" title="https://github.com/polysemy-research/polysemy/issues/246">#246</a> means switching from the <code>weave</code> abstraction -- that bug is inherent to it -- and that's too much for v2. Mind if I remove it from the milestone?</p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/polysemy-research/polysemy/issues/246" style="background-image: url(https://avatars1.githubusercontent.com/u/52079915?s=400&amp;v=4)" target="_blank"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/polysemy-research/polysemy/issues/246" target="_blank" title="Choice of functorial state for runNonDet · Issue #246 · polysemy-research/polysemy">Choice of functorial state for runNonDet · Issue #246 · polysemy-research/polysemy</a></div><div class="message_embed_description">Turns out choosing a functorial state for runNonDet is rife with trouble. We previously used [] as the functorial state for runNonDet. However, this made the semantics of &lt;|&gt; differ depending...</div></div></div></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/f1ec33bcc6144366b30e479d6b3bed74cdb9f611?x=x&amp;version=4"></a><div class="content"><a class="author">Love Waern (King of the Homeless)</a><div class="metadata"><a href="#186012981" name="186012981"><div>2020-01-18 21:42:25</div></a></div><div class="text"><p>I mean, we COULD remove <code>runNonDet</code>, but that's the nuclear option.</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/20a04d823b7c3891d78ca5f6a188ccd0e4fc5e3d?x=x&amp;version=2"></a><div class="content"><a class="author">TheMatten</a><div class="metadata"><a href="#186013040" name="186013040"><div>2020-01-18 21:44:14</div></a></div><div class="text"><p><span class="user-mention" data-user-id="254034">@Love Waern (King of the Homeless)</span> Ok - when it comes to <code>NonDet</code>, we should at least mark it <code>DEPRECATED</code> if we can't solve this for now</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/f1ec33bcc6144366b30e479d6b3bed74cdb9f611?x=x&amp;version=4"></a><div class="content"><a class="author">Love Waern (King of the Homeless)</a><div class="metadata"><a href="#186013048" name="186013048"><div>2020-01-18 21:44:58</div></a></div><div class="text"><p><code>runNonDet</code> specifically is the problem, not <code>NonDet</code> in general. I'd be sad to mark it as <code>DEPRECATED</code>. Maybe a big fat warning (maybe even through the<code>WARNING</code> pragma) would suffice?</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/20a04d823b7c3891d78ca5f6a188ccd0e4fc5e3d?x=x&amp;version=2"></a><div class="content"><a class="author">TheMatten</a><div class="metadata"><a href="#186013114" name="186013114"><div>2020-01-18 21:47:01</div></a></div><div class="text"><p>I would like to know how much used it actually is - if not that much, it would be nice to not "trap" more code into it</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/f1ec33bcc6144366b30e479d6b3bed74cdb9f611?x=x&amp;version=4"></a><div class="content"><a class="author">Love Waern (King of the Homeless)</a><div class="metadata"><a href="#186013126" name="186013126"><div>2020-01-18 21:47:50</div></a></div><div class="text"><p>At the same time, it's the only avenue for nondeterminism. It would be a terrible loss to lose it.</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/20a04d823b7c3891d78ca5f6a188ccd0e4fc5e3d?x=x&amp;version=2"></a><div class="content"><a class="author">TheMatten</a><div class="metadata"><a href="#186013473" name="186013473"><div>2020-01-18 21:58:20</div></a></div><div class="text"><p>Hmm - okay, let's put <strong>BIG GLARING WARNING</strong> into docs to make sure people know about it <span aria-label="slight smile" class="emoji emoji-1f642" role="img" title="slight smile">:slight_smile:</span></p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/20a04d823b7c3891d78ca5f6a188ccd0e4fc5e3d?x=x&amp;version=2"></a><div class="content"><a class="author">TheMatten</a><div class="metadata"><a href="#188251660" name="188251660"><div>2020-02-14 22:04:02</div></a></div><div class="text"><p><a href="#narrow/stream/201385-Haskell/topic/Native.20continuations" title="#narrow/stream/201385-Haskell/topic/Native.20continuations">https://funprog.zulipchat.com/#narrow/stream/201385-Haskell/topic/Native.20continuations</a> - I wonder what <em>effects</em> could native continuations and <code>eff</code> itself have on <code>polysemy</code> in the future <span aria-label="slight smile" class="emoji emoji-1f642" role="img" title="slight smile">:slight_smile:</span></p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/20a04d823b7c3891d78ca5f6a188ccd0e4fc5e3d?x=x&amp;version=2"></a><div class="content"><a class="author">TheMatten</a><div class="metadata"><a href="#205365959" name="205365959"><div>2020-07-29 14:44:03</div></a></div><div class="text"><p>One idea: if API is going to change in v2 (which it is surely going to), we could possibly try to put together some sort of migration tool using <code>retrie</code> - it would be cool if users could run e.g. <code>polysemy-migrate v1-v2</code> and simply check made changes</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/20a04d823b7c3891d78ca5f6a188ccd0e4fc5e3d?x=x&amp;version=2"></a><div class="content"><a class="author">TheMatten</a><div class="metadata"><a href="#205402647" name="205402647"><div>2020-07-29 19:29:39</div></a></div><div class="text"><p>I'm starting to think that there may be enough breaking changes to do and <a href="https://github.com/ghc-proposals/ghc-proposals/pull/313">#313</a> is far enough to justify moving those more "ambitious" goals into v3 and doing v2 with API changes closer to <em>now</em></p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/ghc-proposals/ghc-proposals/pull/313" style="background-image: url(https://avatars0.githubusercontent.com/u/20374637?s=400&amp;v=4)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/ghc-proposals/ghc-proposals/pull/313" title="Delimited continuation primops by lexi-lambda · Pull Request #313 · ghc-proposals/ghc-proposals">Delimited continuation primops by lexi-lambda · Pull Request #313 · ghc-proposals/ghc-proposals</a></div><div class="message_embed_description">This is a proposal for adding primops for capturing slices of the RTS stack to improve the performance of algebraic effect systems, which require delimited continuations.
Rendered</div></div></div></div></div></div></div></div><div class="ui vertical footer segment"><a href="https://github.com/srid/zulip-archive">Powered by Haskell</a></div></div></body></html>