<html lang="en"><head><meta content="text/html; charset=utf-8" http-equiv="Content-Type"><meta content="width=device-width, initial-scale=1" name="viewport"><meta content="Perhaps there should be another release before &quot;v2&quot;, because the current version doesn&#39;t build with ghc 8.10 - https://github.com/polysemy-research/polysemy/issues/336
We could also push in minor improvements from various pull requests. @TheMatten @Love Waern (King of the Homeless) ?
Build failure o" name="description"><link href="https://funprog.srid.ca/polysemy/new-hackage-release-for-8-10.html" rel="canonical"><meta property="og:title" content="New Hackage release for 8.10 - Polysemy"><meta property="og:site_name" content="Functional Programming Zulip Archive"><meta property="og:type" content="article"><meta property="og:article:section" content="Polysemy"><meta property="og:article:modified_time" content="2020-05-27T20:33:53Z"><meta property="og:article:published_time" content="2020-04-29T12:01:39Z"><title>New Hackage release for 8.10 - Polysemy</title><style type="text/css">
div#thesite
{
  font-family   : "Open Sans", sans-serif;
  font-size     : 1em !important;
  margin-top    : 1em;
  margin-bottom : 1em;
}

div#thesite h1
{
  font-family : "Roboto", sans-serif;
  line-height : 1.19999em;
}

div#thesite h2
{
  font-family : "Roboto", sans-serif;
  line-height : 1.19999em;
}

div#thesite h3
{
  font-family : "Roboto", sans-serif;
  line-height : 1.19999em;
}

div#thesite h4
{
  font-family : "Roboto", sans-serif;
  line-height : 1.19999em;
}

div#thesite h5
{
  font-family : "Roboto", sans-serif;
  line-height : 1.19999em;
}

div#thesite h6
{
  font-family : "Roboto", sans-serif;
  line-height : 1.19999em;
}

div#thesite .ui.breadcrumb.rib .section
{
  font-family : "Roboto", sans-serif;
  line-height : 1.19999em;
}

div#thesite .header
{
  font-family : "Roboto", sans-serif;
  line-height : 1.19999em;
}

div#thesite .as-header
{
  font-family : "Roboto", sans-serif;
  line-height : 1.19999em;
}

div#thesite code, pre, tt
{
  font-family : "SFMono-Regular","Menlo","Monaco","Consolas","Liberation Mono","Courier New", monospace;
}

div#thesite .ui.breadcrumb.rib
{
  margin-bottom : 1em;
}



div#thesite .ui.comments.messages .comment .metadata a
{
  color : #808080;
}

div#thesite .ui.comments.messages .comment a.avatar img
{
  height : auto;
}

div#thesite .subtle
{
  color : #808080;
}


div#thesite .messages pre
{
  font-size : 85%;
  overflow  : auto;
  max-width : 100%;
}

div#thesite .messages .message_embed
{
  border-left  : solid 3px #808080;
  padding-left : 0.69999em;
}

div#thesite .messages .message_inline_image img
{
  max-width     : 100%;
  margin-bottom : 1em;
}


/* Generated with Clay, http://fvisser.nl/clay */</style><link href="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.4.1/semantic.min.css" rel="stylesheet"><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.min.css" rel="stylesheet"><link href="https://fonts.googleapis.com/css?family=Open+Sans|Oswald&amp;display=swap" rel="stylesheet"><link href="https://fonts.googleapis.com/css?family=Roboto|Open+Sans&amp;display=swap" rel="stylesheet"></head><body><div id="thesite" class="ui text container"><div class="ui violet inverted top attached center aligned segment"><h1 class="ui huge header">New Hackage release for 8.10 - Polysemy</h1></div><div class="ui attached segment"><div class="ui message"><p>Welcome to the Functional Programming Zulip Chat Archive. You can join the chat <a href="https://funprog.zulipchat.com">here</a>.</p></div><div class="ui breadcrumb rib"><a href="/" class="section">Home</a><i class="right angle icon divider"></i><a href="/polysemy/" class="section">#Polysemy</a><i class="right angle icon divider"></i><div class="active section">New Hackage release for 8.10</div></div><div class="ui comments messages"><div class="comment"><a class="avatar"><img src="https://www.gravatar.com/avatar/1114fd8de67671f83d3a3ef7594b1950"></a><div class="content"><a class="author">Georgi Lyubenov // googleson78</a><div class="metadata"><a href="#195697425" name="195697425"><div>2020-04-29 12:01:39</div></a></div><div class="text"><p>Perhaps there should be another release before "v2", because the current version doesn't build with ghc 8.10 - <a href="https://github.com/polysemy-research/polysemy/issues/336" title="https://github.com/polysemy-research/polysemy/issues/336">https://github.com/polysemy-research/polysemy/issues/336</a><br>
We could also push in minor improvements from various pull requests. <span class="user-mention" data-user-id="225127">@TheMatten</span> <span class="user-mention" data-user-id="254034">@Love Waern (King of the Homeless)</span> ?</p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/polysemy-research/polysemy/issues/336" style="background-image: url(https://avatars1.githubusercontent.com/u/52079915?s=400&amp;v=4)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/polysemy-research/polysemy/issues/336" title="Build failure on GHC 8.10 (win64) · Issue #336 · polysemy-research/polysemy">Build failure on GHC 8.10 (win64) · Issue #336 · polysemy-research/polysemy</a></div><div class="message_embed_description">I&#39;m following along some blog posts and saw that 8.10 is when we get cost-free polysemy abstractions, so I dutifully grabbed it, and cabal, and manually fixed up my path, got polysemy installed...</div></div></div></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/20a04d823b7c3891d78ca5f6a188ccd0e4fc5e3d?x=x&amp;version=2"></a><div class="content"><a class="author">TheMatten</a><div class="metadata"><a href="#195703872" name="195703872"><div>2020-04-29 12:57:40</div></a></div><div class="text"><p>I guess that's a good idea <span aria-label="thumbs up" class="emoji emoji-1f44d" role="img" title="thumbs up">:thumbs_up:</span></p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/20a04d823b7c3891d78ca5f6a188ccd0e4fc5e3d?x=x&amp;version=2"></a><div class="content"><a class="author">TheMatten</a><div class="metadata"><a href="#195704052" name="195704052"><div>2020-04-29 12:58:59</div></a></div><div class="text"><p>BTW, I would like to wait with v2 until <a href="https://github.com/ghc-proposals/ghc-proposals/pull/313" title="https://github.com/ghc-proposals/ghc-proposals/pull/313">https://github.com/ghc-proposals/ghc-proposals/pull/313</a> lands, because it will probably change the way we do effects in Haskell...</p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/ghc-proposals/ghc-proposals/pull/313" style="background-image: url(https://avatars0.githubusercontent.com/u/20374637?s=400&amp;v=4)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/ghc-proposals/ghc-proposals/pull/313" title="Delimited continuation primops by lexi-lambda · Pull Request #313 · ghc-proposals/ghc-proposals">Delimited continuation primops by lexi-lambda · Pull Request #313 · ghc-proposals/ghc-proposals</a></div><div class="message_embed_description">This is a proposal for adding primops for capturing slices of the RTS stack to improve the performance of algebraic effect systems, which require delimited continuations.
Rendered</div></div></div></div></div></div><div class="comment"><a class="avatar"><img src="https://www.gravatar.com/avatar/1114fd8de67671f83d3a3ef7594b1950"></a><div class="content"><a class="author">Georgi Lyubenov // googleson78</a><div class="metadata"><a href="#195704255" name="195704255"><div>2020-04-29 13:00:41</div></a></div><div class="text"><p>Also, there's an outdated "Unreleased changes" section at the bottom of the changelog, I suggest we update it, bump it to the top and use it. IMO it would be helpful to keep track of what changed when doing a release.</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/f1ec33bcc6144366b30e479d6b3bed74cdb9f611?x=x&amp;version=4"></a><div class="content"><a class="author">Love Waern (King of the Homeless)</a><div class="metadata"><a href="#195723070" name="195723070"><div>2020-04-29 15:01:54</div></a></div><div class="text"><p>To cut this release, we must do one of the following:</p>
<ol>
<li>Fix and enable loop-breaker.</li>
<li>Remove the "zero-cost abstractions" bit altogether, for the moment.</li>
</ol>
<p>We can't lie about zero-cost abstractions.</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/f1ec33bcc6144366b30e479d6b3bed74cdb9f611?x=x&amp;version=4"></a><div class="content"><a class="author">Love Waern (King of the Homeless)</a><div class="metadata"><a href="#195723292" name="195723292"><div>2020-04-29 15:03:03</div></a></div><div class="text"><p>I have no idea how to go about 1. The plugin's one of my weak spots.</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/f1ec33bcc6144366b30e479d6b3bed74cdb9f611?x=x&amp;version=4"></a><div class="content"><a class="author">Love Waern (King of the Homeless)</a><div class="metadata"><a href="#195723512" name="195723512"><div>2020-04-29 15:04:14</div></a></div><div class="text"><p><span class="user-mention" data-user-id="225127">@TheMatten</span> you worked on loop-breaker, right? Or was that <span class="user-mention" data-user-id="251120">@Sandy Maguire</span> 's work?</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/20a04d823b7c3891d78ca5f6a188ccd0e4fc5e3d?x=x&amp;version=2"></a><div class="content"><a class="author">TheMatten</a><div class="metadata"><a href="#195724281" name="195724281"><div>2020-04-29 15:09:01</div></a></div><div class="text"><p>I worked on it - I guess I will try to find some time to fix it later this week</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/20a04d823b7c3891d78ca5f6a188ccd0e4fc5e3d?x=x&amp;version=2"></a><div class="content"><a class="author">TheMatten</a><div class="metadata"><a href="#195724476" name="195724476"><div>2020-04-29 15:10:30</div></a></div><div class="text"><p>(BTW, with <code>loopbreaker</code>, it's technically 0-cost when <code>-fexpose-all-unfoldings</code> is enabled <span aria-label="slight smile" class="emoji emoji-1f642" role="img" title="slight smile">:slight_smile:</span> )</p></div></div></div><div class="comment"><a class="avatar"><img src="https://www.gravatar.com/avatar/18a3cb5710b32a7d09cfe39c1dbb7768"></a><div class="content"><a class="author">Joshua Grosso</a><div class="metadata"><a href="#198798684" name="198798684"><div>2020-05-26 18:01:26</div></a></div><div class="text"><p>Just curious if there's any updates on a GHC 8.10.1 release (e.g. for <code>polysemy-plugin</code> to fix the <code>Ct</code>-related build error).</p></div></div></div><div class="comment"><a class="avatar"><img src="https://www.gravatar.com/avatar/1114fd8de67671f83d3a3ef7594b1950"></a><div class="content"><a class="author">Georgi Lyubenov // googleson78</a><div class="metadata"><a href="#198863189" name="198863189"><div>2020-05-27 08:30:08</div></a></div><div class="text"><p>let's remove the "zero-cost abstractions" bit and upload a new version?</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/20a04d823b7c3891d78ca5f6a188ccd0e4fc5e3d?x=x&amp;version=2"></a><div class="content"><a class="author">TheMatten</a><div class="metadata"><a href="#198864424" name="198864424"><div>2020-05-27 08:43:32</div></a></div><div class="text"><p>Instead of just removing that part, maybe we could explain reasoning behind that decision</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/068f19d948936a41dcd13e340bacb9344e28944c?x=x&amp;version=2"></a><div class="content"><a class="author">Bolt</a><div class="metadata"><a href="#198866744" name="198866744"><div>2020-05-27 09:06:24</div></a></div><div class="text"><p>How much dark magic is behind the loopbreaker? I could offer some help</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/20a04d823b7c3891d78ca5f6a188ccd0e4fc5e3d?x=x&amp;version=2"></a><div class="content"><a class="author">TheMatten</a><div class="metadata"><a href="#198867308" name="198867308"><div>2020-05-27 09:12:57</div></a></div><div class="text"><p><span class="user-mention" data-user-id="250742">@Bolt</span> well, thing is, as Alexis have shown, that neither of current effects libraries (including <code>mtl</code>) can't optimize past module boundaries (except when <code>-fexpose-all-unfoldings</code> is enabled, but then compiler can't keep up with big codebases like <code>semantic</code>) - so in long term, we probably want to remove <code>loopbreaker</code> altogether and switch to delimited continuation primitives (once they get accepted of course) as basis for our effects implementation, which have minimal runtime overhead</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/068f19d948936a41dcd13e340bacb9344e28944c?x=x&amp;version=2"></a><div class="content"><a class="author">Bolt</a><div class="metadata"><a href="#198867462" name="198867462"><div>2020-05-27 09:14:41</div></a></div><div class="text"><p>I see, so the loopbreaker is just a temporary fix and is not worth the hassle to fix it. If that's the case I agree, remove it entirely and explain the decision</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/20a04d823b7c3891d78ca5f6a188ccd0e4fc5e3d?x=x&amp;version=2"></a><div class="content"><a class="author">TheMatten</a><div class="metadata"><a href="#198867964" name="198867964"><div>2020-05-27 09:20:27</div></a></div><div class="text"><p>And I don't think that's anything to be sad about - from runtime point of view, instead of some final transformer stack, with delimited continuations we'll run in restricted form of what could be considered <code>ReaderT Handlers IO</code>, which seems much more lightweight than layers and layers of transformers IMO</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/068f19d948936a41dcd13e340bacb9344e28944c?x=x&amp;version=2"></a><div class="content"><a class="author">Bolt</a><div class="metadata"><a href="#198868760" name="198868760"><div>2020-05-27 09:30:21</div></a></div><div class="text"><p>I'm not familiar with delimited continuations neither am capable of seeing how they help. But if this is for the best I agree with you :p</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/20a04d823b7c3891d78ca5f6a188ccd0e4fc5e3d?x=x&amp;version=2"></a><div class="content"><a class="author">TheMatten</a><div class="metadata"><a href="#198871215" name="198871215"><div>2020-05-27 09:59:34</div></a></div><div class="text"><p>Are you familiar with <a href="https://hackage.haskell.org/package/transformers-0.5.6.2/docs/Control-Monad-Trans-Cont.html"><code>Cont</code></a> monad?</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/20a04d823b7c3891d78ca5f6a188ccd0e4fc5e3d?x=x&amp;version=2"></a><div class="content"><a class="author">TheMatten</a><div class="metadata"><a href="#198874323" name="198874323"><div>2020-05-27 10:36:41</div></a></div><div class="text"><p>It provides two combinators - <code>reset</code>, which "delimits" continuation, and <code>shift</code>, which is given remaining computation that depends on it's result as a function (continuation) and returns result of whole computation in <code>reset</code> - example (using transformer version with <code>IO</code>):</p>
<div class="codehilite"><pre><span></span><code><span class="nf">evalContT</span> <span class="kr">do</span>
    <span class="n">lift</span> <span class="o">$</span> <span class="n">print</span> <span class="mi">1</span>
    <span class="n">x</span> <span class="ow">&lt;-</span> <span class="n">resetT</span> <span class="kr">do</span>
        <span class="n">lift</span> <span class="o">$</span> <span class="n">print</span> <span class="mi">2</span>
        <span class="n">y</span> <span class="ow">&lt;-</span> <span class="n">shiftT</span> <span class="nf">\</span><span class="n">k</span> <span class="ow">-&gt;</span> <span class="kr">do</span>
            <span class="n">lift</span> <span class="o">$</span> <span class="n">k</span> <span class="mi">3</span>  <span class="c1">-- returns 42</span>
            <span class="n">lift</span> <span class="o">$</span> <span class="n">k</span> <span class="mi">4</span>  <span class="c1">-- returns 42</span>
            <span class="n">pure</span> <span class="mi">5</span>
        <span class="n">lift</span> <span class="o">$</span> <span class="n">print</span> <span class="n">y</span>
        <span class="n">pure</span> <span class="mi">42</span>
    <span class="n">lift</span> <span class="o">$</span> <span class="n">print</span> <span class="n">x</span>
</code></pre></div>


<p>prints</p>
<div class="codehilite"><pre><span></span><code><span class="mi">1</span>
<span class="mi">2</span>
<span class="mi">3</span>
<span class="mi">4</span>
<span class="mi">5</span>
</code></pre></div></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/20a04d823b7c3891d78ca5f6a188ccd0e4fc5e3d?x=x&amp;version=2"></a><div class="content"><a class="author">TheMatten</a><div class="metadata"><a href="#198876462" name="198876462"><div>2020-05-27 11:03:21</div></a></div><div class="text"><p>You can use them to model exceptions, coroutines and all sorts of other stuff that affects control flow - and provide alternative to <code>Tactics</code> that has simple interface and is easier to reason about</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/068f19d948936a41dcd13e340bacb9344e28944c?x=x&amp;version=2"></a><div class="content"><a class="author">Bolt</a><div class="metadata"><a href="#198949298" name="198949298"><div>2020-05-27 20:33:53</div></a></div><div class="text"><p>Awesome I was not familiar with the Cont monad! But I'll read more about it <span aria-label="grinning face with smiling eyes" class="emoji emoji-1f601" role="img" title="grinning face with smiling eyes">:grinning_face_with_smiling_eyes:</span></p></div></div></div></div></div><div class="ui vertical footer segment"><a href="https://github.com/srid/zulip-archive">Powered by Haskell</a> | Questions? Contact <a href="https://www.srid.ca">srid</a></div></div></body></html>