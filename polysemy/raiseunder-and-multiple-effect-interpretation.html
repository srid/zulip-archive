<html lang="en"><head><meta content="text/html; charset=utf-8" http-equiv="Content-Type"><meta content="width=device-width, initial-scale=1" name="viewport"><meta content="What&#39;s the right way to do this:
interp1 :: Member e3 r =&gt; Sem (e1 : e2 : r) a -&gt; Sem r a

interp2 :: Sem (e1 : e2 : r) a -&gt; Sem r a
interp2 = interp_e3 . interp1 . raiseUnder???



It seems that I would need to introduce an effect two levels deep, but I don&#39;t see a combinator for that. Is there a b" name="description"><link href="https://funprog.srid.ca/polysemy/raiseunder-and-multiple-effect-interpretation.html" rel="canonical"><meta property="og:title" content="raiseUnder and multiple effect interpretation - Polysemy"><meta property="og:site_name" content="Functional Programming Zulip Archive"><meta property="og:type" content="article"><meta property="og:article:section" content="Polysemy"><meta property="og:article:modified_time" content="2020-07-28T21:05:15Z"><meta property="og:article:published_time" content="2020-06-16T14:49:03Z"><meta property="og:image" content="https://zulip-avatars.s3.amazonaws.com/13896/7334dc60b6aef6a75cd9284126231f13c76926a5?version=6"><title>raiseUnder and multiple effect interpretation - Polysemy</title><style type="text/css">
div#thesite
{
  font-family   : "Open Sans", sans-serif;
  font-size     : 1em !important;
  margin-top    : 1em;
  margin-bottom : 1em;
}

div#thesite h1
{
  font-family : "Roboto", sans-serif;
  line-height : 1.19999em;
}

div#thesite h2
{
  font-family : "Roboto", sans-serif;
  line-height : 1.19999em;
}

div#thesite h3
{
  font-family : "Roboto", sans-serif;
  line-height : 1.19999em;
}

div#thesite h4
{
  font-family : "Roboto", sans-serif;
  line-height : 1.19999em;
}

div#thesite h5
{
  font-family : "Roboto", sans-serif;
  line-height : 1.19999em;
}

div#thesite h6
{
  font-family : "Roboto", sans-serif;
  line-height : 1.19999em;
}

div#thesite .ui.breadcrumb.rib .section
{
  font-family : "Roboto", sans-serif;
  line-height : 1.19999em;
}

div#thesite .header
{
  font-family : "Roboto", sans-serif;
  line-height : 1.19999em;
}

div#thesite .as-header
{
  font-family : "Roboto", sans-serif;
  line-height : 1.19999em;
}

div#thesite code, pre, tt
{
  font-family : "SFMono-Regular","Menlo","Monaco","Consolas","Liberation Mono","Courier New", monospace;
}

div#thesite .ui.breadcrumb.rib
{
  margin-bottom : 1em;
}



div#thesite .ui.comments.messages .comment .metadata a
{
  color : #808080;
}

div#thesite .ui.comments.messages .comment a.avatar img
{
  height : auto;
}

div#thesite .subtle
{
  color : #808080;
}


div#thesite .messages pre
{
  font-size : 85%;
  overflow  : auto;
  max-width : 100%;
}

div#thesite .messages .message_embed
{
  border-left  : solid 3px #808080;
  padding-left : 0.69999em;
}

div#thesite .messages .message_inline_image img
{
  max-width     : 100%;
  margin-bottom : 1em;
}


/* Generated with Clay, http://fvisser.nl/clay */</style><link href="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.4.1/semantic.min.css" rel="stylesheet"><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.min.css" rel="stylesheet"><link href="https://fonts.googleapis.com/css?family=Open+Sans|Oswald&amp;display=swap" rel="stylesheet"><link href="https://fonts.googleapis.com/css?family=Roboto|Open+Sans&amp;display=swap" rel="stylesheet"></head><body><div id="thesite" class="ui text container"><div class="ui violet inverted top attached center aligned segment"><h1 class="ui huge header">raiseUnder and multiple effect interpretation - Polysemy</h1></div><div class="ui attached segment"><div class="ui message"><p>Welcome to the Functional Programming Zulip Chat Archive. You can join the chat <a href="https://funprog.zulipchat.com">here</a>.</p></div><div class="ui breadcrumb rib"><a href="/" class="section">Home</a><i class="right angle icon divider"></i><a href="/polysemy/" class="section">#Polysemy</a><i class="right angle icon divider"></i><div class="active section">raiseUnder and multiple effect interpretation</div></div><div class="ui comments messages"><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/7334dc60b6aef6a75cd9284126231f13c76926a5?version=6"></a><div class="content"><a class="author">Torsten Schmits</a><div class="metadata"><a href="#201026274" name="201026274"><div>2020-06-16 14:49:03</div></a></div><div class="text"><p>What's the right way to do this:</p>
<div class="codehilite"><pre><span></span><code><span class="nf">interp1</span> <span class="ow">::</span> <span class="kt">Member</span> <span class="n">e3</span> <span class="n">r</span> <span class="ow">=&gt;</span> <span class="kt">Sem</span> <span class="p">(</span><span class="n">e1</span> <span class="kt">:</span> <span class="n">e2</span> <span class="kt">:</span> <span class="n">r</span><span class="p">)</span> <span class="n">a</span> <span class="ow">-&gt;</span> <span class="kt">Sem</span> <span class="n">r</span> <span class="n">a</span>

<span class="nf">interp2</span> <span class="ow">::</span> <span class="kt">Sem</span> <span class="p">(</span><span class="n">e1</span> <span class="kt">:</span> <span class="n">e2</span> <span class="kt">:</span> <span class="n">r</span><span class="p">)</span> <span class="n">a</span> <span class="ow">-&gt;</span> <span class="kt">Sem</span> <span class="n">r</span> <span class="n">a</span>
<span class="nf">interp2</span> <span class="ow">=</span> <span class="n">interp_e3</span> <span class="o">.</span> <span class="n">interp1</span> <span class="o">.</span> <span class="n">raiseUnder</span><span class="o">???</span>
</code></pre></div>


<p>It seems that I would need to introduce an effect two levels deep, but I don't see a combinator for that. Is there a better way?</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/7334dc60b6aef6a75cd9284126231f13c76926a5?version=6"></a><div class="content"><a class="author">Torsten Schmits</a><div class="metadata"><a href="#201026964" name="201026964"><div>2020-06-16 14:53:44</div></a></div><div class="text"><p>to be clear, I want <code>e3</code> not to be needed in the outside interpreter stack</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/7334dc60b6aef6a75cd9284126231f13c76926a5?version=6"></a><div class="content"><a class="author">Torsten Schmits</a><div class="metadata"><a href="#201027048" name="201027048"><div>2020-06-16 14:54:10</div></a></div><div class="text"><p>which works fine when <code>interp1</code> is a single effect, with <code>raiseUnderN</code></p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/20a04d823b7c3891d78ca5f6a188ccd0e4fc5e3d?version=2"></a><div class="content"><a class="author">TheMatten</a><div class="metadata"><a href="#201029858" name="201029858"><div>2020-06-16 15:12:29</div></a></div><div class="text"><p>I guess we should try to get</p>
<div class="codehilite"><pre><span></span><code><span class="nf">lift</span> <span class="ow">::</span> <span class="n">forall</span> <span class="n">effs1</span> <span class="n">effs2</span> <span class="n">a</span><span class="o">.</span> <span class="kt">Lift</span> <span class="n">effs1</span> <span class="n">effs2</span> <span class="ow">=&gt;</span> <span class="kt">Sem</span> <span class="n">effs1</span> <span class="n">a</span> <span class="ow">-&gt;</span> <span class="kt">Sem</span> <span class="n">effs2</span> <span class="n">a</span>
</code></pre></div>


<p>at some point</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/20a04d823b7c3891d78ca5f6a188ccd0e4fc5e3d?version=2"></a><div class="content"><a class="author">TheMatten</a><div class="metadata"><a href="#201029893" name="201029893"><div>2020-06-16 15:12:48</div></a></div><div class="text"><p>(from <code>eff</code>)</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/7334dc60b6aef6a75cd9284126231f13c76926a5?version=6"></a><div class="content"><a class="author">Torsten Schmits</a><div class="metadata"><a href="#201029919" name="201029919"><div>2020-06-16 15:13:02</div></a></div><div class="text"><p>yeah</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/7334dc60b6aef6a75cd9284126231f13c76926a5?version=6"></a><div class="content"><a class="author">Torsten Schmits</a><div class="metadata"><a href="#205254770" name="205254770"><div>2020-07-28 15:59:10</div></a></div><div class="text"><p>for your FYI, I made combinators for this problem: <a href="https://github.com/polysemy-research/polysemy/pull/369">https://github.com/polysemy-research/polysemy/pull/369</a></p>
<p><span class="user-mention" data-user-id="225127">@TheMatten</span> pls2check!</p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/polysemy-research/polysemy/pull/369" style="background-image: url(https://avatars1.githubusercontent.com/u/52079915?s=400&amp;v=4)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/polysemy-research/polysemy/pull/369" title="raise2Under and raise3Under by tek 路 Pull Request #369 路 polysemy-research/polysemy">raise2Under and raise3Under by tek 路 Pull Request #369 路 polysemy-research/polysemy</a></div><div class="message_embed_description">These combinators are like raiseUnder, but place the new effect at the
second and third position in the list.
This is for interpreters that consume two effects, delegating to two other interpreters...</div></div></div></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/20a04d823b7c3891d78ca5f6a188ccd0e4fc5e3d?version=2"></a><div class="content"><a class="author">TheMatten</a><div class="metadata"><a href="#205255460" name="205255460"><div>2020-07-28 16:04:26</div></a></div><div class="text"><p><span class="user-mention" data-user-id="260881">@Torsten Schmits</span> Cool, thanks!<br>
While talking about "shuffling" effects around, what about porting <a href="https://github.com/hasura/eff/blob/bf0520d0fb0644fef2bb78d0cfa289efdc9fc851/eff/src/Control/Effect/Internal.hs#L744"><code>lift</code></a> from <code>eff</code>, which would allow us to reorder and add effects freely?</p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/hasura/eff/blob/bf0520d0fb0644fef2bb78d0cfa289efdc9fc851/eff/src/Control/Effect/Internal.hs#L744" style="background-image: url(https://avatars3.githubusercontent.com/u/13966722?s=400&amp;v=4)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/hasura/eff/blob/bf0520d0fb0644fef2bb78d0cfa289efdc9fc851/eff/src/Control/Effect/Internal.hs#L744" title="hasura/eff">hasura/eff</a></div><div class="message_embed_description"> a work in progress effect system for Haskell . Contribute to hasura/eff development by creating an account on GitHub.</div></div></div></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/7334dc60b6aef6a75cd9284126231f13c76926a5?version=6"></a><div class="content"><a class="author">Torsten Schmits</a><div class="metadata"><a href="#205255553" name="205255553"><div>2020-07-28 16:05:21</div></a></div><div class="text"><p>would love to! you wanna merge this anyway for the time being?</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/7334dc60b6aef6a75cd9284126231f13c76926a5?version=6"></a><div class="content"><a class="author">Torsten Schmits</a><div class="metadata"><a href="#205255740" name="205255740"><div>2020-07-28 16:06:30</div></a></div><div class="text"><p>ah, I see you already approved. <span aria-label="rocket" class="emoji emoji-1f680" role="img" title="rocket">:rocket:</span></p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/20a04d823b7c3891d78ca5f6a188ccd0e4fc5e3d?version=2"></a><div class="content"><a class="author">TheMatten</a><div class="metadata"><a href="#205255836" name="205255836"><div>2020-07-28 16:07:24</div></a></div><div class="text"><p>Even if we added <code>lift</code> later, we probably want these as more "inferable" variants, because they should produce much more sane type errors</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/20a04d823b7c3891d78ca5f6a188ccd0e4fc5e3d?version=2"></a><div class="content"><a class="author">TheMatten</a><div class="metadata"><a href="#205255867" name="205255867"><div>2020-07-28 16:07:40</div></a></div><div class="text"><p>We would just turn them into call to <code>lift</code> in that case</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/7334dc60b6aef6a75cd9284126231f13c76926a5?version=6"></a><div class="content"><a class="author">Torsten Schmits</a><div class="metadata"><a href="#205256102" name="205256102"><div>2020-07-28 16:09:46</div></a></div><div class="text"><p>right!</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/bd1c2dd9ab5e95cae3e7a38c2f373739e5a1acba?version=2"></a><div class="content"><a class="author">Georgi Lyubenov // googleson78</a><div class="metadata"><a href="#205256654" name="205256654"><div>2020-07-28 16:14:17</div></a></div><div class="text"><p>Well this is rather unfortunate! <code>raise2Under</code> actually means "raise an effect under two effects", and the existing <code>raiseUnder2</code> actually means "raise two effects under the current one" <span aria-label="sweat smile" class="emoji emoji-1f605" role="img" title="sweat smile">:sweat_smile:</span></p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/bd1c2dd9ab5e95cae3e7a38c2f373739e5a1acba?version=2"></a><div class="content"><a class="author">Georgi Lyubenov // googleson78</a><div class="metadata"><a href="#205257619" name="205257619"><div>2020-07-28 16:22:08</div></a></div><div class="text"><p>again with the self-recursive calls where it's entirely non-obvious to me how this is terminating at all -_- (wrt <code>raiseUnder</code>)</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/20a04d823b7c3891d78ca5f6a188ccd0e4fc5e3d?version=2"></a><div class="content"><a class="author">TheMatten</a><div class="metadata"><a href="#205259005" name="205259005"><div>2020-07-28 16:33:18</div></a></div><div class="text"><p>That recursive use should mostly matter in higher-order effects, where you call it on your argument to actually conform to "latest" row</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/20a04d823b7c3891d78ca5f6a188ccd0e4fc5e3d?version=2"></a><div class="content"><a class="author">TheMatten</a><div class="metadata"><a href="#205259112" name="205259112"><div>2020-07-28 16:34:02</div></a></div><div class="text"><p>So it stops at some point, because you don't have infinitely nested higher-order calls <span aria-label="slight smile" class="emoji emoji-1f642" role="img" title="slight smile">:slight_smile:</span></p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/20a04d823b7c3891d78ca5f6a188ccd0e4fc5e3d?version=2"></a><div class="content"><a class="author">TheMatten</a><div class="metadata"><a href="#205278464" name="205278464"><div>2020-07-28 19:17:27</div></a></div><div class="text"><div class="codehilite"><pre><span></span><code><span class="c1">-- inspired by</span>
<span class="c1">-- https://github.com/hasura/eff/blob/bf0520d0fb0644fef2bb78d0cfa289efdc9fc851/eff/src/Control/Effect/Internal.hs#L688</span>

<span class="kr">class</span> <span class="kt">Raise</span> <span class="p">(</span><span class="n">r</span> <span class="ow">::</span> <span class="p">[</span><span class="kt">Effect</span><span class="p">])</span> <span class="p">(</span><span class="n">r&#39;</span> <span class="ow">::</span> <span class="p">[</span><span class="kt">Effect</span><span class="p">])</span> <span class="kr">where</span>
  <span class="n">raiseUnion</span> <span class="ow">::</span> <span class="kt">Union</span> <span class="n">r</span> <span class="n">m</span> <span class="n">a</span> <span class="ow">-&gt;</span> <span class="kt">Union</span> <span class="n">r&#39;</span> <span class="n">m</span> <span class="n">a</span>

<span class="kr">instance</span> <span class="cm">{-# overlapping #-}</span> <span class="kt">Raise</span> <span class="n">r</span> <span class="n">r</span> <span class="kr">where</span>
  <span class="n">raiseUnion</span> <span class="ow">=</span> <span class="n">id</span>

<span class="kr">instance</span> <span class="p">(</span><span class="n">r&#39;</span> <span class="o">~</span> <span class="p">(</span><span class="n">_0</span><span class="kt">:</span><span class="n">r&#39;&#39;</span><span class="p">),</span> <span class="kt">Raise</span> <span class="n">r</span> <span class="n">r&#39;&#39;</span><span class="p">)</span> <span class="ow">=&gt;</span> <span class="kt">Raise</span> <span class="n">r</span> <span class="n">r&#39;</span> <span class="kr">where</span>
  <span class="n">raiseUnion</span> <span class="ow">=</span> <span class="p">(</span><span class="nf">\</span><span class="p">(</span><span class="kt">Union</span> <span class="n">n</span> <span class="n">w</span><span class="p">)</span> <span class="ow">-&gt;</span> <span class="kt">Union</span> <span class="p">(</span><span class="kt">There</span> <span class="n">n</span><span class="p">)</span> <span class="n">w</span><span class="p">)</span> <span class="o">.</span> <span class="n">raiseUnion</span>

<span class="kr">class</span> <span class="kt">Subsume</span> <span class="p">(</span><span class="n">r</span> <span class="ow">::</span> <span class="p">[</span><span class="kt">Effect</span><span class="p">])</span> <span class="p">(</span><span class="n">r&#39;</span> <span class="ow">::</span> <span class="p">[</span><span class="kt">Effect</span><span class="p">])</span> <span class="kr">where</span>
  <span class="n">subsumeUnion</span> <span class="ow">::</span> <span class="kt">Union</span> <span class="n">r</span> <span class="n">m</span> <span class="n">a</span> <span class="ow">-&gt;</span> <span class="kt">Union</span> <span class="n">r&#39;</span> <span class="n">m</span> <span class="n">a</span>

<span class="kr">instance</span> <span class="cm">{-# incoherent #-}</span> <span class="kt">Raise</span> <span class="n">r</span> <span class="n">r&#39;</span> <span class="ow">=&gt;</span> <span class="kt">Subsume</span> <span class="n">r</span> <span class="n">r&#39;</span> <span class="kr">where</span>
  <span class="n">subsumeUnion</span> <span class="ow">=</span> <span class="n">raiseUnion</span>

<span class="kr">instance</span> <span class="p">(</span><span class="kt">Member</span> <span class="n">e</span> <span class="n">r&#39;</span><span class="p">,</span> <span class="kt">Subsume</span> <span class="n">r</span> <span class="n">r&#39;</span><span class="p">)</span> <span class="ow">=&gt;</span> <span class="kt">Subsume</span> <span class="p">(</span><span class="n">e</span><span class="kt">:</span><span class="n">r</span><span class="p">)</span> <span class="n">r&#39;</span> <span class="kr">where</span>
  <span class="n">subsumeUnion</span> <span class="ow">=</span> <span class="n">either</span> <span class="n">subsumeUnion</span> <span class="n">injWeaving</span> <span class="o">.</span> <span class="n">decomp</span>

<span class="kr">instance</span> <span class="kt">Subsume</span> <span class="kt">&#39;[]</span> <span class="n">r</span> <span class="kr">where</span>
  <span class="n">subsumeUnion</span> <span class="ow">=</span> <span class="n">absurdU</span>

<span class="nf">raise&#39;</span> <span class="ow">::</span> <span class="kt">Subsume</span> <span class="n">r</span> <span class="n">r&#39;</span> <span class="ow">=&gt;</span> <span class="kt">Sem</span> <span class="n">r</span> <span class="n">a</span> <span class="ow">-&gt;</span> <span class="kt">Sem</span> <span class="n">r&#39;</span> <span class="n">a</span>
<span class="nf">raise&#39;</span> <span class="ow">=</span> <span class="n">hoistSem</span> <span class="o">$</span> <span class="n">hoist</span> <span class="n">raise&#39;</span> <span class="o">.</span> <span class="n">subsumeUnion</span>

<span class="nf">raise</span> <span class="ow">::</span> <span class="kt">Sem</span> <span class="n">r</span> <span class="n">a</span> <span class="ow">-&gt;</span> <span class="kt">Sem</span> <span class="p">(</span><span class="n">e</span> <span class="kt">&#39;:</span> <span class="n">r</span><span class="p">)</span> <span class="n">a</span>
<span class="nf">raise</span> <span class="ow">=</span> <span class="n">raise&#39;</span>

<span class="nf">raiseUnder</span> <span class="ow">::</span> <span class="kt">Sem</span> <span class="p">(</span><span class="n">e1</span> <span class="kt">&#39;:</span> <span class="n">r</span><span class="p">)</span> <span class="n">a</span> <span class="ow">-&gt;</span> <span class="kt">Sem</span> <span class="p">(</span><span class="n">e1</span> <span class="kt">&#39;:</span> <span class="p">(</span><span class="n">e2</span> <span class="kt">&#39;:</span> <span class="n">r</span><span class="p">))</span> <span class="n">a</span>
<span class="nf">raiseUnder</span> <span class="ow">=</span> <span class="n">raise&#39;</span>

<span class="nf">raiseUnder2</span> <span class="ow">::</span> <span class="kt">Sem</span> <span class="p">(</span><span class="n">e1</span> <span class="kt">&#39;:</span> <span class="n">r</span><span class="p">)</span> <span class="n">a</span> <span class="ow">-&gt;</span> <span class="kt">Sem</span> <span class="p">(</span><span class="n">e1</span> <span class="kt">&#39;:</span> <span class="p">(</span><span class="n">e2</span> <span class="kt">&#39;:</span> <span class="p">(</span><span class="n">e3</span> <span class="kt">&#39;:</span> <span class="n">r</span><span class="p">)))</span> <span class="n">a</span>
<span class="nf">raiseUnder2</span> <span class="ow">=</span> <span class="n">raise&#39;</span>

<span class="nf">raiseUnder3</span> <span class="ow">::</span> <span class="kt">Sem</span> <span class="p">(</span><span class="n">e1</span> <span class="kt">&#39;:</span> <span class="n">r</span><span class="p">)</span> <span class="n">a</span> <span class="ow">-&gt;</span> <span class="kt">Sem</span> <span class="p">(</span><span class="n">e1</span> <span class="kt">&#39;:</span> <span class="p">(</span><span class="n">e2</span> <span class="kt">&#39;:</span> <span class="p">(</span><span class="n">e3</span> <span class="kt">&#39;:</span> <span class="p">(</span><span class="n">e4</span> <span class="kt">&#39;:</span> <span class="n">r</span><span class="p">))))</span> <span class="n">a</span>
<span class="nf">raiseUnder3</span> <span class="ow">=</span> <span class="n">raise&#39;</span>

<span class="nf">subsume</span> <span class="ow">::</span> <span class="kt">Member</span> <span class="n">e</span> <span class="n">r</span> <span class="ow">=&gt;</span> <span class="kt">Sem</span> <span class="p">(</span><span class="n">e</span> <span class="kt">&#39;:</span> <span class="n">r</span><span class="p">)</span> <span class="n">a</span> <span class="ow">-&gt;</span> <span class="kt">Sem</span> <span class="n">r</span> <span class="n">a</span>
<span class="nf">subsume</span> <span class="ow">=</span> <span class="n">raise&#39;</span>
</code></pre></div></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/7334dc60b6aef6a75cd9284126231f13c76926a5?version=6"></a><div class="content"><a class="author">Torsten Schmits</a><div class="metadata"><a href="#205278857" name="205278857"><div>2020-07-28 19:21:07</div></a></div><div class="text"><p>seems easy enough!</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/20a04d823b7c3891d78ca5f6a188ccd0e4fc5e3d?version=2"></a><div class="content"><a class="author">TheMatten</a><div class="metadata"><a href="#205278938" name="205278938"><div>2020-07-28 19:21:59</div></a></div><div class="text"><p>A little bit of <em>incoherence</em> and it can work with both concrete stacks and "polymorphic tails"</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/20a04d823b7c3891d78ca5f6a188ccd0e4fc5e3d?version=2"></a><div class="content"><a class="author">TheMatten</a><div class="metadata"><a href="#205279221" name="205279221"><div>2020-07-28 19:24:21</div></a></div><div class="text"><p>Should I open a PR? Or do you have some ideas for names? (those operators in <code>eff</code> are <em>nice</em>)</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/20a04d823b7c3891d78ca5f6a188ccd0e4fc5e3d?version=2"></a><div class="content"><a class="author">TheMatten</a><div class="metadata"><a href="#205279327" name="205279327"><div>2020-07-28 19:25:15</div></a></div><div class="text"><p>(Haha, I wonder how many people used <a href="https://hackage.haskell.org/package/polysemy-zoo-0.7.0.0/docs/Polysemy-Operators.html">https://hackage.haskell.org/package/polysemy-zoo-0.7.0.0/docs/Polysemy-Operators.html</a> <span aria-label="big smile" class="emoji emoji-1f604" role="img" title="big smile">:big_smile:</span> )</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/20a04d823b7c3891d78ca5f6a188ccd0e4fc5e3d?version=2"></a><div class="content"><a class="author">TheMatten</a><div class="metadata"><a href="#205280849" name="205280849"><div>2020-07-28 19:38:25</div></a></div><div class="text"><p>Maybe something like</p>
<div class="codehilite"><pre><span></span><code><span class="c1">-------------------------------------------------------------------------------</span>
<span class="c1">-- | Raises effect stack by arbitrary number of effects.</span>
<span class="nf">raise&#39;</span> <span class="ow">::</span> <span class="kt">Raise</span> <span class="n">r</span> <span class="n">r&#39;</span> <span class="ow">=&gt;</span> <span class="kt">Sem</span> <span class="n">r</span> <span class="n">a</span> <span class="ow">-&gt;</span> <span class="kt">Sem</span> <span class="n">r&#39;</span> <span class="n">a</span>
<span class="nf">raise&#39;</span> <span class="ow">=</span> <span class="n">hoistSem</span> <span class="o">$</span> <span class="n">hoist</span> <span class="n">raise&#39;</span> <span class="o">.</span> <span class="n">raiseUnion</span>

<span class="nf">raise</span> <span class="ow">::</span> <span class="kt">Sem</span> <span class="n">r</span> <span class="n">a</span> <span class="ow">-&gt;</span> <span class="kt">Sem</span> <span class="p">(</span><span class="n">e</span> <span class="kt">&#39;:</span> <span class="n">r</span><span class="p">)</span> <span class="n">a</span>
<span class="nf">raise</span> <span class="ow">=</span> <span class="n">raise&#39;</span>

<span class="nf">raiseUnder</span> <span class="ow">::</span> <span class="kt">Sem</span> <span class="p">(</span><span class="n">e1</span> <span class="kt">&#39;:</span> <span class="n">r</span><span class="p">)</span> <span class="n">a</span> <span class="ow">-&gt;</span> <span class="kt">Sem</span> <span class="p">(</span><span class="n">e1</span> <span class="kt">&#39;:</span> <span class="p">(</span><span class="n">e2</span> <span class="kt">&#39;:</span> <span class="n">r</span><span class="p">))</span> <span class="n">a</span>
<span class="nf">raiseUnder</span> <span class="ow">=</span> <span class="n">subsume&#39;</span>

<span class="nf">raiseUnder2</span> <span class="ow">::</span> <span class="kt">Sem</span> <span class="p">(</span><span class="n">e1</span> <span class="kt">&#39;:</span> <span class="n">r</span><span class="p">)</span> <span class="n">a</span> <span class="ow">-&gt;</span> <span class="kt">Sem</span> <span class="p">(</span><span class="n">e1</span> <span class="kt">&#39;:</span> <span class="p">(</span><span class="n">e2</span> <span class="kt">&#39;:</span> <span class="p">(</span><span class="n">e3</span> <span class="kt">&#39;:</span> <span class="n">r</span><span class="p">)))</span> <span class="n">a</span>
<span class="nf">raiseUnder2</span> <span class="ow">=</span> <span class="n">subsume&#39;</span>

<span class="nf">raiseUnder3</span> <span class="ow">::</span> <span class="kt">Sem</span> <span class="p">(</span><span class="n">e1</span> <span class="kt">&#39;:</span> <span class="n">r</span><span class="p">)</span> <span class="n">a</span> <span class="ow">-&gt;</span> <span class="kt">Sem</span> <span class="p">(</span><span class="n">e1</span> <span class="kt">&#39;:</span> <span class="p">(</span><span class="n">e2</span> <span class="kt">&#39;:</span> <span class="p">(</span><span class="n">e3</span> <span class="kt">&#39;:</span> <span class="p">(</span><span class="n">e4</span> <span class="kt">&#39;:</span> <span class="n">r</span><span class="p">))))</span> <span class="n">a</span>
<span class="nf">raiseUnder3</span> <span class="ow">=</span> <span class="n">subsume&#39;</span>

<span class="kr">class</span> <span class="kt">Raise</span> <span class="p">(</span><span class="n">r</span> <span class="ow">::</span> <span class="p">[</span><span class="kt">Effect</span><span class="p">])</span> <span class="p">(</span><span class="n">r&#39;</span> <span class="ow">::</span> <span class="p">[</span><span class="kt">Effect</span><span class="p">])</span> <span class="kr">where</span>
  <span class="n">raiseUnion</span> <span class="ow">::</span> <span class="kt">Union</span> <span class="n">r</span> <span class="n">m</span> <span class="n">a</span> <span class="ow">-&gt;</span> <span class="kt">Union</span> <span class="n">r&#39;</span> <span class="n">m</span> <span class="n">a</span>

<span class="kr">instance</span> <span class="cm">{-# overlapping #-}</span> <span class="kt">Raise</span> <span class="n">r</span> <span class="n">r</span> <span class="kr">where</span>
  <span class="n">raiseUnion</span> <span class="ow">=</span> <span class="n">id</span>

<span class="kr">instance</span> <span class="p">(</span><span class="n">r&#39;</span> <span class="o">~</span> <span class="p">(</span><span class="n">_0</span><span class="kt">:</span><span class="n">r&#39;&#39;</span><span class="p">),</span> <span class="kt">Raise</span> <span class="n">r</span> <span class="n">r&#39;&#39;</span><span class="p">)</span> <span class="ow">=&gt;</span> <span class="kt">Raise</span> <span class="n">r</span> <span class="n">r&#39;</span> <span class="kr">where</span>
  <span class="n">raiseUnion</span> <span class="ow">=</span> <span class="p">(</span><span class="nf">\</span><span class="p">(</span><span class="kt">Union</span> <span class="n">n</span> <span class="n">w</span><span class="p">)</span> <span class="ow">-&gt;</span> <span class="kt">Union</span> <span class="p">(</span><span class="kt">There</span> <span class="n">n</span><span class="p">)</span> <span class="n">w</span><span class="p">)</span> <span class="o">.</span> <span class="n">raiseUnion</span>

<span class="c1">-------------------------------------------------------------------------------</span>
<span class="c1">-- | Allows reordering and adding known effects on top of effect stack, as long</span>
<span class="c1">-- as polymorphic tail of new stack is &#39;raise&#39;-d version of the original one.</span>
<span class="nf">subsume&#39;</span> <span class="ow">::</span> <span class="kt">Subsume</span> <span class="n">r</span> <span class="n">r&#39;</span> <span class="ow">=&gt;</span> <span class="kt">Sem</span> <span class="n">r</span> <span class="n">a</span> <span class="ow">-&gt;</span> <span class="kt">Sem</span> <span class="n">r&#39;</span> <span class="n">a</span>
<span class="nf">subsume&#39;</span> <span class="ow">=</span> <span class="n">hoistSem</span> <span class="o">$</span> <span class="n">hoist</span> <span class="n">subsume&#39;</span> <span class="o">.</span> <span class="n">subsumeUnion</span>

<span class="nf">subsume</span> <span class="ow">::</span> <span class="kt">Member</span> <span class="n">e</span> <span class="n">r</span> <span class="ow">=&gt;</span> <span class="kt">Sem</span> <span class="p">(</span><span class="n">e</span> <span class="kt">&#39;:</span> <span class="n">r</span><span class="p">)</span> <span class="n">a</span> <span class="ow">-&gt;</span> <span class="kt">Sem</span> <span class="n">r</span> <span class="n">a</span>
<span class="nf">subsume</span> <span class="ow">=</span> <span class="n">subsume&#39;</span>

<span class="kr">class</span> <span class="kt">Subsume</span> <span class="p">(</span><span class="n">r</span> <span class="ow">::</span> <span class="p">[</span><span class="kt">Effect</span><span class="p">])</span> <span class="p">(</span><span class="n">r&#39;</span> <span class="ow">::</span> <span class="p">[</span><span class="kt">Effect</span><span class="p">])</span> <span class="kr">where</span>
  <span class="n">subsumeUnion</span> <span class="ow">::</span> <span class="kt">Union</span> <span class="n">r</span> <span class="n">m</span> <span class="n">a</span> <span class="ow">-&gt;</span> <span class="kt">Union</span> <span class="n">r&#39;</span> <span class="n">m</span> <span class="n">a</span>

<span class="kr">instance</span> <span class="cm">{-# incoherent #-}</span> <span class="kt">Raise</span> <span class="n">r</span> <span class="n">r&#39;</span> <span class="ow">=&gt;</span> <span class="kt">Subsume</span> <span class="n">r</span> <span class="n">r&#39;</span> <span class="kr">where</span>
  <span class="n">subsumeUnion</span> <span class="ow">=</span> <span class="n">raiseUnion</span>

<span class="kr">instance</span> <span class="p">(</span><span class="kt">Member</span> <span class="n">e</span> <span class="n">r&#39;</span><span class="p">,</span> <span class="kt">Subsume</span> <span class="n">r</span> <span class="n">r&#39;</span><span class="p">)</span> <span class="ow">=&gt;</span> <span class="kt">Subsume</span> <span class="p">(</span><span class="n">e</span><span class="kt">:</span><span class="n">r</span><span class="p">)</span> <span class="n">r&#39;</span> <span class="kr">where</span>
  <span class="n">subsumeUnion</span> <span class="ow">=</span> <span class="n">either</span> <span class="n">subsumeUnion</span> <span class="n">injWeaving</span> <span class="o">.</span> <span class="n">decomp</span>

<span class="kr">instance</span> <span class="kt">Subsume</span> <span class="kt">&#39;[]</span> <span class="n">r</span> <span class="kr">where</span>
  <span class="n">subsumeUnion</span> <span class="ow">=</span> <span class="n">absurdU</span>
</code></pre></div>


<p>where names could be switched to <code>raise</code> and <code>raiseN</code> (for <code>N</code> in <code>[1..3]</code>) in v2</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/7334dc60b6aef6a75cd9284126231f13c76926a5?version=6"></a><div class="content"><a class="author">Torsten Schmits</a><div class="metadata"><a href="#205281367" name="205281367"><div>2020-07-28 19:43:03</div></a></div><div class="text"><p><span class="user-mention silent" data-user-id="225127">TheMatten</span> <a href="#narrow/stream/216942-Polysemy/topic/raiseUnder.20and.20multiple.20effect.20interpretation/near/205279327">said</a>:</p>
<blockquote>
<p>(Haha, I wonder how many people used <a href="https://hackage.haskell.org/package/polysemy-zoo-0.7.0.0/docs/Polysemy-Operators.html">https://hackage.haskell.org/package/polysemy-zoo-0.7.0.0/docs/Polysemy-Operators.html</a> <span aria-label="big smile" class="emoji emoji-1f604" role="img" title="big smile">:big_smile:</span> )</p>
</blockquote>
<p>ooh, never seen those. not sure I find them very readable though, but I'd have to use them a bit to get an impression</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/7334dc60b6aef6a75cd9284126231f13c76926a5?version=6"></a><div class="content"><a class="author">Torsten Schmits</a><div class="metadata"><a href="#205281795" name="205281795"><div>2020-07-28 19:46:59</div></a></div><div class="text"><p>I say make a PR and wait for comments over there</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/20a04d823b7c3891d78ca5f6a188ccd0e4fc5e3d?version=2"></a><div class="content"><a class="author">TheMatten</a><div class="metadata"><a href="#205290797" name="205290797"><div>2020-07-28 21:05:15</div></a></div><div class="text"><p><a href="https://github.com/polysemy-research/polysemy/pull/370/">https://github.com/polysemy-research/polysemy/pull/370/</a></p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/polysemy-research/polysemy/pull/370/" style="background-image: url(https://avatars1.githubusercontent.com/u/52079915?s=400&amp;v=4)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/polysemy-research/polysemy/pull/370/" title="Add 'Raise' and 'Subsume' by TheMatten 路 Pull Request #370 路 polysemy-research/polysemy">Add 'Raise' and 'Subsume' by TheMatten 路 Pull Request #370 路 polysemy-research/polysemy</a></div><div class="message_embed_description">See https://funprog.srid.ca/polysemy/raiseunder-and-multiple-effect-interpretation.html and #369.</div></div></div></div></div></div></div></div><div class="ui vertical footer segment"><a href="https://github.com/srid/zulip-archive">Powered by Haskell</a> | Questions? Contact <a href="https://www.srid.ca">srid</a></div></div></body></html>