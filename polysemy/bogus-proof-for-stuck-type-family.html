<html lang="en"><head><meta content="text/html; charset=utf-8" http-equiv="Content-Type"><meta content="width=device-width, initial-scale=1" name="viewport"><meta content="I broke polysemy,
&lt;no location info&gt;: error:
    bogus proof for stuck type family
CallStack (from HasCallStack):
  error, called at src/Polysemy/Plugin/Fundep.hs:178:9 in polysemy-plugin-0.2.5.0-BT55LwSy8F0v20rojK9yr:Polysemy.Plugin.Fundep
" name="description"><link href="https://funprog.srid.ca/polysemy/bogus-proof-for-stuck-type-family.html" rel="canonical"><meta property="og:title" content="bogus proof for stuck type family - Polysemy"><meta property="og:site_name" content="Functional Programming Zulip Archive"><meta property="og:type" content="article"><meta property="og:article:section" content="Polysemy"><meta property="og:article:modified_time" content="2020-02-23T05:32:35Z"><meta property="og:article:published_time" content="2020-02-22T18:07:42Z"><meta property="og:image" content="https://zulip-avatars.s3.amazonaws.com/13896/4429aa8b689608f24a4ad712843ce29862e330d2?x=x&amp;version=2"><title>bogus proof for stuck type family - Polysemy</title><style type="text/css">
div#thesite
{
  font-family   : "Open Sans", sans-serif;
  font-size     : 1em !important;
  margin-top    : 1em;
  margin-bottom : 1em;
}

div#thesite h1
{
  font-family : "Roboto", sans-serif;
  line-height : 1.19999em;
}

div#thesite h2
{
  font-family : "Roboto", sans-serif;
  line-height : 1.19999em;
}

div#thesite h3
{
  font-family : "Roboto", sans-serif;
  line-height : 1.19999em;
}

div#thesite h4
{
  font-family : "Roboto", sans-serif;
  line-height : 1.19999em;
}

div#thesite h5
{
  font-family : "Roboto", sans-serif;
  line-height : 1.19999em;
}

div#thesite h6
{
  font-family : "Roboto", sans-serif;
  line-height : 1.19999em;
}

div#thesite .ui.breadcrumb.rib .section
{
  font-family : "Roboto", sans-serif;
  line-height : 1.19999em;
}

div#thesite .header
{
  font-family : "Roboto", sans-serif;
  line-height : 1.19999em;
}

div#thesite .as-header
{
  font-family : "Roboto", sans-serif;
  line-height : 1.19999em;
}

div#thesite code, pre, tt
{
  font-family : "SFMono-Regular","Menlo","Monaco","Consolas","Liberation Mono","Courier New", monospace;
}

div#thesite .ui.breadcrumb.rib
{
  margin-bottom : 1em;
}



div#thesite .ui.comments.messages .comment .metadata a
{
  color : #808080;
}

div#thesite .ui.comments.messages .comment a.avatar img
{
  height : auto;
}

div#thesite .subtle
{
  color : #808080;
}


div#thesite .messages pre
{
  font-size : 85%;
  overflow  : auto;
  max-width : 100%;
}

div#thesite .messages .message_embed
{
  border-left  : solid 3px #808080;
  padding-left : 0.69999em;
}

div#thesite .messages .message_inline_image img
{
  max-width     : 100%;
  margin-bottom : 1em;
}


/* Generated with Clay, http://fvisser.nl/clay */</style><link href="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.4.1/semantic.min.css" rel="stylesheet"><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.min.css" rel="stylesheet"><link href="https://fonts.googleapis.com/css?family=Open+Sans|Oswald&amp;display=swap" rel="stylesheet"><link href="https://fonts.googleapis.com/css?family=Roboto|Open+Sans&amp;display=swap" rel="stylesheet"></head><body><div id="thesite" class="ui text container"><div class="ui violet inverted top attached center aligned segment"><h1 class="ui huge header">bogus proof for stuck type family - Polysemy</h1></div><div class="ui attached segment"><div class="ui message"><p>Welcome to the Functional Programming Zulip Chat Archive. You can join the chat <a href="https://funprog.zulipchat.com">here</a>.</p></div><div class="ui breadcrumb rib"><a href="/" class="section">Home</a><i class="right angle icon divider"></i><a href="/polysemy/" class="section">#Polysemy</a><i class="right angle icon divider"></i><div class="active section">bogus proof for stuck type family</div></div><div class="ui comments messages"><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/4429aa8b689608f24a4ad712843ce29862e330d2?x=x&amp;version=2"></a><div class="content"><a class="author">Sridhar Ratnakumar</a><div class="metadata"><a href="#188827219" name="188827219"><div>2020-02-22 18:07:42</div></a></div><div class="text"><p>I broke polysemy,</p>
<div class="codehilite"><pre><span></span>&lt;no location info&gt;: error:
    bogus proof for stuck type family
CallStack (from HasCallStack):
  error, called at src/Polysemy/Plugin/Fundep.hs:178:9 in polysemy-plugin-0.2.5.0-BT55LwSy8F0v20rojK9yr:Polysemy.Plugin.Fundep
</pre></div></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/20a04d823b7c3891d78ca5f6a188ccd0e4fc5e3d?x=x&amp;version=2"></a><div class="content"><a class="author">TheMatten</a><div class="metadata"><a href="#188827493" name="188827493"><div>2020-02-22 18:14:51</div></a></div><div class="text"><p>How it happened?</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/4429aa8b689608f24a4ad712843ce29862e330d2?x=x&amp;version=2"></a><div class="content"><a class="author">Sridhar Ratnakumar</a><div class="metadata"><a href="#188827696" name="188827696"><div>2020-02-22 18:21:26</div></a></div><div class="text"><p>Refactoring some code, using dependent-sum set of libraries</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/4429aa8b689608f24a4ad712843ce29862e330d2?x=x&amp;version=2"></a><div class="content"><a class="author">Sridhar Ratnakumar</a><div class="metadata"><a href="#188827771" name="188827771"><div>2020-02-22 18:23:38</div></a></div><div class="text"><p>All I did was this change: <a href="https://gist.github.com/srid/2dc18afadea2cb09e8fedf202c6aba2e" target="_blank" title="https://gist.github.com/srid/2dc18afadea2cb09e8fedf202c6aba2e">https://gist.github.com/srid/2dc18afadea2cb09e8fedf202c6aba2e</a></p>
<div class="message_embed"><a class="message_embed_image" href="https://gist.github.com/srid/2dc18afadea2cb09e8fedf202c6aba2e" style="background-image: url(https://github.githubassets.com/images/modules/gists/gist-og-image.png)" target="_blank"></a><div class="data-container"><div class="message_embed_title"><a href="https://gist.github.com/srid/2dc18afadea2cb09e8fedf202c6aba2e" target="_blank" title="stuff.diff">stuff.diff</a></div><div class="message_embed_description">GitHub Gist: instantly share code, notes, and snippets.</div></div></div></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/20a04d823b7c3891d78ca5f6a188ccd0e4fc5e3d?x=x&amp;version=2"></a><div class="content"><a class="author">TheMatten</a><div class="metadata"><a href="#188827831" name="188827831"><div>2020-02-22 18:24:58</div></a></div><div class="text"><p>What happens when you change declaration of <code>Tracking</code> back to annotated one?</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/4429aa8b689608f24a4ad712843ce29862e330d2?x=x&amp;version=2"></a><div class="content"><a class="author">Sridhar Ratnakumar</a><div class="metadata"><a href="#188827890" name="188827890"><div>2020-02-22 18:26:13</div></a></div><div class="text"><p>Doesn't change anything.</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/4429aa8b689608f24a4ad712843ce29862e330d2?x=x&amp;version=2"></a><div class="content"><a class="author">Sridhar Ratnakumar</a><div class="metadata"><a href="#188827958" name="188827958"><div>2020-02-22 18:28:40</div></a></div><div class="text"><p>It is arising right when compiling an unrelated module (not shown in the diff)</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/4429aa8b689608f24a4ad712843ce29862e330d2?x=x&amp;version=2"></a><div class="content"><a class="author">Sridhar Ratnakumar</a><div class="metadata"><a href="#188827968" name="188827968"><div>2020-02-22 18:29:30</div></a></div><div class="text"><p>(And that module only <em>uses</em> the effects polysemy TH generated, and doesn't define any effects itself)</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/4429aa8b689608f24a4ad712843ce29862e330d2?x=x&amp;version=2"></a><div class="content"><a class="author">Sridhar Ratnakumar</a><div class="metadata"><a href="#188828013" name="188828013"><div>2020-02-22 18:30:03</div></a></div><div class="text"><p>I wish I could share it, but it is a mix of private stuff (I literally have Haskell types for moods, feelings, private narratives).</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/20a04d823b7c3891d78ca5f6a188ccd0e4fc5e3d?x=x&amp;version=2"></a><div class="content"><a class="author">TheMatten</a><div class="metadata"><a href="#188828099" name="188828099"><div>2020-02-22 18:33:59</div></a></div><div class="text"><p>Try passing <code>corelint</code> flag to <code>polysemy-plugin</code></p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/4429aa8b689608f24a4ad712843ce29862e330d2?x=x&amp;version=2"></a><div class="content"><a class="author">Sridhar Ratnakumar</a><div class="metadata"><a href="#188828805" name="188828805"><div>2020-02-22 18:54:55</div></a></div><div class="text"><p>as a cabal flag? i'm starting from scratch, recreating that diff piecemeal ...</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/4429aa8b689608f24a4ad712843ce29862e330d2?x=x&amp;version=2"></a><div class="content"><a class="author">Sridhar Ratnakumar</a><div class="metadata"><a href="#188829185" name="188829185"><div>2020-02-22 19:05:57</div></a></div><div class="text"><p>Figured out where it is coming from. I had to comment out the actual DSL use, to make compilation succeed.</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/4429aa8b689608f24a4ad712843ce29862e330d2?x=x&amp;version=2"></a><div class="content"><a class="author">Sridhar Ratnakumar</a><div class="metadata"><a href="#188829248" name="188829248"><div>2020-02-22 19:07:59</div></a></div><div class="text"><p>This triggers the error:</p>
<div class="codehilite"><pre><span></span><span class="nf">didSet</span> <span class="p">(</span><span class="kt">Squat</span> <span class="kt">:/</span><span class="p">)</span> <span class="p">`</span><span class="n">mapM_</span><span class="p">`</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">]</span>
</pre></div>


<p>And fix (to get rid of the error) is:</p>
<div class="codehilite"><pre><span></span><span class="p">(</span><span class="n">didSet</span> <span class="o">.</span> <span class="p">(</span><span class="kt">Squat</span> <span class="kt">:/</span><span class="p">))</span> <span class="p">`</span><span class="n">mapM_</span><span class="p">`</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">]</span>
</pre></div></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/4429aa8b689608f24a4ad712843ce29862e330d2?x=x&amp;version=2"></a><div class="content"><a class="author">Sridhar Ratnakumar</a><div class="metadata"><a href="#188829287" name="188829287"><div>2020-02-22 19:08:19</div></a></div><div class="text"><p>Looks like I've identified a bug in polysemy-plugin?</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/4429aa8b689608f24a4ad712843ce29862e330d2?x=x&amp;version=2"></a><div class="content"><a class="author">Sridhar Ratnakumar</a><div class="metadata"><a href="#188829297" name="188829297"><div>2020-02-22 19:09:07</div></a></div><div class="text"><p>The corresponding Effect constructor is <code>DidSet :: DSum Move Identity -&gt; MyEffect m ()</code></p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/4429aa8b689608f24a4ad712843ce29862e330d2?x=x&amp;version=2"></a><div class="content"><a class="author">Sridhar Ratnakumar</a><div class="metadata"><a href="#188829305" name="188829305"><div>2020-02-22 19:09:37</div></a></div><div class="text"><p>And <code>Squat :/ n</code> is just alias for <code>Squat :=&gt; Identity n</code> (of type <code>DSum Move Identity</code>)</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/20a04d823b7c3891d78ca5f6a188ccd0e4fc5e3d?x=x&amp;version=2"></a><div class="content"><a class="author">TheMatten</a><div class="metadata"><a href="#188829827" name="188829827"><div>2020-02-22 19:24:37</div></a></div><div class="text"><p>I guess that's one more reason for plugin rewrite - but honestly, <code>eff</code> is getting closer with required primops being submitted as GHC proposal and I wonder how much of <code>polysemy</code>'s internals will stay relevant once it comes out...</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/20a04d823b7c3891d78ca5f6a188ccd0e4fc5e3d?x=x&amp;version=2"></a><div class="content"><a class="author">TheMatten</a><div class="metadata"><a href="#188829849" name="188829849"><div>2020-02-22 19:26:02</div></a></div><div class="text"><p>Though, <code>eff</code> will have the same problems that we solve with it, so maybe we want to decouple it (at least fundep part)</p></div></div></div><div class="comment"><a class="avatar"></a><div class="content"><a class="author">Sandy Maguire</a><div class="metadata"><a href="#188851353" name="188851353"><div>2020-02-23 05:32:12</div></a></div><div class="text"><p>Impressive</p></div></div></div><div class="comment"><a class="avatar"></a><div class="content"><a class="author">Sandy Maguire</a><div class="metadata"><a href="#188851367" name="188851367"><div>2020-02-23 05:32:35</div></a></div><div class="text"><p>try turning off custom error messages and i think it will work just fine</p></div></div></div></div></div><div class="ui vertical footer segment"><a href="https://github.com/srid/zulip-archive">Powered by Haskell</a> | Questions? Contact <a href="https://www.srid.ca">srid</a></div></div></body></html>