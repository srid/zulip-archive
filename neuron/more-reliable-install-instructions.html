<html lang="en"><head><meta content="text/html; charset=utf-8" http-equiv="Content-Type"><meta content="width=device-width, initial-scale=1" name="viewport"><meta content="@Sridhar Ratnakumar  I was thinking that the build instructions of nix-env -if https://github.com/srid/neuron/archive/master.tar.gz is kind of fragile, primarily for two reasons:

If the current CI is not finished yet, it will needlessly build locally, instead of using the prebuilt binaries. (race c" name="description"><link href="https://funprog.srid.ca/neuron/more-reliable-install-instructions.html" rel="canonical"><meta property="og:title" content="More reliable install instructions - Neuron"><meta property="og:site_name" content="Functional Programming Zulip Archive"><meta property="og:type" content="article"><meta property="og:article:section" content="Neuron"><meta property="og:article:modified_time" content="2020-10-11T19:59:06Z"><meta property="og:article:published_time" content="2020-10-08T19:55:46Z"><title>More reliable install instructions - Neuron</title><style type="text/css">
div#thesite
{
  font-family   : "Open Sans", sans-serif;
  font-size     : 1em !important;
  margin-top    : 1em;
  margin-bottom : 1em;
}

div#thesite h1
{
  font-family : "Roboto", sans-serif;
  line-height : 1.19999em;
}

div#thesite h2
{
  font-family : "Roboto", sans-serif;
  line-height : 1.19999em;
}

div#thesite h3
{
  font-family : "Roboto", sans-serif;
  line-height : 1.19999em;
}

div#thesite h4
{
  font-family : "Roboto", sans-serif;
  line-height : 1.19999em;
}

div#thesite h5
{
  font-family : "Roboto", sans-serif;
  line-height : 1.19999em;
}

div#thesite h6
{
  font-family : "Roboto", sans-serif;
  line-height : 1.19999em;
}

div#thesite .ui.breadcrumb.rib .section
{
  font-family : "Roboto", sans-serif;
  line-height : 1.19999em;
}

div#thesite .header
{
  font-family : "Roboto", sans-serif;
  line-height : 1.19999em;
}

div#thesite .as-header
{
  font-family : "Roboto", sans-serif;
  line-height : 1.19999em;
}

div#thesite code, pre, tt
{
  font-family : "SFMono-Regular","Menlo","Monaco","Consolas","Liberation Mono","Courier New", monospace;
}

div#thesite .ui.breadcrumb.rib
{
  margin-bottom : 1em;
}



div#thesite .ui.comments.messages .comment .metadata a
{
  color : #808080;
}

div#thesite .ui.comments.messages .comment a.avatar img
{
  height : auto;
}

div#thesite .subtle
{
  color : #808080;
}


div#thesite .messages pre
{
  font-size : 85%;
  overflow  : auto;
  max-width : 100%;
}

div#thesite .messages .message_embed
{
  border-left  : solid 3px #808080;
  padding-left : 0.69999em;
}

div#thesite .messages .message_inline_image img
{
  max-width     : 100%;
  margin-bottom : 1em;
}


/* Generated with Clay, http://fvisser.nl/clay */</style><link href="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.4.1/semantic.min.css" rel="stylesheet"><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.min.css" rel="stylesheet"><link href="https://fonts.googleapis.com/css?family=Open+Sans|Oswald&amp;display=swap" rel="stylesheet"><link href="https://fonts.googleapis.com/css?family=Roboto|Open+Sans&amp;display=swap" rel="stylesheet"></head><body><div id="thesite" class="ui text container"><div class="ui violet inverted top attached center aligned segment"><h1 class="ui huge header">More reliable install instructions - Neuron</h1></div><div class="ui attached segment"><div class="ui message"><p>Welcome to the Functional Programming Zulip Chat Archive. You can join the chat <a href="https://funprog.zulipchat.com">here</a>.</p></div><div class="ui breadcrumb rib"><a href="/" class="section">Home</a><i class="right angle icon divider"></i><a href="/neuron/" class="section">#Neuron</a><i class="right angle icon divider"></i><div class="active section">More reliable install instructions</div></div><div class="ui comments messages"><div class="comment"><a class="avatar"></a><div class="content"><a class="author">Hjulle</a><div class="metadata"><a href="#212741349" name="212741349"><div>2020-10-08 19:55:46</div></a></div><div class="text"><p><span class="user-mention" data-user-id="251311">@Sridhar Ratnakumar</span>  I was thinking that the build instructions of <code>nix-env -if https://github.com/srid/neuron/archive/master.tar.gz</code> is kind of fragile, primarily for two reasons:</p>
<ol>
<li>If the current CI is not finished yet, it will needlessly build locally, instead of using the prebuilt binaries. (race condition)</li>
<li>If the current master is broken for some reason, it will try and fail to install that version.</li>
</ol>
<p>I know that pinning is one option, but that is kind of annoying and requires manual updating.<br>
As an alternative, I'm thinking that we could make a branch that automatically updates whenever CI on master successfully builds (or use a dev branch that automatically pushes to master on successful builds). </p>
<p>Do you think that makes sense?</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/4429aa8b689608f24a4ad712843ce29862e330d2?x=x&amp;version=2"></a><div class="content"><a class="author">Sridhar Ratnakumar</a><div class="metadata"><a href="#212747566" name="212747566"><div>2020-10-08 20:52:21</div></a></div><div class="text"><p>Yes, but do we <em>really</em> need to do this though? <code>master</code> enters broken state very rarely.</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/4429aa8b689608f24a4ad712843ce29862e330d2?x=x&amp;version=2"></a><div class="content"><a class="author">Sridhar Ratnakumar</a><div class="metadata"><a href="#212747584" name="212747584"><div>2020-10-08 20:52:33</div></a></div><div class="text"><p>Incidentally, the install page now links to static binary: <a href="https://neuron.zettel.page/install.html">https://neuron.zettel.page/install.html</a></p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/4429aa8b689608f24a4ad712843ce29862e330d2?x=x&amp;version=2"></a><div class="content"><a class="author">Sridhar Ratnakumar</a><div class="metadata"><a href="#212747662" name="212747662"><div>2020-10-08 20:53:26</div></a></div><div class="text"><p>I could make a rule so that master never gets (code) commits without a PR. So we can wait for the PR CI to pass before merging it.</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/4429aa8b689608f24a4ad712843ce29862e330d2?x=x&amp;version=2"></a><div class="content"><a class="author">Sridhar Ratnakumar</a><div class="metadata"><a href="#212747696" name="212747696"><div>2020-10-08 20:53:51</div></a></div><div class="text"><p>This way the cache gets uploaded during the PR CI, and when the <code>master</code> CI runs no new build actually happens.</p></div></div></div><div class="comment"><a class="avatar"></a><div class="content"><a class="author">Hjulle</a><div class="metadata"><a href="#212799305" name="212799305"><div>2020-10-09 08:58:21</div></a></div><div class="text"><p>I guess we don't <strong>really</strong> need it. It was mostly a neat feature in the name of reliability. The PRs only approach would certainly work, but might be more tedious sometimes and I was hoping that automatic merging on successful build could be a nice "set up once and then forget" feature that could save work in the long run.<br>
I think I have once run into problem number one, so it's not a purely hypothetical issue. The only question is if it is worth the effort.</p>
<p>I'm also thinking of this from the perspective of "What would be a good setup for nix projects in general?" and if something like this would be worth adding to Github nix templates.</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/4429aa8b689608f24a4ad712843ce29862e330d2?x=x&amp;version=2"></a><div class="content"><a class="author">Sridhar Ratnakumar</a><div class="metadata"><a href="#212873532" name="212873532"><div>2020-10-09 20:44:05</div></a></div><div class="text"><p>Are you not using the static bundle in CI? <a href="https://github.com/srid/neuron-template/blob/fa6e87b02d1bdacd6d16748806d5b387729ec056/.github/workflows/publish.yaml#L14-L16">https://github.com/srid/neuron-template/blob/fa6e87b02d1bdacd6d16748806d5b387729ec056/.github/workflows/publish.yaml#L14-L16</a></p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/srid/neuron-template/blob/fa6e87b02d1bdacd6d16748806d5b387729ec056/.github/workflows/publish.yaml#L14-L16" style="background-image: url(https://avatars2.githubusercontent.com/u/3998?s=400&amp;v=4)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/srid/neuron-template/blob/fa6e87b02d1bdacd6d16748806d5b387729ec056/.github/workflows/publish.yaml#L14-L16" title="srid/neuron-template">srid/neuron-template</a></div><div class="message_embed_description">A template to get started with neuron. Contribute to srid/neuron-template development by creating an account on GitHub.</div></div></div></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/4429aa8b689608f24a4ad712843ce29862e330d2?x=x&amp;version=2"></a><div class="content"><a class="author">Sridhar Ratnakumar</a><div class="metadata"><a href="#212873558" name="212873558"><div>2020-10-09 20:44:22</div></a></div><div class="text"><p>If CI is still running on the <code>HEAD</code> rev, then this curl command will just get the last available bundle. There is no compilation involved.</p></div></div></div><div class="comment"><a class="avatar"></a><div class="content"><a class="author">Hjulle</a><div class="metadata"><a href="#212969608" name="212969608"><div>2020-10-11 15:31:14</div></a></div><div class="text"><p>I'm not thinking of CI. I'm on mac, so the static bundle is not available here.<br>
But yes, the static bundle for CI is really neat!</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/4429aa8b689608f24a4ad712843ce29862e330d2?x=x&amp;version=2"></a><div class="content"><a class="author">Sridhar Ratnakumar</a><div class="metadata"><a href="#212979266" name="212979266"><div>2020-10-11 19:59:06</div></a></div><div class="text"><p>Looks like you are pulling directly from <code>master</code>? Pinning would avoid these troubles. Tools like <code>niv</code> will make it easier to update periodically the pinned rev.</p></div></div></div></div></div><div class="ui vertical footer segment"><a href="https://github.com/srid/zulip-archive">Powered by Haskell</a> | Questions? Contact <a href="https://www.srid.ca">srid</a></div></div></body></html>