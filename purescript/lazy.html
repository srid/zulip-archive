<html lang="en"><head><meta content="text/html; charset=utf-8" http-equiv="Content-Type"><meta content="width=device-width, initial-scale=1" name="viewport"><meta content="Does anyone know of some good example uses of the Lazy functor? I&#39;m having a hard time wrapping my head around how it ought to be used." name="description"><link href="https://funprog.srid.ca/purescript/lazy.html" rel="canonical"><meta property="og:title" content="Lazy - PureScript"><meta property="og:site_name" content="Functional Programming Zulip Archive"><meta property="og:type" content="article"><meta property="og:article:section" content="PureScript"><meta property="og:article:modified_time" content="2020-10-11T21:10:21Z"><meta property="og:article:published_time" content="2020-10-10T22:50:20Z"><title>Lazy - PureScript</title><style type="text/css">
div#thesite
{
  font-family   : "Open Sans", sans-serif;
  font-size     : 1em !important;
  margin-top    : 1em;
  margin-bottom : 1em;
}

div#thesite h1
{
  font-family : "Roboto", sans-serif;
  line-height : 1.19999em;
}

div#thesite h2
{
  font-family : "Roboto", sans-serif;
  line-height : 1.19999em;
}

div#thesite h3
{
  font-family : "Roboto", sans-serif;
  line-height : 1.19999em;
}

div#thesite h4
{
  font-family : "Roboto", sans-serif;
  line-height : 1.19999em;
}

div#thesite h5
{
  font-family : "Roboto", sans-serif;
  line-height : 1.19999em;
}

div#thesite h6
{
  font-family : "Roboto", sans-serif;
  line-height : 1.19999em;
}

div#thesite .ui.breadcrumb.rib .section
{
  font-family : "Roboto", sans-serif;
  line-height : 1.19999em;
}

div#thesite .header
{
  font-family : "Roboto", sans-serif;
  line-height : 1.19999em;
}

div#thesite .as-header
{
  font-family : "Roboto", sans-serif;
  line-height : 1.19999em;
}

div#thesite code, pre, tt
{
  font-family : "SFMono-Regular","Menlo","Monaco","Consolas","Liberation Mono","Courier New", monospace;
}

div#thesite .ui.breadcrumb.rib
{
  margin-bottom : 1em;
}



div#thesite .ui.comments.messages .comment .metadata a
{
  color : #808080;
}

div#thesite .ui.comments.messages .comment a.avatar img
{
  height : auto;
}

div#thesite .subtle
{
  color : #808080;
}


div#thesite .messages pre
{
  font-size : 85%;
  overflow  : auto;
  max-width : 100%;
}

div#thesite .messages .message_embed
{
  border-left  : solid 3px #808080;
  padding-left : 0.69999em;
}

div#thesite .messages .message_inline_image img
{
  max-width     : 100%;
  margin-bottom : 1em;
}


/* Generated with Clay, http://fvisser.nl/clay */</style><link href="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.4.1/semantic.min.css" rel="stylesheet"><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.min.css" rel="stylesheet"><link href="https://fonts.googleapis.com/css?family=Open+Sans|Oswald&amp;display=swap" rel="stylesheet"><link href="https://fonts.googleapis.com/css?family=Roboto|Open+Sans&amp;display=swap" rel="stylesheet"></head><body><div id="thesite" class="ui text container"><div class="ui violet inverted top attached center aligned segment"><h1 class="ui huge header">Lazy - PureScript</h1></div><div class="ui attached segment"><div class="ui message"><p>Welcome to the Functional Programming Zulip Chat Archive. You can join the chat <a href="https://funprog.zulipchat.com">here</a>.</p></div><div class="ui breadcrumb rib"><a href="/" class="section">Home</a><i class="right angle icon divider"></i><a href="/purescript/" class="section">#PureScript</a><i class="right angle icon divider"></i><div class="active section">Lazy</div></div><div class="ui comments messages"><div class="comment"><a class="avatar"><img src="https://www.gravatar.com/avatar/3cea5dd94abba9982d34d28eef71efc0"></a><div class="content"><a class="author">Mason Mackaman</a><div class="metadata"><a href="#212938377" name="212938377"><div>2020-10-10 22:50:20</div></a></div><div class="text"><p>Does anyone know of some good example uses of the Lazy functor? I'm having a hard time wrapping my head around how it ought to be used.</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/20a04d823b7c3891d78ca5f6a188ccd0e4fc5e3d?x=x&amp;version=2"></a><div class="content"><a class="author">TheMatten</a><div class="metadata"><a href="#212952760" name="212952760"><div>2020-10-11 07:08:34</div></a></div><div class="text"><p>It's just <code>Unit -&gt; a</code> - so if you've ever used nullary function instead of it's result, you've used <code>Lazy</code> (as in PureScript, it's not real, sharing "laziness" as in Haskell)</p></div></div></div><div class="comment"><a class="avatar"><img src="https://www.gravatar.com/avatar/3cea5dd94abba9982d34d28eef71efc0"></a><div class="content"><a class="author">Mason Mackaman</a><div class="metadata"><a href="#212973934" name="212973934"><div>2020-10-11 17:31:39</div></a></div><div class="text"><p>I'm familiar with using at thunk to delay computation, but lazy is different. Using the <code>a -&gt; b</code> instance, the two functions in the lazy documentations are</p>
<div class="codehilite" data-code-language="Haskell"><pre><span></span><code><span class="nf">defer</span> <span class="ow">::</span> <span class="p">(</span><span class="kt">Unit</span> <span class="ow">-&gt;</span> <span class="n">a</span> <span class="ow">-&gt;</span> <span class="n">b</span><span class="p">)</span> <span class="ow">-&gt;</span> <span class="n">a</span> <span class="ow">-&gt;</span> <span class="n">b</span>
<span class="nf">fix</span> <span class="ow">::</span> <span class="p">((</span><span class="n">a</span> <span class="ow">-&gt;</span> <span class="n">b</span><span class="p">)</span> <span class="ow">-&gt;</span> <span class="n">a</span> <span class="ow">-&gt;</span> <span class="n">b</span><span class="p">)</span> <span class="ow">-&gt;</span> <span class="n">a</span> <span class="ow">-&gt;</span> <span class="n">b</span>
</code></pre></div>

<p>I don't understand the point of a <code>Unit -&gt; a -&gt; b</code>? how is that any more lazy than just <code>a -&gt; b</code>? In both cases <code>b</code> gets computed after you give it <code>a</code>.</p></div></div></div><div class="comment"><a class="avatar"><img src="https://www.gravatar.com/avatar/3cea5dd94abba9982d34d28eef71efc0"></a><div class="content"><a class="author">Mason Mackaman</a><div class="metadata"><a href="#212974071" name="212974071"><div>2020-10-11 17:34:09</div></a></div><div class="text"><p>I'm probably just looking at it completely wrong because honestly, I don't even know what those functions are trying to do.</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/20a04d823b7c3891d78ca5f6a188ccd0e4fc5e3d?x=x&amp;version=2"></a><div class="content"><a class="author">TheMatten</a><div class="metadata"><a href="#212976398" name="212976398"><div>2020-10-11 18:34:56</div></a></div><div class="text"><div class="codehilite" data-code-language="Haskell"><pre><span></span><code><span class="nf">defer</span> <span class="ow">::</span> <span class="p">(</span><span class="kt">Unit</span> <span class="ow">-&gt;</span> <span class="n">a</span> <span class="ow">-&gt;</span> <span class="n">b</span><span class="p">)</span> <span class="ow">-&gt;</span> <span class="n">a</span> <span class="ow">-&gt;</span> <span class="n">b</span>
<span class="nf">defer</span> <span class="n">f</span> <span class="ow">=</span> <span class="nf">\</span><span class="n">a</span> <span class="ow">-&gt;</span> <span class="n">f</span> <span class="n">unit</span> <span class="n">a</span>
</code></pre></div>

<p>mind position of call to <code>f</code> - it's after applying <code>a</code>, and so <code>defer f</code> is actually less strict than <code>f unit</code> - e.g. in</p>
<div class="codehilite" data-code-language="Haskell"><pre><span></span><code><span class="nf">f</span> <span class="n">unit</span> <span class="ow">=</span> <span class="n">g</span> <span class="o">&lt;&lt;&lt;</span> <span class="n">h</span>
</code></pre></div>

<p><code>f unit a</code> evaluates <code>&lt;&lt;&lt;</code> after applying <code>unit</code>, but</p>
<div class="codehilite" data-code-language="Haskell"><pre><span></span><code><span class="nf">defer</span> <span class="n">f</span> <span class="n">a</span> <span class="o">==</span> <span class="p">(</span><span class="nf">\</span><span class="n">a</span> <span class="ow">-&gt;</span> <span class="n">f</span> <span class="n">unit</span> <span class="n">a</span><span class="p">)</span> <span class="n">a</span> <span class="ow">=</span> <span class="p">(</span><span class="nf">\</span><span class="n">a</span> <span class="ow">-&gt;</span> <span class="p">(</span><span class="n">g</span> <span class="o">&lt;&lt;&lt;</span> <span class="n">h</span><span class="p">)</span> <span class="n">unit</span> <span class="n">a</span><span class="p">)</span> <span class="n">a</span>
</code></pre></div>

<p>only after applying <code>a</code></p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/20a04d823b7c3891d78ca5f6a188ccd0e4fc5e3d?x=x&amp;version=2"></a><div class="content"><a class="author">TheMatten</a><div class="metadata"><a href="#212976469" name="212976469"><div>2020-10-11 18:37:05</div></a></div><div class="text"><p>I mean, I guess it doesn't matter that often, but there's still a difference, and <code>defer</code> is sort of safeguard that makes sure that all the computation in function is deferred until application of last argument</p></div></div></div><div class="comment"><a class="avatar"><img src="https://www.gravatar.com/avatar/3cea5dd94abba9982d34d28eef71efc0"></a><div class="content"><a class="author">Mason Mackaman</a><div class="metadata"><a href="#212977547" name="212977547"><div>2020-10-11 19:09:12</div></a></div><div class="text"><p>so we could have</p>
<div class="codehilite" data-code-language="Haskell"><pre><span></span><code><span class="nf">f</span> <span class="ow">::</span> <span class="n">a</span> <span class="ow">-&gt;</span> <span class="n">b</span>
<span class="nf">f</span> <span class="ow">=</span> <span class="n">g</span> <span class="o">&lt;&lt;&lt;</span> <span class="n">h</span>
</code></pre></div>

<p>which evaluates <code>g &lt;&lt;&lt; h</code> once and then does the computations involved in computing <code>g &lt;&lt;&lt; h $ a</code> every time <code>f a</code> is called<br>
vs.</p>
<div class="codehilite" data-code-language="Haskell"><pre><span></span><code><span class="nf">f'</span> <span class="ow">::</span> <span class="kt">Unit</span> <span class="ow">-&gt;</span> <span class="n">a</span> <span class="ow">-&gt;</span> <span class="n">b</span>
<span class="nf">f'</span> <span class="kr">_</span> <span class="ow">-&gt;</span> <span class="n">g</span> <span class="o">&lt;&lt;&lt;</span> <span class="n">h</span>

<span class="nf">f</span> <span class="ow">::</span> <span class="n">a</span> <span class="ow">-&gt;</span> <span class="n">b</span>
<span class="nf">f</span> <span class="ow">=</span> <span class="n">defer</span> <span class="n">f'</span>
</code></pre></div>

<p>which evaluates <code>g &lt;&lt;&lt; h</code> along with computations involved in computing <code>g &lt;&lt;&lt; h $ a</code> every time <code>f a</code> is called?</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/20a04d823b7c3891d78ca5f6a188ccd0e4fc5e3d?x=x&amp;version=2"></a><div class="content"><a class="author">TheMatten</a><div class="metadata"><a href="#212979404" name="212979404"><div>2020-10-11 20:02:30</div></a></div><div class="text"><p>There's no "once" in PS, only "later" - we're talking about simple functions here (JS functions at runtime), compared to actual laziness in Haskell, which includes sharing - Haskell "thunk" is literally computation that either computes it's value and writes in in place, or returns already computed value</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/20a04d823b7c3891d78ca5f6a188ccd0e4fc5e3d?x=x&amp;version=2"></a><div class="content"><a class="author">TheMatten</a><div class="metadata"><a href="#212979420" name="212979420"><div>2020-10-11 20:03:42</div></a></div><div class="text"><p>So will always evaluate <code>&lt;&lt;&lt;</code> and function it outputs, it's just that <code>defer</code> can change when the former happens</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/20a04d823b7c3891d78ca5f6a188ccd0e4fc5e3d?x=x&amp;version=2"></a><div class="content"><a class="author">TheMatten</a><div class="metadata"><a href="#212979548" name="212979548"><div>2020-10-11 20:06:54</div></a></div><div class="text"><p>In Haskell you can do stuff like building doubly linked lists or lazily streaming files - trying to do the same thing with <code>Lazy</code> in PS would result in infinite recursion and duplicated reading on parallel access respectively</p></div></div></div><div class="comment"><a class="avatar"><img src="https://www.gravatar.com/avatar/3cea5dd94abba9982d34d28eef71efc0"></a><div class="content"><a class="author">Mason Mackaman</a><div class="metadata"><a href="#212980752" name="212980752"><div>2020-10-11 20:38:52</div></a></div><div class="text"><p>Alright so I realized I could just look at the compiled JS and decided to do that since I wasn't getting it. First off, I think the <code>g &lt;&lt;&lt; h</code> example actually was the exact same in both cases (as far as what gets computed when), but I found another simple example where it's not</p>
<div class="codehilite" data-code-language="Haskell"><pre><span></span><code><span class="nf">f</span> <span class="ow">::</span> <span class="kt">Int</span> <span class="ow">-&gt;</span> <span class="kt">Int</span>
<span class="nf">f</span> <span class="ow">=</span> <span class="kr">let</span> <span class="n">x</span> <span class="ow">=</span> <span class="n">bigComputation</span> <span class="mi">1</span> <span class="kr">in</span> <span class="n">x</span>

<span class="nf">e'</span> <span class="ow">::</span> <span class="kt">Unit</span> <span class="ow">-&gt;</span> <span class="kt">Int</span> <span class="ow">-&gt;</span> <span class="kt">Int</span>
<span class="nf">e'</span> <span class="kr">_</span> <span class="ow">=</span> <span class="kr">let</span> <span class="n">x</span> <span class="ow">=</span> <span class="n">bigComputation</span> <span class="mi">2</span> <span class="kr">in</span> <span class="n">x</span>

<span class="nf">e</span> <span class="ow">::</span> <span class="kt">Int</span> <span class="ow">-&gt;</span> <span class="kt">Int</span>
<span class="nf">e</span> <span class="ow">=</span> <span class="n">defer</span> <span class="n">e'</span>
</code></pre></div>

<p>compiles to</p>
<div class="codehilite" data-code-language="JavaScript"><pre><span></span><code><span class="kd">var</span> <span class="nx">lazyFn</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Lazy</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">f</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">x</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">f</span><span class="p">(</span><span class="nx">Data_Unit</span><span class="p">.</span><span class="nx">unit</span><span class="p">)(</span><span class="nx">x</span><span class="p">);</span>
  <span class="p">};</span>
<span class="p">});</span>

<span class="c1">// ...</span>

<span class="kd">var</span> <span class="nx">e$prime</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">v</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">x</span> <span class="o">=</span> <span class="nx">bigComputation</span><span class="p">(</span><span class="mf">2</span><span class="p">);</span>
    <span class="k">return</span> <span class="nx">x</span><span class="p">;</span>
<span class="p">};</span>

<span class="kd">var</span> <span class="nx">e</span> <span class="o">=</span> <span class="nx">Control_Lazy</span><span class="p">.</span><span class="nx">defer</span><span class="p">(</span><span class="nx">Control_Lazy</span><span class="p">.</span><span class="nx">lazyFn</span><span class="p">)(</span><span class="nx">e$prime</span><span class="p">);</span>

<span class="kd">var</span> <span class="nx">f</span> <span class="o">=</span> <span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">x</span> <span class="o">=</span> <span class="nx">bigComputation</span><span class="p">(</span><span class="mf">1</span><span class="p">);</span>
    <span class="k">return</span> <span class="nx">x</span><span class="p">;</span>
<span class="p">})();</span>
</code></pre></div>

<p>If you look at <code>f</code> you can see what I meant by "once" (my intuition happened to be correct), <code>bigComputation(1)</code> is only executed once (to create <code>f</code>), whereas with <code>e</code> it only gets executed when <code>e</code> is called (but it does so every time)</p></div></div></div><div class="comment"><a class="avatar"><img src="https://www.gravatar.com/avatar/3cea5dd94abba9982d34d28eef71efc0"></a><div class="content"><a class="author">Mason Mackaman</a><div class="metadata"><a href="#212981088" name="212981088"><div>2020-10-11 20:49:43</div></a></div><div class="text"><p>okay you actually don't even need to use <code>let</code> and it's even simpler. And I think <code>g &lt;&lt;&lt; h</code> just didn't work because of compiler optimization - it did <code>g(h(x))</code> instead of  using <code>compose(g)(h)</code>, which would have demonstrated the difference.</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/20a04d823b7c3891d78ca5f6a188ccd0e4fc5e3d?x=x&amp;version=2"></a><div class="content"><a class="author">TheMatten</a><div class="metadata"><a href="#212981774" name="212981774"><div>2020-10-11 21:09:36</div></a></div><div class="text"><p>Ah, I see what you meant - yeah</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/20a04d823b7c3891d78ca5f6a188ccd0e4fc5e3d?x=x&amp;version=2"></a><div class="content"><a class="author">TheMatten</a><div class="metadata"><a href="#212981852" name="212981852"><div>2020-10-11 21:10:21</div></a></div><div class="text"><p>I meant "once" as in on multiple access to same reference</p></div></div></div></div></div><div class="ui vertical footer segment"><a href="https://github.com/srid/zulip-archive">Powered by Haskell</a> | Questions? Contact <a href="https://www.srid.ca">srid</a></div></div></body></html>