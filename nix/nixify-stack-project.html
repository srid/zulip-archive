<html lang="en"><head><meta content="text/html; charset=utf-8" http-equiv="Content-Type"><meta content="width=device-width, initial-scale=1" name="viewport"><meta content="So I moved to a NixOS machine a while back and I haven&#39;t done any Haskell development in it really. But I&#39;m looking to build a Stack project and not sure how to go about things like getting the right GHC version.
Can people point me to some resources for getting up to speed with taking an existing S" name="description"><link href="https://funprog.srid.ca/nix/nixify-stack-project.html" rel="canonical"><meta property="og:title" content="Nixify Stack project - Nix"><meta property="og:site_name" content="Functional Programming Zulip Archive"><meta property="og:type" content="article"><meta property="og:article:section" content="Nix"><meta property="og:article:modified_time" content="2020-09-24T18:00:10Z"><meta property="og:article:published_time" content="2020-09-24T09:06:56Z"><title>Nixify Stack project - Nix</title><style type="text/css">
div#thesite
{
  font-family   : "Open Sans", sans-serif;
  font-size     : 1em !important;
  margin-top    : 1em;
  margin-bottom : 1em;
}

div#thesite h1
{
  font-family : "Roboto", sans-serif;
  line-height : 1.19999em;
}

div#thesite h2
{
  font-family : "Roboto", sans-serif;
  line-height : 1.19999em;
}

div#thesite h3
{
  font-family : "Roboto", sans-serif;
  line-height : 1.19999em;
}

div#thesite h4
{
  font-family : "Roboto", sans-serif;
  line-height : 1.19999em;
}

div#thesite h5
{
  font-family : "Roboto", sans-serif;
  line-height : 1.19999em;
}

div#thesite h6
{
  font-family : "Roboto", sans-serif;
  line-height : 1.19999em;
}

div#thesite .ui.breadcrumb.rib .section
{
  font-family : "Roboto", sans-serif;
  line-height : 1.19999em;
}

div#thesite .header
{
  font-family : "Roboto", sans-serif;
  line-height : 1.19999em;
}

div#thesite .as-header
{
  font-family : "Roboto", sans-serif;
  line-height : 1.19999em;
}

div#thesite code, pre, tt
{
  font-family : "SFMono-Regular","Menlo","Monaco","Consolas","Liberation Mono","Courier New", monospace;
}

div#thesite .ui.breadcrumb.rib
{
  margin-bottom : 1em;
}



div#thesite .ui.comments.messages .comment .metadata a
{
  color : #808080;
}

div#thesite .ui.comments.messages .comment a.avatar img
{
  height : auto;
}

div#thesite .subtle
{
  color : #808080;
}


div#thesite .messages pre
{
  font-size : 85%;
  overflow  : auto;
  max-width : 100%;
}

div#thesite .messages .message_embed
{
  border-left  : solid 3px #808080;
  padding-left : 0.69999em;
}

div#thesite .messages .message_inline_image img
{
  max-width     : 100%;
  margin-bottom : 1em;
}


/* Generated with Clay, http://fvisser.nl/clay */</style><link href="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.4.1/semantic.min.css" rel="stylesheet"><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.min.css" rel="stylesheet"><link href="https://fonts.googleapis.com/css?family=Open+Sans|Oswald&amp;display=swap" rel="stylesheet"><link href="https://fonts.googleapis.com/css?family=Roboto|Open+Sans&amp;display=swap" rel="stylesheet"></head><body><div id="thesite" class="ui text container"><div class="ui violet inverted top attached center aligned segment"><h1 class="ui huge header">Nixify Stack project - Nix</h1></div><div class="ui attached segment"><div class="ui message"><p>Welcome to the Functional Programming Zulip Chat Archive. You can join the chat <a href="https://funprog.zulipchat.com">here</a>.</p></div><div class="ui breadcrumb rib"><a href="/" class="section">Home</a><i class="right angle icon divider"></i><a href="/nix/" class="section">#Nix</a><i class="right angle icon divider"></i><div class="active section">Nixify Stack project</div></div><div class="ui comments messages"><div class="comment"><a class="avatar"><img src="https://www.gravatar.com/avatar/374affb4db58caa9507f265d7fdf03fe"></a><div class="content"><a class="author">Fintan Halpenny</a><div class="metadata"><a href="#211105401" name="211105401"><div>2020-09-24 09:06:56</div></a></div><div class="text"><p>So I moved to a NixOS machine a while back and I haven't done any Haskell development in it really. But I'm looking to build a Stack project and not sure how to go about things like getting the right GHC version.</p>
<p>Can people point me to some resources for getting up to speed with taking an existing Stack based project and building it using Nix? I'm also just cargo culting Nix still so I really need to get a grip on how to write derivations and all that jazz. I have a shallow understanding of how it all works :)</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/7334dc60b6aef6a75cd9284126231f13c76926a5?x=x&amp;version=4"></a><div class="content"><a class="author">Torsten Schmits</a><div class="metadata"><a href="#211105662" name="211105662"><div>2020-09-24 09:09:50</div></a></div><div class="text"><p>first of all, there's <a href="https://github.com/input-output-hk/stack2nix">stack2nix</a></p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/input-output-hk/stack2nix" style="background-image: url(https://avatars3.githubusercontent.com/u/12909177?s=400&amp;v=4)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/input-output-hk/stack2nix" title="input-output-hk/stack2nix">input-output-hk/stack2nix</a></div><div class="message_embed_description">Generate nix expressions for Haskell projects. Contribute to input-output-hk/stack2nix development by creating an account on GitHub.</div></div></div></div></div></div><div class="comment"><a class="avatar"><img src="https://www.gravatar.com/avatar/374affb4db58caa9507f265d7fdf03fe"></a><div class="content"><a class="author">Fintan Halpenny</a><div class="metadata"><a href="#211105788" name="211105788"><div>2020-09-24 09:11:11</div></a></div><div class="text"><p>Ya I tried that and it failed to do anything which wasn't inspiring. And then I got the sense it was abandoned for their haskell.nix project</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/7334dc60b6aef6a75cd9284126231f13c76926a5?x=x&amp;version=4"></a><div class="content"><a class="author">Torsten Schmits</a><div class="metadata"><a href="#211105891" name="211105891"><div>2020-09-24 09:12:13</div></a></div><div class="text"><p>right hm</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/7334dc60b6aef6a75cd9284126231f13c76926a5?x=x&amp;version=4"></a><div class="content"><a class="author">Torsten Schmits</a><div class="metadata"><a href="#211105926" name="211105926"><div>2020-09-24 09:12:49</div></a></div><div class="text"><p>so how customized is your stack config?</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/7334dc60b6aef6a75cd9284126231f13c76926a5?x=x&amp;version=4"></a><div class="content"><a class="author">Torsten Schmits</a><div class="metadata"><a href="#211105953" name="211105953"><div>2020-09-24 09:13:11</div></a></div><div class="text"><p>and what's your development workflow? ghcid?</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/7334dc60b6aef6a75cd9284126231f13c76926a5?x=x&amp;version=4"></a><div class="content"><a class="author">Torsten Schmits</a><div class="metadata"><a href="#211105967" name="211105967"><div>2020-09-24 09:13:22</div></a></div><div class="text"><p>or <code>stack build</code></p></div></div></div><div class="comment"><a class="avatar"><img src="https://www.gravatar.com/avatar/374affb4db58caa9507f265d7fdf03fe"></a><div class="content"><a class="author">Fintan Halpenny</a><div class="metadata"><a href="#211105970" name="211105970"><div>2020-09-24 09:13:24</div></a></div><div class="text"><p>It's the unison project</p></div></div></div><div class="comment"><a class="avatar"><img src="https://www.gravatar.com/avatar/374affb4db58caa9507f265d7fdf03fe"></a><div class="content"><a class="author">Fintan Halpenny</a><div class="metadata"><a href="#211105989" name="211105989"><div>2020-09-24 09:13:34</div></a></div><div class="text"><p>So I just wanna stack build to get the executable</p></div></div></div><div class="comment"><a class="avatar"><img src="https://www.gravatar.com/avatar/374affb4db58caa9507f265d7fdf03fe"></a><div class="content"><a class="author">Fintan Halpenny</a><div class="metadata"><a href="#211106012" name="211106012"><div>2020-09-24 09:13:50</div></a></div><div class="text"><p>If I learn other stuff along the way then that's a bonus <span aria-label="grinning face with smiling eyes" class="emoji emoji-1f601" role="img" title="grinning face with smiling eyes">:grinning_face_with_smiling_eyes:</span></p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/7334dc60b6aef6a75cd9284126231f13c76926a5?x=x&amp;version=4"></a><div class="content"><a class="author">Torsten Schmits</a><div class="metadata"><a href="#211106071" name="211106071"><div>2020-09-24 09:14:10</div></a></div><div class="text"><p>then you basically want to get to the point where you run <code>nix-build -A ghc.unison</code></p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/7334dc60b6aef6a75cd9284126231f13c76926a5?x=x&amp;version=4"></a><div class="content"><a class="author">Torsten Schmits</a><div class="metadata"><a href="#211106110" name="211106110"><div>2020-09-24 09:14:40</div></a></div><div class="text"><p>so your nix expression needs to choose a ghc from nixpkgs and stuff it with package overrides</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/7334dc60b6aef6a75cd9284126231f13c76926a5?x=x&amp;version=4"></a><div class="content"><a class="author">Torsten Schmits</a><div class="metadata"><a href="#211106191" name="211106191"><div>2020-09-24 09:15:34</div></a></div><div class="text"><p>you choose a ghc by saying <code>pkgs.haskell.packages.ghc884</code>, choosing the version you want</p></div></div></div><div class="comment"><a class="avatar"><img src="https://www.gravatar.com/avatar/374affb4db58caa9507f265d7fdf03fe"></a><div class="content"><a class="author">Fintan Halpenny</a><div class="metadata"><a href="#211106206" name="211106206"><div>2020-09-24 09:15:50</div></a></div><div class="text"><p>Makes sense <span aria-label="ok" class="emoji emoji-1f44c" role="img" title="ok">:ok:</span></p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/7334dc60b6aef6a75cd9284126231f13c76926a5?x=x&amp;version=4"></a><div class="content"><a class="author">Torsten Schmits</a><div class="metadata"><a href="#211106281" name="211106281"><div>2020-09-24 09:16:19</div></a></div><div class="text"><p>then you call <code>ghc.override { overrides = myOverrides; }</code></p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/7334dc60b6aef6a75cd9284126231f13c76926a5?x=x&amp;version=4"></a><div class="content"><a class="author">Torsten Schmits</a><div class="metadata"><a href="#211106380" name="211106380"><div>2020-09-24 09:17:36</div></a></div><div class="text"><p>where myOverrides has the shape <code>finalGhc: previousGhc: { conduit = finalGhc.callCabal2nix "conduit" /home/fintan/conduit; ... }</code></p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/7334dc60b6aef6a75cd9284126231f13c76926a5?x=x&amp;version=4"></a><div class="content"><a class="author">Torsten Schmits</a><div class="metadata"><a href="#211106499" name="211106499"><div>2020-09-24 09:18:46</div></a></div><div class="text"><p>where <code>finalGhc</code> and <code>previousGhc</code> are ways to say "I want to use whatever is gonna be the override at the end" and "I want to override this"</p></div></div></div><div class="comment"><a class="avatar"><img src="https://www.gravatar.com/avatar/374affb4db58caa9507f265d7fdf03fe"></a><div class="content"><a class="author">Fintan Halpenny</a><div class="metadata"><a href="#211106523" name="211106523"><div>2020-09-24 09:19:01</div></a></div><div class="text"><p>Annnd I'm lost a bit <span aria-label="sweat smile" class="emoji emoji-1f605" role="img" title="sweat smile">:sweat_smile:</span> at a high level I think this makes sense but writing the derivation is still a bit beyond me</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/7334dc60b6aef6a75cd9284126231f13c76926a5?x=x&amp;version=4"></a><div class="content"><a class="author">Torsten Schmits</a><div class="metadata"><a href="#211106550" name="211106550"><div>2020-09-24 09:19:21</div></a></div><div class="text"><p>and whatever is in that set is used as a package db</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/7334dc60b6aef6a75cd9284126231f13c76926a5?x=x&amp;version=4"></a><div class="content"><a class="author">Torsten Schmits</a><div class="metadata"><a href="#211106553" name="211106553"><div>2020-09-24 09:19:25</div></a></div><div class="text"><p><span aria-label="smile" class="emoji emoji-1f642" role="img" title="smile">:smile:</span></p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/7334dc60b6aef6a75cd9284126231f13c76926a5?x=x&amp;version=4"></a><div class="content"><a class="author">Torsten Schmits</a><div class="metadata"><a href="#211106564" name="211106564"><div>2020-09-24 09:19:37</div></a></div><div class="text"><p>so, example</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/7334dc60b6aef6a75cd9284126231f13c76926a5?x=x&amp;version=4"></a><div class="content"><a class="author">Torsten Schmits</a><div class="metadata"><a href="#211106760" name="211106760"><div>2020-09-24 09:21:32</div></a></div><div class="text"><div class="codehilite" data-code-language="Nix"><pre><span></span><code><span class="p">{}:</span>
<span class="k">let</span>
  <span class="ss">pkgs =</span> <span class="nb">import</span> <span class="l">&lt;nixpkgs&gt;</span> <span class="p">{};</span>
  <span class="ss">ghc =</span> pkgs<span class="o">.</span>haskell<span class="o">.</span>packages<span class="o">.</span>ghc884<span class="o">.</span>override <span class="p">{</span>
    <span class="ss">overrides =</span> finalGhc<span class="p">:</span> previousGhc<span class="p">:</span> <span class="p">{</span>
      <span class="ss">unison-core =</span> finalGhc<span class="o">.</span>callCabal2nix <span class="s2">"unison-core"</span> <span class="o">.</span><span class="l">/unison-core</span> <span class="p">{};</span>
   <span class="p">};</span>
<span class="p">};</span>
<span class="k">in</span> <span class="p">{</span>
  <span class="k">inherit</span> ghc<span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/7334dc60b6aef6a75cd9284126231f13c76926a5?x=x&amp;version=4"></a><div class="content"><a class="author">Torsten Schmits</a><div class="metadata"><a href="#211106912" name="211106912"><div>2020-09-24 09:23:01</div></a></div><div class="text"><p>use that as <code>default.nix</code> and run <code>nix-build -A ghc.unison-core</code></p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/7334dc60b6aef6a75cd9284126231f13c76926a5?x=x&amp;version=4"></a><div class="content"><a class="author">Torsten Schmits</a><div class="metadata"><a href="#211107167" name="211107167"><div>2020-09-24 09:25:50</div></a></div><div class="text"><p>(updated with the correct names)</p></div></div></div><div class="comment"><a class="avatar"><img src="https://www.gravatar.com/avatar/374affb4db58caa9507f265d7fdf03fe"></a><div class="content"><a class="author">Fintan Halpenny</a><div class="metadata"><a href="#211107230" name="211107230"><div>2020-09-24 09:26:15</div></a></div><div class="text"><p>Ya was realising it was under <code>unsion-core</code> <span aria-label="smile" class="emoji emoji-1f642" role="img" title="smile">:smile:</span></p></div></div></div><div class="comment"><a class="avatar"><img src="https://www.gravatar.com/avatar/374affb4db58caa9507f265d7fdf03fe"></a><div class="content"><a class="author">Fintan Halpenny</a><div class="metadata"><a href="#211107262" name="211107262"><div>2020-09-24 09:26:43</div></a></div><div class="text"><p>I'm getting a syntax error on <code>in</code> <span aria-label="thinking" class="emoji emoji-1f914" role="img" title="thinking">:thinking:</span></p></div></div></div><div class="comment"><a class="avatar"><img src="https://www.gravatar.com/avatar/374affb4db58caa9507f265d7fdf03fe"></a><div class="content"><a class="author">Fintan Halpenny</a><div class="metadata"><a href="#211107441" name="211107441"><div>2020-09-24 09:28:30</div></a></div><div class="text"><p>Ah, missed a curly</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/7334dc60b6aef6a75cd9284126231f13c76926a5?x=x&amp;version=4"></a><div class="content"><a class="author">Torsten Schmits</a><div class="metadata"><a href="#211107476" name="211107476"><div>2020-09-24 09:29:00</div></a></div><div class="text"><p>updated it so that <code>ghc</code> is actually an attribute</p></div></div></div><div class="comment"><a class="avatar"><img src="https://www.gravatar.com/avatar/374affb4db58caa9507f265d7fdf03fe"></a><div class="content"><a class="author">Fintan Halpenny</a><div class="metadata"><a href="#211107495" name="211107495"><div>2020-09-24 09:29:14</div></a></div><div class="text"><p>So, now I'm getting <code>error: attribute 'ghc884' missing, at /home/haptop/Developer/unison/default.nix:4:9</code></p></div></div></div><div class="comment"><a class="avatar"><img src="https://www.gravatar.com/avatar/374affb4db58caa9507f265d7fdf03fe"></a><div class="content"><a class="author">Fintan Halpenny</a><div class="metadata"><a href="#211107563" name="211107563"><div>2020-09-24 09:29:58</div></a></div><div class="text"><p>What does your brain say when you see this error? Like I wanna know what steps I should think about when I come across something like this</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/7334dc60b6aef6a75cd9284126231f13c76926a5?x=x&amp;version=4"></a><div class="content"><a class="author">Torsten Schmits</a><div class="metadata"><a href="#211107697" name="211107697"><div>2020-09-24 09:30:53</div></a></div><div class="text"><p>well, first thought is that I either used the wrong attribute path or that your nixpkgs doesn't have ghc 8.8.4</p></div></div></div><div class="comment"><a class="avatar"><img src="https://www.gravatar.com/avatar/374affb4db58caa9507f265d7fdf03fe"></a><div class="content"><a class="author">Fintan Halpenny</a><div class="metadata"><a href="#211107711" name="211107711"><div>2020-09-24 09:31:08</div></a></div><div class="text"><p>Also it seems like the resolver unison uses points to 8.8.3</p></div></div></div><div class="comment"><a class="avatar"><img src="https://www.gravatar.com/avatar/374affb4db58caa9507f265d7fdf03fe"></a><div class="content"><a class="author">Fintan Halpenny</a><div class="metadata"><a href="#211107763" name="211107763"><div>2020-09-24 09:31:44</div></a></div><div class="text"><p>Hmmm, but I'm _pretty_ sure I'm using 20.03</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/7334dc60b6aef6a75cd9284126231f13c76926a5?x=x&amp;version=4"></a><div class="content"><a class="author">Torsten Schmits</a><div class="metadata"><a href="#211107778" name="211107778"><div>2020-09-24 09:31:55</div></a></div><div class="text"><p>well, those are details that aren't necessary to get the derivation working but you can just use 883</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/7334dc60b6aef6a75cd9284126231f13c76926a5?x=x&amp;version=4"></a><div class="content"><a class="author">Torsten Schmits</a><div class="metadata"><a href="#211107913" name="211107913"><div>2020-09-24 09:33:11</div></a></div><div class="text"><p>so change it to 883 and then try, for example, <code>nix-build -A ghc.aeson</code></p></div></div></div><div class="comment"><a class="avatar"><img src="https://www.gravatar.com/avatar/374affb4db58caa9507f265d7fdf03fe"></a><div class="content"><a class="author">Fintan Halpenny</a><div class="metadata"><a href="#211107921" name="211107921"><div>2020-09-24 09:33:15</div></a></div><div class="text"><p>Which details aren't necessary?</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/7334dc60b6aef6a75cd9284126231f13c76926a5?x=x&amp;version=4"></a><div class="content"><a class="author">Torsten Schmits</a><div class="metadata"><a href="#211107929" name="211107929"><div>2020-09-24 09:33:21</div></a></div><div class="text"><p>then if it works, just <code>ctrl-c</code></p></div></div></div><div class="comment"><a class="avatar"><img src="https://www.gravatar.com/avatar/374affb4db58caa9507f265d7fdf03fe"></a><div class="content"><a class="author">Fintan Halpenny</a><div class="metadata"><a href="#211107951" name="211107951"><div>2020-09-24 09:33:36</div></a></div><div class="text"><p>It does not <span aria-label="grimacing" class="emoji emoji-1f62c" role="img" title="grimacing">:grimacing:</span></p></div></div></div><div class="comment"><a class="avatar"><img src="https://www.gravatar.com/avatar/374affb4db58caa9507f265d7fdf03fe"></a><div class="content"><a class="author">Fintan Halpenny</a><div class="metadata"><a href="#211107962" name="211107962"><div>2020-09-24 09:33:49</div></a></div><div class="text"><p>Still missing the attribute</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/7334dc60b6aef6a75cd9284126231f13c76926a5?x=x&amp;version=4"></a><div class="content"><a class="author">Torsten Schmits</a><div class="metadata"><a href="#211107968" name="211107968"><div>2020-09-24 09:33:53</div></a></div><div class="text"><p>which compiler version to use. we just want to get the nix expression right, not build successfully <span aria-label="smile" class="emoji emoji-1f642" role="img" title="smile">:smile:</span></p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/7334dc60b6aef6a75cd9284126231f13c76926a5?x=x&amp;version=4"></a><div class="content"><a class="author">Torsten Schmits</a><div class="metadata"><a href="#211108080" name="211108080"><div>2020-09-24 09:34:45</div></a></div><div class="text"><p>ok just a sec</p></div></div></div><div class="comment"><a class="avatar"><img src="https://www.gravatar.com/avatar/374affb4db58caa9507f265d7fdf03fe"></a><div class="content"><a class="author">Fintan Halpenny</a><div class="metadata"><a href="#211108162" name="211108162"><div>2020-09-24 09:35:45</div></a></div><div class="text"><p>Appreciate the help <span aria-label="bow" class="emoji emoji-1f647" role="img" title="bow">:bow:</span></p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/7334dc60b6aef6a75cd9284126231f13c76926a5?x=x&amp;version=4"></a><div class="content"><a class="author">Torsten Schmits</a><div class="metadata"><a href="#211108174" name="211108174"><div>2020-09-24 09:35:58</div></a></div><div class="text"><p>try <code>import (fetchTarball "https://github.com/NixOS/nixpkgs/archive/773ef5ae78339db744b917c2b35d28812028bd8c.tar.gz") {}</code></p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/7334dc60b6aef6a75cd9284126231f13c76926a5?x=x&amp;version=4"></a><div class="content"><a class="author">Torsten Schmits</a><div class="metadata"><a href="#211108225" name="211108225"><div>2020-09-24 09:36:07</div></a></div><div class="text"><p>my pleasure <span aria-label="smile" class="emoji emoji-1f642" role="img" title="smile">:smile:</span></p></div></div></div><div class="comment"><a class="avatar"><img src="https://www.gravatar.com/avatar/374affb4db58caa9507f265d7fdf03fe"></a><div class="content"><a class="author">Fintan Halpenny</a><div class="metadata"><a href="#211108271" name="211108271"><div>2020-09-24 09:36:42</div></a></div><div class="text"><p>Would that go before the <code>let</code>?</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/7334dc60b6aef6a75cd9284126231f13c76926a5?x=x&amp;version=4"></a><div class="content"><a class="author">Torsten Schmits</a><div class="metadata"><a href="#211108272" name="211108272"><div>2020-09-24 09:36:43</div></a></div><div class="text"><p>(instead of <code>import &lt;nixpkgs&gt;</code>)</p></div></div></div><div class="comment"><a class="avatar"><img src="https://www.gravatar.com/avatar/374affb4db58caa9507f265d7fdf03fe"></a><div class="content"><a class="author">Fintan Halpenny</a><div class="metadata"><a href="#211108360" name="211108360"><div>2020-09-24 09:37:46</div></a></div><div class="text"><p>I see</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/7334dc60b6aef6a75cd9284126231f13c76926a5?x=x&amp;version=4"></a><div class="content"><a class="author">Torsten Schmits</a><div class="metadata"><a href="#211108361" name="211108361"><div>2020-09-24 09:37:47</div></a></div><div class="text"><div class="codehilite" data-code-language="Nix"><pre><span></span><code><span class="p">{}:</span>
<span class="k">let</span>
  <span class="ss">pkgs =</span> <span class="nb">import</span> <span class="p">(</span>fetchTarball <span class="s2">"https://github.com/NixOS/nixpkgs/archive/773ef5ae78339db744b917c2b35d28812028bd8c.tar.gz"</span><span class="p">)</span> <span class="p">{};</span>
  <span class="ss">ghc =</span> pkgs<span class="o">.</span>haskell<span class="o">.</span>packages<span class="o">.</span>ghc884<span class="o">.</span>override <span class="p">{</span>
    <span class="ss">overrides =</span> finalGhc<span class="p">:</span> previousGhc<span class="p">:</span> <span class="p">{</span>
      <span class="ss">unison-core =</span> finalGhc<span class="o">.</span>callCabal2nix <span class="s2">"unison-core"</span> <span class="o">.</span><span class="l">/unison-core</span> <span class="p">{};</span>
   <span class="p">};</span>
<span class="p">};</span>
<span class="k">in</span> <span class="p">{</span>
  <span class="k">inherit</span> ghc<span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div></div></div><div class="comment"><a class="avatar"><img src="https://www.gravatar.com/avatar/374affb4db58caa9507f265d7fdf03fe"></a><div class="content"><a class="author">Fintan Halpenny</a><div class="metadata"><a href="#211108428" name="211108428"><div>2020-09-24 09:38:07</div></a></div><div class="text"><p>So we're just pinning the packages to that archive entry?</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/7334dc60b6aef6a75cd9284126231f13c76926a5?x=x&amp;version=4"></a><div class="content"><a class="author">Torsten Schmits</a><div class="metadata"><a href="#211108453" name="211108453"><div>2020-09-24 09:38:28</div></a></div><div class="text"><p>yeah just to be sure nothing in your env is overriding</p></div></div></div><div class="comment"><a class="avatar"><img src="https://www.gravatar.com/avatar/374affb4db58caa9507f265d7fdf03fe"></a><div class="content"><a class="author">Fintan Halpenny</a><div class="metadata"><a href="#211108473" name="211108473"><div>2020-09-24 09:38:47</div></a></div><div class="text"><p>Seems to be working</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/7334dc60b6aef6a75cd9284126231f13c76926a5?x=x&amp;version=4"></a><div class="content"><a class="author">Torsten Schmits</a><div class="metadata"><a href="#211108483" name="211108483"><div>2020-09-24 09:38:53</div></a></div><div class="text"><p>awesome!</p></div></div></div><div class="comment"><a class="avatar"><img src="https://www.gravatar.com/avatar/374affb4db58caa9507f265d7fdf03fe"></a><div class="content"><a class="author">Fintan Halpenny</a><div class="metadata"><a href="#211108491" name="211108491"><div>2020-09-24 09:39:03</div></a></div><div class="text"><p>There's compiling Haskell at least <span aria-label="sweat smile" class="emoji emoji-1f605" role="img" title="sweat smile">:sweat_smile:</span></p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/7334dc60b6aef6a75cd9284126231f13c76926a5?x=x&amp;version=4"></a><div class="content"><a class="author">Torsten Schmits</a><div class="metadata"><a href="#211108528" name="211108528"><div>2020-09-24 09:39:27</div></a></div><div class="text"><p>then you can start trying <code>nix-build -A ghc.unison-core</code></p></div></div></div><div class="comment"><a class="avatar"><img src="https://www.gravatar.com/avatar/374affb4db58caa9507f265d7fdf03fe"></a><div class="content"><a class="author">Fintan Halpenny</a><div class="metadata"><a href="#211108554" name="211108554"><div>2020-09-24 09:39:47</div></a></div><div class="text"><p>That's what I've ran :)</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/7334dc60b6aef6a75cd9284126231f13c76926a5?x=x&amp;version=4"></a><div class="content"><a class="author">Torsten Schmits</a><div class="metadata"><a href="#211108715" name="211108715"><div>2020-09-24 09:41:39</div></a></div><div class="text"><p>now the stack dep overrides. you'll want to add an attribute for each to your ghc, just like <code>unison-core</code>. then there's multiple variants for adding packages:</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/7334dc60b6aef6a75cd9284126231f13c76926a5?x=x&amp;version=4"></a><div class="content"><a class="author">Torsten Schmits</a><div class="metadata"><a href="#211108885" name="211108885"><div>2020-09-24 09:43:21</div></a></div><div class="text"><div class="codehilite" data-code-language="Nix"><pre><span></span><code><span class="ss">strings =</span> finalGhc<span class="o">.</span>callHackage <span class="s2">"strings"</span> <span class="s2">"1.1"</span> <span class="p">{};</span>
</code></pre></div>

<p>this is the simplest, and requires that this version is in the curated set in nixpkgs</p></div></div></div><div class="comment"><a class="avatar"><img src="https://www.gravatar.com/avatar/374affb4db58caa9507f265d7fdf03fe"></a><div class="content"><a class="author">Fintan Halpenny</a><div class="metadata"><a href="#211109031" name="211109031"><div>2020-09-24 09:44:46</div></a></div><div class="text"><p>So I should stop the build?</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/7334dc60b6aef6a75cd9284126231f13c76926a5?x=x&amp;version=4"></a><div class="content"><a class="author">Torsten Schmits</a><div class="metadata"><a href="#211109071" name="211109071"><div>2020-09-24 09:45:06</div></a></div><div class="text"><p>if not, you'll need <code>callHackageDirect { pkg = "strings"; ver = "1.1"; sha256 = "asdkfjasdkfj"; }</code> where you'll have to either put a <em>wrong</em> sha in there and wait for nix to tell you the right one (<em>do not</em> use the sha of another package, it will use that then) or use <code>nix-prefetch-url</code> with the hackage url</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/7334dc60b6aef6a75cd9284126231f13c76926a5?x=x&amp;version=4"></a><div class="content"><a class="author">Torsten Schmits</a><div class="metadata"><a href="#211109108" name="211109108"><div>2020-09-24 09:45:37</div></a></div><div class="text"><p>well you can run it till you get an error if you like and hack on the file in the meantime <span aria-label="smile" class="emoji emoji-1f642" role="img" title="smile">:smile:</span></p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/7334dc60b6aef6a75cd9284126231f13c76926a5?x=x&amp;version=4"></a><div class="content"><a class="author">Torsten Schmits</a><div class="metadata"><a href="#211109134" name="211109134"><div>2020-09-24 09:45:59</div></a></div><div class="text"><p>but if there's a late version conflict of a very general package, all of its deps will be rebuilt</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/7334dc60b6aef6a75cd9284126231f13c76926a5?x=x&amp;version=4"></a><div class="content"><a class="author">Torsten Schmits</a><div class="metadata"><a href="#211109221" name="211109221"><div>2020-09-24 09:46:51</div></a></div><div class="text"><p>and the last one would be github deps</p></div></div></div><div class="comment"><a class="avatar"><img src="https://www.gravatar.com/avatar/374affb4db58caa9507f265d7fdf03fe"></a><div class="content"><a class="author">Fintan Halpenny</a><div class="metadata"><a href="#211109244" name="211109244"><div>2020-09-24 09:47:10</div></a></div><div class="text"><p>Ahhh fair enough</p></div></div></div><div class="comment"><a class="avatar"><img src="https://www.gravatar.com/avatar/374affb4db58caa9507f265d7fdf03fe"></a><div class="content"><a class="author">Fintan Halpenny</a><div class="metadata"><a href="#211109277" name="211109277"><div>2020-09-24 09:47:35</div></a></div><div class="text"><p>So, these entries go into the override set?</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/7334dc60b6aef6a75cd9284126231f13c76926a5?x=x&amp;version=4"></a><div class="content"><a class="author">Torsten Schmits</a><div class="metadata"><a href="#211109376" name="211109376"><div>2020-09-24 09:48:21</div></a></div><div class="text"><div class="codehilite" data-code-language="Nix"><pre><span></span><code><span class="ss">configurator =</span> finalGhc<span class="o">.</span>callCabal2nix <span class="s2">"configurator"</span> <span class="p">(</span>pkgs<span class="o">.</span>fetchFromGithub <span class="p">{</span> <span class="ss">repo =</span> <span class="s2">"unisonweb/configurator"</span><span class="p">;</span> <span class="o">..</span> <span class="p">};</span>
</code></pre></div></div></div></div><div class="comment"><a class="avatar"><img src="https://www.gravatar.com/avatar/374affb4db58caa9507f265d7fdf03fe"></a><div class="content"><a class="author">Fintan Halpenny</a><div class="metadata"><a href="#211109391" name="211109391"><div>2020-09-24 09:48:29</div></a></div><div class="text"><p>Where did you find strings from? <span aria-label="thinking" class="emoji emoji-1f914" role="img" title="thinking">:thinking:</span></p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/7334dc60b6aef6a75cd9284126231f13c76926a5?x=x&amp;version=4"></a><div class="content"><a class="author">Torsten Schmits</a><div class="metadata"><a href="#211109399" name="211109399"><div>2020-09-24 09:48:34</div></a></div><div class="text"><p>exactly, as attributes just like <code>unison-core</code></p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/7334dc60b6aef6a75cd9284126231f13c76926a5?x=x&amp;version=4"></a><div class="content"><a class="author">Torsten Schmits</a><div class="metadata"><a href="#211109403" name="211109403"><div>2020-09-24 09:48:39</div></a></div><div class="text"><p>from <code>stack.yaml</code></p></div></div></div><div class="comment"><a class="avatar"><img src="https://www.gravatar.com/avatar/374affb4db58caa9507f265d7fdf03fe"></a><div class="content"><a class="author">Fintan Halpenny</a><div class="metadata"><a href="#211109415" name="211109415"><div>2020-09-24 09:48:43</div></a></div><div class="text"><p>Oh in the extra deps</p></div></div></div><div class="comment"><a class="avatar"><img src="https://www.gravatar.com/avatar/374affb4db58caa9507f265d7fdf03fe"></a><div class="content"><a class="author">Fintan Halpenny</a><div class="metadata"><a href="#211109581" name="211109581"><div>2020-09-24 09:50:39</div></a></div><div class="text"><p>Ok, I'll have to come back to this later. I should do some work-work <span aria-label="joy" class="emoji emoji-1f602" role="img" title="joy">:joy:</span> Thanks for getting me going on this <span class="user-mention" data-user-id="260881">@Torsten Schmits</span> <span aria-label="heart" class="emoji emoji-2764" role="img" title="heart">:heart:</span></p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/7334dc60b6aef6a75cd9284126231f13c76926a5?x=x&amp;version=4"></a><div class="content"><a class="author">Torsten Schmits</a><div class="metadata"><a href="#211109695" name="211109695"><div>2020-09-24 09:51:51</div></a></div><div class="text"><p>happy to help <span aria-label="upside down" class="emoji emoji-1f643" role="img" title="upside down">:upside_down:</span></p></div></div></div><div class="comment"><a class="avatar"><img src="https://www.gravatar.com/avatar/33ed1f4a88793f2221d759610e2e8ddb"></a><div class="content"><a class="author">codygman</a><div class="metadata"><a href="#211156539" name="211156539"><div>2020-09-24 16:31:23</div></a></div><div class="text"><p>I use haskell.nix for this, but it has some annoyances</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/7334dc60b6aef6a75cd9284126231f13c76926a5?x=x&amp;version=4"></a><div class="content"><a class="author">Torsten Schmits</a><div class="metadata"><a href="#211156577" name="211156577"><div>2020-09-24 16:31:43</div></a></div><div class="text"><p><span class="user-mention silent" data-user-id="325194">codygman</span> <a href="#narrow/stream/214966-Nix/topic/Nixify.20Stack.20project/near/211156539">said</a>:</p>
<blockquote>
<p>I use haskell.nix for this, but it has some annoyances</p>
</blockquote>
<p>what are those?</p></div></div></div><div class="comment"><a class="avatar"><img src="https://www.gravatar.com/avatar/33ed1f4a88793f2221d759610e2e8ddb"></a><div class="content"><a class="author">codygman</a><div class="metadata"><a href="#211157692" name="211157692"><div>2020-09-24 16:40:19</div></a></div><div class="text"><p>If you want to use stack inside of a nix shell that uses Nix installed packages you have to do this and it's brittle when packages changed because stack will try to install them:</p>
<p><a href="https://github.com/codygman/haskell-nix-stack-workflow/tree/e66a50e2be2706724174b2e7d3c5e4a884f42179">https://github.com/codygman/haskell-nix-stack-workflow/tree/e66a50e2be2706724174b2e7d3c5e4a884f42179</a></p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/codygman/haskell-nix-stack-workflow/tree/e66a50e2be2706724174b2e7d3c5e4a884f42179" style="background-image: url(https://avatars2.githubusercontent.com/u/225847?s=400&amp;v=4)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/codygman/haskell-nix-stack-workflow/tree/e66a50e2be2706724174b2e7d3c5e4a884f42179" title="codygman/haskell-nix-stack-workflow">codygman/haskell-nix-stack-workflow</a></div><div class="message_embed_description">Contribute to codygman/haskell-nix-stack-workflow development by creating an account on GitHub.</div></div></div></div></div></div><div class="comment"><a class="avatar"><img src="https://www.gravatar.com/avatar/33ed1f4a88793f2221d759610e2e8ddb"></a><div class="content"><a class="author">codygman</a><div class="metadata"><a href="#211157762" name="211157762"><div>2020-09-24 16:41:03</div></a></div><div class="text"><p>Err you probably want master instead of that tree if you try it. Related discussion: <a href="https://github.com/input-output-hk/haskell.nix/issues/689#issuecomment-683658719">https://github.com/input-output-hk/haskell.nix/issues/689#issuecomment-683658719</a></p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/input-output-hk/haskell.nix/issues/689#issuecomment-683658719" style="background-image: url(https://avatars3.githubusercontent.com/u/12909177?s=400&amp;v=4)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/input-output-hk/haskell.nix/issues/689#issuecomment-683658719" title="Improve stack workflow/UX with haskell.nix 路 Issue #689 路 input-output-hk/haskell.nix">Improve stack workflow/UX with haskell.nix 路 Issue #689 路 input-output-hk/haskell.nix</a></div><div class="message_embed_description">update the docs with a minimal copy-pastable example for stack (moving extra stuff to &quot;appendix&quot; or something) figure out if we want to work with stack to disable their nix support when i...</div></div></div></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/7334dc60b6aef6a75cd9284126231f13c76926a5?x=x&amp;version=4"></a><div class="content"><a class="author">Torsten Schmits</a><div class="metadata"><a href="#211157923" name="211157923"><div>2020-09-24 16:42:22</div></a></div><div class="text"><p>why stack inside of nix-shell? we were replacing stack here</p></div></div></div><div class="comment"><a class="avatar"><img src="https://www.gravatar.com/avatar/33ed1f4a88793f2221d759610e2e8ddb"></a><div class="content"><a class="author">codygman</a><div class="metadata"><a href="#211159352" name="211159352"><div>2020-09-24 16:53:14</div></a></div><div class="text"><p>Oh, my mistake. Here I wanted to use stack as a dumb frontend but have nix do the real work. If you think stacks UX is nicer to use or your team does, this is nice. </p>
<p>Why not use stack --nix? To avoid specifying dependencies anywhere but default.nix and package.yaml, work with direnv, and probably other things I forgot.</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/7334dc60b6aef6a75cd9284126231f13c76926a5?x=x&amp;version=4"></a><div class="content"><a class="author">Torsten Schmits</a><div class="metadata"><a href="#211159591" name="211159591"><div>2020-09-24 16:54:55</div></a></div><div class="text"><p>interesting proposition!</p></div></div></div><div class="comment"><a class="avatar"><img src="https://www.gravatar.com/avatar/33ed1f4a88793f2221d759610e2e8ddb"></a><div class="content"><a class="author">codygman</a><div class="metadata"><a href="#211159710" name="211159710"><div>2020-09-24 16:55:58</div></a></div><div class="text"><p>I've been challenging that proposition by using stack --nix more as of late though. I'm undecided which approach I think is better.</p></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/7334dc60b6aef6a75cd9284126231f13c76926a5?x=x&amp;version=4"></a><div class="content"><a class="author">Torsten Schmits</a><div class="metadata"><a href="#211165541" name="211165541"><div>2020-09-24 17:42:10</div></a></div><div class="text"><p>do you have a list of features that have significantly better UX in stack?</p></div></div></div><div class="comment"><a class="avatar"><img src="https://www.gravatar.com/avatar/33ed1f4a88793f2221d759610e2e8ddb"></a><div class="content"><a class="author">codygman</a><div class="metadata"><a href="#211167749" name="211167749"><div>2020-09-24 17:58:12</div></a></div><div class="text"><p>I moved over to cabal by default recently to rediscover those and challenge that view, so not yet.</p>
<p>However these come to mind:</p>
<ul>
<li>stack build --profile</li>
<li>stack build --fast</li>
<li>hpack maybe but yaml dangerous</li>
<li>stack new (I think this might not be true anymore?)</li>
<li>stack ghci loading everything by default.. or for some reason cabal doesn't have everything I expect</li>
</ul></div></div></div><div class="comment"><a class="avatar"><img src="https://zulip-avatars.s3.amazonaws.com/13896/7334dc60b6aef6a75cd9284126231f13c76926a5?x=x&amp;version=4"></a><div class="content"><a class="author">Torsten Schmits</a><div class="metadata"><a href="#211168037" name="211168037"><div>2020-09-24 18:00:10</div></a></div><div class="text"><p>and <code>haskell.nix</code> doesn't offer adequate replacements?</p></div></div></div></div></div><div class="ui vertical footer segment"><a href="https://github.com/srid/zulip-archive">Powered by Haskell</a> | Questions? Contact <a href="https://www.srid.ca">srid</a></div></div></body></html>